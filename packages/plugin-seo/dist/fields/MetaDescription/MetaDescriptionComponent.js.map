{"version":3,"sources":["../../../src/fields/MetaDescription/MetaDescriptionComponent.tsx"],"sourcesContent":["'use client'\n\nimport type { FieldType } from '@payloadcms/ui'\nimport type { TextareaFieldClientProps } from 'payload'\n\nimport {\n  FieldLabel,\n  TextareaInput,\n  useConfig,\n  useDocumentInfo,\n  useDocumentTitle,\n  useField,\n  useForm,\n  useLocale,\n  useTranslation,\n} from '@payloadcms/ui'\nimport { reduceToSerializableFields } from '@payloadcms/ui/shared'\nimport { formatAdminURL } from 'payload/shared'\nimport React, { useCallback } from 'react'\n\nimport type { PluginSEOTranslationKeys, PluginSEOTranslations } from '../../translations/index.js'\nimport type { GenerateDescription } from '../../types.js'\n\nimport { defaults } from '../../defaults.js'\nimport { LengthIndicator } from '../../ui/LengthIndicator.js'\n\nconst { maxLength: maxLengthDefault, minLength: minLengthDefault } = defaults.description\n\ntype MetaDescriptionProps = {\n  readonly hasGenerateDescriptionFn: boolean\n} & TextareaFieldClientProps\n\nexport const MetaDescriptionComponent: React.FC<MetaDescriptionProps> = (props) => {\n  const {\n    field: {\n      label,\n      localized,\n      maxLength: maxLengthFromProps,\n      minLength: minLengthFromProps,\n      required,\n    },\n    hasGenerateDescriptionFn,\n    readOnly,\n  } = props\n\n  const {\n    config: {\n      routes: { api },\n    },\n  } = useConfig()\n\n  const { t } = useTranslation<PluginSEOTranslations, PluginSEOTranslationKeys>()\n\n  const locale = useLocale()\n  const { getData } = useForm()\n  const docInfo = useDocumentInfo()\n  const { title } = useDocumentTitle()\n\n  const maxLength = maxLengthFromProps || maxLengthDefault\n  const minLength = minLengthFromProps || minLengthDefault\n\n  const {\n    customComponents: { AfterInput, BeforeInput, Label } = {},\n    errorMessage,\n    path,\n    setValue,\n    showError,\n    value,\n  }: FieldType<string> = useField()\n\n  const regenerateDescription = useCallback(async () => {\n    if (!hasGenerateDescriptionFn) {\n      return\n    }\n\n    const endpoint = formatAdminURL({\n      apiRoute: api,\n      path: '/plugin-seo/generate-description',\n    })\n\n    const genDescriptionResponse = await fetch(endpoint, {\n      body: JSON.stringify({\n        id: docInfo.id,\n        collectionSlug: docInfo.collectionSlug,\n        doc: getData(),\n        docPermissions: docInfo.docPermissions,\n        globalSlug: docInfo.globalSlug,\n        hasPublishPermission: docInfo.hasPublishPermission,\n        hasSavePermission: docInfo.hasSavePermission,\n        initialData: docInfo.initialData,\n        initialState: reduceToSerializableFields(docInfo.initialState ?? {}),\n        locale: typeof locale === 'object' ? locale?.code : locale,\n        title,\n      } satisfies Omit<\n        Parameters<GenerateDescription>[0],\n        'collectionConfig' | 'globalConfig' | 'hasPublishedDoc' | 'req' | 'versionCount'\n      >),\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      method: 'POST',\n    })\n\n    const { result: generatedDescription } = await genDescriptionResponse.json()\n\n    setValue(generatedDescription || '')\n  }, [\n    hasGenerateDescriptionFn,\n\n    api,\n    docInfo.id,\n    docInfo.collectionSlug,\n    docInfo.docPermissions,\n    docInfo.globalSlug,\n    docInfo.hasPublishPermission,\n    docInfo.hasSavePermission,\n    docInfo.initialData,\n    docInfo.initialState,\n    getData,\n    locale,\n    setValue,\n    title,\n  ])\n\n  return (\n    <div\n      style={{\n        marginBottom: '20px',\n      }}\n    >\n      <div\n        style={{\n          marginBottom: '5px',\n          position: 'relative',\n        }}\n      >\n        <div className=\"plugin-seo__field\">\n          {Label ?? (\n            <FieldLabel label={label} localized={localized} path={path} required={required} />\n          )}\n          {hasGenerateDescriptionFn && (\n            <React.Fragment>\n              &nbsp; &mdash; &nbsp;\n              <button\n                disabled={readOnly}\n                onClick={() => {\n                  void regenerateDescription()\n                }}\n                style={{\n                  background: 'none',\n                  backgroundColor: 'transparent',\n                  border: 'none',\n                  color: 'currentcolor',\n                  cursor: 'pointer',\n                  padding: 0,\n                  textDecoration: 'underline',\n                }}\n                type=\"button\"\n              >\n                {t('plugin-seo:autoGenerate')}\n              </button>\n            </React.Fragment>\n          )}\n        </div>\n        <div\n          style={{\n            color: '#9A9A9A',\n          }}\n        >\n          {t('plugin-seo:lengthTipDescription', { maxLength, minLength })}\n          <a\n            href=\"https://developers.google.com/search/docs/advanced/appearance/snippet#meta-descriptions\"\n            rel=\"noopener noreferrer\"\n            target=\"_blank\"\n          >\n            {t('plugin-seo:bestPractices')}\n          </a>\n        </div>\n      </div>\n      <div\n        style={{\n          marginBottom: '10px',\n          position: 'relative',\n        }}\n      >\n        <TextareaInput\n          AfterInput={AfterInput}\n          BeforeInput={BeforeInput}\n          Error={errorMessage}\n          onChange={setValue}\n          path={path}\n          readOnly={readOnly}\n          required={required}\n          showError={showError}\n          style={{\n            marginBottom: 0,\n          }}\n          value={value}\n        />\n      </div>\n      <div\n        style={{\n          alignItems: 'center',\n          display: 'flex',\n          width: '100%',\n        }}\n      >\n        <LengthIndicator maxLength={maxLength} minLength={minLength} text={value} />\n      </div>\n    </div>\n  )\n}\n"],"names":["FieldLabel","TextareaInput","useConfig","useDocumentInfo","useDocumentTitle","useField","useForm","useLocale","useTranslation","reduceToSerializableFields","formatAdminURL","React","useCallback","defaults","LengthIndicator","maxLength","maxLengthDefault","minLength","minLengthDefault","description","MetaDescriptionComponent","props","field","label","localized","maxLengthFromProps","minLengthFromProps","required","hasGenerateDescriptionFn","readOnly","config","routes","api","t","locale","getData","docInfo","title","customComponents","AfterInput","BeforeInput","Label","errorMessage","path","setValue","showError","value","regenerateDescription","endpoint","apiRoute","genDescriptionResponse","fetch","body","JSON","stringify","id","collectionSlug","doc","docPermissions","globalSlug","hasPublishPermission","hasSavePermission","initialData","initialState","code","credentials","headers","method","result","generatedDescription","json","div","style","marginBottom","position","className","Fragment","button","disabled","onClick","background","backgroundColor","border","color","cursor","padding","textDecoration","type","a","href","rel","target","Error","onChange","alignItems","display","width","text"],"mappings":"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"}