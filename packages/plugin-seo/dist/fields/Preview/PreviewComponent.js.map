{"version":3,"sources":["../../../src/fields/Preview/PreviewComponent.tsx"],"sourcesContent":["'use client'\n\nimport type { FormField, UIField } from 'payload'\n\nimport {\n  useAllFormFields,\n  useConfig,\n  useDocumentInfo,\n  useDocumentTitle,\n  useForm,\n  useLocale,\n  useTranslation,\n} from '@payloadcms/ui'\nimport { reduceToSerializableFields } from '@payloadcms/ui/shared'\nimport { formatAdminURL } from 'payload/shared'\nimport React, { useEffect, useState } from 'react'\n\nimport type { PluginSEOTranslationKeys, PluginSEOTranslations } from '../../translations/index.js'\nimport type { GenerateURL } from '../../types.js'\n\ntype PreviewProps = {\n  readonly descriptionPath?: string\n  readonly hasGenerateURLFn: boolean\n  readonly titlePath?: string\n} & UIField\n\nexport const PreviewComponent: React.FC<PreviewProps> = (props) => {\n  const {\n    descriptionPath: descriptionPathFromContext,\n    hasGenerateURLFn,\n    titlePath: titlePathFromContext,\n  } = props\n\n  const { t } = useTranslation<PluginSEOTranslations, PluginSEOTranslationKeys>()\n\n  const {\n    config: {\n      routes: { api },\n    },\n  } = useConfig()\n\n  const locale = useLocale()\n  const [fields] = useAllFormFields()\n  const { getData } = useForm()\n  const docInfo = useDocumentInfo()\n  const { title } = useDocumentTitle()\n\n  const descriptionPath = descriptionPathFromContext || 'meta.description'\n  const titlePath = titlePathFromContext || 'meta.title'\n\n  const {\n    [descriptionPath]: { value: metaDescription } = {} as FormField,\n    [titlePath]: { value: metaTitle } = {} as FormField,\n  } = fields\n\n  const [href, setHref] = useState<string>()\n\n  useEffect(() => {\n    const endpoint = formatAdminURL({\n      apiRoute: api,\n      path: '/plugin-seo/generate-url',\n    })\n\n    const getHref = async () => {\n      const genURLResponse = await fetch(endpoint, {\n        body: JSON.stringify({\n          id: docInfo.id,\n          collectionSlug: docInfo.collectionSlug,\n          doc: getData(),\n          docPermissions: docInfo.docPermissions,\n          globalSlug: docInfo.globalSlug,\n          hasPublishPermission: docInfo.hasPublishPermission,\n          hasSavePermission: docInfo.hasSavePermission,\n          initialData: docInfo.initialData,\n          initialState: reduceToSerializableFields(docInfo.initialState ?? {}),\n          locale: typeof locale === 'object' ? locale?.code : locale,\n          title,\n        } satisfies Omit<\n          Parameters<GenerateURL>[0],\n          'collectionConfig' | 'globalConfig' | 'hasPublishedDoc' | 'req' | 'versionCount'\n        >),\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        method: 'POST',\n      })\n\n      const { result: newHref } = await genURLResponse.json()\n\n      setHref(newHref)\n    }\n\n    if (hasGenerateURLFn && !href) {\n      void getHref()\n    }\n  }, [fields, href, locale, docInfo, hasGenerateURLFn, getData, api, title])\n\n  return (\n    <div\n      style={{\n        marginBottom: '20px',\n      }}\n    >\n      <div>{t('plugin-seo:preview')}</div>\n      <div\n        style={{\n          color: '#9A9A9A',\n          marginBottom: '5px',\n        }}\n      >\n        {t('plugin-seo:previewDescription')}\n      </div>\n      <div\n        style={{\n          background: 'var(--theme-elevation-50)',\n          borderRadius: '5px',\n          boxShadow: '0px 0px 10px rgba(0, 0, 0, 0.1)',\n          maxWidth: '600px',\n          padding: '20px',\n          pointerEvents: 'none',\n          width: '100%',\n        }}\n      >\n        <div>\n          <a\n            href={href}\n            style={{\n              textDecoration: 'none',\n            }}\n          >\n            {href || 'https://...'}\n          </a>\n        </div>\n        <h4\n          style={{\n            margin: 0,\n          }}\n        >\n          <a\n            href=\"/\"\n            style={{\n              textDecoration: 'none',\n            }}\n          >\n            {metaTitle as string}\n          </a>\n        </h4>\n        <p\n          style={{\n            margin: 0,\n          }}\n        >\n          {metaDescription as string}\n        </p>\n      </div>\n    </div>\n  )\n}\n"],"names":["useAllFormFields","useConfig","useDocumentInfo","useDocumentTitle","useForm","useLocale","useTranslation","reduceToSerializableFields","formatAdminURL","React","useEffect","useState","PreviewComponent","props","descriptionPath","descriptionPathFromContext","hasGenerateURLFn","titlePath","titlePathFromContext","t","config","routes","api","locale","fields","getData","docInfo","title","value","metaDescription","metaTitle","href","setHref","endpoint","apiRoute","path","getHref","genURLResponse","fetch","body","JSON","stringify","id","collectionSlug","doc","docPermissions","globalSlug","hasPublishPermission","hasSavePermission","initialData","initialState","code","credentials","headers","method","result","newHref","json","div","style","marginBottom","color","background","borderRadius","boxShadow","maxWidth","padding","pointerEvents","width","a","textDecoration","h4","margin","p"],"mappings":"AAAA;;AAIA,SACEA,gBAAgB,EAChBC,SAAS,EACTC,eAAe,EACfC,gBAAgB,EAChBC,OAAO,EACPC,SAAS,EACTC,cAAc,QACT,iBAAgB;AACvB,SAASC,0BAA0B,QAAQ,wBAAuB;AAClE,SAASC,cAAc,QAAQ,iBAAgB;AAC/C,OAAOC,SAASC,SAAS,EAAEC,QAAQ,QAAQ,QAAO;AAWlD,OAAO,MAAMC,mBAA2C,CAACC;IACvD,MAAM,EACJC,iBAAiBC,0BAA0B,EAC3CC,gBAAgB,EAChBC,WAAWC,oBAAoB,EAChC,GAAGL;IAEJ,MAAM,EAAEM,CAAC,EAAE,GAAGb;IAEd,MAAM,EACJc,QAAQ,EACNC,QAAQ,EAAEC,GAAG,EAAE,EAChB,EACF,GAAGrB;IAEJ,MAAMsB,SAASlB;IACf,MAAM,CAACmB,OAAO,GAAGxB;IACjB,MAAM,EAAEyB,OAAO,EAAE,GAAGrB;IACpB,MAAMsB,UAAUxB;IAChB,MAAM,EAAEyB,KAAK,EAAE,GAAGxB;IAElB,MAAMW,kBAAkBC,8BAA8B;IACtD,MAAME,YAAYC,wBAAwB;IAE1C,MAAM,EACJ,CAACJ,gBAAgB,EAAE,EAAEc,OAAOC,eAAe,EAAE,GAAG,CAAC,CAAc,EAC/D,CAACZ,UAAU,EAAE,EAAEW,OAAOE,SAAS,EAAE,GAAG,CAAC,CAAc,EACpD,GAAGN;IAEJ,MAAM,CAACO,MAAMC,QAAQ,GAAGrB;IAExBD,UAAU;QACR,MAAMuB,WAAWzB,eAAe;YAC9B0B,UAAUZ;YACVa,MAAM;QACR;QAEA,MAAMC,UAAU;YACd,MAAMC,iBAAiB,MAAMC,MAAML,UAAU;gBAC3CM,MAAMC,KAAKC,SAAS,CAAC;oBACnBC,IAAIhB,QAAQgB,EAAE;oBACdC,gBAAgBjB,QAAQiB,cAAc;oBACtCC,KAAKnB;oBACLoB,gBAAgBnB,QAAQmB,cAAc;oBACtCC,YAAYpB,QAAQoB,UAAU;oBAC9BC,sBAAsBrB,QAAQqB,oBAAoB;oBAClDC,mBAAmBtB,QAAQsB,iBAAiB;oBAC5CC,aAAavB,QAAQuB,WAAW;oBAChCC,cAAc3C,2BAA2BmB,QAAQwB,YAAY,IAAI,CAAC;oBAClE3B,QAAQ,OAAOA,WAAW,WAAWA,QAAQ4B,OAAO5B;oBACpDI;gBACF;gBAIAyB,aAAa;gBACbC,SAAS;oBACP,gBAAgB;gBAClB;gBACAC,QAAQ;YACV;YAEA,MAAM,EAAEC,QAAQC,OAAO,EAAE,GAAG,MAAMnB,eAAeoB,IAAI;YAErDzB,QAAQwB;QACV;QAEA,IAAIxC,oBAAoB,CAACe,MAAM;YAC7B,KAAKK;QACP;IACF,GAAG;QAACZ;QAAQO;QAAMR;QAAQG;QAASV;QAAkBS;QAASH;QAAKK;KAAM;IAEzE,qBACE,MAAC+B;QACCC,OAAO;YACLC,cAAc;QAChB;;0BAEA,KAACF;0BAAKvC,EAAE;;0BACR,KAACuC;gBACCC,OAAO;oBACLE,OAAO;oBACPD,cAAc;gBAChB;0BAECzC,EAAE;;0BAEL,MAACuC;gBACCC,OAAO;oBACLG,YAAY;oBACZC,cAAc;oBACdC,WAAW;oBACXC,UAAU;oBACVC,SAAS;oBACTC,eAAe;oBACfC,OAAO;gBACT;;kCAEA,KAACV;kCACC,cAAA,KAACW;4BACCtC,MAAMA;4BACN4B,OAAO;gCACLW,gBAAgB;4BAClB;sCAECvC,QAAQ;;;kCAGb,KAACwC;wBACCZ,OAAO;4BACLa,QAAQ;wBACV;kCAEA,cAAA,KAACH;4BACCtC,MAAK;4BACL4B,OAAO;gCACLW,gBAAgB;4BAClB;sCAECxC;;;kCAGL,KAAC2C;wBACCd,OAAO;4BACLa,QAAQ;wBACV;kCAEC3C;;;;;;AAKX,EAAC"}