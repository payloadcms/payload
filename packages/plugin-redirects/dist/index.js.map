{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import type { CollectionConfig, Config, Field, SelectField } from 'payload'\n\nimport { deepMergeSimple } from 'payload/shared'\n\nimport type { RedirectsPluginConfig } from './types.js'\n\nimport { redirectOptions } from './redirectTypes.js'\nimport { translations } from './translations/index.js'\n\nexport { redirectOptions, redirectTypes } from './redirectTypes.js'\nexport { translations as redirectsTranslations } from './translations/index.js'\nexport const redirectsPlugin =\n  (pluginConfig: RedirectsPluginConfig) =>\n  (incomingConfig: Config): Config => {\n    // Merge translations FIRST (before building fields)\n    if (!incomingConfig.i18n) {\n      incomingConfig.i18n = {}\n    }\n\n    if (!incomingConfig.i18n?.translations) {\n      incomingConfig.i18n.translations = {}\n    }\n\n    incomingConfig.i18n.translations = deepMergeSimple(\n      translations,\n      incomingConfig.i18n?.translations,\n    )\n\n    const redirectSelectField: SelectField = {\n      name: 'type',\n      type: 'select',\n      // @ts-expect-error - translations are not typed in plugins yet\n      label: ({ t }) => t('plugin-redirects:redirectType'),\n      options: redirectOptions.filter((option) =>\n        pluginConfig?.redirectTypes?.includes(option.value),\n      ),\n      required: true,\n      ...((pluginConfig?.redirectTypeFieldOverride || {}) as {\n        hasMany: boolean\n      } & Partial<SelectField>),\n    }\n\n    const defaultFields: Field[] = [\n      {\n        name: 'from',\n        type: 'text',\n        index: true,\n        // @ts-expect-error - translations are not typed in plugins yet\n        label: ({ t }) => t('plugin-redirects:fromUrl'),\n        required: true,\n        unique: true,\n      },\n      {\n        name: 'to',\n        type: 'group',\n        fields: [\n          {\n            name: 'type',\n            type: 'radio',\n            admin: {\n              layout: 'horizontal',\n            },\n            defaultValue: 'reference',\n            // @ts-expect-error - translations are not typed in plugins yet\n            label: ({ t }) => t('plugin-redirects:toUrlType'),\n            options: [\n              {\n                // @ts-expect-error - translations are not typed in plugins yet\n                label: ({ t }) => t('plugin-redirects:internalLink'),\n                value: 'reference',\n              },\n              {\n                // @ts-expect-error - translations are not typed in plugins yet\n                label: ({ t }) => t('plugin-redirects:customUrl'),\n                value: 'custom',\n              },\n            ],\n          },\n          {\n            name: 'reference',\n            type: 'relationship',\n            admin: {\n              condition: (_, siblingData) => siblingData?.type === 'reference',\n            },\n            // @ts-expect-error - translations are not typed in plugins yet\n            label: ({ t }) => t('plugin-redirects:documentToRedirect'),\n            relationTo: pluginConfig?.collections || [],\n            required: true,\n          },\n          {\n            name: 'url',\n            type: 'text',\n            admin: {\n              condition: (_, siblingData) => siblingData?.type === 'custom',\n            },\n            // @ts-expect-error - translations are not typed in plugins yet\n            label: ({ t }) => t('plugin-redirects:customUrl'),\n            required: true,\n          },\n        ],\n        label: false,\n      },\n      ...(pluginConfig?.redirectTypes ? [redirectSelectField] : []),\n    ]\n\n    const redirectsCollection: CollectionConfig = {\n      ...(pluginConfig?.overrides || {}),\n      slug: pluginConfig?.overrides?.slug || 'redirects',\n      access: {\n        read: () => true,\n        ...(pluginConfig?.overrides?.access || {}),\n      },\n      admin: {\n        defaultColumns: ['from', 'to.type', 'createdAt'],\n        ...(pluginConfig?.overrides?.admin || {}),\n      },\n      fields:\n        pluginConfig?.overrides?.fields && typeof pluginConfig?.overrides?.fields === 'function'\n          ? pluginConfig?.overrides.fields({ defaultFields })\n          : defaultFields,\n    }\n\n    return {\n      ...incomingConfig,\n      collections: [...(incomingConfig?.collections || []), redirectsCollection],\n    }\n  }\n"],"names":["deepMergeSimple","redirectOptions","translations","redirectTypes","redirectsTranslations","redirectsPlugin","pluginConfig","incomingConfig","i18n","redirectSelectField","name","type","label","t","options","filter","option","includes","value","required","redirectTypeFieldOverride","defaultFields","index","unique","fields","admin","layout","defaultValue","condition","_","siblingData","relationTo","collections","redirectsCollection","overrides","slug","access","read","defaultColumns"],"mappings":"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"}