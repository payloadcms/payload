{"version":3,"sources":["../src/useLivePreview.ts"],"sourcesContent":["'use client'\nimport { ready, subscribe, unsubscribe } from '@payloadcms/live-preview'\nimport { useCallback, useEffect, useRef, useState } from 'react'\n\n/**\n * This is a React hook to implement {@link https://payloadcms.com/docs/live-preview/overview Payload Live Preview}.\n *\n * @link https://payloadcms.com/docs/live-preview/frontend\n */\n// NOTE: cannot use Record<string, unknown> here bc generated interfaces will not satisfy the type constraint\nexport const useLivePreview = <T extends Record<string, any>>(props: {\n  apiRoute?: string\n  depth?: number\n  /**\n   * To prevent the flicker of missing data on initial load,\n   * you can pass in the initial page data from the server.\n   */\n  initialData: T\n  serverURL: string\n}): {\n  data: T\n  /**\n   * To prevent the flicker of stale data while the post message is being sent,\n   * you can conditionally render loading UI based on the `isLoading` state.\n   */\n  isLoading: boolean\n} => {\n  const { apiRoute, depth, initialData, serverURL } = props\n  const [data, setData] = useState<T>(initialData)\n  const [isLoading, setIsLoading] = useState<boolean>(true)\n  const hasSentReadyMessage = useRef<boolean>(false)\n\n  const onChange = useCallback((mergedData: T) => {\n    setData(mergedData)\n    setIsLoading(false)\n  }, [])\n\n  useEffect(() => {\n    const subscription = subscribe({\n      apiRoute,\n      callback: onChange,\n      depth,\n      initialData,\n      serverURL,\n    })\n\n    if (!hasSentReadyMessage.current) {\n      hasSentReadyMessage.current = true\n\n      ready({\n        serverURL,\n      })\n    }\n\n    return () => {\n      unsubscribe(subscription)\n    }\n  }, [serverURL, onChange, depth, initialData, apiRoute])\n\n  return {\n    data,\n    isLoading,\n  }\n}\n"],"names":["ready","subscribe","unsubscribe","useCallback","useEffect","useRef","useState","useLivePreview","props","apiRoute","depth","initialData","serverURL","data","setData","isLoading","setIsLoading","hasSentReadyMessage","onChange","mergedData","subscription","callback","current"],"mappings":"AAAA;AACA,SAASA,KAAK,EAAEC,SAAS,EAAEC,WAAW,QAAQ,2BAA0B;AACxE,SAASC,WAAW,EAAEC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,QAAO;AAEhE;;;;CAIC,GACD,6GAA6G;AAC7G,OAAO,MAAMC,iBAAiB,CAAgCC;IAiB5D,MAAM,EAAEC,QAAQ,EAAEC,KAAK,EAAEC,WAAW,EAAEC,SAAS,EAAE,GAAGJ;IACpD,MAAM,CAACK,MAAMC,QAAQ,GAAGR,SAAYK;IACpC,MAAM,CAACI,WAAWC,aAAa,GAAGV,SAAkB;IACpD,MAAMW,sBAAsBZ,OAAgB;IAE5C,MAAMa,WAAWf,YAAY,CAACgB;QAC5BL,QAAQK;QACRH,aAAa;IACf,GAAG,EAAE;IAELZ,UAAU;QACR,MAAMgB,eAAenB,UAAU;YAC7BQ;YACAY,UAAUH;YACVR;YACAC;YACAC;QACF;QAEA,IAAI,CAACK,oBAAoBK,OAAO,EAAE;YAChCL,oBAAoBK,OAAO,GAAG;YAE9BtB,MAAM;gBACJY;YACF;QACF;QAEA,OAAO;YACLV,YAAYkB;QACd;IACF,GAAG;QAACR;QAAWM;QAAUR;QAAOC;QAAaF;KAAS;IAEtD,OAAO;QACLI;QACAE;IACF;AACF,EAAC"}