{"version":3,"sources":["../../../src/bin/generateImportMap/generateImportMap.spec.ts"],"sourcesContent":["import { describe, beforeEach, expect, it, vitest } from 'vitest'\nimport type { PayloadComponent } from '../../index.js'\nimport { addPayloadComponentToImportMap } from './utilities/addPayloadComponentToImportMap.js'\nimport { getImportMapToBaseDirPath } from './utilities/getImportMapToBaseDirPath.js'\n\ndescribe('addPayloadComponentToImportMap', () => {\n  let importMap: Record<string, string>\n  let imports: Record<\n    string,\n    {\n      path: string\n      specifier: string\n    }\n  >\n\n  beforeEach(() => {\n    importMap = {}\n    imports = {}\n    vitest.restoreAllMocks()\n  })\n\n  function componentPathTest({\n    baseDir,\n    importMapFilePath,\n    payloadComponent,\n    expectedPath,\n    expectedSpecifier,\n    expectedImportMapToBaseDirPath,\n  }: {\n    baseDir: string\n    importMapFilePath: string\n    payloadComponent: PayloadComponent\n    expectedPath: string\n    expectedImportMapToBaseDirPath: string\n    expectedSpecifier: string\n  }) {\n    const importMapToBaseDirPath = getImportMapToBaseDirPath({\n      baseDir,\n      importMapPath: importMapFilePath,\n    })\n\n    expect(importMapToBaseDirPath).toBe(expectedImportMapToBaseDirPath)\n\n    const { path, specifier } =\n      addPayloadComponentToImportMap({\n        importMapToBaseDirPath,\n        importMap,\n        imports,\n        payloadComponent,\n      }) ?? {}\n\n    expect(path).toBe(expectedPath)\n    expect(specifier).toBe(expectedSpecifier)\n  }\n\n  it('relative path with import map partially in base dir', () => {\n    componentPathTest({\n      baseDir: '/myPackage/test/myTest',\n      importMapFilePath: '/myPackage/app/(payload)/importMap.js',\n      payloadComponent: './MyComponent.js#MyExport',\n      expectedImportMapToBaseDirPath: '../../test/myTest/',\n      expectedPath: '../../test/myTest/MyComponent.js',\n      expectedSpecifier: 'MyExport',\n    })\n  })\n\n  it('relative path with import map partially in base dir 2', () => {\n    componentPathTest({\n      baseDir: '/myPackage/test/myTest',\n      importMapFilePath: '/myPackage/test/prod/app/(payload)/importMap.js',\n      payloadComponent: {\n        path: './MyComponent.js#MyExport',\n      },\n      expectedImportMapToBaseDirPath: '../../../myTest/',\n      expectedPath: '../../../myTest/MyComponent.js',\n      expectedSpecifier: 'MyExport',\n    })\n  })\n\n  it('relative path with import map partially in base dir 3', () => {\n    componentPathTest({\n      baseDir: '/myPackage/test/myTest',\n      importMapFilePath: '/myPackage/test/prod/app/(payload)/importMap.js',\n      payloadComponent: {\n        path: '../otherTest/MyComponent.js',\n        exportName: 'MyExport',\n      },\n      expectedImportMapToBaseDirPath: '../../../myTest/',\n      expectedPath: '../../../otherTest/MyComponent.js',\n      expectedSpecifier: 'MyExport',\n    })\n  })\n\n  it('relative path with import map within base dir', () => {\n    componentPathTest({\n      baseDir: '/myPackage/test/myTest',\n      importMapFilePath: '/myPackage/test/myTest/prod/app/(payload)/importMap.js',\n      payloadComponent: './MyComponent.js#MyExport',\n      expectedImportMapToBaseDirPath: '../../../',\n      expectedPath: '../../../MyComponent.js',\n      expectedSpecifier: 'MyExport',\n    })\n  })\n\n  it('relative path with import map not in base dir', () => {\n    componentPathTest({\n      baseDir: '/test/myTest',\n      importMapFilePath: '/app/(payload)/importMap.js',\n      payloadComponent: './MyComponent.js#MyExport',\n      expectedImportMapToBaseDirPath: '../../test/myTest/',\n      expectedPath: '../../test/myTest/MyComponent.js',\n      expectedSpecifier: 'MyExport',\n    })\n  })\n\n  it('relative path with import map not in base dir 2', () => {\n    componentPathTest({\n      baseDir: '/test/myTest',\n      importMapFilePath: '/app/(payload)/importMap.js',\n      payloadComponent: '../myOtherTest/MyComponent.js#MyExport',\n      expectedImportMapToBaseDirPath: '../../test/myTest/',\n      expectedPath: '../../test/myOtherTest/MyComponent.js',\n      expectedSpecifier: 'MyExport',\n    })\n  })\n\n  it('relative path with import map not in base dir, baseDir ending with slash', () => {\n    componentPathTest({\n      baseDir: '/test/myTest/',\n      importMapFilePath: '/app/(payload)/importMap.js',\n      payloadComponent: './MyComponent.js#MyExport',\n      expectedImportMapToBaseDirPath: '../../test/myTest/',\n      expectedPath: '../../test/myTest/MyComponent.js',\n      expectedSpecifier: 'MyExport',\n    })\n  })\n\n  it('relative path with import map not in base dir, component starting with slash', () => {\n    componentPathTest({\n      baseDir: '/test/myTest',\n      importMapFilePath: '/app/(payload)/importMap.js',\n      payloadComponent: '/MyComponent.js#MyExport',\n      expectedImportMapToBaseDirPath: '../../test/myTest/',\n      expectedPath: '../../test/myTest/MyComponent.js',\n      expectedSpecifier: 'MyExport',\n    })\n  })\n\n  it('aliased path', () => {\n    componentPathTest({\n      baseDir: '/test/myTest',\n      importMapFilePath: '/app/(payload)/importMap.js',\n      payloadComponent: '@components/MyComponent.js#MyExport',\n      expectedImportMapToBaseDirPath: '../../test/myTest/',\n      expectedPath: '@components/MyComponent.js',\n      expectedSpecifier: 'MyExport',\n    })\n  })\n  it('aliased path in PayloadComponent object', () => {\n    componentPathTest({\n      baseDir: '/test/',\n      importMapFilePath: '/app/(payload)/importMap.js',\n      payloadComponent: {\n        path: '@components/MyComponent.js',\n      },\n      expectedImportMapToBaseDirPath: '../../test/',\n      expectedPath: '@components/MyComponent.js',\n      expectedSpecifier: 'default',\n    })\n  })\n\n  it('relative path import starting with slash, going up', () => {\n    componentPathTest({\n      baseDir: '/test/myTest',\n      importMapFilePath: '/test/myTest/app/importMap.js',\n      payloadComponent: '/../MyComponent.js#MyExport',\n      expectedImportMapToBaseDirPath: '../',\n      expectedPath: '../../MyComponent.js',\n      expectedSpecifier: 'MyExport',\n    })\n  })\n\n  it('relative path import starting with dot-slash, going up', () => {\n    componentPathTest({\n      baseDir: '/test/myTest',\n      importMapFilePath: '/test/myTest/app/importMap.js',\n      payloadComponent: './../MyComponent.js#MyExport',\n      expectedImportMapToBaseDirPath: '../',\n      expectedPath: '../../MyComponent.js',\n      expectedSpecifier: 'MyExport',\n    })\n  })\n\n  it('importMap and baseDir in same directory', () => {\n    componentPathTest({\n      baseDir: '/test/myTest',\n      importMapFilePath: '/test/myTest/importMap.js',\n      payloadComponent: './MyComponent.js#MyExport',\n      expectedImportMapToBaseDirPath: './',\n      expectedPath: './MyComponent.js',\n      expectedSpecifier: 'MyExport',\n    })\n  })\n\n  it('baseDir within importMap dir', () => {\n    componentPathTest({\n      baseDir: '/test/myTest/components',\n      importMapFilePath: '/test/myTest/importMap.js',\n      payloadComponent: './MyComponent.js#MyExport',\n      expectedImportMapToBaseDirPath: './components/',\n      expectedPath: './components/MyComponent.js',\n      expectedSpecifier: 'MyExport',\n    })\n  })\n})\n"],"names":["describe","beforeEach","expect","it","vitest","addPayloadComponentToImportMap","getImportMapToBaseDirPath","importMap","imports","restoreAllMocks","componentPathTest","baseDir","importMapFilePath","payloadComponent","expectedPath","expectedSpecifier","expectedImportMapToBaseDirPath","importMapToBaseDirPath","importMapPath","toBe","path","specifier","exportName"],"mappings":"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"}