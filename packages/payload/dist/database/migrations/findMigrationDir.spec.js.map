{"version":3,"sources":["../../../src/database/migrations/findMigrationDir.spec.ts"],"sourcesContent":["import { afterEach, beforeEach, describe, expect, it, vitest } from 'vitest'\nimport { findMigrationDir } from './findMigrationDir'\nimport fs from 'fs'\nimport path from 'path'\n\nconst workDir = path.resolve(import.meta.dirname, '_tmp')\n\ndescribe('findMigrationDir', () => {\n  beforeEach(() => {\n    const cwdSpy = vitest.spyOn(process, 'cwd')\n    cwdSpy.mockReturnValue(workDir)\n    fs.mkdirSync(workDir, { recursive: true })\n  })\n\n  afterEach(() => {\n    fs.rmSync(workDir, { force: true, recursive: true })\n  })\n\n  it('should return the passed directory', () => {\n    const dir = path.resolve(workDir, 'custom_migrations')\n    expect(findMigrationDir(dir)).toBe(dir)\n  })\n\n  it('should return src/migrations because that folder exists', () => {\n    fs.mkdirSync(path.resolve(workDir, 'src/migrations'), { recursive: true })\n    expect(findMigrationDir()).toBe(path.resolve(workDir, 'src/migrations'))\n  })\n\n  it('should return dist/migrations because that folder exists', () => {\n    fs.mkdirSync(path.resolve(workDir, 'dist/migrations'), { recursive: true })\n    expect(findMigrationDir()).toBe(path.resolve(workDir, 'dist/migrations'))\n  })\n\n  it('should return src/migrations because src exists', () => {\n    fs.mkdirSync(path.resolve(workDir, 'src'), { recursive: true })\n    expect(findMigrationDir()).toBe(path.resolve(workDir, 'src/migrations'))\n  })\n\n  it('should return migrations because src does not exist', () => {\n    expect(findMigrationDir()).toBe(path.resolve(workDir, 'migrations'))\n  })\n})\n"],"names":["afterEach","beforeEach","describe","expect","it","vitest","findMigrationDir","fs","path","workDir","resolve","dirname","cwdSpy","spyOn","process","mockReturnValue","mkdirSync","recursive","rmSync","force","dir","toBe"],"mappings":"AAAA,SAASA,SAAS,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,EAAE,EAAEC,MAAM,QAAQ,SAAQ;AAC5E,SAASC,gBAAgB,QAAQ,qBAAoB;AACrD,OAAOC,QAAQ,KAAI;AACnB,OAAOC,UAAU,OAAM;AAEvB,MAAMC,UAAUD,KAAKE,OAAO,CAAC,YAAYC,OAAO,EAAE;AAElDT,SAAS,oBAAoB;IAC3BD,WAAW;QACT,MAAMW,SAASP,OAAOQ,KAAK,CAACC,SAAS;QACrCF,OAAOG,eAAe,CAACN;QACvBF,GAAGS,SAAS,CAACP,SAAS;YAAEQ,WAAW;QAAK;IAC1C;IAEAjB,UAAU;QACRO,GAAGW,MAAM,CAACT,SAAS;YAAEU,OAAO;YAAMF,WAAW;QAAK;IACpD;IAEAb,GAAG,sCAAsC;QACvC,MAAMgB,MAAMZ,KAAKE,OAAO,CAACD,SAAS;QAClCN,OAAOG,iBAAiBc,MAAMC,IAAI,CAACD;IACrC;IAEAhB,GAAG,2DAA2D;QAC5DG,GAAGS,SAAS,CAACR,KAAKE,OAAO,CAACD,SAAS,mBAAmB;YAAEQ,WAAW;QAAK;QACxEd,OAAOG,oBAAoBe,IAAI,CAACb,KAAKE,OAAO,CAACD,SAAS;IACxD;IAEAL,GAAG,4DAA4D;QAC7DG,GAAGS,SAAS,CAACR,KAAKE,OAAO,CAACD,SAAS,oBAAoB;YAAEQ,WAAW;QAAK;QACzEd,OAAOG,oBAAoBe,IAAI,CAACb,KAAKE,OAAO,CAACD,SAAS;IACxD;IAEAL,GAAG,mDAAmD;QACpDG,GAAGS,SAAS,CAACR,KAAKE,OAAO,CAACD,SAAS,QAAQ;YAAEQ,WAAW;QAAK;QAC7Dd,OAAOG,oBAAoBe,IAAI,CAACb,KAAKE,OAAO,CAACD,SAAS;IACxD;IAEAL,GAAG,uDAAuD;QACxDD,OAAOG,oBAAoBe,IAAI,CAACb,KAAKE,OAAO,CAACD,SAAS;IACxD;AACF"}