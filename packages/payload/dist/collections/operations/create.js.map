{"version":3,"sources":["../../../src/collections/operations/create.ts"],"sourcesContent":["import crypto from 'crypto'\n\nimport type { CollectionSlug, JsonObject } from '../../index.js'\nimport type {\n  Document,\n  PayloadRequest,\n  PopulateType,\n  SelectType,\n  TransformCollectionWithSelect,\n} from '../../types/index.js'\nimport type {\n  Collection,\n  DataFromCollectionSlug,\n  RequiredDataFromCollectionSlug,\n  SelectFromCollectionSlug,\n} from '../config/types.js'\n\nimport { ensureUsernameOrEmail } from '../../auth/ensureUsernameOrEmail.js'\nimport { executeAccess } from '../../auth/executeAccess.js'\nimport { sendVerificationEmail } from '../../auth/sendVerificationEmail.js'\nimport { registerLocalStrategy } from '../../auth/strategies/local/register.js'\nimport { getDuplicateDocumentData } from '../../duplicateDocument/index.js'\nimport { afterChange } from '../../fields/hooks/afterChange/index.js'\nimport { afterRead } from '../../fields/hooks/afterRead/index.js'\nimport { beforeChange } from '../../fields/hooks/beforeChange/index.js'\nimport { beforeValidate } from '../../fields/hooks/beforeValidate/index.js'\nimport { saveVersion } from '../../index.js'\nimport { generateFileData } from '../../uploads/generateFileData.js'\nimport { unlinkTempFiles } from '../../uploads/unlinkTempFiles.js'\nimport { uploadFiles } from '../../uploads/uploadFiles.js'\nimport { commitTransaction } from '../../utilities/commitTransaction.js'\nimport { hasDraftsEnabled, hasDraftValidationEnabled } from '../../utilities/getVersionsConfig.js'\nimport { initTransaction } from '../../utilities/initTransaction.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { sanitizeInternalFields } from '../../utilities/sanitizeInternalFields.js'\nimport { sanitizeSelect } from '../../utilities/sanitizeSelect.js'\nimport { buildAfterOperation } from './utilities/buildAfterOperation.js'\nimport { buildBeforeOperation } from './utilities/buildBeforeOperation.js'\n\nexport type Arguments<TSlug extends CollectionSlug> = {\n  autosave?: boolean\n  collection: Collection\n  data: RequiredDataFromCollectionSlug<TSlug>\n  depth?: number\n  disableTransaction?: boolean\n  disableVerificationEmail?: boolean\n  draft?: boolean\n  duplicateFromID?: DataFromCollectionSlug<TSlug>['id']\n  overrideAccess?: boolean\n  overwriteExistingFiles?: boolean\n  populate?: PopulateType\n  publishSpecificLocale?: string\n  req: PayloadRequest\n  select?: SelectType\n  selectedLocales?: string[]\n  showHiddenFields?: boolean\n}\n\nexport const createOperation = async <\n  TSlug extends CollectionSlug,\n  TSelect extends SelectFromCollectionSlug<TSlug>,\n>(\n  incomingArgs: Arguments<TSlug>,\n): Promise<TransformCollectionWithSelect<TSlug, TSelect>> => {\n  let args = incomingArgs\n\n  try {\n    const shouldCommit = !args.disableTransaction && (await initTransaction(args.req))\n\n    ensureUsernameOrEmail<TSlug>({\n      authOptions: args.collection.config.auth,\n      collectionSlug: args.collection.config.slug,\n      data: args.data,\n      operation: 'create',\n      req: args.req,\n    })\n\n    // /////////////////////////////////////\n    // beforeOperation - Collection\n    // /////////////////////////////////////\n\n    args = await buildBeforeOperation({\n      args,\n      collection: args.collection.config,\n      operation: 'create',\n    })\n\n    if (args.publishSpecificLocale) {\n      args.req.locale = args.publishSpecificLocale\n    }\n\n    const {\n      autosave = false,\n      collection: { config: collectionConfig },\n      collection,\n      depth,\n      disableVerificationEmail,\n      draft = false,\n      duplicateFromID,\n      overrideAccess,\n      overwriteExistingFiles = false,\n      populate,\n      publishSpecificLocale,\n      req: {\n        fallbackLocale,\n        locale,\n        payload,\n        payload: { config },\n      },\n      req,\n      select: incomingSelect,\n      selectedLocales,\n      showHiddenFields,\n    } = args\n\n    let { data } = args\n\n    const isSavingDraft = Boolean(draft && hasDraftsEnabled(collectionConfig))\n\n    let duplicatedFromDocWithLocales: JsonObject = {}\n    let duplicatedFromDoc: JsonObject = {}\n\n    if (duplicateFromID) {\n      const duplicateResult = await getDuplicateDocumentData({\n        id: duplicateFromID,\n        collectionConfig,\n        draftArg: isSavingDraft,\n        overrideAccess,\n        req,\n        selectedLocales,\n      })\n\n      duplicatedFromDoc = duplicateResult.duplicatedFromDoc\n      duplicatedFromDocWithLocales = duplicateResult.duplicatedFromDocWithLocales\n    }\n\n    // /////////////////////////////////////\n    // Access\n    // /////////////////////////////////////\n\n    if (!overrideAccess) {\n      await executeAccess({ data, req }, collectionConfig.access.create)\n    }\n\n    // /////////////////////////////////////\n    // Generate data for all files and sizes\n    // /////////////////////////////////////\n\n    const { data: newFileData, files: filesToUpload } = await generateFileData({\n      collection,\n      config,\n      data,\n      isDuplicating: Boolean(duplicateFromID),\n      operation: 'create',\n      originalDoc: duplicatedFromDoc,\n      overwriteExistingFiles,\n      req,\n      throwOnMissingFile:\n        !isSavingDraft && collection.config.upload.filesRequiredOnCreate !== false,\n    })\n\n    data = newFileData\n\n    // /////////////////////////////////////\n    // beforeValidate - Fields\n    // /////////////////////////////////////\n\n    data = await beforeValidate({\n      collection: collectionConfig,\n      context: req.context,\n      data,\n      doc: duplicatedFromDoc,\n      global: null,\n      operation: 'create',\n      overrideAccess: overrideAccess!,\n      req,\n    })\n\n    // /////////////////////////////////////\n    // beforeValidate - Collections\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks.beforeValidate?.length) {\n      for (const hook of collectionConfig.hooks.beforeValidate) {\n        data =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            data,\n            operation: 'create',\n            originalDoc: duplicatedFromDoc,\n            req,\n          })) || data\n      }\n    }\n\n    // /////////////////////////////////////\n    // beforeChange - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.beforeChange?.length) {\n      for (const hook of collectionConfig.hooks.beforeChange) {\n        data =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            data,\n            operation: 'create',\n            originalDoc: duplicatedFromDoc,\n            req,\n          })) || data\n      }\n    }\n\n    // /////////////////////////////////////\n    // beforeChange - Fields\n    // /////////////////////////////////////\n\n    const resultWithLocales = await beforeChange<JsonObject>({\n      collection: collectionConfig,\n      context: req.context,\n      data,\n      doc: duplicatedFromDoc,\n      docWithLocales: duplicatedFromDocWithLocales,\n      global: null,\n      operation: 'create',\n      overrideAccess,\n      req,\n      skipValidation: isSavingDraft && !hasDraftValidationEnabled(collectionConfig),\n    })\n\n    // /////////////////////////////////////\n    // Write files to local storage\n    // /////////////////////////////////////\n\n    if (!collectionConfig.upload.disableLocalStorage) {\n      await uploadFiles(payload, filesToUpload, req)\n    }\n\n    // /////////////////////////////////////\n    // Create\n    // /////////////////////////////////////\n\n    let doc\n\n    const select = sanitizeSelect({\n      fields: collectionConfig.flattenedFields,\n      forceSelect: collectionConfig.forceSelect,\n      select: incomingSelect,\n    })\n\n    if (collectionConfig.auth && !collectionConfig.auth.disableLocalStrategy) {\n      if (collectionConfig.auth.verify) {\n        resultWithLocales._verified = Boolean(resultWithLocales._verified) || false\n        resultWithLocales._verificationToken = crypto.randomBytes(20).toString('hex')\n      }\n\n      doc = await registerLocalStrategy({\n        collection: collectionConfig,\n        doc: resultWithLocales,\n        password: data.password as string,\n        payload: req.payload,\n        req,\n      })\n    } else {\n      doc = await payload.db.create({\n        collection: collectionConfig.slug,\n        data: resultWithLocales,\n        req,\n      })\n    }\n\n    const verificationToken = doc._verificationToken\n    let result: Document = sanitizeInternalFields(doc)\n\n    // /////////////////////////////////////\n    // Create version\n    // /////////////////////////////////////\n\n    if (collectionConfig.versions) {\n      await saveVersion({\n        id: result.id,\n        autosave,\n        collection: collectionConfig,\n        docWithLocales: result,\n        operation: 'create',\n        payload,\n        publishSpecificLocale,\n        req,\n        returning: false,\n      })\n    }\n\n    // /////////////////////////////////////\n    // Send verification email if applicable\n    // /////////////////////////////////////\n\n    if (collectionConfig.auth && collectionConfig.auth.verify && result.email) {\n      await sendVerificationEmail({\n        collection: { config: collectionConfig },\n        config: payload.config,\n        disableEmail: disableVerificationEmail!,\n        email: payload.email,\n        req,\n        token: verificationToken,\n        user: result,\n      })\n    }\n\n    // /////////////////////////////////////\n    // afterRead - Fields\n    // /////////////////////////////////////\n\n    result = await afterRead({\n      collection: collectionConfig,\n      context: req.context,\n      depth: depth!,\n      doc: result,\n      draft,\n      fallbackLocale: fallbackLocale!,\n      global: null,\n      locale: locale!,\n      overrideAccess: overrideAccess!,\n      populate,\n      req,\n      select,\n      showHiddenFields: showHiddenFields!,\n    })\n\n    // /////////////////////////////////////\n    // afterRead - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.afterRead?.length) {\n      for (const hook of collectionConfig.hooks.afterRead) {\n        result =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            doc: result,\n            req,\n          })) || result\n      }\n    }\n\n    // /////////////////////////////////////\n    // afterChange - Fields\n    // /////////////////////////////////////\n\n    result = await afterChange({\n      collection: collectionConfig,\n      context: req.context,\n      data,\n      doc: result,\n      global: null,\n      operation: 'create',\n      previousDoc: {},\n      req,\n    })\n\n    // /////////////////////////////////////\n    // afterChange - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.afterChange?.length) {\n      for (const hook of collectionConfig.hooks.afterChange) {\n        result =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            data,\n            doc: result,\n            operation: 'create',\n            previousDoc: {},\n            req: args.req,\n          })) || result\n      }\n    }\n\n    // /////////////////////////////////////\n    // afterOperation - Collection\n    // /////////////////////////////////////\n\n    result = await buildAfterOperation<TSlug>({\n      args,\n      collection: collectionConfig,\n      operation: 'create',\n      result,\n    })\n\n    await unlinkTempFiles({ collectionConfig, config, req })\n\n    // /////////////////////////////////////\n    // Return results\n    // /////////////////////////////////////\n\n    if (shouldCommit) {\n      await commitTransaction(req)\n    }\n\n    return result\n  } catch (error: unknown) {\n    await killTransaction(args.req)\n    throw error\n  }\n}\n"],"names":["crypto","ensureUsernameOrEmail","executeAccess","sendVerificationEmail","registerLocalStrategy","getDuplicateDocumentData","afterChange","afterRead","beforeChange","beforeValidate","saveVersion","generateFileData","unlinkTempFiles","uploadFiles","commitTransaction","hasDraftsEnabled","hasDraftValidationEnabled","initTransaction","killTransaction","sanitizeInternalFields","sanitizeSelect","buildAfterOperation","buildBeforeOperation","createOperation","incomingArgs","args","shouldCommit","disableTransaction","req","authOptions","collection","config","auth","collectionSlug","slug","data","operation","publishSpecificLocale","locale","autosave","collectionConfig","depth","disableVerificationEmail","draft","duplicateFromID","overrideAccess","overwriteExistingFiles","populate","fallbackLocale","payload","select","incomingSelect","selectedLocales","showHiddenFields","isSavingDraft","Boolean","duplicatedFromDocWithLocales","duplicatedFromDoc","duplicateResult","id","draftArg","access","create","newFileData","files","filesToUpload","isDuplicating","originalDoc","throwOnMissingFile","upload","filesRequiredOnCreate","context","doc","global","hooks","length","hook","resultWithLocales","docWithLocales","skipValidation","disableLocalStorage","fields","flattenedFields","forceSelect","disableLocalStrategy","verify","_verified","_verificationToken","randomBytes","toString","password","db","verificationToken","result","versions","returning","email","disableEmail","token","user","previousDoc","error"],"mappings":"AAAA,OAAOA,YAAY,SAAQ;AAiB3B,SAASC,qBAAqB,QAAQ,sCAAqC;AAC3E,SAASC,aAAa,QAAQ,8BAA6B;AAC3D,SAASC,qBAAqB,QAAQ,sCAAqC;AAC3E,SAASC,qBAAqB,QAAQ,0CAAyC;AAC/E,SAASC,wBAAwB,QAAQ,mCAAkC;AAC3E,SAASC,WAAW,QAAQ,0CAAyC;AACrE,SAASC,SAAS,QAAQ,wCAAuC;AACjE,SAASC,YAAY,QAAQ,2CAA0C;AACvE,SAASC,cAAc,QAAQ,6CAA4C;AAC3E,SAASC,WAAW,QAAQ,iBAAgB;AAC5C,SAASC,gBAAgB,QAAQ,oCAAmC;AACpE,SAASC,eAAe,QAAQ,mCAAkC;AAClE,SAASC,WAAW,QAAQ,+BAA8B;AAC1D,SAASC,iBAAiB,QAAQ,uCAAsC;AACxE,SAASC,gBAAgB,EAAEC,yBAAyB,QAAQ,uCAAsC;AAClG,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,sBAAsB,QAAQ,4CAA2C;AAClF,SAASC,cAAc,QAAQ,oCAAmC;AAClE,SAASC,mBAAmB,QAAQ,qCAAoC;AACxE,SAASC,oBAAoB,QAAQ,sCAAqC;AAqB1E,OAAO,MAAMC,kBAAkB,OAI7BC;IAEA,IAAIC,OAAOD;IAEX,IAAI;QACF,MAAME,eAAe,CAACD,KAAKE,kBAAkB,IAAK,MAAMV,gBAAgBQ,KAAKG,GAAG;QAEhF3B,sBAA6B;YAC3B4B,aAAaJ,KAAKK,UAAU,CAACC,MAAM,CAACC,IAAI;YACxCC,gBAAgBR,KAAKK,UAAU,CAACC,MAAM,CAACG,IAAI;YAC3CC,MAAMV,KAAKU,IAAI;YACfC,WAAW;YACXR,KAAKH,KAAKG,GAAG;QACf;QAEA,wCAAwC;QACxC,+BAA+B;QAC/B,wCAAwC;QAExCH,OAAO,MAAMH,qBAAqB;YAChCG;YACAK,YAAYL,KAAKK,UAAU,CAACC,MAAM;YAClCK,WAAW;QACb;QAEA,IAAIX,KAAKY,qBAAqB,EAAE;YAC9BZ,KAAKG,GAAG,CAACU,MAAM,GAAGb,KAAKY,qBAAqB;QAC9C;QAEA,MAAM,EACJE,WAAW,KAAK,EAChBT,YAAY,EAAEC,QAAQS,gBAAgB,EAAE,EACxCV,UAAU,EACVW,KAAK,EACLC,wBAAwB,EACxBC,QAAQ,KAAK,EACbC,eAAe,EACfC,cAAc,EACdC,yBAAyB,KAAK,EAC9BC,QAAQ,EACRV,qBAAqB,EACrBT,KAAK,EACHoB,cAAc,EACdV,MAAM,EACNW,OAAO,EACPA,SAAS,EAAElB,MAAM,EAAE,EACpB,EACDH,GAAG,EACHsB,QAAQC,cAAc,EACtBC,eAAe,EACfC,gBAAgB,EACjB,GAAG5B;QAEJ,IAAI,EAAEU,IAAI,EAAE,GAAGV;QAEf,MAAM6B,gBAAgBC,QAAQZ,SAAS5B,iBAAiByB;QAExD,IAAIgB,+BAA2C,CAAC;QAChD,IAAIC,oBAAgC,CAAC;QAErC,IAAIb,iBAAiB;YACnB,MAAMc,kBAAkB,MAAMrD,yBAAyB;gBACrDsD,IAAIf;gBACJJ;gBACAoB,UAAUN;gBACVT;gBACAjB;gBACAwB;YACF;YAEAK,oBAAoBC,gBAAgBD,iBAAiB;YACrDD,+BAA+BE,gBAAgBF,4BAA4B;QAC7E;QAEA,wCAAwC;QACxC,SAAS;QACT,wCAAwC;QAExC,IAAI,CAACX,gBAAgB;YACnB,MAAM3C,cAAc;gBAAEiC;gBAAMP;YAAI,GAAGY,iBAAiBqB,MAAM,CAACC,MAAM;QACnE;QAEA,wCAAwC;QACxC,wCAAwC;QACxC,wCAAwC;QAExC,MAAM,EAAE3B,MAAM4B,WAAW,EAAEC,OAAOC,aAAa,EAAE,GAAG,MAAMtD,iBAAiB;YACzEmB;YACAC;YACAI;YACA+B,eAAeX,QAAQX;YACvBR,WAAW;YACX+B,aAAaV;YACbX;YACAlB;YACAwC,oBACE,CAACd,iBAAiBxB,WAAWC,MAAM,CAACsC,MAAM,CAACC,qBAAqB,KAAK;QACzE;QAEAnC,OAAO4B;QAEP,wCAAwC;QACxC,0BAA0B;QAC1B,wCAAwC;QAExC5B,OAAO,MAAM1B,eAAe;YAC1BqB,YAAYU;YACZ+B,SAAS3C,IAAI2C,OAAO;YACpBpC;YACAqC,KAAKf;YACLgB,QAAQ;YACRrC,WAAW;YACXS,gBAAgBA;YAChBjB;QACF;QAEA,wCAAwC;QACxC,+BAA+B;QAC/B,wCAAwC;QAExC,IAAIY,iBAAiBkC,KAAK,CAACjE,cAAc,EAAEkE,QAAQ;YACjD,KAAK,MAAMC,QAAQpC,iBAAiBkC,KAAK,CAACjE,cAAc,CAAE;gBACxD0B,OACE,AAAC,MAAMyC,KAAK;oBACV9C,YAAYU;oBACZ+B,SAAS3C,IAAI2C,OAAO;oBACpBpC;oBACAC,WAAW;oBACX+B,aAAaV;oBACb7B;gBACF,MAAOO;YACX;QACF;QAEA,wCAAwC;QACxC,4BAA4B;QAC5B,wCAAwC;QAExC,IAAIK,iBAAiBkC,KAAK,EAAElE,cAAcmE,QAAQ;YAChD,KAAK,MAAMC,QAAQpC,iBAAiBkC,KAAK,CAAClE,YAAY,CAAE;gBACtD2B,OACE,AAAC,MAAMyC,KAAK;oBACV9C,YAAYU;oBACZ+B,SAAS3C,IAAI2C,OAAO;oBACpBpC;oBACAC,WAAW;oBACX+B,aAAaV;oBACb7B;gBACF,MAAOO;YACX;QACF;QAEA,wCAAwC;QACxC,wBAAwB;QACxB,wCAAwC;QAExC,MAAM0C,oBAAoB,MAAMrE,aAAyB;YACvDsB,YAAYU;YACZ+B,SAAS3C,IAAI2C,OAAO;YACpBpC;YACAqC,KAAKf;YACLqB,gBAAgBtB;YAChBiB,QAAQ;YACRrC,WAAW;YACXS;YACAjB;YACAmD,gBAAgBzB,iBAAiB,CAACtC,0BAA0BwB;QAC9D;QAEA,wCAAwC;QACxC,+BAA+B;QAC/B,wCAAwC;QAExC,IAAI,CAACA,iBAAiB6B,MAAM,CAACW,mBAAmB,EAAE;YAChD,MAAMnE,YAAYoC,SAASgB,eAAerC;QAC5C;QAEA,wCAAwC;QACxC,SAAS;QACT,wCAAwC;QAExC,IAAI4C;QAEJ,MAAMtB,SAAS9B,eAAe;YAC5B6D,QAAQzC,iBAAiB0C,eAAe;YACxCC,aAAa3C,iBAAiB2C,WAAW;YACzCjC,QAAQC;QACV;QAEA,IAAIX,iBAAiBR,IAAI,IAAI,CAACQ,iBAAiBR,IAAI,CAACoD,oBAAoB,EAAE;YACxE,IAAI5C,iBAAiBR,IAAI,CAACqD,MAAM,EAAE;gBAChCR,kBAAkBS,SAAS,GAAG/B,QAAQsB,kBAAkBS,SAAS,KAAK;gBACtET,kBAAkBU,kBAAkB,GAAGvF,OAAOwF,WAAW,CAAC,IAAIC,QAAQ,CAAC;YACzE;YAEAjB,MAAM,MAAMpE,sBAAsB;gBAChC0B,YAAYU;gBACZgC,KAAKK;gBACLa,UAAUvD,KAAKuD,QAAQ;gBACvBzC,SAASrB,IAAIqB,OAAO;gBACpBrB;YACF;QACF,OAAO;YACL4C,MAAM,MAAMvB,QAAQ0C,EAAE,CAAC7B,MAAM,CAAC;gBAC5BhC,YAAYU,iBAAiBN,IAAI;gBACjCC,MAAM0C;gBACNjD;YACF;QACF;QAEA,MAAMgE,oBAAoBpB,IAAIe,kBAAkB;QAChD,IAAIM,SAAmB1E,uBAAuBqD;QAE9C,wCAAwC;QACxC,iBAAiB;QACjB,wCAAwC;QAExC,IAAIhC,iBAAiBsD,QAAQ,EAAE;YAC7B,MAAMpF,YAAY;gBAChBiD,IAAIkC,OAAOlC,EAAE;gBACbpB;gBACAT,YAAYU;gBACZsC,gBAAgBe;gBAChBzD,WAAW;gBACXa;gBACAZ;gBACAT;gBACAmE,WAAW;YACb;QACF;QAEA,wCAAwC;QACxC,wCAAwC;QACxC,wCAAwC;QAExC,IAAIvD,iBAAiBR,IAAI,IAAIQ,iBAAiBR,IAAI,CAACqD,MAAM,IAAIQ,OAAOG,KAAK,EAAE;YACzE,MAAM7F,sBAAsB;gBAC1B2B,YAAY;oBAAEC,QAAQS;gBAAiB;gBACvCT,QAAQkB,QAAQlB,MAAM;gBACtBkE,cAAcvD;gBACdsD,OAAO/C,QAAQ+C,KAAK;gBACpBpE;gBACAsE,OAAON;gBACPO,MAAMN;YACR;QACF;QAEA,wCAAwC;QACxC,qBAAqB;QACrB,wCAAwC;QAExCA,SAAS,MAAMtF,UAAU;YACvBuB,YAAYU;YACZ+B,SAAS3C,IAAI2C,OAAO;YACpB9B,OAAOA;YACP+B,KAAKqB;YACLlD;YACAK,gBAAgBA;YAChByB,QAAQ;YACRnC,QAAQA;YACRO,gBAAgBA;YAChBE;YACAnB;YACAsB;YACAG,kBAAkBA;QACpB;QAEA,wCAAwC;QACxC,yBAAyB;QACzB,wCAAwC;QAExC,IAAIb,iBAAiBkC,KAAK,EAAEnE,WAAWoE,QAAQ;YAC7C,KAAK,MAAMC,QAAQpC,iBAAiBkC,KAAK,CAACnE,SAAS,CAAE;gBACnDsF,SACE,AAAC,MAAMjB,KAAK;oBACV9C,YAAYU;oBACZ+B,SAAS3C,IAAI2C,OAAO;oBACpBC,KAAKqB;oBACLjE;gBACF,MAAOiE;YACX;QACF;QAEA,wCAAwC;QACxC,uBAAuB;QACvB,wCAAwC;QAExCA,SAAS,MAAMvF,YAAY;YACzBwB,YAAYU;YACZ+B,SAAS3C,IAAI2C,OAAO;YACpBpC;YACAqC,KAAKqB;YACLpB,QAAQ;YACRrC,WAAW;YACXgE,aAAa,CAAC;YACdxE;QACF;QAEA,wCAAwC;QACxC,2BAA2B;QAC3B,wCAAwC;QAExC,IAAIY,iBAAiBkC,KAAK,EAAEpE,aAAaqE,QAAQ;YAC/C,KAAK,MAAMC,QAAQpC,iBAAiBkC,KAAK,CAACpE,WAAW,CAAE;gBACrDuF,SACE,AAAC,MAAMjB,KAAK;oBACV9C,YAAYU;oBACZ+B,SAAS3C,IAAI2C,OAAO;oBACpBpC;oBACAqC,KAAKqB;oBACLzD,WAAW;oBACXgE,aAAa,CAAC;oBACdxE,KAAKH,KAAKG,GAAG;gBACf,MAAOiE;YACX;QACF;QAEA,wCAAwC;QACxC,8BAA8B;QAC9B,wCAAwC;QAExCA,SAAS,MAAMxE,oBAA2B;YACxCI;YACAK,YAAYU;YACZJ,WAAW;YACXyD;QACF;QAEA,MAAMjF,gBAAgB;YAAE4B;YAAkBT;YAAQH;QAAI;QAEtD,wCAAwC;QACxC,iBAAiB;QACjB,wCAAwC;QAExC,IAAIF,cAAc;YAChB,MAAMZ,kBAAkBc;QAC1B;QAEA,OAAOiE;IACT,EAAE,OAAOQ,OAAgB;QACvB,MAAMnF,gBAAgBO,KAAKG,GAAG;QAC9B,MAAMyE;IACR;AACF,EAAC"}