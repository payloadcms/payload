{"version":3,"sources":["../../../src/collections/endpoints/update.ts"],"sourcesContent":["import { getTranslation } from '@payloadcms/translations'\nimport { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollection } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { parseParams } from '../../utilities/parseParams/index.js'\nimport { updateOperation } from '../operations/update.js'\n\nexport const updateHandler: PayloadHandler = async (req) => {\n  const collection = getRequestCollection(req)\n\n  const { depth, draft, limit, overrideLock, populate, select, sort, trash, where } = parseParams(\n    req.query,\n  )\n\n  const result = await updateOperation({\n    collection,\n    data: req.data!,\n    depth,\n    draft,\n    limit,\n    overrideLock: overrideLock ?? false,\n    populate,\n    req,\n    select,\n    sort,\n    trash,\n    where: where!,\n  })\n\n  const headers = headersWithCors({\n    headers: new Headers(),\n    req,\n  })\n\n  if (result.errors.length === 0) {\n    const message = req.t('general:updatedCountSuccessfully', {\n      count: result.docs.length,\n      label: getTranslation(\n        collection.config.labels[result.docs.length === 1 ? 'singular' : 'plural'],\n        req.i18n,\n      ),\n    })\n\n    return Response.json(\n      {\n        ...result,\n        message,\n      },\n      {\n        headers,\n        status: httpStatus.OK,\n      },\n    )\n  }\n\n  result.errors = result.errors.map((error) =>\n    error.isPublic\n      ? error\n      : {\n          ...error,\n          message: 'Something went wrong.',\n        },\n  )\n\n  const total = result.docs.length + result.errors.length\n  const message = req.t('error:unableToUpdateCount', {\n    count: result.errors.length,\n    label: getTranslation(collection.config.labels[total === 1 ? 'singular' : 'plural'], req.i18n),\n    total,\n  })\n\n  return Response.json(\n    {\n      ...result,\n      message,\n    },\n    {\n      headers,\n      status: httpStatus.BAD_REQUEST,\n    },\n  )\n}\n"],"names":["getTranslation","status","httpStatus","getRequestCollection","headersWithCors","parseParams","updateOperation","updateHandler","req","collection","depth","draft","limit","overrideLock","populate","select","sort","trash","where","query","result","data","headers","Headers","errors","length","message","t","count","docs","label","config","labels","i18n","Response","json","OK","map","error","isPublic","total","BAD_REQUEST"],"mappings":"AAAA,SAASA,cAAc,QAAQ,2BAA0B;AACzD,SAASC,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,oBAAoB,QAAQ,sCAAqC;AAC1E,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,WAAW,QAAQ,uCAAsC;AAClE,SAASC,eAAe,QAAQ,0BAAyB;AAEzD,OAAO,MAAMC,gBAAgC,OAAOC;IAClD,MAAMC,aAAaN,qBAAqBK;IAExC,MAAM,EAAEE,KAAK,EAAEC,KAAK,EAAEC,KAAK,EAAEC,YAAY,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAEC,KAAK,EAAE,GAAGb,YAClFG,IAAIW,KAAK;IAGX,MAAMC,SAAS,MAAMd,gBAAgB;QACnCG;QACAY,MAAMb,IAAIa,IAAI;QACdX;QACAC;QACAC;QACAC,cAAcA,gBAAgB;QAC9BC;QACAN;QACAO;QACAC;QACAC;QACAC,OAAOA;IACT;IAEA,MAAMI,UAAUlB,gBAAgB;QAC9BkB,SAAS,IAAIC;QACbf;IACF;IAEA,IAAIY,OAAOI,MAAM,CAACC,MAAM,KAAK,GAAG;QAC9B,MAAMC,UAAUlB,IAAImB,CAAC,CAAC,oCAAoC;YACxDC,OAAOR,OAAOS,IAAI,CAACJ,MAAM;YACzBK,OAAO9B,eACLS,WAAWsB,MAAM,CAACC,MAAM,CAACZ,OAAOS,IAAI,CAACJ,MAAM,KAAK,IAAI,aAAa,SAAS,EAC1EjB,IAAIyB,IAAI;QAEZ;QAEA,OAAOC,SAASC,IAAI,CAClB;YACE,GAAGf,MAAM;YACTM;QACF,GACA;YACEJ;YACArB,QAAQC,WAAWkC,EAAE;QACvB;IAEJ;IAEAhB,OAAOI,MAAM,GAAGJ,OAAOI,MAAM,CAACa,GAAG,CAAC,CAACC,QACjCA,MAAMC,QAAQ,GACVD,QACA;YACE,GAAGA,KAAK;YACRZ,SAAS;QACX;IAGN,MAAMc,QAAQpB,OAAOS,IAAI,CAACJ,MAAM,GAAGL,OAAOI,MAAM,CAACC,MAAM;IACvD,MAAMC,UAAUlB,IAAImB,CAAC,CAAC,6BAA6B;QACjDC,OAAOR,OAAOI,MAAM,CAACC,MAAM;QAC3BK,OAAO9B,eAAeS,WAAWsB,MAAM,CAACC,MAAM,CAACQ,UAAU,IAAI,aAAa,SAAS,EAAEhC,IAAIyB,IAAI;QAC7FO;IACF;IAEA,OAAON,SAASC,IAAI,CAClB;QACE,GAAGf,MAAM;QACTM;IACF,GACA;QACEJ;QACArB,QAAQC,WAAWuC,WAAW;IAChC;AAEJ,EAAC"}