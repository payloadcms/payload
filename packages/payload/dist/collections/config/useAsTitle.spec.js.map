{"version":3,"sources":["../../../src/collections/config/useAsTitle.spec.ts"],"sourcesContent":["import type { Config } from '../../config/types.js'\nimport type { CollectionConfig } from '../../index.js'\n\nimport { InvalidConfiguration } from '../../errors/InvalidConfiguration.js'\nimport { sanitizeCollection } from './sanitize.js'\nimport { describe, it, expect } from 'vitest'\n\ndescribe('sanitize - collections -', () => {\n  const config = {\n    collections: [],\n    globals: [],\n  } as Partial<Config>\n\n  describe('validate useAsTitle -', () => {\n    const defaultCollection: CollectionConfig = {\n      slug: 'collection-with-defaults',\n      fields: [\n        {\n          name: 'title',\n          type: 'text',\n        },\n      ],\n    }\n\n    it('should throw on invalid field', async () => {\n      const collectionConfig: CollectionConfig = {\n        ...defaultCollection,\n        admin: {\n          useAsTitle: 'invalidField',\n        },\n      }\n      await expect(async () => {\n        await sanitizeCollection(\n          // @ts-expect-error\n          {\n            ...config,\n            collections: [collectionConfig],\n          },\n          collectionConfig,\n        )\n      }).rejects.toThrow(InvalidConfiguration)\n    })\n\n    it('should not throw on valid field', async () => {\n      const collectionConfig: CollectionConfig = {\n        ...defaultCollection,\n        admin: {\n          useAsTitle: 'title',\n        },\n      }\n      await expect(async () => {\n        await sanitizeCollection(\n          // @ts-expect-error\n          {\n            ...config,\n            collections: [collectionConfig],\n          },\n          collectionConfig,\n        )\n      }).not.toThrow()\n    })\n\n    it('should not throw on valid field inside tabs', async () => {\n      const collectionConfig: CollectionConfig = {\n        ...defaultCollection,\n        admin: {\n          useAsTitle: 'title',\n        },\n        fields: [\n          {\n            type: 'tabs',\n            tabs: [\n              {\n                label: 'General',\n                fields: [\n                  {\n                    name: 'title',\n                    type: 'text',\n                  },\n                ],\n              },\n            ],\n          },\n        ],\n      }\n      await expect(async () => {\n        await sanitizeCollection(\n          // @ts-expect-error\n          {\n            ...config,\n            collections: [collectionConfig],\n          },\n          collectionConfig,\n        )\n      }).not.toThrow()\n    })\n\n    it('should not throw on valid field inside collapsibles', async () => {\n      const collectionConfig: CollectionConfig = {\n        ...defaultCollection,\n        admin: {\n          useAsTitle: 'title',\n        },\n        fields: [\n          {\n            type: 'collapsible',\n            label: 'Collapsible',\n            fields: [\n              {\n                name: 'title',\n                type: 'text',\n              },\n            ],\n          },\n        ],\n      }\n      await expect(async () => {\n        await sanitizeCollection(\n          // @ts-expect-error\n          {\n            ...config,\n            collections: [collectionConfig],\n          },\n          collectionConfig,\n        )\n      }).not.toThrow()\n    })\n\n    it('should throw on nested useAsTitle', async () => {\n      const collectionConfig: CollectionConfig = {\n        ...defaultCollection,\n        admin: {\n          useAsTitle: 'content.title',\n        },\n      }\n      await expect(async () => {\n        await sanitizeCollection(\n          // @ts-expect-error\n          {\n            ...config,\n            collections: [collectionConfig],\n          },\n          collectionConfig,\n        )\n      }).rejects.toThrow(InvalidConfiguration)\n    })\n\n    it('should not throw on default field: id', async () => {\n      const collectionConfig: CollectionConfig = {\n        ...defaultCollection,\n        admin: {\n          useAsTitle: 'id',\n        },\n      }\n      await expect(async () => {\n        await sanitizeCollection(\n          // @ts-expect-error\n          {\n            ...config,\n            collections: [collectionConfig],\n          },\n          collectionConfig,\n        )\n      }).not.toThrow()\n    })\n\n    it('should not throw on default field: email if auth is enabled', async () => {\n      const collectionConfig: CollectionConfig = {\n        ...defaultCollection,\n        auth: true,\n        admin: {\n          useAsTitle: 'email',\n        },\n      }\n      await expect(async () => {\n        await sanitizeCollection(\n          // @ts-expect-error\n          {\n            ...config,\n            collections: [collectionConfig],\n          },\n          collectionConfig,\n        )\n      }).not.toThrow()\n    })\n    it('should throw on default field: email if auth is not enabled', async () => {\n      const collectionConfig: CollectionConfig = {\n        ...defaultCollection,\n        admin: {\n          useAsTitle: 'email',\n        },\n      }\n      await expect(async () => {\n        await sanitizeCollection(\n          // @ts-expect-error\n          {\n            ...config,\n            collections: [collectionConfig],\n          },\n          collectionConfig,\n        )\n      }).rejects.toThrow(InvalidConfiguration)\n    })\n  })\n})\n"],"names":["InvalidConfiguration","sanitizeCollection","describe","it","expect","config","collections","globals","defaultCollection","slug","fields","name","type","collectionConfig","admin","useAsTitle","rejects","toThrow","not","tabs","label","auth"],"mappings":"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"}