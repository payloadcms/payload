{"version":3,"sources":["../../src/utilities/createLocalReq.spec.ts"],"sourcesContent":["import { describe, expect, it, vi } from 'vitest'\n\nimport type { Payload } from '../index.js'\n\nimport { createLocalReq } from './createLocalReq.js'\n\ndescribe('createLocalReq - URL construction', () => {\n  const mockPayload = {\n    config: {\n      serverURL: undefined,\n      i18n: {\n        fallbackLanguage: 'en',\n        supportedLanguages: { en: {} },\n        translations: {},\n      },\n      localization: undefined,\n    },\n    logger: {\n      error: vi.fn(),\n    },\n  } as unknown as Payload\n\n  it('should use req.url when provided and serverURL is undefined', async () => {\n    const req = {\n      url: 'http://example.com/api/test',\n    }\n\n    const result = await createLocalReq({ req }, mockPayload)\n\n    expect(result.url).toBe('http://example.com/api/test')\n    expect(mockPayload.logger.error).not.toHaveBeenCalled()\n  })\n\n  it('should use serverURL when req.url is not provided', async () => {\n    const payloadWithServerURL = {\n      config: {\n        serverURL: 'http://configured-server.com',\n        i18n: {\n          fallbackLanguage: 'en',\n          supportedLanguages: { en: {} },\n          translations: {},\n        },\n        localization: undefined,\n      },\n      logger: {\n        error: vi.fn(),\n      },\n    } as unknown as Payload\n\n    const req = {}\n\n    const result = await createLocalReq({ req, urlSuffix: '/api' }, payloadWithServerURL)\n\n    expect(result.url).toContain('http://configured-server.com/api')\n    expect(payloadWithServerURL.logger.error).not.toHaveBeenCalled()\n  })\n\n  it('should prioritize req.url over serverURL', async () => {\n    const payloadWithServerURL = {\n      config: {\n        serverURL: 'http://configured-server.com',\n        i18n: {\n          fallbackLanguage: 'en',\n          supportedLanguages: { en: {} },\n          translations: {},\n        },\n        localization: undefined,\n      },\n      logger: {\n        error: vi.fn(),\n      },\n    } as unknown as Payload\n\n    const req = {\n      url: 'http://actual-request.com/api/test',\n    }\n\n    const result = await createLocalReq({ req }, payloadWithServerURL)\n\n    expect(result.url).toBe('http://actual-request.com/api/test')\n    expect(payloadWithServerURL.logger.error).not.toHaveBeenCalled()\n  })\n\n  it('should fall back to localhost when neither req.url nor serverURL provided', async () => {\n    const req = {}\n\n    const result = await createLocalReq({ req }, mockPayload)\n\n    expect(result.url).toBe('http://localhost/')\n    expect(mockPayload.logger.error).not.toHaveBeenCalled()\n  })\n\n  it('should append urlSuffix to serverURL when used', async () => {\n    const payloadWithServerURL = {\n      config: {\n        serverURL: 'http://configured-server.com',\n        i18n: {\n          fallbackLanguage: 'en',\n          supportedLanguages: { en: {} },\n          translations: {},\n        },\n        localization: undefined,\n      },\n      logger: {\n        error: vi.fn(),\n      },\n    } as unknown as Payload\n\n    const req = {}\n\n    const result = await createLocalReq({ req, urlSuffix: '/api/preview' }, payloadWithServerURL)\n\n    expect(result.url).toContain('/api/preview')\n    expect(payloadWithServerURL.logger.error).not.toHaveBeenCalled()\n  })\n\n  it('should append urlSuffix to fallback URL when neither req.url nor serverURL provided', async () => {\n    const req = {}\n\n    const result = await createLocalReq({ req, urlSuffix: '/api/test' }, mockPayload)\n\n    expect(result.url).toBe('http://localhost/api/test')\n    expect(mockPayload.logger.error).not.toHaveBeenCalled()\n  })\n})\n"],"names":["describe","expect","it","vi","createLocalReq","mockPayload","config","serverURL","undefined","i18n","fallbackLanguage","supportedLanguages","en","translations","localization","logger","error","fn","req","url","result","toBe","not","toHaveBeenCalled","payloadWithServerURL","urlSuffix","toContain"],"mappings":"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"}