{"version":3,"sources":["../../../src/ui/VariantOptionsSelector/index.tsx"],"sourcesContent":["import type { SelectFieldServerProps } from 'payload'\n\nimport { FieldLabel } from '@payloadcms/ui'\n\nimport { ErrorBox } from './ErrorBox.js'\nimport './index.css'\nimport { OptionsSelect } from './OptionsSelect.js'\n\ntype Props = {} & SelectFieldServerProps\n\nexport const VariantOptionsSelector: React.FC<Props> = async (props) => {\n  const { clientField, data, field, path, req, user } = props\n  const { label } = clientField\n\n  // Get collection slugs from field custom prop, with defaults for backwards compatibility\n  const productsSlug = (field.custom?.productsSlug as string) || 'products'\n  const variantTypesSlug = (field.custom?.variantTypesSlug as string) || 'variantTypes'\n\n  const product = await req.payload.findByID({\n    id: data.product,\n    collection: productsSlug,\n    depth: 0,\n    draft: true,\n    select: {\n      variants: true,\n      variantTypes: true,\n    },\n    user,\n  })\n\n  // @ts-expect-error - TODO: Fix types\n  const existingVariantOptions = product.variants?.docs?.map((variant) => variant.options) ?? []\n\n  const variantTypeIDs = product.variantTypes\n\n  const variantTypes = []\n\n  // Need to get the variant types separately so that the options are populated\n  // @ts-expect-error - TODO: Fix types\n  if (variantTypeIDs?.length && variantTypeIDs.length > 0) {\n    // @ts-expect-error - TODO: Fix types\n    for (const variantTypeID of variantTypeIDs) {\n      const variantType = await req.payload.findByID({\n        id: variantTypeID,\n        collection: variantTypesSlug,\n        depth: 1,\n        joins: {\n          options: {\n            sort: 'value',\n          },\n        },\n      })\n\n      if (variantType) {\n        variantTypes.push(variantType)\n      }\n    }\n  }\n\n  return (\n    <div className=\"variantOptionsSelector\">\n      <div className=\"variantOptionsSelectorHeading\">\n        <FieldLabel as=\"span\" label={label} />\n      </div>\n\n      <ErrorBox existingOptions={existingVariantOptions} path={path}>\n        <div className=\"variantOptionsSelectorList\">\n          {variantTypes.map((type) => {\n            // @ts-expect-error - TODO: Fix types\n            const options = type.options.docs.map((option) => ({\n              label: option.label,\n              value: option.id,\n            }))\n\n            return (\n              <OptionsSelect\n                field={clientField}\n                key={type.name}\n                label={type.label || type.name}\n                options={options}\n                path={path}\n              />\n            )\n          })}\n        </div>\n      </ErrorBox>\n    </div>\n  )\n}\n"],"names":["FieldLabel","ErrorBox","OptionsSelect","VariantOptionsSelector","props","clientField","data","field","path","req","user","label","productsSlug","custom","variantTypesSlug","product","payload","findByID","id","collection","depth","draft","select","variants","variantTypes","existingVariantOptions","docs","map","variant","options","variantTypeIDs","length","variantTypeID","variantType","joins","sort","push","div","className","as","existingOptions","type","option","value","name"],"mappings":";AAEA,SAASA,UAAU,QAAQ,iBAAgB;AAE3C,SAASC,QAAQ,QAAQ,gBAAe;AACxC,OAAO,cAAa;AACpB,SAASC,aAAa,QAAQ,qBAAoB;AAIlD,OAAO,MAAMC,yBAA0C,OAAOC;IAC5D,MAAM,EAAEC,WAAW,EAAEC,IAAI,EAAEC,KAAK,EAAEC,IAAI,EAAEC,GAAG,EAAEC,IAAI,EAAE,GAAGN;IACtD,MAAM,EAAEO,KAAK,EAAE,GAAGN;IAElB,yFAAyF;IACzF,MAAMO,eAAe,AAACL,MAAMM,MAAM,EAAED,gBAA2B;IAC/D,MAAME,mBAAmB,AAACP,MAAMM,MAAM,EAAEC,oBAA+B;IAEvE,MAAMC,UAAU,MAAMN,IAAIO,OAAO,CAACC,QAAQ,CAAC;QACzCC,IAAIZ,KAAKS,OAAO;QAChBI,YAAYP;QACZQ,OAAO;QACPC,OAAO;QACPC,QAAQ;YACNC,UAAU;YACVC,cAAc;QAChB;QACAd;IACF;IAEA,qCAAqC;IACrC,MAAMe,yBAAyBV,QAAQQ,QAAQ,EAAEG,MAAMC,IAAI,CAACC,UAAYA,QAAQC,OAAO,KAAK,EAAE;IAE9F,MAAMC,iBAAiBf,QAAQS,YAAY;IAE3C,MAAMA,eAAe,EAAE;IAEvB,6EAA6E;IAC7E,qCAAqC;IACrC,IAAIM,gBAAgBC,UAAUD,eAAeC,MAAM,GAAG,GAAG;QACvD,qCAAqC;QACrC,KAAK,MAAMC,iBAAiBF,eAAgB;YAC1C,MAAMG,cAAc,MAAMxB,IAAIO,OAAO,CAACC,QAAQ,CAAC;gBAC7CC,IAAIc;gBACJb,YAAYL;gBACZM,OAAO;gBACPc,OAAO;oBACLL,SAAS;wBACPM,MAAM;oBACR;gBACF;YACF;YAEA,IAAIF,aAAa;gBACfT,aAAaY,IAAI,CAACH;YACpB;QACF;IACF;IAEA,qBACE,MAACI;QAAIC,WAAU;;0BACb,KAACD;gBAAIC,WAAU;0BACb,cAAA,KAACtC;oBAAWuC,IAAG;oBAAO5B,OAAOA;;;0BAG/B,KAACV;gBAASuC,iBAAiBf;gBAAwBjB,MAAMA;0BACvD,cAAA,KAAC6B;oBAAIC,WAAU;8BACZd,aAAaG,GAAG,CAAC,CAACc;wBACjB,qCAAqC;wBACrC,MAAMZ,UAAUY,KAAKZ,OAAO,CAACH,IAAI,CAACC,GAAG,CAAC,CAACe,SAAY,CAAA;gCACjD/B,OAAO+B,OAAO/B,KAAK;gCACnBgC,OAAOD,OAAOxB,EAAE;4BAClB,CAAA;wBAEA,qBACE,KAAChB;4BACCK,OAAOF;4BAEPM,OAAO8B,KAAK9B,KAAK,IAAI8B,KAAKG,IAAI;4BAC9Bf,SAASA;4BACTrB,MAAMA;2BAHDiC,KAAKG,IAAI;oBAMpB;;;;;AAKV,EAAC"}