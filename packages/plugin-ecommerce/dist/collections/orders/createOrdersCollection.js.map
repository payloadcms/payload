{"version":3,"sources":["../../../src/collections/orders/createOrdersCollection.ts"],"sourcesContent":["import type { CollectionConfig, Field } from 'payload'\n\nimport type { AccessConfig, CurrenciesConfig } from '../../types/index.js'\n\nimport { amountField } from '../../fields/amountField.js'\nimport { cartItemsField } from '../../fields/cartItemsField.js'\nimport { currencyField } from '../../fields/currencyField.js'\nimport { accessOR } from '../../utilities/accessComposition.js'\n\ntype Props = {\n  access: Pick<AccessConfig, 'adminOnlyFieldAccess' | 'isAdmin' | 'isDocumentOwner'>\n  /**\n   * Array of fields used for capturing the shipping address data.\n   */\n  addressFields?: Field[]\n  currenciesConfig?: CurrenciesConfig\n  /**\n   * Slug of the customers collection, defaults to 'users'.\n   */\n  customersSlug?: string\n  enableVariants?: boolean\n  /**\n   * Slug of the products collection, defaults to 'products'.\n   */\n  productsSlug?: string\n  /**\n   * Slug of the transactions collection, defaults to 'transactions'.\n   */\n  transactionsSlug?: string\n  /**\n   * Slug of the variants collection, defaults to 'variants'.\n   */\n  variantsSlug?: string\n}\n\nexport const createOrdersCollection: (props: Props) => CollectionConfig = (props) => {\n  const {\n    access,\n    addressFields,\n    currenciesConfig,\n    customersSlug = 'users',\n    enableVariants = false,\n    productsSlug = 'products',\n    transactionsSlug = 'transactions',\n    variantsSlug = 'variants',\n  } = props || {}\n\n  const fields: Field[] = [\n    {\n      type: 'tabs',\n      tabs: [\n        {\n          fields: [\n            cartItemsField({\n              enableVariants,\n              overrides: {\n                name: 'items',\n                label: ({ t }) =>\n                  // @ts-expect-error - translations are not typed in plugins yet\n                  t('plugin-ecommerce:items'),\n                labels: {\n                  plural: ({ t }) =>\n                    // @ts-expect-error - translations are not typed in plugins yet\n                    t('plugin-ecommerce:items'),\n                  singular: ({ t }) =>\n                    // @ts-expect-error - translations are not typed in plugins yet\n                    t('plugin-ecommerce:item'),\n                },\n              },\n              productsSlug,\n              variantsSlug,\n            }),\n          ],\n          label: ({ t }) =>\n            // @ts-expect-error - translations are not typed in plugins yet\n            t('plugin-ecommerce:orderDetails'),\n        },\n        {\n          fields: [\n            ...(addressFields\n              ? [\n                  {\n                    name: 'shippingAddress',\n                    type: 'group',\n                    fields: addressFields,\n                    label: ({ t }) =>\n                      // @ts-expect-error - translations are not typed in plugins yet\n                      t('plugin-ecommerce:shippingAddress'),\n                  } as Field,\n                ]\n              : []),\n          ],\n          label: ({ t }) =>\n            // @ts-expect-error - translations are not typed in plugins yet\n            t('plugin-ecommerce:shipping'),\n        },\n      ],\n    },\n    {\n      name: 'customer',\n      type: 'relationship',\n      admin: {\n        position: 'sidebar',\n      },\n      label: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:customer'),\n      relationTo: customersSlug,\n    },\n    {\n      name: 'customerEmail',\n      type: 'email',\n      admin: {\n        position: 'sidebar',\n      },\n      label: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:customerEmail'),\n    },\n    {\n      name: 'transactions',\n      type: 'relationship',\n      access: {\n        create: access.adminOnlyFieldAccess,\n        read: access.adminOnlyFieldAccess,\n        update: access.adminOnlyFieldAccess,\n      },\n      admin: {\n        position: 'sidebar',\n      },\n      hasMany: true,\n      label: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:transactions'),\n      relationTo: transactionsSlug,\n    },\n    {\n      name: 'status',\n      type: 'select',\n      admin: {\n        position: 'sidebar',\n      },\n      defaultValue: 'processing',\n      interfaceName: 'OrderStatus',\n      label: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:status'),\n      options: [\n        {\n          // @ts-expect-error - translations are not typed in plugins yet\n          label: ({ t }) => t('plugin-ecommerce:processing'),\n          value: 'processing',\n        },\n        {\n          // @ts-expect-error - translations are not typed in plugins yet\n          label: ({ t }) => t('plugin-ecommerce:completed'),\n          value: 'completed',\n        },\n        {\n          // @ts-expect-error - translations are not typed in plugins yet\n          label: ({ t }) => t('plugin-ecommerce:cancelled'),\n          value: 'cancelled',\n        },\n        {\n          // @ts-expect-error - translations are not typed in plugins yet\n          label: ({ t }) => t('plugin-ecommerce:refunded'),\n          value: 'refunded',\n        },\n      ],\n    },\n\n    ...(currenciesConfig\n      ? [\n          {\n            type: 'row',\n            admin: {\n              position: 'sidebar',\n            },\n            fields: [\n              amountField({\n                currenciesConfig,\n              }),\n              currencyField({\n                currenciesConfig,\n              }),\n            ],\n          } as Field,\n        ]\n      : []),\n  ]\n\n  const baseConfig: CollectionConfig = {\n    slug: 'orders',\n    access: {\n      create: access.isAdmin,\n      delete: access.isAdmin,\n      read: accessOR(access.isAdmin, access.isDocumentOwner),\n      update: access.isAdmin,\n    },\n    admin: {\n      description: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:ordersCollectionDescription'),\n      group: 'Ecommerce',\n      useAsTitle: 'createdAt',\n    },\n    fields,\n    labels: {\n      plural: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:orders'),\n      singular: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:order'),\n    },\n    timestamps: true,\n  }\n\n  return { ...baseConfig }\n}\n"],"names":["amountField","cartItemsField","currencyField","accessOR","createOrdersCollection","props","access","addressFields","currenciesConfig","customersSlug","enableVariants","productsSlug","transactionsSlug","variantsSlug","fields","type","tabs","overrides","name","label","t","labels","plural","singular","admin","position","relationTo","create","adminOnlyFieldAccess","read","update","hasMany","defaultValue","interfaceName","options","value","baseConfig","slug","isAdmin","delete","isDocumentOwner","description","group","useAsTitle","timestamps"],"mappings":"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"}