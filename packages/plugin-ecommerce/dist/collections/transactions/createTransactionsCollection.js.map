{"version":3,"sources":["../../../src/collections/transactions/createTransactionsCollection.ts"],"sourcesContent":["import type { CollectionConfig, Field } from 'payload'\n\nimport type { AccessConfig, CurrenciesConfig, PaymentAdapter } from '../../types/index.js'\n\nimport { amountField } from '../../fields/amountField.js'\nimport { cartItemsField } from '../../fields/cartItemsField.js'\nimport { currencyField } from '../../fields/currencyField.js'\nimport { statusField } from '../../fields/statusField.js'\n\ntype Props = {\n  access: Pick<AccessConfig, 'isAdmin'>\n  /**\n   * Array of fields used for capturing the billing address.\n   */\n  addressFields?: Field[]\n  /**\n   * Slug of the carts collection, defaults to 'carts'.\n   */\n  cartsSlug?: string\n  currenciesConfig?: CurrenciesConfig\n  /**\n   * Slug of the customers collection, defaults to 'users'.\n   */\n  customersSlug?: string\n  /**\n   * Enable variants in the transactions collection.\n   */\n  enableVariants?: boolean\n  /**\n   * Slug of the orders collection, defaults to 'orders'.\n   */\n  ordersSlug?: string\n  paymentMethods?: PaymentAdapter[]\n  /**\n   * Slug of the products collection, defaults to 'products'.\n   */\n  productsSlug?: string\n  /**\n   * Slug of the variants collection, defaults to 'variants'.\n   */\n  variantsSlug?: string\n}\n\nexport const createTransactionsCollection: (props: Props) => CollectionConfig = (props) => {\n  const {\n    access,\n    addressFields,\n    cartsSlug = 'carts',\n    currenciesConfig,\n    customersSlug = 'users',\n    enableVariants = false,\n    ordersSlug = 'orders',\n    paymentMethods,\n    productsSlug = 'products',\n    variantsSlug = 'variants',\n  } = props || {}\n\n  const fields: Field[] = [\n    {\n      type: 'tabs',\n      tabs: [\n        {\n          fields: [\n            cartItemsField({\n              enableVariants,\n              overrides: {\n                name: 'items',\n                label: ({ t }) =>\n                  // @ts-expect-error - translations are not typed in plugins yet\n                  t('plugin-ecommerce:items'),\n                labels: {\n                  plural: ({ t }) =>\n                    // @ts-expect-error - translations are not typed in plugins yet\n                    t('plugin-ecommerce:items'),\n                  singular: ({ t }) =>\n                    // @ts-expect-error - translations are not typed in plugins yet\n                    t('plugin-ecommerce:item'),\n                },\n              },\n              productsSlug,\n              variantsSlug,\n            }),\n            ...(paymentMethods?.length && paymentMethods.length > 0\n              ? [\n                  {\n                    name: 'paymentMethod',\n                    type: 'select',\n                    label: ({ t }) =>\n                      // @ts-expect-error - translations are not typed in plugins yet\n                      t('plugin-ecommerce:paymentMethod'),\n                    options: paymentMethods.map((method) => ({\n                      label: method.label ?? method.name,\n                      value: method.name,\n                    })),\n                  } as Field,\n                  ...(paymentMethods.map((method) => method.group) || []),\n                ]\n              : []),\n          ],\n          label: ({ t }) =>\n            // @ts-expect-error - translations are not typed in plugins yet\n            t('plugin-ecommerce:transactionDetails'),\n        },\n        {\n          fields: [\n            ...(addressFields\n              ? [\n                  {\n                    name: 'billingAddress',\n                    type: 'group',\n                    fields: addressFields,\n                    label: ({ t }) =>\n                      // @ts-expect-error - translations are not typed in plugins yet\n                      t('plugin-ecommerce:billingAddress'),\n                  } as Field,\n                ]\n              : []),\n          ],\n          label: ({ t }) =>\n            // @ts-expect-error - translations are not typed in plugins yet\n            t('plugin-ecommerce:billing'),\n        },\n      ],\n    },\n    statusField({\n      overrides: {\n        admin: {\n          position: 'sidebar',\n        },\n      },\n    }),\n    {\n      name: 'customer',\n      type: 'relationship',\n      admin: {\n        position: 'sidebar',\n      },\n      label: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:customer'),\n      relationTo: customersSlug,\n    },\n    {\n      name: 'customerEmail',\n      type: 'email',\n      admin: {\n        position: 'sidebar',\n      },\n      label: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:customerEmail'),\n    },\n    {\n      name: 'order',\n      type: 'relationship',\n      admin: {\n        position: 'sidebar',\n      },\n      label: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:order'),\n      relationTo: ordersSlug,\n    },\n    {\n      name: 'cart',\n      type: 'relationship',\n      admin: {\n        position: 'sidebar',\n      },\n      relationTo: cartsSlug,\n    },\n    ...(currenciesConfig\n      ? [\n          {\n            type: 'row',\n            admin: {\n              position: 'sidebar',\n            },\n            fields: [\n              amountField({\n                currenciesConfig,\n              }),\n              currencyField({\n                currenciesConfig,\n              }),\n            ],\n          } as Field,\n        ]\n      : []),\n  ]\n\n  const baseConfig: CollectionConfig = {\n    slug: 'transactions',\n    access: {\n      create: access.isAdmin,\n      delete: access.isAdmin,\n      read: access.isAdmin,\n      update: access.isAdmin,\n    },\n    admin: {\n      defaultColumns: ['createdAt', 'customer', 'order', 'amount', 'status'],\n      description: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:transactionsCollectionDescription'),\n      group: 'Ecommerce',\n    },\n    fields,\n    labels: {\n      plural: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:transactions'),\n      singular: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:transaction'),\n    },\n  }\n\n  return { ...baseConfig }\n}\n"],"names":["amountField","cartItemsField","currencyField","statusField","createTransactionsCollection","props","access","addressFields","cartsSlug","currenciesConfig","customersSlug","enableVariants","ordersSlug","paymentMethods","productsSlug","variantsSlug","fields","type","tabs","overrides","name","label","t","labels","plural","singular","length","options","map","method","value","group","admin","position","relationTo","baseConfig","slug","create","isAdmin","delete","read","update","defaultColumns","description"],"mappings":"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"}