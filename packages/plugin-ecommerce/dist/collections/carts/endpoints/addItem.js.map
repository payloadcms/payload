{"version":3,"sources":["../../../../src/collections/carts/endpoints/addItem.ts"],"sourcesContent":["import type { CollectionSlug, Endpoint } from 'payload'\n\nimport { addDataAndFileToRequest } from 'payload'\n\nimport type { CartItemMatcher } from '../operations/types.js'\n\nimport { addItem } from '../operations/addItem.js'\n\ntype Args = {\n  cartItemMatcher?: CartItemMatcher\n  cartsSlug: CollectionSlug\n}\n\n/**\n * Creates an endpoint handler for adding items to a cart.\n *\n * Route: POST /api/{cartsSlug}/:id/add-item\n *\n * Request body:\n * - item: { product: string, variant?: string, ...customFields }\n * - quantity?: number (defaults to 1)\n * - secret?: string (for guest cart access)\n */\nexport const addItemEndpoint = ({ cartItemMatcher, cartsSlug }: Args): Endpoint => ({\n  handler: async (req) => {\n    await addDataAndFileToRequest(req)\n\n    const cartID = req.routeParams?.id as string | undefined\n    const data = req.data as {\n      item?: { [key: string]: unknown; product: string; variant?: string }\n      quantity?: number\n      secret?: string\n    }\n\n    if (!cartID) {\n      return Response.json({ message: 'Cart ID is required', success: false }, { status: 400 })\n    }\n\n    if (!data?.item?.product) {\n      return Response.json(\n        { message: 'Item with product ID is required', success: false },\n        { status: 400 },\n      )\n    }\n\n    const result = await addItem({\n      cartID,\n      cartItemMatcher,\n      cartsSlug,\n      item: data.item,\n      payload: req.payload,\n      quantity: data.quantity,\n      req,\n      secret: data.secret,\n    })\n\n    if (!result.success) {\n      return Response.json(result, { status: 404 })\n    }\n\n    return Response.json(result)\n  },\n  method: 'post',\n  path: '/:id/add-item',\n})\n"],"names":["addDataAndFileToRequest","addItem","addItemEndpoint","cartItemMatcher","cartsSlug","handler","req","cartID","routeParams","id","data","Response","json","message","success","status","item","product","result","payload","quantity","secret","method","path"],"mappings":"AAEA,SAASA,uBAAuB,QAAQ,UAAS;AAIjD,SAASC,OAAO,QAAQ,2BAA0B;AAOlD;;;;;;;;;CASC,GACD,OAAO,MAAMC,kBAAkB,CAAC,EAAEC,eAAe,EAAEC,SAAS,EAAQ,GAAgB,CAAA;QAClFC,SAAS,OAAOC;YACd,MAAMN,wBAAwBM;YAE9B,MAAMC,SAASD,IAAIE,WAAW,EAAEC;YAChC,MAAMC,OAAOJ,IAAII,IAAI;YAMrB,IAAI,CAACH,QAAQ;gBACX,OAAOI,SAASC,IAAI,CAAC;oBAAEC,SAAS;oBAAuBC,SAAS;gBAAM,GAAG;oBAAEC,QAAQ;gBAAI;YACzF;YAEA,IAAI,CAACL,MAAMM,MAAMC,SAAS;gBACxB,OAAON,SAASC,IAAI,CAClB;oBAAEC,SAAS;oBAAoCC,SAAS;gBAAM,GAC9D;oBAAEC,QAAQ;gBAAI;YAElB;YAEA,MAAMG,SAAS,MAAMjB,QAAQ;gBAC3BM;gBACAJ;gBACAC;gBACAY,MAAMN,KAAKM,IAAI;gBACfG,SAASb,IAAIa,OAAO;gBACpBC,UAAUV,KAAKU,QAAQ;gBACvBd;gBACAe,QAAQX,KAAKW,MAAM;YACrB;YAEA,IAAI,CAACH,OAAOJ,OAAO,EAAE;gBACnB,OAAOH,SAASC,IAAI,CAACM,QAAQ;oBAAEH,QAAQ;gBAAI;YAC7C;YAEA,OAAOJ,SAASC,IAAI,CAACM;QACvB;QACAI,QAAQ;QACRC,MAAM;IACR,CAAA,EAAE"}