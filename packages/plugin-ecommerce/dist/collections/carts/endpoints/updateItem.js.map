{"version":3,"sources":["../../../../src/collections/carts/endpoints/updateItem.ts"],"sourcesContent":["import type { CollectionSlug, Endpoint } from 'payload'\n\nimport { addDataAndFileToRequest } from 'payload'\n\nimport type { FieldWithOperator } from '../operations/types.js'\n\nimport { updateItem } from '../operations/updateItem.js'\n\ntype Args = {\n  cartsSlug: CollectionSlug\n}\n\n/**\n * Creates an endpoint handler for updating an item in a cart.\n * Supports MongoDB-style operators for flexible updates.\n *\n * Route: POST /api/{cartsSlug}/:id/update-item\n *\n * Request body:\n * - itemID: string (the cart item row ID to update)\n * - quantity: number | { $inc: number } (set or increment/decrement)\n * - removeOnZero?: boolean (defaults to true, removes item if quantity reaches 0)\n * - secret?: string (for guest cart access)\n *\n * @example\n * ```ts\n * // Set quantity to 5\n * fetch('/api/carts/123/update-item', {\n *   method: 'POST',\n *   body: JSON.stringify({ itemID: 'item-456', quantity: 5 })\n * })\n *\n * // Increment by 1\n * fetch('/api/carts/123/update-item', {\n *   method: 'POST',\n *   body: JSON.stringify({ itemID: 'item-456', quantity: { $inc: 1 } })\n * })\n *\n * // Decrement by 1\n * fetch('/api/carts/123/update-item', {\n *   method: 'POST',\n *   body: JSON.stringify({ itemID: 'item-456', quantity: { $inc: -1 } })\n * })\n * ```\n */\nexport const updateItemEndpoint = ({ cartsSlug }: Args): Endpoint => ({\n  handler: async (req) => {\n    await addDataAndFileToRequest(req)\n\n    const cartID = req.routeParams?.id as string | undefined\n    const data = req.data as {\n      itemID?: string\n      quantity?: FieldWithOperator<number>\n      removeOnZero?: boolean\n      secret?: string\n    }\n\n    if (!cartID) {\n      return Response.json({ message: 'Cart ID is required', success: false }, { status: 400 })\n    }\n\n    if (!data?.itemID) {\n      return Response.json({ message: 'Item ID is required', success: false }, { status: 400 })\n    }\n\n    if (data?.quantity === undefined) {\n      return Response.json({ message: 'Quantity is required', success: false }, { status: 400 })\n    }\n\n    // Validate quantity format\n    const isValidQuantity =\n      typeof data.quantity === 'number' ||\n      (typeof data.quantity === 'object' &&\n        data.quantity !== null &&\n        '$inc' in data.quantity &&\n        typeof data.quantity.$inc === 'number')\n\n    if (!isValidQuantity) {\n      return Response.json(\n        {\n          message: 'Quantity must be a number or { $inc: number }',\n          success: false,\n        },\n        { status: 400 },\n      )\n    }\n\n    const result = await updateItem({\n      cartID,\n      cartsSlug,\n      itemID: data.itemID,\n      payload: req.payload,\n      quantity: data.quantity,\n      removeOnZero: data.removeOnZero,\n      req,\n      secret: data.secret,\n    })\n\n    if (!result.success) {\n      return Response.json(result, { status: 404 })\n    }\n\n    return Response.json(result)\n  },\n  method: 'post',\n  path: '/:id/update-item',\n})\n"],"names":["addDataAndFileToRequest","updateItem","updateItemEndpoint","cartsSlug","handler","req","cartID","routeParams","id","data","Response","json","message","success","status","itemID","quantity","undefined","isValidQuantity","$inc","result","payload","removeOnZero","secret","method","path"],"mappings":"AAEA,SAASA,uBAAuB,QAAQ,UAAS;AAIjD,SAASC,UAAU,QAAQ,8BAA6B;AAMxD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAgCC,GACD,OAAO,MAAMC,qBAAqB,CAAC,EAAEC,SAAS,EAAQ,GAAgB,CAAA;QACpEC,SAAS,OAAOC;YACd,MAAML,wBAAwBK;YAE9B,MAAMC,SAASD,IAAIE,WAAW,EAAEC;YAChC,MAAMC,OAAOJ,IAAII,IAAI;YAOrB,IAAI,CAACH,QAAQ;gBACX,OAAOI,SAASC,IAAI,CAAC;oBAAEC,SAAS;oBAAuBC,SAAS;gBAAM,GAAG;oBAAEC,QAAQ;gBAAI;YACzF;YAEA,IAAI,CAACL,MAAMM,QAAQ;gBACjB,OAAOL,SAASC,IAAI,CAAC;oBAAEC,SAAS;oBAAuBC,SAAS;gBAAM,GAAG;oBAAEC,QAAQ;gBAAI;YACzF;YAEA,IAAIL,MAAMO,aAAaC,WAAW;gBAChC,OAAOP,SAASC,IAAI,CAAC;oBAAEC,SAAS;oBAAwBC,SAAS;gBAAM,GAAG;oBAAEC,QAAQ;gBAAI;YAC1F;YAEA,2BAA2B;YAC3B,MAAMI,kBACJ,OAAOT,KAAKO,QAAQ,KAAK,YACxB,OAAOP,KAAKO,QAAQ,KAAK,YACxBP,KAAKO,QAAQ,KAAK,QAClB,UAAUP,KAAKO,QAAQ,IACvB,OAAOP,KAAKO,QAAQ,CAACG,IAAI,KAAK;YAElC,IAAI,CAACD,iBAAiB;gBACpB,OAAOR,SAASC,IAAI,CAClB;oBACEC,SAAS;oBACTC,SAAS;gBACX,GACA;oBAAEC,QAAQ;gBAAI;YAElB;YAEA,MAAMM,SAAS,MAAMnB,WAAW;gBAC9BK;gBACAH;gBACAY,QAAQN,KAAKM,MAAM;gBACnBM,SAAShB,IAAIgB,OAAO;gBACpBL,UAAUP,KAAKO,QAAQ;gBACvBM,cAAcb,KAAKa,YAAY;gBAC/BjB;gBACAkB,QAAQd,KAAKc,MAAM;YACrB;YAEA,IAAI,CAACH,OAAOP,OAAO,EAAE;gBACnB,OAAOH,SAASC,IAAI,CAACS,QAAQ;oBAAEN,QAAQ;gBAAI;YAC7C;YAEA,OAAOJ,SAASC,IAAI,CAACS;QACvB;QACAI,QAAQ;QACRC,MAAM;IACR,CAAA,EAAE"}