{"version":3,"sources":["../../../../src/collections/carts/operations/removeItem.ts"],"sourcesContent":["import type { CartItemData, CartOperationResult, RemoveItemArgs } from './types.js'\n\nimport { createRequestWithSecret } from './createRequestWithSecret.js'\n\n/**\n * Removes an item from a cart by its row ID.\n *\n * This handler is isolated and can be used from:\n * - Custom endpoints\n * - Local API operations\n * - Hooks\n *\n * @example\n * ```ts\n * const result = await removeItem({\n *   payload,\n *   cartsSlug: 'carts',\n *   cartID: '123',\n *   itemID: 'item-row-id',\n * })\n * ```\n */\nexport const removeItem = async (args: RemoveItemArgs): Promise<CartOperationResult> => {\n  const { cartID, cartsSlug, itemID, payload, req, secret } = args\n\n  // Inject secret into request context for access control\n  const reqWithSecret = createRequestWithSecret(req, secret)\n\n  const cart = await payload.findByID({\n    id: cartID,\n    collection: cartsSlug,\n    depth: 0,\n    overrideAccess: false,\n    req: reqWithSecret,\n  })\n\n  if (!cart) {\n    return {\n      cart: null,\n      message: `Cart with ID ${cartID} not found`,\n      success: false,\n    }\n  }\n\n  const existingItems: CartItemData[] = (cart.items as CartItemData[]) || []\n\n  // Find the item by its row ID\n  const itemIndex = existingItems.findIndex((item) => item.id === itemID)\n\n  if (itemIndex === -1) {\n    return {\n      cart,\n      message: `Item with ID ${itemID} not found in cart`,\n      success: false,\n    }\n  }\n\n  // Remove the item\n  const updatedItems = [...existingItems]\n  updatedItems.splice(itemIndex, 1)\n\n  const updatedCart = await payload.update({\n    id: cartID,\n    collection: cartsSlug,\n    data: {\n      items: updatedItems,\n    },\n    depth: 0,\n    overrideAccess: false,\n    req: reqWithSecret,\n  })\n\n  return {\n    cart: updatedCart,\n    message: 'Item removed from cart',\n    success: true,\n  }\n}\n"],"names":["createRequestWithSecret","removeItem","args","cartID","cartsSlug","itemID","payload","req","secret","reqWithSecret","cart","findByID","id","collection","depth","overrideAccess","message","success","existingItems","items","itemIndex","findIndex","item","updatedItems","splice","updatedCart","update","data"],"mappings":"AAEA,SAASA,uBAAuB,QAAQ,+BAA8B;AAEtE;;;;;;;;;;;;;;;;;CAiBC,GACD,OAAO,MAAMC,aAAa,OAAOC;IAC/B,MAAM,EAAEC,MAAM,EAAEC,SAAS,EAAEC,MAAM,EAAEC,OAAO,EAAEC,GAAG,EAAEC,MAAM,EAAE,GAAGN;IAE5D,wDAAwD;IACxD,MAAMO,gBAAgBT,wBAAwBO,KAAKC;IAEnD,MAAME,OAAO,MAAMJ,QAAQK,QAAQ,CAAC;QAClCC,IAAIT;QACJU,YAAYT;QACZU,OAAO;QACPC,gBAAgB;QAChBR,KAAKE;IACP;IAEA,IAAI,CAACC,MAAM;QACT,OAAO;YACLA,MAAM;YACNM,SAAS,CAAC,aAAa,EAAEb,OAAO,UAAU,CAAC;YAC3Cc,SAAS;QACX;IACF;IAEA,MAAMC,gBAAgC,AAACR,KAAKS,KAAK,IAAuB,EAAE;IAE1E,8BAA8B;IAC9B,MAAMC,YAAYF,cAAcG,SAAS,CAAC,CAACC,OAASA,KAAKV,EAAE,KAAKP;IAEhE,IAAIe,cAAc,CAAC,GAAG;QACpB,OAAO;YACLV;YACAM,SAAS,CAAC,aAAa,EAAEX,OAAO,kBAAkB,CAAC;YACnDY,SAAS;QACX;IACF;IAEA,kBAAkB;IAClB,MAAMM,eAAe;WAAIL;KAAc;IACvCK,aAAaC,MAAM,CAACJ,WAAW;IAE/B,MAAMK,cAAc,MAAMnB,QAAQoB,MAAM,CAAC;QACvCd,IAAIT;QACJU,YAAYT;QACZuB,MAAM;YACJR,OAAOI;QACT;QACAT,OAAO;QACPC,gBAAgB;QAChBR,KAAKE;IACP;IAEA,OAAO;QACLC,MAAMe;QACNT,SAAS;QACTC,SAAS;IACX;AACF,EAAC"}