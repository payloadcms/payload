{"version":3,"sources":["../../../../src/collections/carts/operations/defaultCartItemMatcher.spec.ts"],"sourcesContent":["import { describe, expect, it } from 'vitest'\n\nimport type { CartItemData, NewCartItem } from './types.js'\n\nimport { defaultCartItemMatcher } from './defaultCartItemMatcher.js'\n\ndescribe('defaultCartItemMatcher', () => {\n  describe('product matching', () => {\n    it('should match when product IDs are equal (both strings)', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(true)\n    })\n\n    it('should not match when product IDs are different', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-456',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(false)\n    })\n\n    it('should match when existing product is populated object', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: { id: 'product-123', name: 'Test Product' } as any,\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(true)\n    })\n\n    it('should not match when product IDs differ (existing is object)', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: { id: 'product-123', name: 'Test Product' } as any,\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-456',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(false)\n    })\n  })\n\n  describe('variant matching', () => {\n    it('should match when both have same variant ID', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        variant: 'variant-abc',\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n        variant: 'variant-abc',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(true)\n    })\n\n    it('should not match when variants are different', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        variant: 'variant-abc',\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n        variant: 'variant-xyz',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(false)\n    })\n\n    it('should match when both have no variant', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(true)\n    })\n\n    it('should not match when existing has variant but new does not', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        variant: 'variant-abc',\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(false)\n    })\n\n    it('should not match when new has variant but existing does not', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n        variant: 'variant-abc',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(false)\n    })\n\n    it('should match when existing variant is populated object', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        variant: { id: 'variant-abc', name: 'Large' } as any,\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n        variant: 'variant-abc',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(true)\n    })\n\n    it('should not match when variant IDs differ (existing is object)', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        variant: { id: 'variant-abc', name: 'Large' } as any,\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n        variant: 'variant-xyz',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(false)\n    })\n  })\n\n  describe('combined product and variant matching', () => {\n    it('should match when both product and variant match', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        variant: 'variant-abc',\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n        variant: 'variant-abc',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(true)\n    })\n\n    it('should not match when product matches but variant does not', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        variant: 'variant-abc',\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n        variant: 'variant-xyz',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(false)\n    })\n\n    it('should not match when variant matches but product does not', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        variant: 'variant-abc',\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-456',\n        variant: 'variant-abc',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(false)\n    })\n\n    it('should not match when neither product nor variant match', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        variant: 'variant-abc',\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-456',\n        variant: 'variant-xyz',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(false)\n    })\n  })\n\n  describe('edge cases', () => {\n    it('should handle undefined variant in existing item', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        variant: undefined,\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(true)\n    })\n\n    it('should handle undefined variant in new item', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n        variant: undefined,\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(true)\n    })\n\n    it('should handle numeric product IDs', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 123 as any,\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 123 as any,\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(true)\n    })\n\n    it('should handle deeply nested product object', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: {\n          id: 'product-123',\n          name: 'Product',\n          category: { id: 'cat-1', name: 'Category' },\n        } as any,\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(true)\n    })\n\n    it('should handle both product and variant as populated objects', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: { id: 'product-123', name: 'Product' } as any,\n        variant: { id: 'variant-abc', name: 'Large' } as any,\n        quantity: 1,\n      }\n      const newItem: NewCartItem = {\n        product: 'product-123',\n        variant: 'variant-abc',\n      }\n\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(true)\n    })\n\n    it('should ignore other item properties', () => {\n      const existingItem: CartItemData = {\n        id: 'item-1',\n        product: 'product-123',\n        quantity: 5,\n        customProp: 'value-a',\n      } as CartItemData\n      const newItem: NewCartItem = {\n        product: 'product-123',\n        customProp: 'value-b',\n      } as NewCartItem\n\n      // Should match because only product/variant are checked\n      expect(defaultCartItemMatcher({ existingItem, newItem })).toBe(true)\n    })\n  })\n})\n"],"names":["describe","expect","it","defaultCartItemMatcher","existingItem","id","product","quantity","newItem","toBe","name","variant","undefined","category","customProp"],"mappings":"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"}