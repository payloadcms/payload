{"version":3,"sources":["../../../../src/collections/variants/createVariantsCollection/index.ts"],"sourcesContent":["import type { CollectionConfig, Field } from 'payload'\n\nimport type { AccessConfig, CurrenciesConfig, InventoryConfig } from '../../../types/index.js'\n\nimport { inventoryField } from '../../../fields/inventoryField.js'\nimport { pricesField } from '../../../fields/pricesField.js'\nimport { variantsCollectionBeforeChange as beforeChange } from './hooks/beforeChange.js'\nimport { validateOptions } from './hooks/validateOptions.js'\n\ntype Props = {\n  access: Pick<AccessConfig, 'adminOrPublishedStatus' | 'isAdmin'>\n  currenciesConfig?: CurrenciesConfig\n  /**\n   * Enables inventory tracking for variants. Defaults to true.\n   */\n  inventory?: boolean | InventoryConfig\n  /**\n   * Slug of the products collection, defaults to 'products'.\n   */\n  productsSlug?: string\n  /**\n   * Slug of the variant options collection, defaults to 'variantOptions'.\n   */\n  variantOptionsSlug?: string\n  /**\n   * Slug of the variant types collection, defaults to 'variantTypes'.\n   */\n  variantTypesSlug?: string\n}\n\nexport const createVariantsCollection: (props: Props) => CollectionConfig = (props) => {\n  const {\n    access,\n    currenciesConfig,\n    inventory = true,\n    productsSlug = 'products',\n    variantOptionsSlug = 'variantOptions',\n    variantTypesSlug = 'variantTypes',\n  } = props || {}\n  const { supportedCurrencies } = currenciesConfig || {}\n\n  const fields: Field[] = [\n    {\n      name: 'title',\n      type: 'text',\n      admin: {\n        description:\n          'Used for administrative purposes, not shown to customers. This is populated by default.',\n      },\n    },\n    {\n      name: 'product',\n      type: 'relationship',\n      admin: {\n        position: 'sidebar',\n        readOnly: true,\n      },\n      relationTo: productsSlug,\n      required: true,\n    },\n    {\n      // This might need to be a custom component, to show a selector for each variant that is\n      // enabled on the parent product\n      // - separate select inputs, each showing only a specific variant (w/ options)\n      // - it will save data to the DB as IDs in this relationship field\n      // and needs a validate function as well which enforces that the options are fully specified, and accurate\n      name: 'options',\n      type: 'relationship',\n      admin: {\n        components: {\n          Field: {\n            path: '@payloadcms/plugin-ecommerce/rsc#VariantOptionsSelector',\n          },\n        },\n      },\n      custom: {\n        productsSlug,\n        variantTypesSlug,\n      },\n      hasMany: true,\n      label: 'Variant options',\n      relationTo: variantOptionsSlug,\n      required: true,\n      validate: validateOptions({ productsCollectionSlug: productsSlug }),\n    },\n    ...(inventory ? [inventoryField()] : []),\n  ]\n\n  if (supportedCurrencies?.length && supportedCurrencies.length > 0) {\n    const currencyOptions: string[] = []\n\n    supportedCurrencies.forEach((currency) => {\n      currencyOptions.push(currency.code)\n    })\n\n    if (currenciesConfig) {\n      fields.push(...pricesField({ currenciesConfig }))\n    }\n  }\n\n  const baseConfig: CollectionConfig = {\n    slug: 'variants',\n    access: {\n      create: access.isAdmin,\n      delete: access.isAdmin,\n      read: access.adminOrPublishedStatus,\n      update: access.isAdmin,\n    },\n    admin: {\n      description: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:variantsCollectionDescription'),\n      group: false,\n      useAsTitle: 'title',\n    },\n    fields,\n    hooks: {\n      beforeChange: [beforeChange({ productsSlug, variantOptionsSlug })],\n    },\n    labels: {\n      plural: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:variants'),\n      singular: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:variant'),\n    },\n    trash: true,\n    versions: {\n      drafts: {\n        autosave: true,\n      },\n    },\n  }\n\n  return baseConfig\n}\n"],"names":["inventoryField","pricesField","variantsCollectionBeforeChange","beforeChange","validateOptions","createVariantsCollection","props","access","currenciesConfig","inventory","productsSlug","variantOptionsSlug","variantTypesSlug","supportedCurrencies","fields","name","type","admin","description","position","readOnly","relationTo","required","components","Field","path","custom","hasMany","label","validate","productsCollectionSlug","length","currencyOptions","forEach","currency","push","code","baseConfig","slug","create","isAdmin","delete","read","adminOrPublishedStatus","update","t","group","useAsTitle","hooks","labels","plural","singular","trash","versions","drafts","autosave"],"mappings":"AAIA,SAASA,cAAc,QAAQ,oCAAmC;AAClE,SAASC,WAAW,QAAQ,iCAAgC;AAC5D,SAASC,kCAAkCC,YAAY,QAAQ,0BAAyB;AACxF,SAASC,eAAe,QAAQ,6BAA4B;AAuB5D,OAAO,MAAMC,2BAA+D,CAACC;IAC3E,MAAM,EACJC,MAAM,EACNC,gBAAgB,EAChBC,YAAY,IAAI,EAChBC,eAAe,UAAU,EACzBC,qBAAqB,gBAAgB,EACrCC,mBAAmB,cAAc,EAClC,GAAGN,SAAS,CAAC;IACd,MAAM,EAAEO,mBAAmB,EAAE,GAAGL,oBAAoB,CAAC;IAErD,MAAMM,SAAkB;QACtB;YACEC,MAAM;YACNC,MAAM;YACNC,OAAO;gBACLC,aACE;YACJ;QACF;QACA;YACEH,MAAM;YACNC,MAAM;YACNC,OAAO;gBACLE,UAAU;gBACVC,UAAU;YACZ;YACAC,YAAYX;YACZY,UAAU;QACZ;QACA;YACE,wFAAwF;YACxF,gCAAgC;YAChC,8EAA8E;YAC9E,kEAAkE;YAClE,0GAA0G;YAC1GP,MAAM;YACNC,MAAM;YACNC,OAAO;gBACLM,YAAY;oBACVC,OAAO;wBACLC,MAAM;oBACR;gBACF;YACF;YACAC,QAAQ;gBACNhB;gBACAE;YACF;YACAe,SAAS;YACTC,OAAO;YACPP,YAAYV;YACZW,UAAU;YACVO,UAAUzB,gBAAgB;gBAAE0B,wBAAwBpB;YAAa;QACnE;WACID,YAAY;YAACT;SAAiB,GAAG,EAAE;KACxC;IAED,IAAIa,qBAAqBkB,UAAUlB,oBAAoBkB,MAAM,GAAG,GAAG;QACjE,MAAMC,kBAA4B,EAAE;QAEpCnB,oBAAoBoB,OAAO,CAAC,CAACC;YAC3BF,gBAAgBG,IAAI,CAACD,SAASE,IAAI;QACpC;QAEA,IAAI5B,kBAAkB;YACpBM,OAAOqB,IAAI,IAAIlC,YAAY;gBAAEO;YAAiB;QAChD;IACF;IAEA,MAAM6B,aAA+B;QACnCC,MAAM;QACN/B,QAAQ;YACNgC,QAAQhC,OAAOiC,OAAO;YACtBC,QAAQlC,OAAOiC,OAAO;YACtBE,MAAMnC,OAAOoC,sBAAsB;YACnCC,QAAQrC,OAAOiC,OAAO;QACxB;QACAvB,OAAO;YACLC,aAAa,CAAC,EAAE2B,CAAC,EAAE,GACjB,+DAA+D;gBAC/DA,EAAE;YACJC,OAAO;YACPC,YAAY;QACd;QACAjC;QACAkC,OAAO;YACL7C,cAAc;gBAACA,aAAa;oBAAEO;oBAAcC;gBAAmB;aAAG;QACpE;QACAsC,QAAQ;YACNC,QAAQ,CAAC,EAAEL,CAAC,EAAE,GACZ,+DAA+D;gBAC/DA,EAAE;YACJM,UAAU,CAAC,EAAEN,CAAC,EAAE,GACd,+DAA+D;gBAC/DA,EAAE;QACN;QACAO,OAAO;QACPC,UAAU;YACRC,QAAQ;gBACNC,UAAU;YACZ;QACF;IACF;IAEA,OAAOlB;AACT,EAAC"}