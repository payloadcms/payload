{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import type { AcceptedLanguages } from '@payloadcms/translations'\nimport type { Config, Endpoint } from 'payload'\n\nimport { deepMergeSimple } from 'payload/shared'\n\nimport type { PluginDefaultTranslationsObject } from './translations/types.js'\nimport type { EcommercePluginConfig, SanitizedEcommercePluginConfig } from './types/index.js'\n\nimport { createAddressesCollection } from './collections/addresses/createAddressesCollection.js'\nimport { createCartsCollection } from './collections/carts/createCartsCollection.js'\nimport { createOrdersCollection } from './collections/orders/createOrdersCollection.js'\nimport { createProductsCollection } from './collections/products/createProductsCollection.js'\nimport { createTransactionsCollection } from './collections/transactions/createTransactionsCollection.js'\nimport { createVariantOptionsCollection } from './collections/variants/createVariantOptionsCollection.js'\nimport { createVariantsCollection } from './collections/variants/createVariantsCollection/index.js'\nimport { createVariantTypesCollection } from './collections/variants/createVariantTypesCollection.js'\nimport { confirmOrderHandler } from './endpoints/confirmOrder.js'\nimport { initiatePaymentHandler } from './endpoints/initiatePayment.js'\nimport { translations } from './translations/index.js'\nimport { getCollectionSlugMap } from './utilities/getCollectionSlugMap.js'\nimport { pushTypeScriptProperties } from './utilities/pushTypeScriptProperties.js'\nimport { sanitizePluginConfig } from './utilities/sanitizePluginConfig.js'\n\nexport const ecommercePlugin =\n  (pluginConfig?: EcommercePluginConfig) =>\n  async (incomingConfig: Config): Promise<Config> => {\n    if (!pluginConfig) {\n      return incomingConfig\n    }\n\n    const sanitizedPluginConfig = sanitizePluginConfig({ pluginConfig })\n\n    const accessConfig = sanitizedPluginConfig.access\n\n    // Ensure collections exists\n    if (!incomingConfig.collections) {\n      incomingConfig.collections = []\n    }\n\n    // Determine if variants are enabled based on products config\n    const productsConfig =\n      typeof sanitizedPluginConfig.products === 'boolean'\n        ? sanitizedPluginConfig.products\n          ? { variants: true }\n          : undefined\n        : sanitizedPluginConfig.products\n\n    const enableVariants = Boolean(productsConfig?.variants)\n\n    /**\n     * Used to keep track of the slugs of collections in case they are overridden by the user.\n     * Variant-related slugs are only included when variants are enabled.\n     */\n    const collectionSlugMap = getCollectionSlugMap({ enableVariants, sanitizedPluginConfig })\n\n    const currenciesConfig: Required<SanitizedEcommercePluginConfig['currencies']> =\n      sanitizedPluginConfig.currencies\n\n    let addressFields\n\n    if (sanitizedPluginConfig.addresses) {\n      addressFields = sanitizedPluginConfig.addresses.addressFields\n\n      const supportedCountries = sanitizedPluginConfig.addresses.supportedCountries\n\n      const defaultAddressesCollection = createAddressesCollection({\n        access: accessConfig,\n        addressFields,\n        customersSlug: collectionSlugMap.customers,\n        supportedCountries,\n      })\n\n      const addressesCollection =\n        sanitizedPluginConfig.addresses &&\n        typeof sanitizedPluginConfig.addresses === 'object' &&\n        'addressesCollectionOverride' in sanitizedPluginConfig.addresses &&\n        sanitizedPluginConfig.addresses.addressesCollectionOverride\n          ? await sanitizedPluginConfig.addresses.addressesCollectionOverride({\n              defaultCollection: defaultAddressesCollection,\n            })\n          : defaultAddressesCollection\n\n      incomingConfig.collections.push(addressesCollection)\n    }\n\n    if (productsConfig) {\n      if (productsConfig.variants) {\n        const variantsConfig =\n          typeof productsConfig.variants === 'boolean' ? undefined : productsConfig.variants\n\n        const defaultVariantsCollection = createVariantsCollection({\n          access: accessConfig,\n          currenciesConfig,\n          inventory: sanitizedPluginConfig.inventory,\n          productsSlug: collectionSlugMap.products,\n          variantOptionsSlug: collectionSlugMap.variantOptions ?? 'variantOptions',\n          variantTypesSlug: collectionSlugMap.variantTypes ?? 'variantTypes',\n        })\n\n        const variants =\n          variantsConfig &&\n          typeof variantsConfig === 'object' &&\n          'variantsCollectionOverride' in variantsConfig &&\n          variantsConfig.variantsCollectionOverride\n            ? await variantsConfig.variantsCollectionOverride({\n                defaultCollection: defaultVariantsCollection,\n              })\n            : defaultVariantsCollection\n\n        const defaultVariantTypesCollection = createVariantTypesCollection({\n          access: accessConfig,\n          variantOptionsSlug: collectionSlugMap.variantOptions ?? 'variantOptions',\n        })\n\n        const variantTypes =\n          variantsConfig &&\n          typeof variantsConfig === 'object' &&\n          'variantTypesCollectionOverride' in variantsConfig &&\n          variantsConfig.variantTypesCollectionOverride\n            ? await variantsConfig.variantTypesCollectionOverride({\n                defaultCollection: defaultVariantTypesCollection,\n              })\n            : defaultVariantTypesCollection\n\n        const defaultVariantOptionsCollection = createVariantOptionsCollection({\n          access: accessConfig,\n          variantTypesSlug: collectionSlugMap.variantTypes ?? 'variantTypes',\n        })\n\n        const variantOptions =\n          variantsConfig &&\n          typeof variantsConfig === 'object' &&\n          'variantOptionsCollectionOverride' in variantsConfig &&\n          variantsConfig.variantOptionsCollectionOverride\n            ? await variantsConfig.variantOptionsCollectionOverride({\n                defaultCollection: defaultVariantOptionsCollection,\n              })\n            : defaultVariantOptionsCollection\n\n        incomingConfig.collections.push(variants, variantTypes, variantOptions)\n      }\n\n      const defaultProductsCollection = createProductsCollection({\n        access: accessConfig,\n        currenciesConfig,\n        enableVariants,\n        inventory: sanitizedPluginConfig.inventory,\n        variantsSlug: collectionSlugMap.variants ?? 'variants',\n        variantTypesSlug: collectionSlugMap.variantTypes ?? 'variantTypes',\n      })\n\n      const productsCollection =\n        productsConfig &&\n        'productsCollectionOverride' in productsConfig &&\n        productsConfig.productsCollectionOverride\n          ? await productsConfig.productsCollectionOverride({\n              defaultCollection: defaultProductsCollection,\n            })\n          : defaultProductsCollection\n\n      incomingConfig.collections.push(productsCollection)\n\n      if (sanitizedPluginConfig.carts) {\n        const cartsConfig =\n          typeof sanitizedPluginConfig.carts === 'object' ? sanitizedPluginConfig.carts : {}\n\n        const defaultCartsCollection = createCartsCollection({\n          access: accessConfig,\n          allowGuestCarts: cartsConfig.allowGuestCarts,\n          cartItemMatcher: cartsConfig.cartItemMatcher,\n          currenciesConfig,\n          customersSlug: collectionSlugMap.customers,\n          enableVariants: Boolean(productsConfig.variants),\n          productsSlug: collectionSlugMap.products,\n          variantsSlug: collectionSlugMap.variants ?? 'variants',\n        })\n\n        const cartsCollection =\n          sanitizedPluginConfig.carts &&\n          typeof sanitizedPluginConfig.carts === 'object' &&\n          'cartsCollectionOverride' in sanitizedPluginConfig.carts &&\n          sanitizedPluginConfig.carts.cartsCollectionOverride\n            ? await sanitizedPluginConfig.carts.cartsCollectionOverride({\n                defaultCollection: defaultCartsCollection,\n              })\n            : defaultCartsCollection\n\n        incomingConfig.collections.push(cartsCollection)\n      }\n    }\n\n    if (sanitizedPluginConfig.orders) {\n      const defaultOrdersCollection = createOrdersCollection({\n        access: accessConfig,\n        addressFields,\n        currenciesConfig,\n        customersSlug: collectionSlugMap.customers,\n        enableVariants,\n        productsSlug: collectionSlugMap.products,\n        variantsSlug: collectionSlugMap.variants ?? 'variants',\n      })\n\n      const ordersCollection =\n        sanitizedPluginConfig.orders &&\n        typeof sanitizedPluginConfig.orders === 'object' &&\n        'ordersCollectionOverride' in sanitizedPluginConfig.orders &&\n        sanitizedPluginConfig.orders.ordersCollectionOverride\n          ? await sanitizedPluginConfig.orders.ordersCollectionOverride({\n              defaultCollection: defaultOrdersCollection,\n            })\n          : defaultOrdersCollection\n\n      incomingConfig.collections.push(ordersCollection)\n    }\n\n    const paymentMethods = sanitizedPluginConfig.payments.paymentMethods\n\n    if (sanitizedPluginConfig.payments) {\n      if (paymentMethods.length) {\n        if (!Array.isArray(incomingConfig.endpoints)) {\n          incomingConfig.endpoints = []\n        }\n\n        const productsValidation =\n          (typeof sanitizedPluginConfig.products === 'object' &&\n            sanitizedPluginConfig.products.validation) ||\n          undefined\n\n        paymentMethods.forEach((paymentMethod) => {\n          const methodPath = `/payments/${paymentMethod.name}`\n          const endpoints: Endpoint[] = []\n\n          const initiatePayment: Endpoint = {\n            handler: initiatePaymentHandler({\n              currenciesConfig,\n              inventory: sanitizedPluginConfig.inventory,\n              paymentMethod,\n              productsSlug: collectionSlugMap.products,\n              productsValidation,\n              transactionsSlug: collectionSlugMap.transactions,\n              variantsSlug: collectionSlugMap.variants ?? 'variants',\n            }),\n            method: 'post',\n            path: `${methodPath}/initiate`,\n          }\n\n          const confirmOrder: Endpoint = {\n            handler: confirmOrderHandler({\n              cartsSlug: collectionSlugMap.carts,\n              currenciesConfig,\n              ordersSlug: collectionSlugMap.orders,\n              paymentMethod,\n              productsSlug: collectionSlugMap.products,\n              productsValidation,\n              transactionsSlug: collectionSlugMap.transactions,\n              variantsSlug: collectionSlugMap.variants ?? 'variants',\n            }),\n            method: 'post',\n            path: `${methodPath}/confirm-order`,\n          }\n\n          endpoints.push(initiatePayment, confirmOrder)\n\n          // Attach any additional endpoints defined in the payment method\n          if (paymentMethod.endpoints && paymentMethod.endpoints.length > 0) {\n            const methodEndpoints = paymentMethod.endpoints.map((endpoint) => {\n              const path = endpoint.path.startsWith('/') ? endpoint.path : `/${endpoint.path}`\n\n              return {\n                ...endpoint,\n                path: `${methodPath}${path}`,\n              }\n            })\n\n            endpoints.push(...methodEndpoints)\n          }\n\n          incomingConfig.endpoints!.push(...endpoints)\n        })\n      }\n    }\n\n    if (sanitizedPluginConfig.transactions) {\n      const defaultTransactionsCollection = createTransactionsCollection({\n        access: accessConfig,\n        addressFields,\n        cartsSlug: collectionSlugMap.carts,\n        currenciesConfig,\n        customersSlug: collectionSlugMap.customers,\n        enableVariants,\n        ordersSlug: collectionSlugMap.orders,\n        paymentMethods,\n        productsSlug: collectionSlugMap.products,\n        variantsSlug: collectionSlugMap.variants ?? 'variants',\n      })\n\n      const transactionsCollection =\n        sanitizedPluginConfig.transactions &&\n        typeof sanitizedPluginConfig.transactions === 'object' &&\n        'transactionsCollectionOverride' in sanitizedPluginConfig.transactions &&\n        sanitizedPluginConfig.transactions.transactionsCollectionOverride\n          ? await sanitizedPluginConfig.transactions.transactionsCollectionOverride({\n              defaultCollection: defaultTransactionsCollection,\n            })\n          : defaultTransactionsCollection\n\n      incomingConfig.collections.push(transactionsCollection)\n    }\n\n    if (!incomingConfig.i18n) {\n      incomingConfig.i18n = {}\n    }\n\n    if (!incomingConfig.i18n?.translations) {\n      incomingConfig.i18n.translations = {}\n    }\n\n    incomingConfig.i18n.translations = deepMergeSimple(\n      translations,\n      incomingConfig.i18n?.translations,\n    )\n\n    /**\n     * Merge plugin translations\n     */\n    if (!incomingConfig.i18n) {\n      incomingConfig.i18n = {}\n    }\n    Object.entries(translations).forEach(([locale, pluginI18nObject]) => {\n      const typedLocale = locale as AcceptedLanguages\n      if (!incomingConfig.i18n!.translations) {\n        incomingConfig.i18n!.translations = {}\n      }\n      if (!(typedLocale in incomingConfig.i18n!.translations)) {\n        incomingConfig.i18n!.translations[typedLocale] = {}\n      }\n      if (!('plugin-ecommerce' in incomingConfig.i18n!.translations[typedLocale]!)) {\n        ;(incomingConfig.i18n!.translations[typedLocale] as PluginDefaultTranslationsObject)[\n          'plugin-ecommerce'\n        ] = {} as PluginDefaultTranslationsObject['plugin-ecommerce']\n      }\n\n      ;(incomingConfig.i18n!.translations[typedLocale] as PluginDefaultTranslationsObject)[\n        'plugin-ecommerce'\n      ] = {\n        ...pluginI18nObject.translations['plugin-ecommerce'],\n      }\n    })\n\n    if (!incomingConfig.typescript) {\n      incomingConfig.typescript = {}\n    }\n\n    if (!incomingConfig.typescript.schema) {\n      incomingConfig.typescript.schema = []\n    }\n\n    incomingConfig.typescript.schema.push((args) =>\n      pushTypeScriptProperties({\n        ...args,\n        collectionSlugMap,\n        sanitizedPluginConfig,\n      }),\n    )\n\n    return incomingConfig\n  }\n\nexport {\n  createAddressesCollection,\n  createCartsCollection,\n  createOrdersCollection,\n  createProductsCollection,\n  createTransactionsCollection,\n  createVariantOptionsCollection,\n  createVariantsCollection,\n  createVariantTypesCollection,\n}\n\nexport { addItem } from './collections/carts/operations/addItem.js'\nexport { clearCart } from './collections/carts/operations/clearCart.js'\nexport { defaultCartItemMatcher } from './collections/carts/operations/defaultCartItemMatcher.js'\nexport { removeItem } from './collections/carts/operations/removeItem.js'\nexport { isNumericOperator } from './collections/carts/operations/types.js'\nexport type {\n  AddItemArgs,\n  CartItemData,\n  CartItemMatcher,\n  CartItemMatcherArgs,\n  CartOperationResult,\n  ClearCartArgs,\n  FieldWithOperator,\n  NewCartItem,\n  NumericOperator,\n  RemoveItemArgs,\n  UpdateItemArgs,\n} from './collections/carts/operations/types.js'\nexport { updateItem } from './collections/carts/operations/updateItem.js'\nexport { EUR, GBP, USD } from './currencies/index.js'\nexport { amountField } from './fields/amountField.js'\nexport { currencyField } from './fields/currencyField.js'\nexport { pricesField } from './fields/pricesField.js'\nexport { statusField } from './fields/statusField.js'\nexport { variantsFields } from './fields/variantsFields.js'\n"],"names":["deepMergeSimple","createAddressesCollection","createCartsCollection","createOrdersCollection","createProductsCollection","createTransactionsCollection","createVariantOptionsCollection","createVariantsCollection","createVariantTypesCollection","confirmOrderHandler","initiatePaymentHandler","translations","getCollectionSlugMap","pushTypeScriptProperties","sanitizePluginConfig","ecommercePlugin","pluginConfig","incomingConfig","sanitizedPluginConfig","accessConfig","access","collections","productsConfig","products","variants","undefined","enableVariants","Boolean","collectionSlugMap","currenciesConfig","currencies","addressFields","addresses","supportedCountries","defaultAddressesCollection","customersSlug","customers","addressesCollection","addressesCollectionOverride","defaultCollection","push","variantsConfig","defaultVariantsCollection","inventory","productsSlug","variantOptionsSlug","variantOptions","variantTypesSlug","variantTypes","variantsCollectionOverride","defaultVariantTypesCollection","variantTypesCollectionOverride","defaultVariantOptionsCollection","variantOptionsCollectionOverride","defaultProductsCollection","variantsSlug","productsCollection","productsCollectionOverride","carts","cartsConfig","defaultCartsCollection","allowGuestCarts","cartItemMatcher","cartsCollection","cartsCollectionOverride","orders","defaultOrdersCollection","ordersCollection","ordersCollectionOverride","paymentMethods","payments","length","Array","isArray","endpoints","productsValidation","validation","forEach","paymentMethod","methodPath","name","initiatePayment","handler","transactionsSlug","transactions","method","path","confirmOrder","cartsSlug","ordersSlug","methodEndpoints","map","endpoint","startsWith","defaultTransactionsCollection","transactionsCollection","transactionsCollectionOverride","i18n","Object","entries","locale","pluginI18nObject","typedLocale","typescript","schema","args","addItem","clearCart","defaultCartItemMatcher","removeItem","isNumericOperator","updateItem","EUR","GBP","USD","amountField","currencyField","pricesField","statusField","variantsFields"],"mappings":"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"}