{"version":3,"sources":["../../../../src/payments/adapters/stripe/index.ts"],"sourcesContent":["import type { Field, GroupField, PayloadRequest } from 'payload'\nimport type { Stripe } from 'stripe'\n\nimport type {\n  PaymentAdapter,\n  PaymentAdapterArgs,\n  PaymentAdapterClient,\n  PaymentAdapterClientArgs,\n} from '../../../types/index.js'\n\nimport { confirmOrder } from './confirmOrder.js'\nimport { webhooksEndpoint } from './endpoints/webhooks.js'\nimport { initiatePayment } from './initiatePayment.js'\n\ntype StripeWebhookHandler = (args: {\n  event: Stripe.Event\n  req: PayloadRequest\n  stripe: Stripe\n}) => Promise<void> | void\n\ntype StripeWebhookHandlers = {\n  /**\n   * Description of the event (e.g., invoice.created or charge.refunded).\n   */\n  [webhookName: string]: StripeWebhookHandler\n}\n\nexport type StripeAdapterArgs = {\n  /**\n   * This library's types only reflect the latest API version.\n   *\n   * We recommend upgrading your account's API Version to the latest version\n   * if you wish to use TypeScript with this library.\n   *\n   * If you wish to remain on your account's default API version,\n   * you may pass `null` or another version instead of the latest version,\n   * and add a `@ts-ignore` comment here and anywhere the types differ between API versions.\n   *\n   * @docs https://stripe.com/docs/api/versioning\n   */\n  apiVersion?: Stripe.StripeConfig['apiVersion']\n  appInfo?: Stripe.StripeConfig['appInfo']\n  publishableKey: string\n  secretKey: string\n  webhooks?: StripeWebhookHandlers\n  webhookSecret?: string\n} & PaymentAdapterArgs\n\nexport const stripeAdapter: (props: StripeAdapterArgs) => PaymentAdapter = (props) => {\n  const { apiVersion, appInfo, groupOverrides, secretKey, webhooks, webhookSecret } = props\n  const label = props?.label || 'Stripe'\n\n  const baseFields: Field[] = [\n    {\n      name: 'customerID',\n      type: 'text',\n      label: 'Stripe Customer ID',\n    },\n    {\n      name: 'paymentIntentID',\n      type: 'text',\n      label: 'Stripe PaymentIntent ID',\n    },\n  ]\n\n  const groupField: GroupField = {\n    name: 'stripe',\n    type: 'group',\n    ...groupOverrides,\n    admin: {\n      condition: (data) => {\n        const path = 'paymentMethod'\n\n        return data?.[path] === 'stripe'\n      },\n      ...groupOverrides?.admin,\n    },\n    fields:\n      groupOverrides?.fields && typeof groupOverrides?.fields === 'function'\n        ? groupOverrides.fields({ defaultFields: baseFields })\n        : baseFields,\n  }\n\n  return {\n    name: 'stripe',\n    confirmOrder: confirmOrder({\n      apiVersion,\n      appInfo,\n      secretKey,\n    }),\n    endpoints: [webhooksEndpoint({ apiVersion, appInfo, secretKey, webhooks, webhookSecret })],\n    group: groupField,\n    initiatePayment: initiatePayment({\n      apiVersion,\n      appInfo,\n      secretKey,\n    }),\n    label,\n  }\n}\n\nexport type StripeAdapterClientArgs = {\n  /**\n   * This library's types only reflect the latest API version.\n   *\n   * We recommend upgrading your account's API Version to the latest version\n   * if you wish to use TypeScript with this library.\n   *\n   * If you wish to remain on your account's default API version,\n   * you may pass `null` or another version instead of the latest version,\n   * and add a `@ts-ignore` comment here and anywhere the types differ between API versions.\n   *\n   * @docs https://stripe.com/docs/api/versioning\n   */\n  apiVersion?: Stripe.StripeConfig['apiVersion']\n  appInfo?: Stripe.StripeConfig['appInfo']\n  publishableKey: string\n} & PaymentAdapterClientArgs\n\nexport const stripeAdapterClient: (props: StripeAdapterClientArgs) => PaymentAdapterClient = (\n  props,\n) => {\n  return {\n    name: 'stripe',\n    confirmOrder: true,\n    initiatePayment: true,\n    label: 'Card',\n  }\n}\n\nexport type InitiatePaymentReturnType = {\n  clientSecret: string\n  message: string\n  paymentIntentID: string\n}\n"],"names":["confirmOrder","webhooksEndpoint","initiatePayment","stripeAdapter","props","apiVersion","appInfo","groupOverrides","secretKey","webhooks","webhookSecret","label","baseFields","name","type","groupField","admin","condition","data","path","fields","defaultFields","endpoints","group","stripeAdapterClient"],"mappings":"AAUA,SAASA,YAAY,QAAQ,oBAAmB;AAChD,SAASC,gBAAgB,QAAQ,0BAAyB;AAC1D,SAASC,eAAe,QAAQ,uBAAsB;AAoCtD,OAAO,MAAMC,gBAA8D,CAACC;IAC1E,MAAM,EAAEC,UAAU,EAAEC,OAAO,EAAEC,cAAc,EAAEC,SAAS,EAAEC,QAAQ,EAAEC,aAAa,EAAE,GAAGN;IACpF,MAAMO,QAAQP,OAAOO,SAAS;IAE9B,MAAMC,aAAsB;QAC1B;YACEC,MAAM;YACNC,MAAM;YACNH,OAAO;QACT;QACA;YACEE,MAAM;YACNC,MAAM;YACNH,OAAO;QACT;KACD;IAED,MAAMI,aAAyB;QAC7BF,MAAM;QACNC,MAAM;QACN,GAAGP,cAAc;QACjBS,OAAO;YACLC,WAAW,CAACC;gBACV,MAAMC,OAAO;gBAEb,OAAOD,MAAM,CAACC,KAAK,KAAK;YAC1B;YACA,GAAGZ,gBAAgBS,KAAK;QAC1B;QACAI,QACEb,gBAAgBa,UAAU,OAAOb,gBAAgBa,WAAW,aACxDb,eAAea,MAAM,CAAC;YAAEC,eAAeT;QAAW,KAClDA;IACR;IAEA,OAAO;QACLC,MAAM;QACNb,cAAcA,aAAa;YACzBK;YACAC;YACAE;QACF;QACAc,WAAW;YAACrB,iBAAiB;gBAAEI;gBAAYC;gBAASE;gBAAWC;gBAAUC;YAAc;SAAG;QAC1Fa,OAAOR;QACPb,iBAAiBA,gBAAgB;YAC/BG;YACAC;YACAE;QACF;QACAG;IACF;AACF,EAAC;AAoBD,OAAO,MAAMa,sBAAgF,CAC3FpB;IAEA,OAAO;QACLS,MAAM;QACNb,cAAc;QACdE,iBAAiB;QACjBS,OAAO;IACT;AACF,EAAC"}