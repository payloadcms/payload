{"version":3,"sources":["../../src/utilities/defaultProductsValidation.spec.ts"],"sourcesContent":["import { describe, it, expect } from 'vitest'\nimport type { CurrenciesConfig } from '../types/index.js'\n\nimport { EUR, USD } from '../currencies/index.js'\nimport { defaultProductsValidation } from './defaultProductsValidation'\nimport { MissingPrice, OutOfStock } from './errorCodes'\n\ndescribe('defaultProductsValidation', () => {\n  const currenciesConfig: CurrenciesConfig = {\n    defaultCurrency: 'USD',\n    supportedCurrencies: [USD, EUR],\n  }\n\n  describe('currency validation', () => {\n    it('should throw error when currency is not provided', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: '',\n          product: product as any,\n          quantity: 1,\n        })\n      }).toThrow('Currency must be provided for product validation.')\n    })\n\n    it('should throw error when currency is undefined', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: undefined as any,\n          product: product as any,\n          quantity: 1,\n        })\n      }).toThrow('Currency must be provided for product validation.')\n    })\n  })\n\n  describe('variant validation', () => {\n    it('should validate variant price exists', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInEUR: 900,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 1,\n          variant: variant as any,\n        })\n      }).toThrow('Variant with ID variant-1 does not have a price in usd.')\n    })\n\n    it('should pass when variant has price in requested currency', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 1,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n\n    it('should handle case-insensitive currency codes', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'USD',\n          product: {} as any,\n          quantity: 1,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n\n    it('should throw error when variant inventory is 0', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 0,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 1,\n          variant: variant as any,\n        })\n      }).toThrow('Variant with ID variant-1 is out of stock or does not have enough inventory.')\n    })\n\n    it('should throw error when variant inventory is less than quantity', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 5,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 10,\n          variant: variant as any,\n        })\n      }).toThrow('Variant with ID variant-1 is out of stock or does not have enough inventory.')\n    })\n\n    it('should pass when variant inventory equals quantity', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 5,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 5,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n\n    it('should pass when variant inventory is greater than quantity', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 5,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n\n    it('should pass when variant has no inventory field (unlimited stock)', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 100,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n  })\n\n  describe('product validation', () => {\n    it('should validate product price exists', () => {\n      const product = {\n        id: 'product-1',\n        priceInEUR: 900,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n        })\n      }).toThrow('Product does not have a price in.')\n    })\n\n    it('should include error cause with MissingPrice code', () => {\n      const product = {\n        id: 'product-1',\n        priceInEUR: 900,\n        inventory: 10,\n      }\n\n      try {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n        })\n      } catch (error: any) {\n        expect(error.cause).toEqual({\n          code: MissingPrice,\n          codes: ['product-1', 'usd'],\n        })\n      }\n    })\n\n    it('should pass when product has price in requested currency', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n        })\n      }).not.toThrow()\n    })\n\n    it('should throw error when product inventory is 0', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 0,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n        })\n      }).toThrow('Product is out of stock or does not have enough inventory.')\n    })\n\n    it('should include error cause with OutOfStock code', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 0,\n      }\n\n      try {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n        })\n      } catch (error: any) {\n        expect(error.cause).toEqual({\n          code: OutOfStock,\n          codes: ['product-1'],\n        })\n      }\n    })\n\n    it('should throw error when product inventory is less than quantity', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 5,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 10,\n        })\n      }).toThrow('Product is out of stock or does not have enough inventory.')\n    })\n\n    it('should pass when product inventory equals quantity', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 5,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 5,\n        })\n      }).not.toThrow()\n    })\n\n    it('should pass when product inventory is greater than quantity', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 5,\n        })\n      }).not.toThrow()\n    })\n\n    it('should pass when product has no inventory field (unlimited stock)', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 100,\n        })\n      }).not.toThrow()\n    })\n\n    it('should default quantity to 1 when not provided', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 1,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n        })\n      }).not.toThrow()\n    })\n  })\n\n  describe('variant priority over product', () => {\n    it('should only validate variant when both product and variant are provided', () => {\n      const product = {\n        id: 'product-1',\n        priceInEUR: 900, // Missing USD price\n        inventory: 0, // Out of stock\n      }\n\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 10,\n      }\n\n      // Should not throw because variant validation takes priority\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n\n    it('should not validate product inventory when variant is provided', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 0, // Product out of stock\n      }\n\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 10, // But variant has stock\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n  })\n})\n"],"names":["describe","it","expect","EUR","USD","defaultProductsValidation","MissingPrice","OutOfStock","currenciesConfig","defaultCurrency","supportedCurrencies","product","id","priceInUSD","currency","quantity","toThrow","undefined","variant","priceInEUR","inventory","not","error","cause","toEqual","code","codes"],"mappings":"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"}