{"version":3,"sources":["../../src/utilities/sanitizePluginConfig.ts"],"sourcesContent":["import type { EcommercePluginConfig, SanitizedEcommercePluginConfig } from '../types/index.js'\n\nimport { defaultAddressFields } from '../collections/addresses/defaultAddressFields.js'\nimport { USD } from '../currencies/index.js'\n\ntype Props = {\n  pluginConfig: EcommercePluginConfig\n}\n\nexport const sanitizePluginConfig = ({ pluginConfig }: Props): SanitizedEcommercePluginConfig => {\n  const config = {\n    ...pluginConfig,\n  } as Partial<SanitizedEcommercePluginConfig>\n\n  if (typeof config.customers === 'undefined') {\n    config.customers = {\n      slug: 'users',\n    }\n  }\n\n  if (\n    typeof config.addresses === 'undefined' ||\n    (typeof config.addresses === 'boolean' && config.addresses === true)\n  ) {\n    config.addresses = {\n      addressFields: defaultAddressFields(),\n    }\n  } else {\n    const addressFields =\n      (typeof pluginConfig.addresses === 'object' &&\n        typeof pluginConfig.addresses.addressFields === 'function' &&\n        pluginConfig.addresses.addressFields({\n          defaultFields: defaultAddressFields(),\n        })) ||\n      defaultAddressFields()\n\n    config.addresses = {\n      ...config.addresses,\n      addressFields,\n    }\n  }\n\n  if (!config.currencies) {\n    config.currencies = {\n      defaultCurrency: 'USD',\n      supportedCurrencies: [USD],\n    }\n  }\n\n  if (\n    typeof config.inventory === 'undefined' ||\n    (typeof config.inventory === 'boolean' && config.inventory === true)\n  ) {\n    config.inventory = {\n      fieldName: 'inventory',\n    }\n  }\n\n  if (typeof config.carts === 'undefined') {\n    config.carts = {\n      allowGuestCarts: true,\n    }\n  } else if (config.carts === true) {\n    config.carts = {\n      allowGuestCarts: true,\n    }\n  } else if (\n    typeof config.carts === 'object' &&\n    typeof config.carts.allowGuestCarts === 'undefined'\n  ) {\n    config.carts.allowGuestCarts = true\n  }\n\n  if (typeof config.orders === 'undefined') {\n    config.orders = true\n  }\n\n  if (typeof config.transactions === 'undefined') {\n    config.transactions = true\n  }\n\n  if (typeof config.payments === 'undefined') {\n    config.payments = {\n      paymentMethods: [],\n    }\n  } else if (!config.payments.paymentMethods) {\n    config.payments.paymentMethods = []\n  }\n\n  if (config.products) {\n    if (typeof config.products === 'object' && typeof config.products.variants === 'undefined') {\n      config.products.variants = true\n    }\n  }\n\n  config.access = {\n    isAuthenticated: ({ req }) => Boolean(req?.user),\n    publicAccess: () => true,\n    ...pluginConfig.access,\n  }\n\n  return config as SanitizedEcommercePluginConfig\n}\n"],"names":["defaultAddressFields","USD","sanitizePluginConfig","pluginConfig","config","customers","slug","addresses","addressFields","defaultFields","currencies","defaultCurrency","supportedCurrencies","inventory","fieldName","carts","allowGuestCarts","orders","transactions","payments","paymentMethods","products","variants","access","isAuthenticated","req","Boolean","user","publicAccess"],"mappings":"AAEA,SAASA,oBAAoB,QAAQ,mDAAkD;AACvF,SAASC,GAAG,QAAQ,yBAAwB;AAM5C,OAAO,MAAMC,uBAAuB,CAAC,EAAEC,YAAY,EAAS;IAC1D,MAAMC,SAAS;QACb,GAAGD,YAAY;IACjB;IAEA,IAAI,OAAOC,OAAOC,SAAS,KAAK,aAAa;QAC3CD,OAAOC,SAAS,GAAG;YACjBC,MAAM;QACR;IACF;IAEA,IACE,OAAOF,OAAOG,SAAS,KAAK,eAC3B,OAAOH,OAAOG,SAAS,KAAK,aAAaH,OAAOG,SAAS,KAAK,MAC/D;QACAH,OAAOG,SAAS,GAAG;YACjBC,eAAeR;QACjB;IACF,OAAO;QACL,MAAMQ,gBACJ,AAAC,OAAOL,aAAaI,SAAS,KAAK,YACjC,OAAOJ,aAAaI,SAAS,CAACC,aAAa,KAAK,cAChDL,aAAaI,SAAS,CAACC,aAAa,CAAC;YACnCC,eAAeT;QACjB,MACFA;QAEFI,OAAOG,SAAS,GAAG;YACjB,GAAGH,OAAOG,SAAS;YACnBC;QACF;IACF;IAEA,IAAI,CAACJ,OAAOM,UAAU,EAAE;QACtBN,OAAOM,UAAU,GAAG;YAClBC,iBAAiB;YACjBC,qBAAqB;gBAACX;aAAI;QAC5B;IACF;IAEA,IACE,OAAOG,OAAOS,SAAS,KAAK,eAC3B,OAAOT,OAAOS,SAAS,KAAK,aAAaT,OAAOS,SAAS,KAAK,MAC/D;QACAT,OAAOS,SAAS,GAAG;YACjBC,WAAW;QACb;IACF;IAEA,IAAI,OAAOV,OAAOW,KAAK,KAAK,aAAa;QACvCX,OAAOW,KAAK,GAAG;YACbC,iBAAiB;QACnB;IACF,OAAO,IAAIZ,OAAOW,KAAK,KAAK,MAAM;QAChCX,OAAOW,KAAK,GAAG;YACbC,iBAAiB;QACnB;IACF,OAAO,IACL,OAAOZ,OAAOW,KAAK,KAAK,YACxB,OAAOX,OAAOW,KAAK,CAACC,eAAe,KAAK,aACxC;QACAZ,OAAOW,KAAK,CAACC,eAAe,GAAG;IACjC;IAEA,IAAI,OAAOZ,OAAOa,MAAM,KAAK,aAAa;QACxCb,OAAOa,MAAM,GAAG;IAClB;IAEA,IAAI,OAAOb,OAAOc,YAAY,KAAK,aAAa;QAC9Cd,OAAOc,YAAY,GAAG;IACxB;IAEA,IAAI,OAAOd,OAAOe,QAAQ,KAAK,aAAa;QAC1Cf,OAAOe,QAAQ,GAAG;YAChBC,gBAAgB,EAAE;QACpB;IACF,OAAO,IAAI,CAAChB,OAAOe,QAAQ,CAACC,cAAc,EAAE;QAC1ChB,OAAOe,QAAQ,CAACC,cAAc,GAAG,EAAE;IACrC;IAEA,IAAIhB,OAAOiB,QAAQ,EAAE;QACnB,IAAI,OAAOjB,OAAOiB,QAAQ,KAAK,YAAY,OAAOjB,OAAOiB,QAAQ,CAACC,QAAQ,KAAK,aAAa;YAC1FlB,OAAOiB,QAAQ,CAACC,QAAQ,GAAG;QAC7B;IACF;IAEAlB,OAAOmB,MAAM,GAAG;QACdC,iBAAiB,CAAC,EAAEC,GAAG,EAAE,GAAKC,QAAQD,KAAKE;QAC3CC,cAAc,IAAM;QACpB,GAAGzB,aAAaoB,MAAM;IACxB;IAEA,OAAOnB;AACT,EAAC"}