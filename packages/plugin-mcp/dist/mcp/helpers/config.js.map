{"version":3,"sources":["../../../src/mcp/helpers/config.ts"],"sourcesContent":["import type {\n  AdminConfig,\n  CollectionConfigUpdates,\n  DatabaseConfig,\n  GeneralConfig,\n  PluginUpdates,\n} from '../../types.js'\n\n/**\n * Adds a collection to the payload.config.ts file\n */\nexport function addCollectionToConfig(content: string, collectionName: string): string {\n  const capitalizedName = collectionName.charAt(0).toUpperCase() + collectionName.slice(1)\n\n  // Add import statement\n  const importRegex = /import.*from\\s*['\"]\\.\\/collections\\/.*['\"]/g\n  const importMatches = content.match(importRegex)\n\n  if (importMatches && importMatches.length > 0) {\n    const lastImport = importMatches[importMatches.length - 1]\n    const newImport = `import { ${capitalizedName} } from './collections/${capitalizedName}'`\n\n    // Check if import already exists\n    if (lastImport && !content.includes(newImport)) {\n      content = content.replace(lastImport, `${lastImport}\\n${newImport}`)\n    }\n  } else {\n    // Add import after existing imports\n    const importInsertPoint = content.indexOf(\"import sharp from 'sharp'\")\n    if (importInsertPoint !== -1) {\n      const lineEnd = content.indexOf('\\n', importInsertPoint)\n      const newImport = `import { ${capitalizedName} } from './collections/${capitalizedName}'`\n      content = content.slice(0, lineEnd + 1) + newImport + '\\n' + content.slice(lineEnd + 1)\n    }\n  }\n\n  // Add to collections array\n  const collectionsRegex = /collections:\\s*\\[([\\s\\S]*?)\\]/\n  const collectionsMatch = content.match(collectionsRegex)\n\n  if (collectionsMatch && collectionsMatch[1]) {\n    const collectionsContent = collectionsMatch[1].trim()\n    if (!collectionsContent.includes(capitalizedName)) {\n      const newCollections = collectionsContent\n        ? `${collectionsContent}, ${capitalizedName}`\n        : capitalizedName\n      content = content.replace(collectionsRegex, `collections: [${newCollections}]`)\n    }\n  }\n\n  return content\n}\n\n/**\n * Removes a collection from the payload.config.ts file\n */\nexport function removeCollectionFromConfig(content: string, collectionName: string): string {\n  const capitalizedName = collectionName.charAt(0).toUpperCase() + collectionName.slice(1)\n\n  // Remove import statement\n  const importRegex = new RegExp(\n    `import\\\\s*{\\\\s*${capitalizedName}\\\\s*}\\\\s*from\\\\s*['\"]\\\\./collections/${capitalizedName}['\"]\\\\s*\\\\n?`,\n    'g',\n  )\n  content = content.replace(importRegex, '')\n\n  // Remove from collections array\n  const collectionsRegex = /collections:\\s*\\[([\\s\\S]*?)\\]/\n  const collectionsMatch = content.match(collectionsRegex)\n\n  if (collectionsMatch && collectionsMatch[1]) {\n    let collectionsContent = collectionsMatch[1]\n\n    // Remove the collection name and clean up commas\n    collectionsContent = collectionsContent.replace(\n      new RegExp(`\\\\s*,?\\\\s*${capitalizedName}\\\\s*,?`, 'g'),\n      '',\n    )\n    collectionsContent = collectionsContent.replace(/,\\s*,/g, ',') // Remove double commas\n    collectionsContent = collectionsContent.replace(/^\\s*,|,\\s*$/g, '') // Remove leading/trailing commas\n\n    content = content.replace(collectionsRegex, `collections: [${collectionsContent}]`)\n  }\n\n  // Clean up any double newlines from removed imports\n  content = content.replace(/\\n{3,}/g, '\\n\\n')\n\n  return content\n}\n\n/**\n * Updates admin configuration in payload.config.ts\n */\nexport function updateAdminConfig(content: string, adminConfig: AdminConfig): string {\n  const adminRegex = /admin:\\s*\\{([^}]*)\\}/\n  const adminMatch = content.match(adminRegex)\n\n  if (adminMatch && adminMatch[1]) {\n    let adminContent = adminMatch[1]\n\n    // Update specific admin properties\n    if (adminConfig.user) {\n      if (adminContent.includes('user:')) {\n        adminContent = adminContent.replace(/user:[^,}]*/, `user: ${adminConfig.user}.slug`)\n      } else {\n        adminContent = `\\n    user: ${adminConfig.user}.slug,${adminContent}`\n      }\n    }\n\n    if (adminConfig.meta) {\n      const metaConfig = Object.entries(adminConfig.meta)\n        .map(([key, value]) => `      ${key}: '${value}'`)\n        .join(',\\n')\n\n      if (adminContent.includes('meta:')) {\n        adminContent = adminContent.replace(/meta:\\s*\\{[^}]*\\}/, `meta: {\\n${metaConfig}\\n    }`)\n      } else {\n        adminContent = `${adminContent}\\n    meta: {\\n${metaConfig}\\n    },`\n      }\n    }\n\n    content = content.replace(adminRegex, `admin: {${adminContent}\\n  }`)\n  } else {\n    // Add admin config if it doesn't exist\n    const adminConfigEntries = []\n\n    if (adminConfig.user) {\n      adminConfigEntries.push(`    user: ${adminConfig.user}.slug`)\n    }\n\n    if (adminConfig.meta) {\n      const metaConfig = Object.entries(adminConfig.meta)\n        .map(([key, value]) => `      ${key}: '${value}'`)\n        .join(',\\n')\n      adminConfigEntries.push(`    meta: {\\n${metaConfig}\\n    }`)\n    }\n\n    const adminConfigString = `admin: {\\n${adminConfigEntries.join(',\\n')}\\n  },`\n    content = content.replace(\n      /export default buildConfig\\(\\{/,\n      `export default buildConfig({\\n  ${adminConfigString}`,\n    )\n  }\n\n  return content\n}\n\n/**\n * Updates database configuration in payload.config.ts\n */\nexport function updateDatabaseConfig(content: string, databaseConfig: DatabaseConfig): string {\n  if (databaseConfig.type === 'mongodb') {\n    // Update to MongoDB adapter\n    const dbRegex = /db:[^,}]*(?:,|\\})/\n    const mongoImportRegex = /import.*mongooseAdapter.*from.*@payloadcms\\/db-mongodb.*/\n\n    if (!content.match(mongoImportRegex)) {\n      content = content.replace(\n        /(import.*from.*payload.*\\n)/,\n        `$1import { mongooseAdapter } from '@payloadcms/db-mongodb'\\n`,\n      )\n    }\n\n    const dbConfig = `db: mongooseAdapter({\\n    url: process.env.DATABASE_URL || '${databaseConfig.url || ''}',\\n  })`\n    content = content.replace(dbRegex, `${dbConfig},`)\n  }\n\n  return content\n}\n\n/**\n * Updates plugins configuration in payload.config.ts\n */\nexport function updatePluginsConfig(content: string, pluginUpdates: PluginUpdates): string {\n  // Add plugin imports\n  if (pluginUpdates.add) {\n    pluginUpdates.add.forEach((pluginImport: string) => {\n      if (!content.includes(pluginImport)) {\n        content = content.replace(/(import.*from.*payload.*\\n)/, `$1${pluginImport}\\n`)\n      }\n    })\n  }\n\n  // Handle plugins array\n  const pluginsRegex = /plugins:\\s*\\[([\\s\\S]*?)\\]/\n  const pluginsMatch = content.match(pluginsRegex)\n\n  if (pluginsMatch && pluginsMatch[1]) {\n    let pluginsContent = pluginsMatch[1]\n\n    // Remove plugins\n    if (pluginUpdates.remove) {\n      pluginUpdates.remove.forEach((pluginName: string) => {\n        const pluginRegex = new RegExp(`\\\\s*${pluginName}\\\\(\\\\)\\\\s*,?`, 'g')\n        pluginsContent = pluginsContent.replace(pluginRegex, '')\n      })\n    }\n\n    // Add plugins\n    if (pluginUpdates.add) {\n      pluginUpdates.add.forEach((pluginImport: string) => {\n        // This will match: import { PluginName } from '...';\n        const match = pluginImport.match(/import\\s*\\{\\s*(\\w+)\\s*\\}/)\n        if (match && match[1]) {\n          const pluginName = match[1]\n          if (!pluginsContent.includes(`${pluginName}(`)) {\n            pluginsContent = pluginsContent.trim()\n              ? `${pluginsContent}\\n    ${pluginName}(),`\n              : `\\n    ${pluginName}(),`\n          }\n        }\n      })\n    }\n\n    content = content.replace(pluginsRegex, `plugins: [${pluginsContent}\\n  ]`)\n  }\n\n  return content\n}\n\n/**\n * Updates general configuration options in payload.config.ts\n */\nexport function updateGeneralConfig(content: string, generalConfig: GeneralConfig): string {\n  // Update various general configuration options\n  Object.entries(generalConfig).forEach(([key, value]) => {\n    if (value !== undefined && value !== null) {\n      const configRegex = new RegExp(`${key}:\\\\s*[^,}]*`, 'g')\n\n      if (content.match(configRegex)) {\n        if (typeof value === 'string') {\n          content = content.replace(configRegex, `${key}: '${value}'`)\n        } else if (typeof value === 'boolean') {\n          content = content.replace(configRegex, `${key}: ${value}`)\n        } else if (typeof value === 'object') {\n          content = content.replace(configRegex, `${key}: ${JSON.stringify(value, null, 2)}`)\n        }\n      } else {\n        // Add new config option\n        const configValue =\n          typeof value === 'string'\n            ? `'${value}'`\n            : typeof value === 'object'\n              ? JSON.stringify(value, null, 2)\n              : value\n        content = content.replace(\n          /export default buildConfig\\(\\{/,\n          `export default buildConfig({\\n  ${key}: ${configValue},`,\n        )\n      }\n    }\n  })\n\n  return content\n}\n\n/**\n * Updates collection-level configuration in a collection file\n */\nexport function updateCollectionConfig(\n  content: string,\n  updates: CollectionConfigUpdates,\n  collectionName: string,\n): string {\n  let updatedContent = content\n\n  if (updates.slug) {\n    updatedContent = updatedContent.replace(/slug:\\s*'[^']*'/, `slug: '${updates.slug}'`)\n  }\n\n  if (updates.access) {\n    const accessRegex = /access:\\s*\\{[^}]*\\}/\n    if (updatedContent.match(accessRegex)) {\n      // Update existing access config\n      Object.entries(updates.access).forEach(([key, value]) => {\n        if (value !== undefined) {\n          updatedContent = updatedContent.replace(\n            new RegExp(`${key}:\\\\s*[^,}]*`),\n            `${key}: ${value}`,\n          )\n        }\n      })\n    } else {\n      // Add access config\n      const accessConfig = Object.entries(updates.access)\n        .filter(([, value]) => value !== undefined)\n        .map(([key, value]) => `    ${key}: ${value}`)\n        .join(',\\n')\n\n      updatedContent = updatedContent.replace(\n        /slug:\\s*'[^']*',/,\n        `slug: '${collectionName}',\\n  access: {\\n${accessConfig}\\n  },`,\n      )\n    }\n  }\n\n  if (updates.timestamps !== undefined) {\n    if (updatedContent.includes('timestamps:')) {\n      updatedContent = updatedContent.replace(\n        /timestamps:[^,}]*/,\n        `timestamps: ${updates.timestamps}`,\n      )\n    } else {\n      updatedContent = updatedContent.replace(\n        /fields:\\s*\\[/,\n        `timestamps: ${updates.timestamps},\\n  fields: [`,\n      )\n    }\n  }\n\n  if (updates.versioning !== undefined) {\n    if (updatedContent.includes('versioning:')) {\n      updatedContent = updatedContent.replace(\n        /versioning:[^,}]*/,\n        `versioning: ${updates.versioning}`,\n      )\n    } else {\n      updatedContent = updatedContent.replace(\n        /fields:\\s*\\[/,\n        `versioning: ${updates.versioning},\\n  fields: [`,\n      )\n    }\n  }\n\n  return updatedContent\n}\n"],"names":["addCollectionToConfig","content","collectionName","capitalizedName","charAt","toUpperCase","slice","importRegex","importMatches","match","length","lastImport","newImport","includes","replace","importInsertPoint","indexOf","lineEnd","collectionsRegex","collectionsMatch","collectionsContent","trim","newCollections","removeCollectionFromConfig","RegExp","updateAdminConfig","adminConfig","adminRegex","adminMatch","adminContent","user","meta","metaConfig","Object","entries","map","key","value","join","adminConfigEntries","push","adminConfigString","updateDatabaseConfig","databaseConfig","type","dbRegex","mongoImportRegex","dbConfig","url","updatePluginsConfig","pluginUpdates","add","forEach","pluginImport","pluginsRegex","pluginsMatch","pluginsContent","remove","pluginName","pluginRegex","updateGeneralConfig","generalConfig","undefined","configRegex","JSON","stringify","configValue","updateCollectionConfig","updates","updatedContent","slug","access","accessRegex","accessConfig","filter","timestamps","versioning"],"mappings":"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"}