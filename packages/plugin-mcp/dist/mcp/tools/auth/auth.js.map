{"version":3,"sources":["../../../../src/mcp/tools/auth/auth.ts"],"sourcesContent":["import type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js'\nimport type { PayloadRequest } from 'payload'\n\nimport { toolSchemas } from '../schemas.js'\n\nexport const authTool = (server: McpServer, req: PayloadRequest, verboseLogs: boolean) => {\n  const tool = async (headers?: string) => {\n    const payload = req.payload\n\n    if (verboseLogs) {\n      payload.logger.info('[payload-mcp] Checking authentication status')\n    }\n\n    try {\n      // Parse custom headers if provided, otherwise use empty headers\n      let authHeaders = new Headers()\n\n      if (headers) {\n        try {\n          const parsedHeaders = JSON.parse(headers)\n          authHeaders = new Headers(parsedHeaders)\n          if (verboseLogs) {\n            payload.logger.info(`[payload-mcp] Using custom headers: ${headers}`)\n          }\n        } catch (_ignore) {\n          payload.logger.warn(`[payload-mcp] Invalid headers JSON: ${headers}, using empty headers`)\n        }\n      }\n\n      const result = await payload.auth({\n        headers: authHeaders,\n      })\n\n      if (verboseLogs) {\n        payload.logger.info('[payload-mcp] Authentication check completed successfully')\n      }\n\n      return {\n        content: [\n          {\n            type: 'text' as const,\n            text: `# Authentication Status\\n\\n\\`\\`\\`json\\n${JSON.stringify(result, null, 2)}\\n\\`\\`\\``,\n          },\n        ],\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error'\n      payload.logger.error(`[payload-mcp] Error checking authentication: ${errorMessage}`)\n\n      return {\n        content: [\n          {\n            type: 'text' as const,\n            text: `âŒ **Error checking authentication**: ${errorMessage}`,\n          },\n        ],\n      }\n    }\n  }\n\n  server.tool(\n    'auth',\n    toolSchemas.auth.description,\n    toolSchemas.auth.parameters.shape,\n    async ({ headers }) => {\n      return await tool(headers)\n    },\n  )\n}\n"],"names":["toolSchemas","authTool","server","req","verboseLogs","tool","headers","payload","logger","info","authHeaders","Headers","parsedHeaders","JSON","parse","_ignore","warn","result","auth","content","type","text","stringify","error","errorMessage","Error","message","description","parameters","shape"],"mappings":"AAGA,SAASA,WAAW,QAAQ,gBAAe;AAE3C,OAAO,MAAMC,WAAW,CAACC,QAAmBC,KAAqBC;IAC/D,MAAMC,OAAO,OAAOC;QAClB,MAAMC,UAAUJ,IAAII,OAAO;QAE3B,IAAIH,aAAa;YACfG,QAAQC,MAAM,CAACC,IAAI,CAAC;QACtB;QAEA,IAAI;YACF,gEAAgE;YAChE,IAAIC,cAAc,IAAIC;YAEtB,IAAIL,SAAS;gBACX,IAAI;oBACF,MAAMM,gBAAgBC,KAAKC,KAAK,CAACR;oBACjCI,cAAc,IAAIC,QAAQC;oBAC1B,IAAIR,aAAa;wBACfG,QAAQC,MAAM,CAACC,IAAI,CAAC,CAAC,oCAAoC,EAAEH,SAAS;oBACtE;gBACF,EAAE,OAAOS,SAAS;oBAChBR,QAAQC,MAAM,CAACQ,IAAI,CAAC,CAAC,oCAAoC,EAAEV,QAAQ,qBAAqB,CAAC;gBAC3F;YACF;YAEA,MAAMW,SAAS,MAAMV,QAAQW,IAAI,CAAC;gBAChCZ,SAASI;YACX;YAEA,IAAIN,aAAa;gBACfG,QAAQC,MAAM,CAACC,IAAI,CAAC;YACtB;YAEA,OAAO;gBACLU,SAAS;oBACP;wBACEC,MAAM;wBACNC,MAAM,CAAC,uCAAuC,EAAER,KAAKS,SAAS,CAACL,QAAQ,MAAM,GAAG,QAAQ,CAAC;oBAC3F;iBACD;YACH;QACF,EAAE,OAAOM,OAAO;YACd,MAAMC,eAAeD,iBAAiBE,QAAQF,MAAMG,OAAO,GAAG;YAC9DnB,QAAQC,MAAM,CAACe,KAAK,CAAC,CAAC,6CAA6C,EAAEC,cAAc;YAEnF,OAAO;gBACLL,SAAS;oBACP;wBACEC,MAAM;wBACNC,MAAM,CAAC,qCAAqC,EAAEG,cAAc;oBAC9D;iBACD;YACH;QACF;IACF;IAEAtB,OAAOG,IAAI,CACT,QACAL,YAAYkB,IAAI,CAACS,WAAW,EAC5B3B,YAAYkB,IAAI,CAACU,UAAU,CAACC,KAAK,EACjC,OAAO,EAAEvB,OAAO,EAAE;QAChB,OAAO,MAAMD,KAAKC;IACpB;AAEJ,EAAC"}