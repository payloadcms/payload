{"version":3,"sources":["../../../../src/mcp/tools/config/find.ts"],"sourcesContent":["import type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js'\nimport type { PayloadRequest } from 'payload'\n\nimport { readFileSync, statSync } from 'fs'\n\nimport { toolSchemas } from '../schemas.js'\n\nexport const readConfigFile = (\n  req: PayloadRequest,\n  verboseLogs: boolean,\n  configFilePath: string,\n  includeMetadata: boolean = false,\n) => {\n  const payload = req.payload\n  if (verboseLogs) {\n    payload.logger.info(`[payload-mcp] Reading config file, includeMetadata: ${includeMetadata}`)\n  }\n\n  try {\n    // Security check: ensure we're working with the specified config file\n    if (!configFilePath.startsWith(process.cwd()) && !configFilePath.startsWith('/')) {\n      payload.logger.error(`[payload-mcp] Invalid config path attempted: ${configFilePath}`)\n      return {\n        content: [\n          {\n            type: 'text' as const,\n            text: '❌ **Error**: Invalid config path',\n          },\n        ],\n      }\n    }\n\n    const content = readFileSync(configFilePath, 'utf8')\n    const stats = statSync(configFilePath)\n\n    if (verboseLogs) {\n      payload.logger.info(`[payload-mcp] Successfully read config file. Size: ${stats.size} bytes`)\n    }\n\n    let responseText = `# Payload Configuration\n\n**File**: \\`${configFilePath}\\``\n\n    if (includeMetadata) {\n      responseText += `\n**Size**: ${stats.size.toLocaleString()} bytes\n**Modified**: ${stats.mtime.toISOString()}\n**Created**: ${stats.birthtime.toISOString()}`\n    }\n\n    responseText += `\n---\n\n**Configuration Content:**\n\\`\\`\\`typescript\n${content}\n\\`\\`\\``\n\n    return {\n      content: [\n        {\n          type: 'text' as const,\n          text: responseText,\n        },\n      ],\n    }\n  } catch (error) {\n    const errorMessage = (error as Error).message\n    payload.logger.error(`[payload-mcp] Error reading config file: ${errorMessage}`)\n    return {\n      content: [\n        {\n          type: 'text' as const,\n          text: `❌ **Error reading config file**: ${errorMessage}`,\n        },\n      ],\n    }\n  }\n}\n\n// MCP Server tool registration\nexport const findConfigTool = (\n  server: McpServer,\n  req: PayloadRequest,\n  verboseLogs: boolean,\n  configFilePath: string,\n) => {\n  const tool = (includeMetadata: boolean = false) => {\n    const payload = req.payload\n\n    if (verboseLogs) {\n      payload.logger.info(`[payload-mcp] Finding config, includeMetadata: ${includeMetadata}`)\n    }\n\n    try {\n      const result = readConfigFile(req, verboseLogs, configFilePath, includeMetadata)\n\n      if (verboseLogs) {\n        payload.logger.info(`[payload-mcp] Config search completed`)\n      }\n\n      return result\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error'\n      payload.logger.error(`[payload-mcp] Error finding config: ${errorMessage}`)\n\n      return {\n        content: [\n          {\n            type: 'text' as const,\n            text: `Error finding config: ${errorMessage}`,\n          },\n        ],\n      }\n    }\n  }\n\n  server.tool(\n    'findConfig',\n    toolSchemas.findConfig.description,\n    toolSchemas.findConfig.parameters.shape,\n    ({ includeMetadata }) => {\n      return tool(includeMetadata)\n    },\n  )\n}\n"],"names":["readFileSync","statSync","toolSchemas","readConfigFile","req","verboseLogs","configFilePath","includeMetadata","payload","logger","info","startsWith","process","cwd","error","content","type","text","stats","size","responseText","toLocaleString","mtime","toISOString","birthtime","errorMessage","message","findConfigTool","server","tool","result","Error","findConfig","description","parameters","shape"],"mappings":"AAGA,SAASA,YAAY,EAAEC,QAAQ,QAAQ,KAAI;AAE3C,SAASC,WAAW,QAAQ,gBAAe;AAE3C,OAAO,MAAMC,iBAAiB,CAC5BC,KACAC,aACAC,gBACAC,kBAA2B,KAAK;IAEhC,MAAMC,UAAUJ,IAAII,OAAO;IAC3B,IAAIH,aAAa;QACfG,QAAQC,MAAM,CAACC,IAAI,CAAC,CAAC,oDAAoD,EAAEH,iBAAiB;IAC9F;IAEA,IAAI;QACF,sEAAsE;QACtE,IAAI,CAACD,eAAeK,UAAU,CAACC,QAAQC,GAAG,OAAO,CAACP,eAAeK,UAAU,CAAC,MAAM;YAChFH,QAAQC,MAAM,CAACK,KAAK,CAAC,CAAC,6CAA6C,EAAER,gBAAgB;YACrF,OAAO;gBACLS,SAAS;oBACP;wBACEC,MAAM;wBACNC,MAAM;oBACR;iBACD;YACH;QACF;QAEA,MAAMF,UAAUf,aAAaM,gBAAgB;QAC7C,MAAMY,QAAQjB,SAASK;QAEvB,IAAID,aAAa;YACfG,QAAQC,MAAM,CAACC,IAAI,CAAC,CAAC,mDAAmD,EAAEQ,MAAMC,IAAI,CAAC,MAAM,CAAC;QAC9F;QAEA,IAAIC,eAAe,CAAC;;YAEZ,EAAEd,eAAe,EAAE,CAAC;QAE5B,IAAIC,iBAAiB;YACnBa,gBAAgB,CAAC;UACb,EAAEF,MAAMC,IAAI,CAACE,cAAc,GAAG;cAC1B,EAAEH,MAAMI,KAAK,CAACC,WAAW,GAAG;aAC7B,EAAEL,MAAMM,SAAS,CAACD,WAAW,IAAI;QAC1C;QAEAH,gBAAgB,CAAC;;;;;AAKrB,EAAEL,QAAQ;MACJ,CAAC;QAEH,OAAO;YACLA,SAAS;gBACP;oBACEC,MAAM;oBACNC,MAAMG;gBACR;aACD;QACH;IACF,EAAE,OAAON,OAAO;QACd,MAAMW,eAAe,AAACX,MAAgBY,OAAO;QAC7ClB,QAAQC,MAAM,CAACK,KAAK,CAAC,CAAC,yCAAyC,EAAEW,cAAc;QAC/E,OAAO;YACLV,SAAS;gBACP;oBACEC,MAAM;oBACNC,MAAM,CAAC,iCAAiC,EAAEQ,cAAc;gBAC1D;aACD;QACH;IACF;AACF,EAAC;AAED,+BAA+B;AAC/B,OAAO,MAAME,iBAAiB,CAC5BC,QACAxB,KACAC,aACAC;IAEA,MAAMuB,OAAO,CAACtB,kBAA2B,KAAK;QAC5C,MAAMC,UAAUJ,IAAII,OAAO;QAE3B,IAAIH,aAAa;YACfG,QAAQC,MAAM,CAACC,IAAI,CAAC,CAAC,+CAA+C,EAAEH,iBAAiB;QACzF;QAEA,IAAI;YACF,MAAMuB,SAAS3B,eAAeC,KAAKC,aAAaC,gBAAgBC;YAEhE,IAAIF,aAAa;gBACfG,QAAQC,MAAM,CAACC,IAAI,CAAC,CAAC,qCAAqC,CAAC;YAC7D;YAEA,OAAOoB;QACT,EAAE,OAAOhB,OAAO;YACd,MAAMW,eAAeX,iBAAiBiB,QAAQjB,MAAMY,OAAO,GAAG;YAC9DlB,QAAQC,MAAM,CAACK,KAAK,CAAC,CAAC,oCAAoC,EAAEW,cAAc;YAE1E,OAAO;gBACLV,SAAS;oBACP;wBACEC,MAAM;wBACNC,MAAM,CAAC,sBAAsB,EAAEQ,cAAc;oBAC/C;iBACD;YACH;QACF;IACF;IAEAG,OAAOC,IAAI,CACT,cACA3B,YAAY8B,UAAU,CAACC,WAAW,EAClC/B,YAAY8B,UAAU,CAACE,UAAU,CAACC,KAAK,EACvC,CAAC,EAAE5B,eAAe,EAAE;QAClB,OAAOsB,KAAKtB;IACd;AAEJ,EAAC"}