{"version":3,"sources":["../../src/collections/createApiKeysCollection.ts"],"sourcesContent":["import type { CollectionConfig, CollectionSlug } from 'payload'\n\nimport type { PluginMCPServerConfig } from '../types.js'\n\nimport { toCamelCase } from '../utils/camelCase.js'\nimport { createApiKeyFields } from '../utils/createApiKeyFields.js'\n\nexport const createAPIKeysCollection = (\n  collections: PluginMCPServerConfig['collections'],\n  globals: PluginMCPServerConfig['globals'],\n  customTools: Array<{ description: string; name: string }> = [],\n  experimentalTools: NonNullable<PluginMCPServerConfig['experimental']>['tools'] = {},\n  pluginOptions: PluginMCPServerConfig,\n): CollectionConfig => {\n  const customToolsFields = customTools.map((tool) => {\n    const camelCasedName = toCamelCase(tool.name)\n    return {\n      name: camelCasedName,\n      type: 'checkbox' as const,\n      admin: {\n        description: tool.description,\n      },\n      defaultValue: true,\n      label: camelCasedName,\n    }\n  })\n\n  const customResourceFields =\n    pluginOptions.mcp?.resources?.map((resource) => {\n      const camelCasedName = toCamelCase(resource.name)\n      return {\n        name: camelCasedName,\n        type: 'checkbox' as const,\n        admin: {\n          description: resource.description,\n        },\n        defaultValue: true,\n        label: camelCasedName,\n      }\n    }) || []\n\n  const customPromptFields =\n    pluginOptions.mcp?.prompts?.map((prompt) => {\n      const camelCasedName = toCamelCase(prompt.name)\n      return {\n        name: camelCasedName,\n        type: 'checkbox' as const,\n        admin: {\n          description: prompt.description,\n        },\n        defaultValue: true,\n        label: camelCasedName,\n      }\n    }) || []\n\n  const userCollection = pluginOptions.userCollection\n\n  return {\n    slug: 'payload-mcp-api-keys',\n    admin: {\n      description:\n        'API keys control which collections, resources, tools, and prompts MCP clients can access',\n      group: 'MCP',\n      useAsTitle: 'label',\n    },\n    auth: {\n      disableLocalStrategy: true,\n      useAPIKey: true,\n    },\n    fields: [\n      {\n        name: 'user',\n        type: 'relationship',\n        admin: {\n          description: 'The user that the API key is associated with.',\n        },\n        relationTo: userCollection as CollectionSlug,\n        required: true,\n      },\n      {\n        name: 'label',\n        type: 'text',\n        admin: {\n          description: 'A useful label for the API key.',\n        },\n      },\n      {\n        name: 'description',\n        type: 'text',\n        admin: {\n          description: 'The purpose of the API key.',\n        },\n      },\n\n      ...createApiKeyFields({\n        config: collections,\n        configType: 'collection',\n      }),\n\n      ...createApiKeyFields({\n        config: globals,\n        configType: 'global',\n      }),\n\n      ...(customTools.length > 0\n        ? [\n            {\n              type: 'collapsible' as const,\n              admin: {\n                description: 'Manage client access to tools',\n                position: 'sidebar' as const,\n              },\n              fields: [\n                {\n                  name: 'payload-mcp-tool',\n                  type: 'group' as const,\n                  fields: customToolsFields,\n                  label: false as const,\n                },\n              ],\n              label: 'Tools',\n            },\n          ]\n        : []),\n\n      ...(pluginOptions.mcp?.resources && pluginOptions.mcp?.resources.length > 0\n        ? [\n            {\n              type: 'collapsible' as const,\n              admin: {\n                description: 'Manage client access to resources',\n                position: 'sidebar' as const,\n              },\n              fields: [\n                {\n                  name: 'payload-mcp-resource',\n                  type: 'group' as const,\n                  fields: customResourceFields,\n                  label: false as const,\n                },\n              ],\n              label: 'Resources',\n            },\n          ]\n        : []),\n\n      ...(pluginOptions.mcp?.prompts && pluginOptions.mcp?.prompts.length > 0\n        ? [\n            {\n              type: 'collapsible' as const,\n              admin: {\n                description: 'Manage client access to prompts',\n                position: 'sidebar' as const,\n              },\n              fields: [\n                {\n                  name: 'payload-mcp-prompt',\n                  type: 'group' as const,\n                  fields: customPromptFields,\n                  label: false as const,\n                },\n              ],\n              label: 'Prompts',\n            },\n          ]\n        : []),\n\n      // Experimental Tools\n      ...(process.env.NODE_ENV === 'development' &&\n      (experimentalTools?.collections?.enabled ||\n        experimentalTools?.jobs?.enabled ||\n        experimentalTools?.config?.enabled ||\n        experimentalTools?.auth?.enabled)\n        ? [\n            {\n              type: 'collapsible' as const,\n              admin: {\n                description: 'Manage client access to experimental tools',\n                position: 'sidebar' as const,\n              },\n              fields: [\n                ...(experimentalTools?.collections?.enabled\n                  ? [\n                      {\n                        name: 'collections',\n                        type: 'group' as const,\n                        fields: [\n                          {\n                            name: 'find',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to find and list Payload collections with optional content and document counts.',\n                            },\n                            defaultValue: false,\n                          },\n                          {\n                            name: 'create',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to create new Payload collections with specified fields and configuration.',\n                            },\n                            defaultValue: false,\n                          },\n                          {\n                            name: 'update',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to update existing Payload collections with new fields, modifications, or configuration changes.',\n                            },\n                            defaultValue: false,\n                          },\n                          {\n                            name: 'delete',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to delete Payload collections and optionally update the configuration.',\n                            },\n                            defaultValue: false,\n                          },\n                        ],\n                      },\n                    ]\n                  : []),\n                ...(experimentalTools?.jobs?.enabled\n                  ? [\n                      {\n                        name: 'jobs',\n                        type: 'group' as const,\n                        fields: [\n                          {\n                            name: 'create',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to create new Payload jobs (tasks and workflows) with custom schemas and configuration.',\n                            },\n                            defaultValue: false,\n                          },\n                          {\n                            name: 'run',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to execute Payload jobs with custom input data and queue options.',\n                            },\n                            defaultValue: false,\n                          },\n                          {\n                            name: 'update',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to update existing Payload jobs with new schemas, configuration, or handler code.',\n                            },\n                            defaultValue: false,\n                          },\n                        ],\n                      },\n                    ]\n                  : []),\n                ...(experimentalTools?.config?.enabled\n                  ? [\n                      {\n                        name: 'config',\n                        type: 'group' as const,\n                        fields: [\n                          {\n                            name: 'find',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to read and display a Payload configuration file.',\n                            },\n                            defaultValue: false,\n                          },\n                          {\n                            name: 'update',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to update a Payload configuration file with various modifications.',\n                            },\n                            defaultValue: false,\n                          },\n                        ],\n                      },\n                    ]\n                  : []),\n                ...(experimentalTools?.auth?.enabled\n                  ? [\n                      {\n                        name: 'auth',\n                        type: 'group' as const,\n                        fields: [\n                          {\n                            name: 'auth',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to check authentication status for a user by setting custom headers. (e.g. {\"Authorization\": \"Bearer <token>\"})',\n                            },\n                            defaultValue: false,\n                            label: 'Check Auth Status',\n                          },\n                          {\n                            name: 'login',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to authenticate a user with email and password.',\n                            },\n                            defaultValue: false,\n                            label: 'User Login',\n                          },\n                          {\n                            name: 'verify',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to verify a user email with a verification token.',\n                            },\n                            defaultValue: false,\n                            label: 'Email Verification',\n                          },\n                          {\n                            name: 'resetPassword',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to reset a user password with a reset token.',\n                            },\n                            defaultValue: false,\n                            label: 'Reset Password',\n                          },\n                          {\n                            name: 'forgotPassword',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description: 'Allow LLMs to send a password reset email to a user.',\n                            },\n                            defaultValue: false,\n                            label: 'Forgot Password',\n                          },\n                          {\n                            name: 'unlock',\n                            type: 'checkbox' as const,\n                            admin: {\n                              description:\n                                'Allow LLMs to unlock a user account that has been locked due to failed login attempts.',\n                            },\n                            defaultValue: false,\n                            label: 'Unlock Account',\n                          },\n                        ],\n                      },\n                    ]\n                  : []),\n              ],\n              label: 'Experimental Tools',\n            },\n          ]\n        : []),\n    ],\n    labels: {\n      plural: 'API Keys',\n      singular: 'API Key',\n    },\n  }\n}\n"],"names":["toCamelCase","createApiKeyFields","createAPIKeysCollection","collections","globals","customTools","experimentalTools","pluginOptions","customToolsFields","map","tool","camelCasedName","name","type","admin","description","defaultValue","label","customResourceFields","mcp","resources","resource","customPromptFields","prompts","prompt","userCollection","slug","group","useAsTitle","auth","disableLocalStrategy","useAPIKey","fields","relationTo","required","config","configType","length","position","process","env","NODE_ENV","enabled","jobs","labels","plural","singular"],"mappings":"AAIA,SAASA,WAAW,QAAQ,wBAAuB;AACnD,SAASC,kBAAkB,QAAQ,iCAAgC;AAEnE,OAAO,MAAMC,0BAA0B,CACrCC,aACAC,SACAC,cAA4D,EAAE,EAC9DC,oBAAiF,CAAC,CAAC,EACnFC;IAEA,MAAMC,oBAAoBH,YAAYI,GAAG,CAAC,CAACC;QACzC,MAAMC,iBAAiBX,YAAYU,KAAKE,IAAI;QAC5C,OAAO;YACLA,MAAMD;YACNE,MAAM;YACNC,OAAO;gBACLC,aAAaL,KAAKK,WAAW;YAC/B;YACAC,cAAc;YACdC,OAAON;QACT;IACF;IAEA,MAAMO,uBACJX,cAAcY,GAAG,EAAEC,WAAWX,IAAI,CAACY;QACjC,MAAMV,iBAAiBX,YAAYqB,SAAST,IAAI;QAChD,OAAO;YACLA,MAAMD;YACNE,MAAM;YACNC,OAAO;gBACLC,aAAaM,SAASN,WAAW;YACnC;YACAC,cAAc;YACdC,OAAON;QACT;IACF,MAAM,EAAE;IAEV,MAAMW,qBACJf,cAAcY,GAAG,EAAEI,SAASd,IAAI,CAACe;QAC/B,MAAMb,iBAAiBX,YAAYwB,OAAOZ,IAAI;QAC9C,OAAO;YACLA,MAAMD;YACNE,MAAM;YACNC,OAAO;gBACLC,aAAaS,OAAOT,WAAW;YACjC;YACAC,cAAc;YACdC,OAAON;QACT;IACF,MAAM,EAAE;IAEV,MAAMc,iBAAiBlB,cAAckB,cAAc;IAEnD,OAAO;QACLC,MAAM;QACNZ,OAAO;YACLC,aACE;YACFY,OAAO;YACPC,YAAY;QACd;QACAC,MAAM;YACJC,sBAAsB;YACtBC,WAAW;QACb;QACAC,QAAQ;YACN;gBACEpB,MAAM;gBACNC,MAAM;gBACNC,OAAO;oBACLC,aAAa;gBACf;gBACAkB,YAAYR;gBACZS,UAAU;YACZ;YACA;gBACEtB,MAAM;gBACNC,MAAM;gBACNC,OAAO;oBACLC,aAAa;gBACf;YACF;YACA;gBACEH,MAAM;gBACNC,MAAM;gBACNC,OAAO;oBACLC,aAAa;gBACf;YACF;eAEGd,mBAAmB;gBACpBkC,QAAQhC;gBACRiC,YAAY;YACd;eAEGnC,mBAAmB;gBACpBkC,QAAQ/B;gBACRgC,YAAY;YACd;eAEI/B,YAAYgC,MAAM,GAAG,IACrB;gBACE;oBACExB,MAAM;oBACNC,OAAO;wBACLC,aAAa;wBACbuB,UAAU;oBACZ;oBACAN,QAAQ;wBACN;4BACEpB,MAAM;4BACNC,MAAM;4BACNmB,QAAQxB;4BACRS,OAAO;wBACT;qBACD;oBACDA,OAAO;gBACT;aACD,GACD,EAAE;eAEFV,cAAcY,GAAG,EAAEC,aAAab,cAAcY,GAAG,EAAEC,UAAUiB,SAAS,IACtE;gBACE;oBACExB,MAAM;oBACNC,OAAO;wBACLC,aAAa;wBACbuB,UAAU;oBACZ;oBACAN,QAAQ;wBACN;4BACEpB,MAAM;4BACNC,MAAM;4BACNmB,QAAQd;4BACRD,OAAO;wBACT;qBACD;oBACDA,OAAO;gBACT;aACD,GACD,EAAE;eAEFV,cAAcY,GAAG,EAAEI,WAAWhB,cAAcY,GAAG,EAAEI,QAAQc,SAAS,IAClE;gBACE;oBACExB,MAAM;oBACNC,OAAO;wBACLC,aAAa;wBACbuB,UAAU;oBACZ;oBACAN,QAAQ;wBACN;4BACEpB,MAAM;4BACNC,MAAM;4BACNmB,QAAQV;4BACRL,OAAO;wBACT;qBACD;oBACDA,OAAO;gBACT;aACD,GACD,EAAE;YAEN,qBAAqB;eACjBsB,QAAQC,GAAG,CAACC,QAAQ,KAAK,iBAC5BnC,CAAAA,mBAAmBH,aAAauC,WAC/BpC,mBAAmBqC,MAAMD,WACzBpC,mBAAmB6B,QAAQO,WAC3BpC,mBAAmBuB,MAAMa,OAAM,IAC7B;gBACE;oBACE7B,MAAM;oBACNC,OAAO;wBACLC,aAAa;wBACbuB,UAAU;oBACZ;oBACAN,QAAQ;2BACF1B,mBAAmBH,aAAauC,UAChC;4BACE;gCACE9B,MAAM;gCACNC,MAAM;gCACNmB,QAAQ;oCACN;wCACEpB,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;oCAChB;oCACA;wCACEJ,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;oCAChB;oCACA;wCACEJ,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;oCAChB;oCACA;wCACEJ,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;oCAChB;iCACD;4BACH;yBACD,GACD,EAAE;2BACFV,mBAAmBqC,MAAMD,UACzB;4BACE;gCACE9B,MAAM;gCACNC,MAAM;gCACNmB,QAAQ;oCACN;wCACEpB,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;oCAChB;oCACA;wCACEJ,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;oCAChB;oCACA;wCACEJ,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;oCAChB;iCACD;4BACH;yBACD,GACD,EAAE;2BACFV,mBAAmB6B,QAAQO,UAC3B;4BACE;gCACE9B,MAAM;gCACNC,MAAM;gCACNmB,QAAQ;oCACN;wCACEpB,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;oCAChB;oCACA;wCACEJ,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;oCAChB;iCACD;4BACH;yBACD,GACD,EAAE;2BACFV,mBAAmBuB,MAAMa,UACzB;4BACE;gCACE9B,MAAM;gCACNC,MAAM;gCACNmB,QAAQ;oCACN;wCACEpB,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;wCACdC,OAAO;oCACT;oCACA;wCACEL,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;wCACdC,OAAO;oCACT;oCACA;wCACEL,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;wCACdC,OAAO;oCACT;oCACA;wCACEL,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;wCACdC,OAAO;oCACT;oCACA;wCACEL,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aAAa;wCACf;wCACAC,cAAc;wCACdC,OAAO;oCACT;oCACA;wCACEL,MAAM;wCACNC,MAAM;wCACNC,OAAO;4CACLC,aACE;wCACJ;wCACAC,cAAc;wCACdC,OAAO;oCACT;iCACD;4BACH;yBACD,GACD,EAAE;qBACP;oBACDA,OAAO;gBACT;aACD,GACD,EAAE;SACP;QACD2B,QAAQ;YACNC,QAAQ;YACRC,UAAU;QACZ;IACF;AACF,EAAC"}