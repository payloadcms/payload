{"version":3,"sources":["../../../src/lib/ast/package-json.spec.ts"],"sourcesContent":["import { describe, it, expect, beforeEach, afterEach } from 'vitest'\nimport { updatePackageJson } from './package-json'\nimport * as fs from 'fs'\nimport * as path from 'path'\nimport * as os from 'os'\n\ndescribe('updatePackageJson', () => {\n  let tempDir: string\n\n  beforeEach(() => {\n    tempDir = fs.mkdtempSync(path.join(os.tmpdir(), 'payload-test-'))\n  })\n\n  afterEach(() => {\n    fs.rmSync(tempDir, { recursive: true, force: true })\n  })\n\n  it('updates database dependencies', () => {\n    const pkgPath = path.join(tempDir, 'package.json')\n    const originalPkg = {\n      name: 'test-app',\n      dependencies: {\n        '@payloadcms/db-mongodb': '^3.0.0',\n        payload: '^3.0.0',\n      },\n    }\n    fs.writeFileSync(pkgPath, JSON.stringify(originalPkg, null, 2))\n\n    updatePackageJson(pkgPath, {\n      databaseAdapter: 'postgres',\n    })\n\n    const updated = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'))\n    expect(updated.dependencies['@payloadcms/db-postgres']).toBeDefined()\n    expect(updated.dependencies['@payloadcms/db-mongodb']).toBeUndefined()\n  })\n\n  it('removes sharp when requested', () => {\n    const pkgPath = path.join(tempDir, 'package.json')\n    const originalPkg = {\n      name: 'test-app',\n      dependencies: {\n        payload: '^3.0.0',\n        sharp: '^0.33.0',\n      },\n    }\n    fs.writeFileSync(pkgPath, JSON.stringify(originalPkg, null, 2))\n\n    updatePackageJson(pkgPath, {\n      removeSharp: true,\n    })\n\n    const updated = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'))\n    expect(updated.dependencies.sharp).toBeUndefined()\n  })\n\n  it('updates package name', () => {\n    const pkgPath = path.join(tempDir, 'package.json')\n    const originalPkg = {\n      name: 'template-name',\n      dependencies: {\n        payload: '^3.0.0',\n      },\n    }\n    fs.writeFileSync(pkgPath, JSON.stringify(originalPkg, null, 2))\n\n    updatePackageJson(pkgPath, {\n      packageName: 'my-new-app',\n    })\n\n    const updated = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'))\n    expect(updated.name).toBe('my-new-app')\n  })\n})\n"],"names":["describe","it","expect","beforeEach","afterEach","updatePackageJson","fs","path","os","tempDir","mkdtempSync","join","tmpdir","rmSync","recursive","force","pkgPath","originalPkg","name","dependencies","payload","writeFileSync","JSON","stringify","databaseAdapter","updated","parse","readFileSync","toBeDefined","toBeUndefined","sharp","removeSharp","packageName","toBe"],"mappings":"AAAA,SAASA,QAAQ,EAAEC,EAAE,EAAEC,MAAM,EAAEC,UAAU,EAAEC,SAAS,QAAQ,SAAQ;AACpE,SAASC,iBAAiB,QAAQ,iBAAgB;AAClD,YAAYC,QAAQ,KAAI;AACxB,YAAYC,UAAU,OAAM;AAC5B,YAAYC,QAAQ,KAAI;AAExBR,SAAS,qBAAqB;IAC5B,IAAIS;IAEJN,WAAW;QACTM,UAAUH,GAAGI,WAAW,CAACH,KAAKI,IAAI,CAACH,GAAGI,MAAM,IAAI;IAClD;IAEAR,UAAU;QACRE,GAAGO,MAAM,CAACJ,SAAS;YAAEK,WAAW;YAAMC,OAAO;QAAK;IACpD;IAEAd,GAAG,iCAAiC;QAClC,MAAMe,UAAUT,KAAKI,IAAI,CAACF,SAAS;QACnC,MAAMQ,cAAc;YAClBC,MAAM;YACNC,cAAc;gBACZ,0BAA0B;gBAC1BC,SAAS;YACX;QACF;QACAd,GAAGe,aAAa,CAACL,SAASM,KAAKC,SAAS,CAACN,aAAa,MAAM;QAE5DZ,kBAAkBW,SAAS;YACzBQ,iBAAiB;QACnB;QAEA,MAAMC,UAAUH,KAAKI,KAAK,CAACpB,GAAGqB,YAAY,CAACX,SAAS;QACpDd,OAAOuB,QAAQN,YAAY,CAAC,0BAA0B,EAAES,WAAW;QACnE1B,OAAOuB,QAAQN,YAAY,CAAC,yBAAyB,EAAEU,aAAa;IACtE;IAEA5B,GAAG,gCAAgC;QACjC,MAAMe,UAAUT,KAAKI,IAAI,CAACF,SAAS;QACnC,MAAMQ,cAAc;YAClBC,MAAM;YACNC,cAAc;gBACZC,SAAS;gBACTU,OAAO;YACT;QACF;QACAxB,GAAGe,aAAa,CAACL,SAASM,KAAKC,SAAS,CAACN,aAAa,MAAM;QAE5DZ,kBAAkBW,SAAS;YACzBe,aAAa;QACf;QAEA,MAAMN,UAAUH,KAAKI,KAAK,CAACpB,GAAGqB,YAAY,CAACX,SAAS;QACpDd,OAAOuB,QAAQN,YAAY,CAACW,KAAK,EAAED,aAAa;IAClD;IAEA5B,GAAG,wBAAwB;QACzB,MAAMe,UAAUT,KAAKI,IAAI,CAACF,SAAS;QACnC,MAAMQ,cAAc;YAClBC,MAAM;YACNC,cAAc;gBACZC,SAAS;YACX;QACF;QACAd,GAAGe,aAAa,CAACL,SAASM,KAAKC,SAAS,CAACN,aAAa,MAAM;QAE5DZ,kBAAkBW,SAAS;YACzBgB,aAAa;QACf;QAEA,MAAMP,UAAUH,KAAKI,KAAK,CAACpB,GAAGqB,YAAY,CAACX,SAAS;QACpDd,OAAOuB,QAAQP,IAAI,EAAEe,IAAI,CAAC;IAC5B;AACF"}