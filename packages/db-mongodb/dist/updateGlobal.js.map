{"version":3,"sources":["../src/updateGlobal.ts"],"sourcesContent":["import type { MongooseUpdateQueryOptions } from 'mongoose'\nimport type { UpdateGlobal } from 'payload'\n\nimport type { MongooseAdapter } from './index.js'\n\nimport { buildProjectionFromSelect } from './utilities/buildProjectionFromSelect.js'\nimport { getGlobal } from './utilities/getEntity.js'\nimport { getSession } from './utilities/getSession.js'\nimport { transform } from './utilities/transform.js'\n\nexport const updateGlobal: UpdateGlobal = async function updateGlobal(\n  this: MongooseAdapter,\n  { slug: globalSlug, data, options: optionsArgs = {}, req, returning, select },\n) {\n  const { globalConfig, Model } = getGlobal({ adapter: this, globalSlug })\n\n  const fields = globalConfig.fields\n\n  transform({ adapter: this, data, fields, globalSlug, operation: 'write' })\n\n  const options: MongooseUpdateQueryOptions = {\n    ...optionsArgs,\n    lean: true,\n    new: true,\n    projection: buildProjectionFromSelect({\n      adapter: this,\n      fields: globalConfig.flattenedFields,\n      select,\n    }),\n    session: await getSession(this, req),\n    // Timestamps are manually added by the write transform\n    timestamps: false,\n  }\n\n  if (returning === false) {\n    await Model.updateOne({ globalType: globalSlug }, data, options)\n    return null\n  }\n\n  const result: any = await Model.findOneAndUpdate({ globalType: globalSlug }, data, options)\n\n  transform({ adapter: this, data: result, fields, globalSlug, operation: 'read' })\n\n  return result\n}\n"],"names":["buildProjectionFromSelect","getGlobal","getSession","transform","updateGlobal","slug","globalSlug","data","options","optionsArgs","req","returning","select","globalConfig","Model","adapter","fields","operation","lean","new","projection","flattenedFields","session","timestamps","updateOne","globalType","result","findOneAndUpdate"],"mappings":"AAKA,SAASA,yBAAyB,QAAQ,2CAA0C;AACpF,SAASC,SAAS,QAAQ,2BAA0B;AACpD,SAASC,UAAU,QAAQ,4BAA2B;AACtD,SAASC,SAAS,QAAQ,2BAA0B;AAEpD,OAAO,MAAMC,eAA6B,eAAeA,aAEvD,EAAEC,MAAMC,UAAU,EAAEC,IAAI,EAAEC,SAASC,cAAc,CAAC,CAAC,EAAEC,GAAG,EAAEC,SAAS,EAAEC,MAAM,EAAE;IAE7E,MAAM,EAAEC,YAAY,EAAEC,KAAK,EAAE,GAAGb,UAAU;QAAEc,SAAS,IAAI;QAAET;IAAW;IAEtE,MAAMU,SAASH,aAAaG,MAAM;IAElCb,UAAU;QAAEY,SAAS,IAAI;QAAER;QAAMS;QAAQV;QAAYW,WAAW;IAAQ;IAExE,MAAMT,UAAsC;QAC1C,GAAGC,WAAW;QACdS,MAAM;QACNC,KAAK;QACLC,YAAYpB,0BAA0B;YACpCe,SAAS,IAAI;YACbC,QAAQH,aAAaQ,eAAe;YACpCT;QACF;QACAU,SAAS,MAAMpB,WAAW,IAAI,EAAEQ;QAChC,uDAAuD;QACvDa,YAAY;IACd;IAEA,IAAIZ,cAAc,OAAO;QACvB,MAAMG,MAAMU,SAAS,CAAC;YAAEC,YAAYnB;QAAW,GAAGC,MAAMC;QACxD,OAAO;IACT;IAEA,MAAMkB,SAAc,MAAMZ,MAAMa,gBAAgB,CAAC;QAAEF,YAAYnB;IAAW,GAAGC,MAAMC;IAEnFL,UAAU;QAAEY,SAAS,IAAI;QAAER,MAAMmB;QAAQV;QAAQV;QAAYW,WAAW;IAAO;IAE/E,OAAOS;AACT,EAAC"}