{"version":3,"sources":["../src/create.ts"],"sourcesContent":["import type { Create } from 'payload'\n\nimport { type CreateOptions, Types } from 'mongoose'\n\nimport type { MongooseAdapter } from './index.js'\n\nimport { getCollection } from './utilities/getEntity.js'\nimport { getSession } from './utilities/getSession.js'\nimport { handleError } from './utilities/handleError.js'\nimport { transform } from './utilities/transform.js'\n\nexport const create: Create = async function create(\n  this: MongooseAdapter,\n  { collection: collectionSlug, data, req, returning },\n) {\n  const { collectionConfig, customIDType, Model } = getCollection({ adapter: this, collectionSlug })\n\n  let doc\n\n  if (!data.createdAt) {\n    data.createdAt = new Date().toISOString()\n  }\n\n  transform({\n    adapter: this,\n    data,\n    fields: collectionConfig.fields,\n    operation: 'write',\n  })\n\n  if (customIDType) {\n    data._id = data.id\n  } else if (this.allowIDOnCreate && data.id) {\n    try {\n      data._id = new Types.ObjectId(data.id as string)\n    } catch (error) {\n      this.payload.logger.error(\n        `It appears you passed ID to create operation data but it cannot be sanitized to ObjectID, value - ${JSON.stringify(data.id)}`,\n      )\n      throw error\n    }\n  }\n\n  const options: CreateOptions = {\n    session: await getSession(this, req),\n    // Timestamps are manually added by the write transform\n    timestamps: false,\n  }\n\n  try {\n    ;[doc] = await Model.create([data], options)\n  } catch (error) {\n    handleError({ collection: collectionSlug, error, req })\n  }\n  if (returning === false) {\n    return null\n  }\n\n  doc = doc.toObject()\n\n  transform({\n    adapter: this,\n    data: doc,\n    fields: collectionConfig.fields,\n    operation: 'read',\n  })\n\n  return doc\n}\n"],"names":["Types","getCollection","getSession","handleError","transform","create","collection","collectionSlug","data","req","returning","collectionConfig","customIDType","Model","adapter","doc","createdAt","Date","toISOString","fields","operation","_id","id","allowIDOnCreate","ObjectId","error","payload","logger","JSON","stringify","options","session","timestamps","toObject"],"mappings":"AAEA,SAA6BA,KAAK,QAAQ,WAAU;AAIpD,SAASC,aAAa,QAAQ,2BAA0B;AACxD,SAASC,UAAU,QAAQ,4BAA2B;AACtD,SAASC,WAAW,QAAQ,6BAA4B;AACxD,SAASC,SAAS,QAAQ,2BAA0B;AAEpD,OAAO,MAAMC,SAAiB,eAAeA,OAE3C,EAAEC,YAAYC,cAAc,EAAEC,IAAI,EAAEC,GAAG,EAAEC,SAAS,EAAE;IAEpD,MAAM,EAAEC,gBAAgB,EAAEC,YAAY,EAAEC,KAAK,EAAE,GAAGZ,cAAc;QAAEa,SAAS,IAAI;QAAEP;IAAe;IAEhG,IAAIQ;IAEJ,IAAI,CAACP,KAAKQ,SAAS,EAAE;QACnBR,KAAKQ,SAAS,GAAG,IAAIC,OAAOC,WAAW;IACzC;IAEAd,UAAU;QACRU,SAAS,IAAI;QACbN;QACAW,QAAQR,iBAAiBQ,MAAM;QAC/BC,WAAW;IACb;IAEA,IAAIR,cAAc;QAChBJ,KAAKa,GAAG,GAAGb,KAAKc,EAAE;IACpB,OAAO,IAAI,IAAI,CAACC,eAAe,IAAIf,KAAKc,EAAE,EAAE;QAC1C,IAAI;YACFd,KAAKa,GAAG,GAAG,IAAIrB,MAAMwB,QAAQ,CAAChB,KAAKc,EAAE;QACvC,EAAE,OAAOG,OAAO;YACd,IAAI,CAACC,OAAO,CAACC,MAAM,CAACF,KAAK,CACvB,CAAC,kGAAkG,EAAEG,KAAKC,SAAS,CAACrB,KAAKc,EAAE,GAAG;YAEhI,MAAMG;QACR;IACF;IAEA,MAAMK,UAAyB;QAC7BC,SAAS,MAAM7B,WAAW,IAAI,EAAEO;QAChC,uDAAuD;QACvDuB,YAAY;IACd;IAEA,IAAI;;QACD,CAACjB,IAAI,GAAG,MAAMF,MAAMR,MAAM,CAAC;YAACG;SAAK,EAAEsB;IACtC,EAAE,OAAOL,OAAO;QACdtB,YAAY;YAAEG,YAAYC;YAAgBkB;YAAOhB;QAAI;IACvD;IACA,IAAIC,cAAc,OAAO;QACvB,OAAO;IACT;IAEAK,MAAMA,IAAIkB,QAAQ;IAElB7B,UAAU;QACRU,SAAS,IAAI;QACbN,MAAMO;QACNI,QAAQR,iBAAiBQ,MAAM;QAC/BC,WAAW;IACb;IAEA,OAAOL;AACT,EAAC"}