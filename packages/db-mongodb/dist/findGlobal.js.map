{"version":3,"sources":["../src/findGlobal.ts"],"sourcesContent":["import type { QueryOptions } from 'mongoose'\nimport type { FindGlobal } from 'payload'\n\nimport { combineQueries } from 'payload'\n\nimport type { MongooseAdapter } from './index.js'\n\nimport { buildQuery } from './queries/buildQuery.js'\nimport { buildProjectionFromSelect } from './utilities/buildProjectionFromSelect.js'\nimport { getGlobal } from './utilities/getEntity.js'\nimport { getSession } from './utilities/getSession.js'\nimport { transform } from './utilities/transform.js'\n\nexport const findGlobal: FindGlobal = async function findGlobal(\n  this: MongooseAdapter,\n  { slug: globalSlug, locale, req, select, where = {} },\n) {\n  const { globalConfig, Model } = getGlobal({ adapter: this, globalSlug })\n\n  const fields = globalConfig.flattenedFields\n\n  const query = await buildQuery({\n    adapter: this,\n    fields,\n    globalSlug,\n    locale,\n    where: combineQueries({ globalType: { equals: globalSlug } }, where),\n  })\n\n  const options: QueryOptions = {\n    lean: true,\n    select: buildProjectionFromSelect({\n      adapter: this,\n      fields,\n      select,\n    }),\n    session: await getSession(this, req),\n  }\n\n  const doc: any = await Model.findOne(query, {}, options)\n\n  if (!doc) {\n    return null\n  }\n\n  transform({\n    adapter: this,\n    data: doc,\n    fields: globalConfig.fields,\n    operation: 'read',\n  })\n\n  return doc\n}\n"],"names":["combineQueries","buildQuery","buildProjectionFromSelect","getGlobal","getSession","transform","findGlobal","slug","globalSlug","locale","req","select","where","globalConfig","Model","adapter","fields","flattenedFields","query","globalType","equals","options","lean","session","doc","findOne","data","operation"],"mappings":"AAGA,SAASA,cAAc,QAAQ,UAAS;AAIxC,SAASC,UAAU,QAAQ,0BAAyB;AACpD,SAASC,yBAAyB,QAAQ,2CAA0C;AACpF,SAASC,SAAS,QAAQ,2BAA0B;AACpD,SAASC,UAAU,QAAQ,4BAA2B;AACtD,SAASC,SAAS,QAAQ,2BAA0B;AAEpD,OAAO,MAAMC,aAAyB,eAAeA,WAEnD,EAAEC,MAAMC,UAAU,EAAEC,MAAM,EAAEC,GAAG,EAAEC,MAAM,EAAEC,QAAQ,CAAC,CAAC,EAAE;IAErD,MAAM,EAAEC,YAAY,EAAEC,KAAK,EAAE,GAAGX,UAAU;QAAEY,SAAS,IAAI;QAAEP;IAAW;IAEtE,MAAMQ,SAASH,aAAaI,eAAe;IAE3C,MAAMC,QAAQ,MAAMjB,WAAW;QAC7Bc,SAAS,IAAI;QACbC;QACAR;QACAC;QACAG,OAAOZ,eAAe;YAAEmB,YAAY;gBAAEC,QAAQZ;YAAW;QAAE,GAAGI;IAChE;IAEA,MAAMS,UAAwB;QAC5BC,MAAM;QACNX,QAAQT,0BAA0B;YAChCa,SAAS,IAAI;YACbC;YACAL;QACF;QACAY,SAAS,MAAMnB,WAAW,IAAI,EAAEM;IAClC;IAEA,MAAMc,MAAW,MAAMV,MAAMW,OAAO,CAACP,OAAO,CAAC,GAAGG;IAEhD,IAAI,CAACG,KAAK;QACR,OAAO;IACT;IAEAnB,UAAU;QACRU,SAAS,IAAI;QACbW,MAAMF;QACNR,QAAQH,aAAaG,MAAM;QAC3BW,WAAW;IACb;IAEA,OAAOH;AACT,EAAC"}