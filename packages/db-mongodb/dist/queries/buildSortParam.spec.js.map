{"version":3,"sources":["../../src/queries/buildSortParam.spec.ts"],"sourcesContent":["import type { Config, SanitizedConfig } from 'payload'\nimport { describe, beforeAll, it, expect } from 'vitest'\n\nimport { sanitizeConfig } from 'payload'\n\nimport { buildSortParam } from './buildSortParam.js'\nimport { MongooseAdapter } from '../index.js'\n\nlet config: SanitizedConfig\n\ndescribe('builds sort params', () => {\n  beforeAll(async () => {\n    config = await sanitizeConfig({\n      localization: {\n        defaultLocale: 'en',\n        fallback: true,\n        locales: ['en', 'es'],\n      },\n    } as Config)\n  })\n  it('adds a fallback on non-unique field', () => {\n    const result = buildSortParam({\n      config,\n      parentIsLocalized: false,\n      fields: [\n        {\n          name: 'title',\n          type: 'text',\n        },\n        {\n          name: 'order',\n          type: 'number',\n        },\n      ],\n      locale: 'en',\n      sort: 'order',\n      timestamps: true,\n      adapter: {\n        disableFallbackSort: false,\n      } as MongooseAdapter,\n    })\n\n    expect(result).toStrictEqual({ order: 'asc', createdAt: 'desc' })\n  })\n\n  it('adds a fallback when sort isnt provided', () => {\n    const result = buildSortParam({\n      config,\n      parentIsLocalized: false,\n      fields: [\n        {\n          name: 'title',\n          type: 'text',\n        },\n        {\n          name: 'order',\n          type: 'number',\n        },\n      ],\n      locale: 'en',\n      sort: undefined,\n      timestamps: true,\n      adapter: {\n        disableFallbackSort: false,\n      } as MongooseAdapter,\n    })\n\n    expect(result).toStrictEqual({ createdAt: 'desc' })\n  })\n\n  it('does not add a fallback on non-unique field when disableFallbackSort is true', () => {\n    const result = buildSortParam({\n      config,\n      parentIsLocalized: false,\n      fields: [\n        {\n          name: 'title',\n          type: 'text',\n        },\n        {\n          name: 'order',\n          type: 'number',\n        },\n      ],\n      locale: 'en',\n      sort: 'order',\n      timestamps: true,\n      adapter: {\n        disableFallbackSort: true,\n      } as MongooseAdapter,\n    })\n\n    expect(result).toStrictEqual({ order: 'asc' })\n  })\n\n  // This test should be true even when disableFallbackSort is false\n  it('does not add a fallback on unique field', () => {\n    const result = buildSortParam({\n      config,\n      parentIsLocalized: false,\n      fields: [\n        {\n          name: 'title',\n          type: 'text',\n        },\n        {\n          name: 'order',\n          type: 'number',\n          unique: true, // Marking this field as unique\n        },\n      ],\n      locale: 'en',\n      sort: 'order',\n      timestamps: true,\n      adapter: {\n        disableFallbackSort: false,\n      } as MongooseAdapter,\n    })\n\n    expect(result).toStrictEqual({ order: 'asc' })\n  })\n})\n"],"names":["describe","beforeAll","it","expect","sanitizeConfig","buildSortParam","config","localization","defaultLocale","fallback","locales","result","parentIsLocalized","fields","name","type","locale","sort","timestamps","adapter","disableFallbackSort","toStrictEqual","order","createdAt","undefined","unique"],"mappings":"AACA,SAASA,QAAQ,EAAEC,SAAS,EAAEC,EAAE,EAAEC,MAAM,QAAQ,SAAQ;AAExD,SAASC,cAAc,QAAQ,UAAS;AAExC,SAASC,cAAc,QAAQ,sBAAqB;AAGpD,IAAIC;AAEJN,SAAS,sBAAsB;IAC7BC,UAAU;QACRK,SAAS,MAAMF,eAAe;YAC5BG,cAAc;gBACZC,eAAe;gBACfC,UAAU;gBACVC,SAAS;oBAAC;oBAAM;iBAAK;YACvB;QACF;IACF;IACAR,GAAG,uCAAuC;QACxC,MAAMS,SAASN,eAAe;YAC5BC;YACAM,mBAAmB;YACnBC,QAAQ;gBACN;oBACEC,MAAM;oBACNC,MAAM;gBACR;gBACA;oBACED,MAAM;oBACNC,MAAM;gBACR;aACD;YACDC,QAAQ;YACRC,MAAM;YACNC,YAAY;YACZC,SAAS;gBACPC,qBAAqB;YACvB;QACF;QAEAjB,OAAOQ,QAAQU,aAAa,CAAC;YAAEC,OAAO;YAAOC,WAAW;QAAO;IACjE;IAEArB,GAAG,2CAA2C;QAC5C,MAAMS,SAASN,eAAe;YAC5BC;YACAM,mBAAmB;YACnBC,QAAQ;gBACN;oBACEC,MAAM;oBACNC,MAAM;gBACR;gBACA;oBACED,MAAM;oBACNC,MAAM;gBACR;aACD;YACDC,QAAQ;YACRC,MAAMO;YACNN,YAAY;YACZC,SAAS;gBACPC,qBAAqB;YACvB;QACF;QAEAjB,OAAOQ,QAAQU,aAAa,CAAC;YAAEE,WAAW;QAAO;IACnD;IAEArB,GAAG,gFAAgF;QACjF,MAAMS,SAASN,eAAe;YAC5BC;YACAM,mBAAmB;YACnBC,QAAQ;gBACN;oBACEC,MAAM;oBACNC,MAAM;gBACR;gBACA;oBACED,MAAM;oBACNC,MAAM;gBACR;aACD;YACDC,QAAQ;YACRC,MAAM;YACNC,YAAY;YACZC,SAAS;gBACPC,qBAAqB;YACvB;QACF;QAEAjB,OAAOQ,QAAQU,aAAa,CAAC;YAAEC,OAAO;QAAM;IAC9C;IAEA,kEAAkE;IAClEpB,GAAG,2CAA2C;QAC5C,MAAMS,SAASN,eAAe;YAC5BC;YACAM,mBAAmB;YACnBC,QAAQ;gBACN;oBACEC,MAAM;oBACNC,MAAM;gBACR;gBACA;oBACED,MAAM;oBACNC,MAAM;oBACNU,QAAQ;gBACV;aACD;YACDT,QAAQ;YACRC,MAAM;YACNC,YAAY;YACZC,SAAS;gBACPC,qBAAqB;YACvB;QACF;QAEAjB,OAAOQ,QAAQU,aAAa,CAAC;YAAEC,OAAO;QAAM;IAC9C;AACF"}