{"version":3,"sources":["../../src/utilities/populateBreadcrumbs.ts"],"sourcesContent":["import type { Data, Document, PayloadRequest, SanitizedCollectionConfig } from 'payload'\n\nimport type { GenerateLabel, GenerateURL } from '../types.js'\n\nimport { formatBreadcrumb } from './formatBreadcrumb.js'\nimport { getParents as getAllParentDocuments } from './getParents.js'\n\ntype Args = {\n  breadcrumbsFieldName?: string\n  collection: SanitizedCollectionConfig\n  data: Data\n  generateLabel?: GenerateLabel\n  generateURL?: GenerateURL\n  originalDoc?: Document\n  parentFieldName?: string\n  req: PayloadRequest\n}\nexport const populateBreadcrumbs = async ({\n  breadcrumbsFieldName = 'breadcrumbs',\n  collection,\n  data,\n  generateLabel,\n  generateURL,\n  originalDoc,\n  parentFieldName,\n  req,\n}: Args): Promise<Data> => {\n  const newData = data\n\n  const currentDocument = {\n    ...originalDoc,\n    ...data,\n    id: originalDoc?.id ?? data?.id,\n  }\n\n  const allParentDocuments: Document[] = await getAllParentDocuments(\n    req,\n    {\n      generateLabel,\n      generateURL,\n      parentFieldSlug: parentFieldName,\n    },\n    collection,\n    currentDocument,\n  )\n\n  allParentDocuments.push(currentDocument)\n\n  const breadcrumbs = allParentDocuments.map((_, i) =>\n    formatBreadcrumb({\n      breadcrumb: currentDocument[breadcrumbsFieldName]?.[i],\n      collection,\n      docs: allParentDocuments.slice(0, i + 1),\n      generateLabel,\n      generateURL,\n      req,\n    }),\n  )\n\n  newData[breadcrumbsFieldName] = breadcrumbs\n\n  return newData\n}\n"],"names":["formatBreadcrumb","getParents","getAllParentDocuments","populateBreadcrumbs","breadcrumbsFieldName","collection","data","generateLabel","generateURL","originalDoc","parentFieldName","req","newData","currentDocument","id","allParentDocuments","parentFieldSlug","push","breadcrumbs","map","_","i","breadcrumb","docs","slice"],"mappings":"AAIA,SAASA,gBAAgB,QAAQ,wBAAuB;AACxD,SAASC,cAAcC,qBAAqB,QAAQ,kBAAiB;AAYrE,OAAO,MAAMC,sBAAsB,OAAO,EACxCC,uBAAuB,aAAa,EACpCC,UAAU,EACVC,IAAI,EACJC,aAAa,EACbC,WAAW,EACXC,WAAW,EACXC,eAAe,EACfC,GAAG,EACE;IACL,MAAMC,UAAUN;IAEhB,MAAMO,kBAAkB;QACtB,GAAGJ,WAAW;QACd,GAAGH,IAAI;QACPQ,IAAIL,aAAaK,MAAMR,MAAMQ;IAC/B;IAEA,MAAMC,qBAAiC,MAAMb,sBAC3CS,KACA;QACEJ;QACAC;QACAQ,iBAAiBN;IACnB,GACAL,YACAQ;IAGFE,mBAAmBE,IAAI,CAACJ;IAExB,MAAMK,cAAcH,mBAAmBI,GAAG,CAAC,CAACC,GAAGC,IAC7CrB,iBAAiB;YACfsB,YAAYT,eAAe,CAACT,qBAAqB,EAAE,CAACiB,EAAE;YACtDhB;YACAkB,MAAMR,mBAAmBS,KAAK,CAAC,GAAGH,IAAI;YACtCd;YACAC;YACAG;QACF;IAGFC,OAAO,CAACR,qBAAqB,GAAGc;IAEhC,OAAON;AACT,EAAC"}