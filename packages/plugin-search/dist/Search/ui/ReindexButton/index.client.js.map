{"version":3,"sources":["../../../../src/Search/ui/ReindexButton/index.client.tsx"],"sourcesContent":["'use client'\n\nimport {\n  ConfirmationModal,\n  Popup,\n  PopupList,\n  toast,\n  useConfig,\n  useLocale,\n  useModal,\n  useTranslation,\n} from '@payloadcms/ui'\nimport { useRouter } from 'next/navigation.js'\nimport { formatAdminURL } from 'payload/shared'\nimport React, { useCallback, useMemo, useState } from 'react'\n\nimport type { ReindexButtonProps } from './types.js'\n\nimport { ReindexButtonLabel } from './ReindexButtonLabel/index.js'\n\nconst confirmReindexModalSlug = 'confirm-reindex-modal'\n\nexport const ReindexButtonClient: React.FC<ReindexButtonProps> = ({\n  collectionLabels,\n  searchCollections,\n  searchSlug,\n}) => {\n  const { openModal } = useModal()\n\n  const { config } = useConfig()\n\n  const {\n    i18n: { t },\n  } = useTranslation()\n\n  const locale = useLocale()\n  const router = useRouter()\n\n  const [reindexCollections, setReindexCollections] = useState<string[]>([])\n\n  const openConfirmModal = useCallback(() => openModal(confirmReindexModalSlug), [openModal])\n\n  const handleReindexSubmit = useCallback(async () => {\n    if (!reindexCollections.length) {\n      return\n    }\n\n    try {\n      const res = await fetch(\n        formatAdminURL({\n          apiRoute: config.routes.api,\n          path: `/${searchSlug}/reindex?locale=${locale.code}`,\n        }),\n        {\n          body: JSON.stringify({\n            collections: reindexCollections,\n          }),\n          method: 'POST',\n        },\n      )\n\n      const { message } = (await res.json()) as { message: string }\n\n      if (!res.ok) {\n        toast.error(message)\n      } else {\n        toast.success(message)\n        return router.refresh()\n      }\n    } catch (_err: unknown) {\n      // swallow error, toast shown above\n    } finally {\n      setReindexCollections([])\n    }\n  }, [reindexCollections, router, searchSlug, locale, config])\n\n  const handleShowConfirmModal = useCallback(\n    (collections: string | string[] = searchCollections) => {\n      setReindexCollections(typeof collections === 'string' ? [collections] : collections)\n      openConfirmModal()\n    },\n    [openConfirmModal, searchCollections],\n  )\n\n  const handlePopupButtonClick = useCallback(\n    (closePopup: () => void, slug?: string) => {\n      closePopup()\n      handleShowConfirmModal(slug)\n    },\n    [handleShowConfirmModal],\n  )\n\n  const getPluralizedLabel = useCallback(\n    (slug: string) => {\n      const label = collectionLabels[slug]\n      if (typeof label === 'string') {\n        return label\n      } else {\n        return label && Object.hasOwn(label, locale.code) ? label[locale.code] : slug\n      }\n    },\n    [collectionLabels, locale.code],\n  )\n\n  const pluralizedLabels = useMemo(() => {\n    return searchCollections.reduce<Record<string, string>>((acc, slug) => {\n      const label = getPluralizedLabel(slug)\n      if (label) {\n        acc[slug] = label\n      }\n      return acc\n    }, {})\n  }, [searchCollections, getPluralizedLabel])\n\n  const selectedAll = reindexCollections.length === searchCollections.length\n  const selectedLabels = reindexCollections.map((slug) => pluralizedLabels[slug]).join(', ')\n\n  const modalTitle = selectedAll\n    ? t('general:confirmReindexAll')\n    : t('general:confirmReindex', { collections: selectedLabels })\n  const modalDescription = selectedAll\n    ? t('general:confirmReindexDescriptionAll')\n    : t('general:confirmReindexDescription', { collections: selectedLabels })\n\n  return (\n    <div>\n      <Popup\n        button={<ReindexButtonLabel />}\n        render={({ close }) => (\n          <PopupList.ButtonGroup>\n            {searchCollections.map((collectionSlug) => (\n              <PopupList.Button\n                key={collectionSlug}\n                onClick={() => handlePopupButtonClick(close, collectionSlug)}\n              >\n                {pluralizedLabels[collectionSlug]}\n              </PopupList.Button>\n            ))}\n            <PopupList.Button onClick={() => handlePopupButtonClick(close)}>\n              {t('general:allCollections')}\n            </PopupList.Button>\n          </PopupList.ButtonGroup>\n        )}\n        showScrollbar\n        size=\"large\"\n        verticalAlign=\"bottom\"\n      />\n      <ConfirmationModal\n        body={modalDescription}\n        heading={modalTitle}\n        modalSlug={confirmReindexModalSlug}\n        onConfirm={handleReindexSubmit}\n      />\n    </div>\n  )\n}\n"],"names":["ConfirmationModal","Popup","PopupList","toast","useConfig","useLocale","useModal","useTranslation","useRouter","formatAdminURL","React","useCallback","useMemo","useState","ReindexButtonLabel","confirmReindexModalSlug","ReindexButtonClient","collectionLabels","searchCollections","searchSlug","openModal","config","i18n","t","locale","router","reindexCollections","setReindexCollections","openConfirmModal","handleReindexSubmit","length","res","fetch","apiRoute","routes","api","path","code","body","JSON","stringify","collections","method","message","json","ok","error","success","refresh","_err","handleShowConfirmModal","handlePopupButtonClick","closePopup","slug","getPluralizedLabel","label","Object","hasOwn","pluralizedLabels","reduce","acc","selectedAll","selectedLabels","map","join","modalTitle","modalDescription","div","button","render","close","ButtonGroup","collectionSlug","Button","onClick","showScrollbar","size","verticalAlign","heading","modalSlug","onConfirm"],"mappings":"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"}