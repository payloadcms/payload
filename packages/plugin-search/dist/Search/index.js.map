{"version":3,"sources":["../../src/Search/index.ts"],"sourcesContent":["import type { CollectionConfig, Field } from 'payload'\n\nimport type { SanitizedSearchPluginConfig } from '../types.js'\nimport type { ReindexButtonServerProps } from './ui/ReindexButton/types.js'\n\nimport { generateReindexHandler } from '../utilities/generateReindexHandler.js'\n\n// all settings can be overridden by the config\nexport const generateSearchCollection = (\n  pluginConfig: SanitizedSearchPluginConfig,\n): CollectionConfig => {\n  const searchSlug = pluginConfig?.searchOverrides?.slug || 'search'\n  const searchCollections = pluginConfig?.collections || []\n  const collectionLabels = pluginConfig?.labels\n\n  const defaultFields: Field[] = [\n    {\n      name: 'title',\n      type: 'text',\n      admin: {\n        readOnly: true,\n      },\n      localized: pluginConfig.localize,\n    },\n    {\n      name: 'priority',\n      type: 'number',\n      admin: {\n        position: 'sidebar',\n      },\n    },\n    {\n      name: 'doc',\n      type: 'relationship',\n      admin: {\n        position: 'sidebar',\n        readOnly: true,\n      },\n      index: true,\n      maxDepth: 0,\n      relationTo: searchCollections,\n      required: true,\n    },\n    {\n      name: 'docUrl',\n      type: 'ui',\n      admin: {\n        components: {\n          Field: {\n            path: '@payloadcms/plugin-search/client#LinkToDoc',\n          },\n        },\n        position: 'sidebar',\n      },\n    },\n  ]\n\n  if (!collectionLabels) {\n    throw new Error('collectionLabels is required')\n  }\n\n  const newConfig: CollectionConfig = {\n    ...(pluginConfig?.searchOverrides || {}),\n    slug: searchSlug,\n    access: {\n      create: (): boolean => false,\n      read: (): boolean => true,\n      ...(pluginConfig?.searchOverrides?.access || {}),\n    },\n    admin: {\n      components: {\n        views: {\n          list: {\n            actions: [\n              {\n                path: '@payloadcms/plugin-search/client#ReindexButton',\n                serverProps: {\n                  collectionLabels,\n                  searchCollections,\n                  searchSlug,\n                } satisfies ReindexButtonServerProps,\n              },\n            ],\n          },\n        },\n      },\n      defaultColumns: ['title'],\n      description:\n        'This is a collection of automatically created search results. These results are used by the global site search and will be updated automatically as documents in the CMS are created or updated.',\n      enableRichTextRelationship: false,\n      useAsTitle: 'title',\n      ...(pluginConfig?.searchOverrides?.admin || {}),\n    },\n    endpoints: [\n      ...(pluginConfig?.searchOverrides?.endpoints || []),\n      {\n        handler: generateReindexHandler(pluginConfig),\n        method: 'post',\n        path: '/reindex',\n      },\n    ],\n    fields:\n      pluginConfig?.searchOverrides?.fields &&\n      typeof pluginConfig?.searchOverrides?.fields === 'function'\n        ? pluginConfig?.searchOverrides.fields({ defaultFields })\n        : defaultFields,\n    labels: {\n      ...(pluginConfig?.searchOverrides?.labels || {\n        plural: 'Search Results',\n        singular: 'Search Result',\n      }),\n    },\n  }\n\n  return newConfig\n}\n"],"names":["generateReindexHandler","generateSearchCollection","pluginConfig","searchSlug","searchOverrides","slug","searchCollections","collections","collectionLabels","labels","defaultFields","name","type","admin","readOnly","localized","localize","position","index","maxDepth","relationTo","required","components","Field","path","Error","newConfig","access","create","read","views","list","actions","serverProps","defaultColumns","description","enableRichTextRelationship","useAsTitle","endpoints","handler","method","fields","plural","singular"],"mappings":"AAKA,SAASA,sBAAsB,QAAQ,yCAAwC;AAE/E,+CAA+C;AAC/C,OAAO,MAAMC,2BAA2B,CACtCC;IAEA,MAAMC,aAAaD,cAAcE,iBAAiBC,QAAQ;IAC1D,MAAMC,oBAAoBJ,cAAcK,eAAe,EAAE;IACzD,MAAMC,mBAAmBN,cAAcO;IAEvC,MAAMC,gBAAyB;QAC7B;YACEC,MAAM;YACNC,MAAM;YACNC,OAAO;gBACLC,UAAU;YACZ;YACAC,WAAWb,aAAac,QAAQ;QAClC;QACA;YACEL,MAAM;YACNC,MAAM;YACNC,OAAO;gBACLI,UAAU;YACZ;QACF;QACA;YACEN,MAAM;YACNC,MAAM;YACNC,OAAO;gBACLI,UAAU;gBACVH,UAAU;YACZ;YACAI,OAAO;YACPC,UAAU;YACVC,YAAYd;YACZe,UAAU;QACZ;QACA;YACEV,MAAM;YACNC,MAAM;YACNC,OAAO;gBACLS,YAAY;oBACVC,OAAO;wBACLC,MAAM;oBACR;gBACF;gBACAP,UAAU;YACZ;QACF;KACD;IAED,IAAI,CAACT,kBAAkB;QACrB,MAAM,IAAIiB,MAAM;IAClB;IAEA,MAAMC,YAA8B;QAClC,GAAIxB,cAAcE,mBAAmB,CAAC,CAAC;QACvCC,MAAMF;QACNwB,QAAQ;YACNC,QAAQ,IAAe;YACvBC,MAAM,IAAe;YACrB,GAAI3B,cAAcE,iBAAiBuB,UAAU,CAAC,CAAC;QACjD;QACAd,OAAO;YACLS,YAAY;gBACVQ,OAAO;oBACLC,MAAM;wBACJC,SAAS;4BACP;gCACER,MAAM;gCACNS,aAAa;oCACXzB;oCACAF;oCACAH;gCACF;4BACF;yBACD;oBACH;gBACF;YACF;YACA+B,gBAAgB;gBAAC;aAAQ;YACzBC,aACE;YACFC,4BAA4B;YAC5BC,YAAY;YACZ,GAAInC,cAAcE,iBAAiBS,SAAS,CAAC,CAAC;QAChD;QACAyB,WAAW;eACLpC,cAAcE,iBAAiBkC,aAAa,EAAE;YAClD;gBACEC,SAASvC,uBAAuBE;gBAChCsC,QAAQ;gBACRhB,MAAM;YACR;SACD;QACDiB,QACEvC,cAAcE,iBAAiBqC,UAC/B,OAAOvC,cAAcE,iBAAiBqC,WAAW,aAC7CvC,cAAcE,gBAAgBqC,OAAO;YAAE/B;QAAc,KACrDA;QACND,QAAQ;YACN,GAAIP,cAAcE,iBAAiBK,UAAU;gBAC3CiC,QAAQ;gBACRC,UAAU;YACZ,CAAC;QACH;IACF;IAEA,OAAOjB;AACT,EAAC"}