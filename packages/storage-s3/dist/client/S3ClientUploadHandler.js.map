{"version":3,"sources":["../../src/client/S3ClientUploadHandler.ts"],"sourcesContent":["'use client'\nimport { createClientUploadHandler } from '@payloadcms/plugin-cloud-storage/client'\nimport { toast } from '@payloadcms/ui'\nimport { formatAdminURL } from 'payload/shared'\n\nexport const S3ClientUploadHandler = createClientUploadHandler({\n  handler: async ({ apiRoute, collectionSlug, file, prefix, serverHandlerPath, serverURL }) => {\n    const endpointRoute = formatAdminURL({\n      apiRoute,\n      path: serverHandlerPath,\n      serverURL,\n    })\n\n    const response = await fetch(endpointRoute, {\n      body: JSON.stringify({\n        collectionSlug,\n        filename: file.name,\n        filesize: file.size,\n        mimeType: file.type,\n      }),\n      credentials: 'include',\n      method: 'POST',\n    })\n\n    if (!response.ok) {\n      const { errors } = (await response.json()) as {\n        errors: { message: string }[]\n      }\n\n      throw new Error(errors.reduce((acc, err) => `${acc ? `${acc}, ` : ''}${err.message}`, ''))\n    }\n\n    const { url } = (await response.json()) as {\n      url: string\n    }\n\n    await fetch(url, {\n      body: file,\n      headers: { 'Content-Length': file.size.toString(), 'Content-Type': file.type },\n      method: 'PUT',\n    })\n\n    return { prefix }\n  },\n})\n"],"names":["createClientUploadHandler","formatAdminURL","S3ClientUploadHandler","handler","apiRoute","collectionSlug","file","prefix","serverHandlerPath","serverURL","endpointRoute","path","response","fetch","body","JSON","stringify","filename","name","filesize","size","mimeType","type","credentials","method","ok","errors","json","Error","reduce","acc","err","message","url","headers","toString"],"mappings":"AAAA;AACA,SAASA,yBAAyB,QAAQ,0CAAyC;AAEnF,SAASC,cAAc,QAAQ,iBAAgB;AAE/C,OAAO,MAAMC,wBAAwBF,0BAA0B;IAC7DG,SAAS,OAAO,EAAEC,QAAQ,EAAEC,cAAc,EAAEC,IAAI,EAAEC,MAAM,EAAEC,iBAAiB,EAAEC,SAAS,EAAE;QACtF,MAAMC,gBAAgBT,eAAe;YACnCG;YACAO,MAAMH;YACNC;QACF;QAEA,MAAMG,WAAW,MAAMC,MAAMH,eAAe;YAC1CI,MAAMC,KAAKC,SAAS,CAAC;gBACnBX;gBACAY,UAAUX,KAAKY,IAAI;gBACnBC,UAAUb,KAAKc,IAAI;gBACnBC,UAAUf,KAAKgB,IAAI;YACrB;YACAC,aAAa;YACbC,QAAQ;QACV;QAEA,IAAI,CAACZ,SAASa,EAAE,EAAE;YAChB,MAAM,EAAEC,MAAM,EAAE,GAAI,MAAMd,SAASe,IAAI;YAIvC,MAAM,IAAIC,MAAMF,OAAOG,MAAM,CAAC,CAACC,KAAKC,MAAQ,GAAGD,MAAM,GAAGA,IAAI,EAAE,CAAC,GAAG,KAAKC,IAAIC,OAAO,EAAE,EAAE;QACxF;QAEA,MAAM,EAAEC,GAAG,EAAE,GAAI,MAAMrB,SAASe,IAAI;QAIpC,MAAMd,MAAMoB,KAAK;YACfnB,MAAMR;YACN4B,SAAS;gBAAE,kBAAkB5B,KAAKc,IAAI,CAACe,QAAQ;gBAAI,gBAAgB7B,KAAKgB,IAAI;YAAC;YAC7EE,QAAQ;QACV;QAEA,OAAO;YAAEjB;QAAO;IAClB;AACF,GAAE"}