{"version":3,"sources":["../../src/admin/index.ts"],"sourcesContent":["import type { Config } from 'payload'\n\nimport type { PluginOptions } from '../types.js'\n\nimport { getFields } from './fields/getFields.js'\n\n// This is the admin plugin cloud-storage stubfile.\n// It only extends the config that are required by the admin UI.\n\nexport const cloudStorage =\n  (pluginOptions: PluginOptions) =>\n  (incomingConfig: Config): Config => {\n    const { alwaysInsertFields, collections: allCollectionOptions, enabled } = pluginOptions\n    const config = { ...incomingConfig }\n\n    // If disabled and alwaysInsertFields is not true, skip processing\n    if (enabled === false && !alwaysInsertFields) {\n      return config\n    }\n\n    return {\n      ...config,\n      collections: (config.collections || []).map((existingCollection) => {\n        const options = allCollectionOptions[existingCollection.slug]\n\n        // Process if adapter exists OR if alwaysInsertFields is true and this collection is configured\n        if (options?.adapter || (alwaysInsertFields && options)) {\n          const fields = getFields({\n            alwaysInsertFields,\n            collection: existingCollection,\n            prefix: options.prefix,\n          })\n\n          return {\n            ...existingCollection,\n            fields,\n          }\n        }\n\n        return existingCollection\n      }),\n    }\n  }\n"],"names":["getFields","cloudStorage","pluginOptions","incomingConfig","alwaysInsertFields","collections","allCollectionOptions","enabled","config","map","existingCollection","options","slug","adapter","fields","collection","prefix"],"mappings":"AAIA,SAASA,SAAS,QAAQ,wBAAuB;AAEjD,mDAAmD;AACnD,gEAAgE;AAEhE,OAAO,MAAMC,eACX,CAACC,gBACD,CAACC;QACC,MAAM,EAAEC,kBAAkB,EAAEC,aAAaC,oBAAoB,EAAEC,OAAO,EAAE,GAAGL;QAC3E,MAAMM,SAAS;YAAE,GAAGL,cAAc;QAAC;QAEnC,kEAAkE;QAClE,IAAII,YAAY,SAAS,CAACH,oBAAoB;YAC5C,OAAOI;QACT;QAEA,OAAO;YACL,GAAGA,MAAM;YACTH,aAAa,AAACG,CAAAA,OAAOH,WAAW,IAAI,EAAE,AAAD,EAAGI,GAAG,CAAC,CAACC;gBAC3C,MAAMC,UAAUL,oBAAoB,CAACI,mBAAmBE,IAAI,CAAC;gBAE7D,+FAA+F;gBAC/F,IAAID,SAASE,WAAYT,sBAAsBO,SAAU;oBACvD,MAAMG,SAASd,UAAU;wBACvBI;wBACAW,YAAYL;wBACZM,QAAQL,QAAQK,MAAM;oBACxB;oBAEA,OAAO;wBACL,GAAGN,kBAAkB;wBACrBI;oBACF;gBACF;gBAEA,OAAOJ;YACT;QACF;IACF,EAAC"}