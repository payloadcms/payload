{"version":3,"sources":["../../src/utilities/getIncomingFiles.ts"],"sourcesContent":["import type { FileData, PayloadRequest } from 'payload'\n\nimport type { File } from '../types.js'\n\nexport function getIncomingFiles({\n  data,\n  req,\n}: {\n  data: Partial<FileData>\n  req: PayloadRequest\n}): File[] {\n  const file = req.file\n\n  let files: File[] = []\n\n  if (file && data.filename && data.mimeType) {\n    const mainFile: File = {\n      buffer: file.data,\n      clientUploadContext: file.clientUploadContext,\n      filename: data.filename,\n      filesize: file.size,\n      mimeType: data.mimeType,\n      tempFilePath: file.tempFilePath,\n    }\n\n    files = [mainFile]\n\n    if (data?.sizes) {\n      Object.entries(data.sizes).forEach(([key, resizedFileData]) => {\n        if (req.payloadUploadSizes?.[key] && resizedFileData.mimeType) {\n          files = files.concat([\n            {\n              buffer: req.payloadUploadSizes[key],\n              filename: `${resizedFileData.filename}`,\n              filesize: req.payloadUploadSizes[key].length,\n              mimeType: resizedFileData.mimeType,\n            },\n          ])\n        }\n      })\n    }\n  }\n\n  return files\n}\n"],"names":["getIncomingFiles","data","req","file","files","filename","mimeType","mainFile","buffer","clientUploadContext","filesize","size","tempFilePath","sizes","Object","entries","forEach","key","resizedFileData","payloadUploadSizes","concat","length"],"mappings":"AAIA,OAAO,SAASA,iBAAiB,EAC/BC,IAAI,EACJC,GAAG,EAIJ;IACC,MAAMC,OAAOD,IAAIC,IAAI;IAErB,IAAIC,QAAgB,EAAE;IAEtB,IAAID,QAAQF,KAAKI,QAAQ,IAAIJ,KAAKK,QAAQ,EAAE;QAC1C,MAAMC,WAAiB;YACrBC,QAAQL,KAAKF,IAAI;YACjBQ,qBAAqBN,KAAKM,mBAAmB;YAC7CJ,UAAUJ,KAAKI,QAAQ;YACvBK,UAAUP,KAAKQ,IAAI;YACnBL,UAAUL,KAAKK,QAAQ;YACvBM,cAAcT,KAAKS,YAAY;QACjC;QAEAR,QAAQ;YAACG;SAAS;QAElB,IAAIN,MAAMY,OAAO;YACfC,OAAOC,OAAO,CAACd,KAAKY,KAAK,EAAEG,OAAO,CAAC,CAAC,CAACC,KAAKC,gBAAgB;gBACxD,IAAIhB,IAAIiB,kBAAkB,EAAE,CAACF,IAAI,IAAIC,gBAAgBZ,QAAQ,EAAE;oBAC7DF,QAAQA,MAAMgB,MAAM,CAAC;wBACnB;4BACEZ,QAAQN,IAAIiB,kBAAkB,CAACF,IAAI;4BACnCZ,UAAU,GAAGa,gBAAgBb,QAAQ,EAAE;4BACvCK,UAAUR,IAAIiB,kBAAkB,CAACF,IAAI,CAACI,MAAM;4BAC5Cf,UAAUY,gBAAgBZ,QAAQ;wBACpC;qBACD;gBACH;YACF;QACF;IACF;IAEA,OAAOF;AACT"}