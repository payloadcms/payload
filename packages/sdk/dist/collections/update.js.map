{"version":3,"sources":["../../src/collections/update.ts"],"sourcesContent":["import type {\n  CollectionSlug,\n  PayloadTypesShape,\n  SelectType,\n  TypedLocale,\n  UploadCollectionSlug,\n  Where,\n} from 'payload'\nimport type { DeepPartial } from 'ts-essentials'\n\nimport type { PayloadSDK } from '../index.js'\nimport type {\n  BulkOperationResult,\n  PopulateType,\n  RequiredDataFromCollectionSlug,\n  SelectFromCollectionSlug,\n  TransformCollectionWithSelect,\n} from '../types.js'\n\nimport { resolveFileFromOptions } from '../utilities/resolveFileFromOptions.js'\n\nexport type UpdateBaseOptions<\n  T extends PayloadTypesShape,\n  TSlug extends CollectionSlug<T>,\n  TSelect extends SelectType,\n> = {\n  /**\n   * Whether the current update should be marked as from autosave.\n   * `versions.drafts.autosave` should be specified.\n   */\n  autosave?: boolean\n  /**\n   * the Collection slug to operate against.\n   */\n  collection: TSlug\n  /**\n   * The document / documents data to update.\n   */\n  data: DeepPartial<RequiredDataFromCollectionSlug<T, TSlug>>\n  /**\n   * [Control auto-population](https://payloadcms.com/docs/queries/depth) of nested relationship and upload fields.\n   */\n  depth?: number\n  /**\n   * Update documents to a draft.\n   */\n  draft?: boolean\n  /**\n   * Specify a [fallback locale](https://payloadcms.com/docs/configuration/localization) to use for any returned documents.\n   */\n  fallbackLocale?: false | TypedLocale<T>\n  /** File Blob object or URL to the file. Only for upload collections */\n  file?: TSlug extends UploadCollectionSlug<T> ? Blob | string : never\n  /**\n   * Specify [locale](https://payloadcms.com/docs/configuration/localization) for any returned documents.\n   */\n  locale?: TypedLocale<T>\n  /**\n   * Specify [populate](https://payloadcms.com/docs/queries/select#populate) to control which fields to include to the result from populated documents.\n   */\n  populate?: PopulateType<T>\n  /**\n   * Publish the document / documents with a specific locale.\n   */\n  publishSpecificLocale?: string\n  /**\n   * Specify [select](https://payloadcms.com/docs/queries/select) to control which fields to include to the result.\n   */\n  select?: TSelect\n}\n\nexport type UpdateByIDOptions<\n  T extends PayloadTypesShape,\n  TSlug extends CollectionSlug<T>,\n  TSelect extends SelectFromCollectionSlug<T, TSlug>,\n> = {\n  id: number | string\n  limit?: never\n  where?: never\n} & UpdateBaseOptions<T, TSlug, TSelect>\n\nexport type UpdateManyOptions<\n  T extends PayloadTypesShape,\n  TSlug extends CollectionSlug<T>,\n  TSelect extends SelectFromCollectionSlug<T, TSlug>,\n> = {\n  id?: never\n  limit?: number\n  where: Where\n} & UpdateBaseOptions<T, TSlug, TSelect>\n\nexport type UpdateOptions<\n  T extends PayloadTypesShape,\n  TSlug extends CollectionSlug<T>,\n  TSelect extends SelectFromCollectionSlug<T, TSlug>,\n> = UpdateByIDOptions<T, TSlug, TSelect> | UpdateManyOptions<T, TSlug, TSelect>\n\nexport async function update<\n  T extends PayloadTypesShape,\n  TSlug extends CollectionSlug<T>,\n  TSelect extends SelectFromCollectionSlug<T, TSlug>,\n>(\n  sdk: PayloadSDK<T>,\n  options: UpdateOptions<T, TSlug, TSelect>,\n  init?: RequestInit,\n): Promise<\n  BulkOperationResult<T, TSlug, TSelect> | TransformCollectionWithSelect<T, TSlug, TSelect>\n> {\n  let file: Blob | undefined = undefined\n\n  if (options.file) {\n    file = await resolveFileFromOptions(options.file)\n  }\n\n  const response = await sdk.request({\n    args: options,\n    file,\n    init,\n    json: options.data,\n    method: 'PATCH',\n    path: `/${options.collection}${options.id ? `/${options.id}` : ''}`,\n  })\n\n  const json = await response.json()\n\n  if (options.id) {\n    return json.doc\n  }\n\n  return json\n}\n"],"names":["resolveFileFromOptions","update","sdk","options","init","file","undefined","response","request","args","json","data","method","path","collection","id","doc"],"mappings":"AAmBA,SAASA,sBAAsB,QAAQ,yCAAwC;AA8E/E,OAAO,eAAeC,OAKpBC,GAAkB,EAClBC,OAAyC,EACzCC,IAAkB;IAIlB,IAAIC,OAAyBC;IAE7B,IAAIH,QAAQE,IAAI,EAAE;QAChBA,OAAO,MAAML,uBAAuBG,QAAQE,IAAI;IAClD;IAEA,MAAME,WAAW,MAAML,IAAIM,OAAO,CAAC;QACjCC,MAAMN;QACNE;QACAD;QACAM,MAAMP,QAAQQ,IAAI;QAClBC,QAAQ;QACRC,MAAM,CAAC,CAAC,EAAEV,QAAQW,UAAU,GAAGX,QAAQY,EAAE,GAAG,CAAC,CAAC,EAAEZ,QAAQY,EAAE,EAAE,GAAG,IAAI;IACrE;IAEA,MAAML,OAAO,MAAMH,SAASG,IAAI;IAEhC,IAAIP,QAAQY,EAAE,EAAE;QACd,OAAOL,KAAKM,GAAG;IACjB;IAEA,OAAON;AACT"}