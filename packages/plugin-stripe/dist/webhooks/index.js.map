{"version":3,"sources":["../../src/webhooks/index.ts"],"sourcesContent":["import type { StripeWebhookHandler } from '../types.js'\n\nimport { handleCreatedOrUpdated } from './handleCreatedOrUpdated.js'\nimport { handleDeleted } from './handleDeleted.js'\n\nexport const handleWebhooks: StripeWebhookHandler = (args) => {\n  const { event, payload, pluginConfig } = args\n\n  if (pluginConfig?.logs) {\n    payload.logger.info(`ðŸª Received Stripe '${event.type}' webhook event with ID: '${event.id}'.`)\n  }\n\n  // could also traverse into event.data.object.object to get the type, but that seems unreliable\n  // use cli: `stripe resources` to see all available resources\n  const resourceType = event.type.split('.')[0]\n  const method = event.type.split('.').pop()\n\n  const syncConfig = pluginConfig?.sync?.find(\n    (sync) => sync.stripeResourceTypeSingular === resourceType,\n  )\n\n  if (syncConfig) {\n    switch (method) {\n      case 'created': {\n        void handleCreatedOrUpdated({\n          ...args,\n          pluginConfig,\n          resourceType,\n          syncConfig,\n        })\n        break\n      }\n      case 'deleted': {\n        void handleDeleted({\n          ...args,\n          pluginConfig,\n          resourceType,\n          syncConfig,\n        })\n        break\n      }\n      case 'updated': {\n        void handleCreatedOrUpdated({\n          ...args,\n          pluginConfig,\n          resourceType,\n          syncConfig,\n        })\n        break\n      }\n      default: {\n        break\n      }\n    }\n  }\n}\n"],"names":["handleCreatedOrUpdated","handleDeleted","handleWebhooks","args","event","payload","pluginConfig","logs","logger","info","type","id","resourceType","split","method","pop","syncConfig","sync","find","stripeResourceTypeSingular"],"mappings":"AAEA,SAASA,sBAAsB,QAAQ,8BAA6B;AACpE,SAASC,aAAa,QAAQ,qBAAoB;AAElD,OAAO,MAAMC,iBAAuC,CAACC;IACnD,MAAM,EAAEC,KAAK,EAAEC,OAAO,EAAEC,YAAY,EAAE,GAAGH;IAEzC,IAAIG,cAAcC,MAAM;QACtBF,QAAQG,MAAM,CAACC,IAAI,CAAC,CAAC,oBAAoB,EAAEL,MAAMM,IAAI,CAAC,0BAA0B,EAAEN,MAAMO,EAAE,CAAC,EAAE,CAAC;IAChG;IAEA,+FAA+F;IAC/F,6DAA6D;IAC7D,MAAMC,eAAeR,MAAMM,IAAI,CAACG,KAAK,CAAC,IAAI,CAAC,EAAE;IAC7C,MAAMC,SAASV,MAAMM,IAAI,CAACG,KAAK,CAAC,KAAKE,GAAG;IAExC,MAAMC,aAAaV,cAAcW,MAAMC,KACrC,CAACD,OAASA,KAAKE,0BAA0B,KAAKP;IAGhD,IAAII,YAAY;QACd,OAAQF;YACN,KAAK;gBAAW;oBACd,KAAKd,uBAAuB;wBAC1B,GAAGG,IAAI;wBACPG;wBACAM;wBACAI;oBACF;oBACA;gBACF;YACA,KAAK;gBAAW;oBACd,KAAKf,cAAc;wBACjB,GAAGE,IAAI;wBACPG;wBACAM;wBACAI;oBACF;oBACA;gBACF;YACA,KAAK;gBAAW;oBACd,KAAKhB,uBAAuB;wBAC1B,GAAGG,IAAI;wBACPG;wBACAM;wBACAI;oBACF;oBACA;gBACF;YACA;gBAAS;oBACP;gBACF;QACF;IACF;AACF,EAAC"}