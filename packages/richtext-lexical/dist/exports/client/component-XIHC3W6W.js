"use client";import{a as $,b as S}from"./chunk-QJ5EETIB.js";import{a as C}from"./chunk-INBEEENE.js";import{a as N}from"./chunk-F26IQ5RE.js";import{b as m}from"./chunk-BZZVLW4U.js";import{jsx as a,jsxs as n}from"react/jsx-runtime";import{useLexicalComposerContext as Y}from"@lexical/react/LexicalComposerContext.js";import{useLexicalEditable as Z}from"@lexical/react/useLexicalEditable";import{getTranslation as R}from"@payloadcms/translations";import{Button as p,formatDrawerSlug as ee,Thumbnail as te,useConfig as ae,useEditDepth as oe,usePayloadAPI as le,useTranslation as ie}from"@payloadcms/ui";import{$getNodeByKey as y}from"lexical";import{formatAdminURL as se,isImage as re}from"payload/shared";import{useCallback as h,useId as ne,useReducer as de,useRef as ce,useState as ue}from"react";var E={depth:0},Se=L=>{let{className:e,data:{fields:U,relationTo:f,value:d},format:P,nodeKey:l}=L;if(typeof d=="object")throw new Error("Upload value should be a string or number. The Lexical Upload component should not receive the populated value object.");let{config:{routes:{api:T},serverURL:F},getEntityConfig:j}=ae(),I=ce(null),{uuid:z}=m(),A=oe(),[i]=Y(),{editorConfig:B,fieldProps:{schemaPath:k}}=m(),c=Z(),{i18n:g,t:s}=ie(),[_,K]=de(r=>r+1,0),[o]=ue(()=>j({collectionSlug:f})),M=ne(),b=ee({slug:"lexical-upload-drawer-"+z+M,depth:A}),{toggleDrawer:O}=C(b,!0),{closeDocumentDrawer:w,DocumentDrawer:W,DocumentDrawerToggler:H}=N({id:d,collectionSlug:o.slug}),[{data:t},{setParams:D}]=le(se({apiRoute:T,path:`/${o.slug}/${d}`,serverURL:F}),{initialParams:E}),v=t?.thumbnailURL||t?.url,q=h(()=>{i.update(()=>{y(l)?.remove()})},[i,l]),G=h(r=>{D({...E,cacheBust:_}),K(),w()},[D,_,w]),x=B?.resolvedFeatureMap?.get("upload")?.sanitizedClientFeatureProps.collections?.[o.slug]?.hasExtraFields,J=h((r,V)=>{i.update(()=>{let u=y(l);if(u){let X={...u.getData(),fields:V};u.setData(X)}})},[i,l]),Q=v&&t?.width&&t?.height?t.width>t.height?"landscape":"portrait":"landscape";return n("div",{className:`${e}__contents ${e}__contents--${Q}`,"data-align":P||void 0,"data-filename":t?.filename,ref:I,children:[n("div",{className:`${e}__card`,children:[n("div",{className:`${e}__media`,children:[a(te,{collectionSlug:f,fileSrc:re(t?.mimeType)?v:null,height:t?.height,size:"none",width:t?.width}),c&&a("div",{className:`${e}__overlay ${e}__floater`,children:n("div",{className:`${e}__actions`,role:"toolbar",children:[x?a(p,{buttonStyle:"icon-label",className:`${e}__upload-drawer-toggler`,disabled:!c,el:"button",icon:"edit",onClick:O,round:!0,size:"medium",tooltip:s("fields:editRelationship")}):null,a(p,{buttonStyle:"icon-label",className:`${e}__swap-drawer-toggler`,disabled:!c,el:"button",icon:"swap",onClick:()=>{i.dispatchCommand(S,{replace:{nodeKey:l}})},round:!0,size:"medium",tooltip:s("fields:swapUpload")}),a(p,{buttonStyle:"icon-label",className:`${e}__removeButton`,disabled:!c,icon:"x",onClick:r=>{r.preventDefault(),q()},round:!0,size:"medium",tooltip:s("fields:removeUpload")})]})})]}),n("div",{className:`${e}__metaOverlay ${e}__floater`,children:[a(H,{className:`${e}__doc-drawer-toggler`,children:a("strong",{className:`${e}__filename`,children:t?.filename||s("general:untitled")})}),a("div",{className:`${e}__collectionLabel`,children:R(o.labels.singular,g)})]})]}),d?a(W,{onSave:G}):null,x?a($,{data:U,drawerSlug:b,drawerTitle:s("general:editLabel",{label:R(o.labels.singular,g)}),featureKey:"upload",handleDrawerSubmit:J,schemaPath:k,schemaPathSuffix:o.slug}):null]})};export{Se as UploadComponent};
//# sourceMappingURL=component-XIHC3W6W.js.map
