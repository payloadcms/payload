{"version":3,"file":"index.js","names":["c","_c","copyToClipboard","useLexicalComposerContext","objectKlassEquals","ObjectID","$getSelection","$isNodeSelection","COMMAND_PRIORITY_LOW","COPY_COMMAND","useEffect","changeIds","node","fields","id","default","toHexString","children","child","ClipboardPlugin","$","editor","t0","t1","registerCommand","event","selection","getNodes","serializedNode","exportJSON","deepCloneSerializedNode","JSON","parse","stringify","lexicalClipboardData","namespace","_config","nodes","stringifiedLexicalClipboardData","catch","_temp","ClipboardEvent","then","clipboardData","Error","lexicalStringified","getData","lexical","node_0","stringified","setData","error_0","error"],"sources":["../../../../src/lexical/plugins/ClipboardPlugin/index.tsx"],"sourcesContent":["'use client'\n\nimport { copyToClipboard } from '@lexical/clipboard'\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext.js'\nimport { objectKlassEquals } from '@lexical/utils'\nimport ObjectID from 'bson-objectid'\nimport { $getSelection, $isNodeSelection, COMMAND_PRIORITY_LOW, COPY_COMMAND } from 'lexical'\nimport { useEffect } from 'react'\n\ntype SerializedUnknownLexicalNode = {\n  children?: SerializedUnknownLexicalNode[]\n  type: string\n}\n\ntype LexicalClipboardData = {\n  namespace: string\n  nodes: SerializedUnknownLexicalNode[]\n}\n\nconst changeIds = (node: SerializedUnknownLexicalNode) => {\n  if (\n    'fields' in node &&\n    typeof node.fields === 'object' &&\n    node.fields !== null &&\n    'id' in node.fields\n  ) {\n    node.fields.id = new ObjectID.default().toHexString()\n  } else if ('id' in node) {\n    node.id = new ObjectID.default().toHexString()\n  }\n\n  if (node.children) {\n    for (const child of node.children) {\n      changeIds(child)\n    }\n  }\n}\n\nexport function ClipboardPlugin() {\n  const [editor] = useLexicalComposerContext()\n\n  useEffect(() => {\n    // Remove duplicated ids from clipboard. We do it here because:\n    // 1. Browsers do not allow setting the clipboardData in paste event for security reasons.\n    // 2. If you cut instead of paste, the id will be kept, which is a good thing.\n    return editor.registerCommand(\n      COPY_COMMAND,\n      (event) => {\n        // Handle decorator node case\n        const selection = $getSelection()\n        if ($isNodeSelection(selection)) {\n          const node = selection.getNodes()[0]\n\n          const serializedNode = node?.exportJSON() as SerializedUnknownLexicalNode\n          const deepCloneSerializedNode = JSON.parse(JSON.stringify(serializedNode))\n          changeIds(deepCloneSerializedNode)\n\n          const lexicalClipboardData: LexicalClipboardData = {\n            namespace: editor._config.namespace,\n            nodes: [deepCloneSerializedNode],\n          }\n\n          const stringifiedLexicalClipboardData = JSON.stringify(lexicalClipboardData)\n\n          copyToClipboard(editor, null, {\n            'application/x-lexical-editor': stringifiedLexicalClipboardData,\n            'text/plain': '',\n          }).catch((error) => {\n            throw error\n          })\n          return true\n        }\n\n        // Handle range selection case\n        copyToClipboard(editor, objectKlassEquals(event, ClipboardEvent) ? event : null)\n          .then(() => {\n            if (!(event instanceof ClipboardEvent) || !event.clipboardData) {\n              throw new Error('No clipboard event')\n            }\n            const lexicalStringified = event.clipboardData.getData('application/x-lexical-editor')\n            if (!lexicalStringified) {\n              return true\n            }\n\n            const lexical = JSON.parse(lexicalStringified) as {\n              nodes: SerializedUnknownLexicalNode[]\n            }\n\n            for (const node of lexical.nodes) {\n              changeIds(node)\n            }\n            const stringified = JSON.stringify(lexical)\n            event.clipboardData.setData('application/x-lexical-editor', stringified)\n          })\n          .catch((error) => {\n            if (event instanceof ClipboardEvent) {\n              event.clipboardData?.setData('application/x-lexical-editor', '')\n            }\n            throw error\n          })\n        return true\n      },\n      COMMAND_PRIORITY_LOW,\n    )\n  }, [editor])\n\n  return null\n}\n"],"mappings":"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","ignoreList":[]}