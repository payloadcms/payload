{"version":3,"sources":["../../src/schema/buildDrizzleRelations.ts"],"sourcesContent":["import type { Relation } from 'drizzle-orm'\n\nimport { relations } from 'drizzle-orm'\n\nimport type { DrizzleAdapter } from '../types.js'\n\nexport const buildDrizzleRelations = ({ adapter }: { adapter: DrizzleAdapter }) => {\n  for (const tableName in adapter.rawRelations) {\n    const rawRelations = adapter.rawRelations[tableName]\n\n    adapter.relations[`relations_${tableName}`] = relations(\n      adapter.tables[tableName],\n      ({ many, one }) => {\n        const result: Record<string, Relation<string>> = {}\n\n        for (const key in rawRelations) {\n          const relation = rawRelations[key]\n\n          if (relation.type === 'one') {\n            result[key] = one(adapter.tables[relation.to], {\n              fields: relation.fields.map(\n                (field) => adapter.tables[field.table][field.name],\n              ) as any,\n              references: relation.references.map(\n                (reference) => adapter.tables[relation.to][reference],\n              ),\n              relationName: relation.relationName,\n            })\n          } else {\n            if (adapter.tables[relation.to]) {\n              result[key] = many(adapter.tables[relation.to], {\n                relationName: relation.relationName,\n              })\n            }\n          }\n        }\n\n        return result\n      },\n    )\n  }\n}\n"],"names":["relations","buildDrizzleRelations","adapter","tableName","rawRelations","tables","many","one","result","key","relation","type","to","fields","map","field","table","name","references","reference","relationName"],"mappings":"AAEA,SAASA,SAAS,QAAQ,cAAa;AAIvC,OAAO,MAAMC,wBAAwB,CAAC,EAAEC,OAAO,EAA+B;IAC5E,IAAK,MAAMC,aAAaD,QAAQE,YAAY,CAAE;QAC5C,MAAMA,eAAeF,QAAQE,YAAY,CAACD,UAAU;QAEpDD,QAAQF,SAAS,CAAC,CAAC,UAAU,EAAEG,WAAW,CAAC,GAAGH,UAC5CE,QAAQG,MAAM,CAACF,UAAU,EACzB,CAAC,EAAEG,IAAI,EAAEC,GAAG,EAAE;YACZ,MAAMC,SAA2C,CAAC;YAElD,IAAK,MAAMC,OAAOL,aAAc;gBAC9B,MAAMM,WAAWN,YAAY,CAACK,IAAI;gBAElC,IAAIC,SAASC,IAAI,KAAK,OAAO;oBAC3BH,MAAM,CAACC,IAAI,GAAGF,IAAIL,QAAQG,MAAM,CAACK,SAASE,EAAE,CAAC,EAAE;wBAC7CC,QAAQH,SAASG,MAAM,CAACC,GAAG,CACzB,CAACC,QAAUb,QAAQG,MAAM,CAACU,MAAMC,KAAK,CAAC,CAACD,MAAME,IAAI,CAAC;wBAEpDC,YAAYR,SAASQ,UAAU,CAACJ,GAAG,CACjC,CAACK,YAAcjB,QAAQG,MAAM,CAACK,SAASE,EAAE,CAAC,CAACO,UAAU;wBAEvDC,cAAcV,SAASU,YAAY;oBACrC;gBACF,OAAO;oBACL,IAAIlB,QAAQG,MAAM,CAACK,SAASE,EAAE,CAAC,EAAE;wBAC/BJ,MAAM,CAACC,IAAI,GAAGH,KAAKJ,QAAQG,MAAM,CAACK,SAASE,EAAE,CAAC,EAAE;4BAC9CQ,cAAcV,SAASU,YAAY;wBACrC;oBACF;gBACF;YACF;YAEA,OAAOZ;QACT;IAEJ;AACF,EAAC"}