{"version":3,"sources":["../src/updateVersion.ts"],"sourcesContent":["import type {\n  JsonObject,\n  SanitizedCollectionConfig,\n  TypeWithVersion,\n  UpdateVersionArgs,\n} from 'payload'\n\nimport { buildVersionCollectionFields } from 'payload'\nimport toSnakeCase from 'to-snake-case'\n\nimport type { DrizzleAdapter } from './types.js'\n\nimport { buildQuery } from './queries/buildQuery.js'\nimport { upsertRow } from './upsertRow/index.js'\nimport { getTransaction } from './utilities/getTransaction.js'\n\nexport async function updateVersion<T extends JsonObject = JsonObject>(\n  this: DrizzleAdapter,\n  {\n    id,\n    collection,\n    locale,\n    req,\n    returning,\n    select,\n    versionData,\n    where: whereArg,\n  }: UpdateVersionArgs<T>,\n): Promise<TypeWithVersion<T>> {\n  const collectionConfig: SanitizedCollectionConfig = this.payload.collections[collection].config\n  const whereToUse = whereArg || { id: { equals: id } }\n  const tableName = this.tableNameMap.get(\n    `_${toSnakeCase(collectionConfig.slug)}${this.versionsSuffix}`,\n  )\n\n  const fields = buildVersionCollectionFields(this.payload.config, collectionConfig, true)\n\n  const { where } = buildQuery({\n    adapter: this,\n    fields,\n    locale,\n    tableName,\n    where: whereToUse,\n  })\n\n  const db = await getTransaction(this, req)\n\n  const result = await upsertRow<TypeWithVersion<T>>({\n    id,\n    adapter: this,\n    collectionSlug: collection,\n    data: versionData,\n    db,\n    fields,\n    ignoreResult: returning === false,\n    joinQuery: false,\n    operation: 'update',\n    req,\n    select,\n    tableName,\n    where,\n  })\n\n  if (returning === false) {\n    return null\n  }\n\n  return result\n}\n"],"names":["buildVersionCollectionFields","toSnakeCase","buildQuery","upsertRow","getTransaction","updateVersion","id","collection","locale","req","returning","select","versionData","where","whereArg","collectionConfig","payload","collections","config","whereToUse","equals","tableName","tableNameMap","get","slug","versionsSuffix","fields","adapter","db","result","collectionSlug","data","ignoreResult","joinQuery","operation"],"mappings":"AAOA,SAASA,4BAA4B,QAAQ,UAAS;AACtD,OAAOC,iBAAiB,gBAAe;AAIvC,SAASC,UAAU,QAAQ,0BAAyB;AACpD,SAASC,SAAS,QAAQ,uBAAsB;AAChD,SAASC,cAAc,QAAQ,gCAA+B;AAE9D,OAAO,eAAeC,cAEpB,EACEC,EAAE,EACFC,UAAU,EACVC,MAAM,EACNC,GAAG,EACHC,SAAS,EACTC,MAAM,EACNC,WAAW,EACXC,OAAOC,QAAQ,EACM;IAEvB,MAAMC,mBAA8C,IAAI,CAACC,OAAO,CAACC,WAAW,CAACV,WAAW,CAACW,MAAM;IAC/F,MAAMC,aAAaL,YAAY;QAAER,IAAI;YAAEc,QAAQd;QAAG;IAAE;IACpD,MAAMe,YAAY,IAAI,CAACC,YAAY,CAACC,GAAG,CACrC,CAAC,CAAC,EAAEtB,YAAYc,iBAAiBS,IAAI,IAAI,IAAI,CAACC,cAAc,EAAE;IAGhE,MAAMC,SAAS1B,6BAA6B,IAAI,CAACgB,OAAO,CAACE,MAAM,EAAEH,kBAAkB;IAEnF,MAAM,EAAEF,KAAK,EAAE,GAAGX,WAAW;QAC3ByB,SAAS,IAAI;QACbD;QACAlB;QACAa;QACAR,OAAOM;IACT;IAEA,MAAMS,KAAK,MAAMxB,eAAe,IAAI,EAAEK;IAEtC,MAAMoB,SAAS,MAAM1B,UAA8B;QACjDG;QACAqB,SAAS,IAAI;QACbG,gBAAgBvB;QAChBwB,MAAMnB;QACNgB;QACAF;QACAM,cAActB,cAAc;QAC5BuB,WAAW;QACXC,WAAW;QACXzB;QACAE;QACAU;QACAR;IACF;IAEA,IAAIH,cAAc,OAAO;QACvB,OAAO;IACT;IAEA,OAAOmB;AACT"}