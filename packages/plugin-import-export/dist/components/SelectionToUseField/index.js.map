{"version":3,"sources":["../../../src/components/SelectionToUseField/index.tsx"],"sourcesContent":["'use client'\n\nimport type { Where } from 'payload'\n\nimport {\n  RadioGroupField,\n  useDocumentInfo,\n  useField,\n  useListQuery,\n  useSelection,\n  useTranslation,\n} from '@payloadcms/ui'\nimport React, { useEffect, useMemo } from 'react'\n\nconst isWhereEmpty = (where: Where): boolean => {\n  if (!where || typeof where !== 'object') {\n    return true\n  }\n\n  // Flatten one level of OR/AND wrappers\n  if (Array.isArray(where.and)) {\n    return where.and.length === 0\n  }\n  if (Array.isArray(where.or)) {\n    return where.or.length === 0\n  }\n\n  return Object.keys(where).length === 0\n}\n\nexport const SelectionToUseField: React.FC = () => {\n  const { id } = useDocumentInfo()\n  const { query } = useListQuery()\n  const { selectAll, selected } = useSelection()\n  const { t } = useTranslation()\n\n  const { setValue: setSelectionToUseValue, value: selectionToUseValue } = useField({\n    path: 'selectionToUse',\n  })\n\n  const { setValue: setWhere } = useField({\n    path: 'where',\n  })\n\n  const hasMeaningfulFilters = query?.where && !isWhereEmpty(query.where)\n\n  const availableOptions = useMemo(() => {\n    const options = [\n      {\n        // @ts-expect-error - this is not correctly typed in plugins right now\n        label: t('plugin-import-export:selectionToUse-allDocuments'),\n        value: 'all',\n      },\n    ]\n\n    if (hasMeaningfulFilters) {\n      options.unshift({\n        // @ts-expect-error - this is not correctly typed in plugins right now\n        label: t('plugin-import-export:selectionToUse-currentFilters'),\n        value: 'currentFilters',\n      })\n    }\n\n    if (['allInPage', 'some'].includes(selectAll)) {\n      options.unshift({\n        // @ts-expect-error - this is not correctly typed in plugins right now\n        label: t('plugin-import-export:selectionToUse-currentSelection'),\n        value: 'currentSelection',\n      })\n    }\n\n    return options\n  }, [hasMeaningfulFilters, selectAll, t])\n\n  // Auto-set default\n  useEffect(() => {\n    if (id) {\n      return\n    }\n\n    let defaultSelection: 'all' | 'currentFilters' | 'currentSelection' = 'all'\n\n    if (['allInPage', 'some'].includes(selectAll)) {\n      defaultSelection = 'currentSelection'\n    } else if (query?.where) {\n      defaultSelection = 'currentFilters'\n    }\n\n    setSelectionToUseValue(defaultSelection)\n  }, [id, selectAll, query?.where, setSelectionToUseValue])\n\n  // Sync where clause with selected option\n  useEffect(() => {\n    if (id) {\n      return\n    }\n\n    if (selectionToUseValue === 'currentFilters' && query?.where) {\n      setWhere(query.where)\n    } else if (selectionToUseValue === 'currentSelection' && selected) {\n      const ids = [...selected.entries()].filter(([_, isSelected]) => isSelected).map(([id]) => id)\n\n      setWhere({ id: { in: ids } })\n    } else if (selectionToUseValue === 'all') {\n      setWhere({})\n    }\n  }, [id, selectionToUseValue, query?.where, selected, setWhere])\n\n  // Hide component if no other options besides \"all\" are available\n  if (availableOptions.length <= 1) {\n    return null\n  }\n\n  return (\n    <RadioGroupField\n      field={{\n        name: 'selectionToUse',\n        type: 'radio',\n        admin: {},\n        // @ts-expect-error - this is not correctly typed in plugins right now\n        label: t('plugin-import-export:field-selectionToUse-label'),\n        options: availableOptions,\n      }}\n      // @ts-expect-error - this is not correctly typed in plugins right now\n      label={t('plugin-import-export:field-selectionToUse-label')}\n      options={availableOptions}\n      path=\"selectionToUse\"\n    />\n  )\n}\n"],"names":["RadioGroupField","useDocumentInfo","useField","useListQuery","useSelection","useTranslation","React","useEffect","useMemo","isWhereEmpty","where","Array","isArray","and","length","or","Object","keys","SelectionToUseField","id","query","selectAll","selected","t","setValue","setSelectionToUseValue","value","selectionToUseValue","path","setWhere","hasMeaningfulFilters","availableOptions","options","label","unshift","includes","defaultSelection","ids","entries","filter","_","isSelected","map","in","field","name","type","admin"],"mappings":"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"}