{"version":3,"sources":["../../../src/components/SortOrder/index.tsx"],"sourcesContent":["'use client'\n\nimport type { SelectFieldClientComponent } from 'payload'\n\nimport { FieldLabel, ReactSelect, useDocumentInfo, useField, useListQuery } from '@payloadcms/ui'\nimport React, { useEffect, useMemo, useRef, useState } from 'react'\n\nimport { applySortOrder, normalizeQueryParam, stripSortDash } from '../../utilities/sortHelpers.js'\nimport './index.scss'\n\nconst baseClass = 'sort-order-field'\n\ntype Order = 'asc' | 'desc'\ntype OrderOption = { label: string; value: Order }\n\nconst options = [\n  { label: 'Ascending', value: 'asc' as const },\n  { label: 'Descending', value: 'desc' as const },\n] as const\n\nconst defaultOption: OrderOption = options[0]\n\nexport const SortOrder: SelectFieldClientComponent = (props) => {\n  const { id } = useDocumentInfo()\n  const { query } = useListQuery()\n\n  // 'sortOrder' select field: 'asc' | 'desc'\n  const { setValue: setOrder, value: orderValueRaw } = useField<Order>()\n\n  // 'sort' text field: 'title' | '-title'\n  const { setValue: setSort, value: sortRaw } = useField<string>({ path: 'sort' })\n\n  // The current order value, defaulting to 'asc' for UI\n  const orderValue: Order = orderValueRaw || 'asc'\n\n  // Map 'asc' | 'desc' to the option object for ReactSelect\n  const currentOption = useMemo<OrderOption>(\n    () => options.find((o) => o.value === orderValue) ?? defaultOption,\n    [orderValue],\n  )\n  const [displayed, setDisplayed] = useState<null | OrderOption>(currentOption)\n\n  // One-time init guard so clearing `sort` doesn't rehydrate from query again\n  const didInitRef = useRef(false)\n\n  // Derive from list-view query.sort if present; otherwise fall back to groupBy\n  useEffect(() => {\n    if (didInitRef.current) {\n      return\n    }\n\n    // Existing export -> don't initialize here\n    if (id) {\n      didInitRef.current = true\n      return\n    }\n\n    // If sort already has a value, treat as initialized\n    if (typeof sortRaw === 'string' && sortRaw.length > 0) {\n      didInitRef.current = true\n      return\n    }\n\n    const qsSort = normalizeQueryParam(query?.sort)\n    const qsGroupBy = normalizeQueryParam(query?.groupBy)\n\n    if (qsSort) {\n      const isDesc = qsSort.startsWith('-')\n      const base = stripSortDash(qsSort)\n      const order: Order = isDesc ? 'desc' : 'asc'\n      setOrder(order)\n      setSort(applySortOrder(base, order)) // combined: 'title' or '-title'\n      didInitRef.current = true\n      return\n    }\n\n    // Fallback: groupBy (always ascending)\n    if (qsGroupBy) {\n      setOrder('asc')\n      setSort(applySortOrder(qsGroupBy, 'asc')) // write 'groupByField' (no dash)\n      didInitRef.current = true\n      return\n    }\n\n    // Nothing to initialize\n    didInitRef.current = true\n  }, [id, query?.sort, query?.groupBy, sortRaw, setOrder, setSort])\n\n  // Keep the select's displayed option in sync with the stored order\n  useEffect(() => {\n    setDisplayed(currentOption ?? defaultOption)\n  }, [currentOption])\n\n  // Handle manual order changes via ReactSelect:\n  //  - update the order field\n  //  - rewrite the combined \"sort\" string to add/remove the leading '-'\n  const onChange = (option: null | OrderOption) => {\n    const next = option?.value ?? 'asc'\n    setOrder(next)\n\n    const base = stripSortDash(sortRaw)\n    if (base) {\n      setSort(applySortOrder(base, next))\n    }\n\n    setDisplayed(option ?? defaultOption)\n  }\n\n  return (\n    <div className={baseClass}>\n      <FieldLabel label={props.field.label} path={props.path} />\n      <ReactSelect\n        className={baseClass}\n        disabled={props.readOnly}\n        inputId={`field-${props.path.replace(/\\./g, '__')}`}\n        isClearable={false}\n        isSearchable={false}\n        // @ts-expect-error react-select option typing differs from our local type\n        onChange={onChange}\n        options={options as unknown as OrderOption[]}\n        // @ts-expect-error react-select option typing differs from our local type\n        value={displayed}\n      />\n    </div>\n  )\n}\n"],"names":["FieldLabel","ReactSelect","useDocumentInfo","useField","useListQuery","React","useEffect","useMemo","useRef","useState","applySortOrder","normalizeQueryParam","stripSortDash","baseClass","options","label","value","defaultOption","SortOrder","props","id","query","setValue","setOrder","orderValueRaw","setSort","sortRaw","path","orderValue","currentOption","find","o","displayed","setDisplayed","didInitRef","current","length","qsSort","sort","qsGroupBy","groupBy","isDesc","startsWith","base","order","onChange","option","next","div","className","field","disabled","readOnly","inputId","replace","isClearable","isSearchable"],"mappings":"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"}