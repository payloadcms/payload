{"version":3,"sources":["../../../src/components/FieldsToExport/reduceFields.tsx"],"sourcesContent":["import type { ClientField } from 'payload'\n\nimport { fieldAffectsData, fieldHasSubFields } from 'payload/shared'\nimport React, { Fragment } from 'react'\n\nconst createNestedClientFieldPath = (parentPath: string, field: ClientField): string => {\n  if (parentPath) {\n    if (fieldAffectsData(field)) {\n      return `${parentPath}.${field.name}`\n    }\n    return parentPath\n  }\n\n  if (fieldAffectsData(field)) {\n    return field.name\n  }\n\n  return ''\n}\n\nconst combineLabel = ({\n  field,\n  prefix,\n}: {\n  field: ClientField\n  prefix?: React.ReactNode\n}): React.ReactNode => {\n  return (\n    <Fragment>\n      {prefix ? (\n        <Fragment>\n          <span style={{ display: 'inline-block' }}>{prefix}</span>\n          {' > '}\n        </Fragment>\n      ) : null}\n      <span style={{ display: 'inline-block' }}>\n        {'label' in field && typeof field.label === 'string'\n          ? field.label\n          : (('name' in field && field.name) ?? 'unnamed field')}\n      </span>\n    </Fragment>\n  )\n}\n\nexport const reduceFields = ({\n  disabledFields = [],\n  fields,\n  labelPrefix = null,\n  path = '',\n}: {\n  disabledFields?: string[]\n  fields: ClientField[]\n  labelPrefix?: React.ReactNode\n  path?: string\n}): { id: string; label: React.ReactNode; value: string }[] => {\n  if (!fields) {\n    return []\n  }\n\n  return fields.reduce<{ id: string; label: React.ReactNode; value: string }[]>(\n    (fieldsToUse, field) => {\n      // escape for a variety of reasons, include ui fields as they have `name`.\n      if (field.type === 'ui') {\n        return fieldsToUse\n      }\n\n      if (!(field.type === 'array' || field.type === 'blocks') && fieldHasSubFields(field)) {\n        return [\n          ...fieldsToUse,\n          ...reduceFields({\n            disabledFields,\n            fields: field.fields,\n            labelPrefix: combineLabel({ field, prefix: labelPrefix }),\n            path: createNestedClientFieldPath(path, field),\n          }),\n        ]\n      }\n\n      if (field.type === 'tabs' && 'tabs' in field) {\n        return [\n          ...fieldsToUse,\n          ...field.tabs.reduce<{ id: string; label: React.ReactNode; value: string }[]>(\n            (tabFields, tab) => {\n              if ('fields' in tab) {\n                const isNamedTab = 'name' in tab && tab.name\n\n                const newPath = isNamedTab ? `${path}${path ? '.' : ''}${tab.name}` : path\n\n                return [\n                  ...tabFields,\n                  ...reduceFields({\n                    disabledFields,\n                    fields: tab.fields,\n                    labelPrefix: isNamedTab\n                      ? combineLabel({\n                          field: {\n                            name: tab.name,\n                            label: tab.label ?? tab.name,\n                          } as any,\n                          prefix: labelPrefix,\n                        })\n                      : labelPrefix,\n                    path: newPath,\n                  }),\n                ]\n              }\n              return tabFields\n            },\n            [],\n          ),\n        ]\n      }\n\n      const val = createNestedClientFieldPath(path, field)\n\n      // If the field is disabled, skip it\n      if (\n        disabledFields.some(\n          (disabledField) => val === disabledField || val.startsWith(`${disabledField}.`),\n        )\n      ) {\n        return fieldsToUse\n      }\n\n      const formattedField = {\n        id: val,\n        label: combineLabel({ field, prefix: labelPrefix }),\n        value: val,\n      }\n\n      return [...fieldsToUse, formattedField]\n    },\n    [],\n  )\n}\n"],"names":["fieldAffectsData","fieldHasSubFields","React","Fragment","createNestedClientFieldPath","parentPath","field","name","combineLabel","prefix","span","style","display","label","reduceFields","disabledFields","fields","labelPrefix","path","reduce","fieldsToUse","type","tabs","tabFields","tab","isNamedTab","newPath","val","some","disabledField","startsWith","formattedField","id","value"],"mappings":";AAEA,SAASA,gBAAgB,EAAEC,iBAAiB,QAAQ,iBAAgB;AACpE,OAAOC,SAASC,QAAQ,QAAQ,QAAO;AAEvC,MAAMC,8BAA8B,CAACC,YAAoBC;IACvD,IAAID,YAAY;QACd,IAAIL,iBAAiBM,QAAQ;YAC3B,OAAO,GAAGD,WAAW,CAAC,EAAEC,MAAMC,IAAI,EAAE;QACtC;QACA,OAAOF;IACT;IAEA,IAAIL,iBAAiBM,QAAQ;QAC3B,OAAOA,MAAMC,IAAI;IACnB;IAEA,OAAO;AACT;AAEA,MAAMC,eAAe,CAAC,EACpBF,KAAK,EACLG,MAAM,EAIP;IACC,qBACE,MAACN;;YACEM,uBACC,MAACN;;kCACC,KAACO;wBAAKC,OAAO;4BAAEC,SAAS;wBAAe;kCAAIH;;oBAC1C;;iBAED;0BACJ,KAACC;gBAAKC,OAAO;oBAAEC,SAAS;gBAAe;0BACpC,WAAWN,SAAS,OAAOA,MAAMO,KAAK,KAAK,WACxCP,MAAMO,KAAK,GACV,AAAC,CAAA,UAAUP,SAASA,MAAMC,IAAI,AAAD,KAAM;;;;AAIhD;AAEA,OAAO,MAAMO,eAAe,CAAC,EAC3BC,iBAAiB,EAAE,EACnBC,MAAM,EACNC,cAAc,IAAI,EAClBC,OAAO,EAAE,EAMV;IACC,IAAI,CAACF,QAAQ;QACX,OAAO,EAAE;IACX;IAEA,OAAOA,OAAOG,MAAM,CAClB,CAACC,aAAad;QACZ,0EAA0E;QAC1E,IAAIA,MAAMe,IAAI,KAAK,MAAM;YACvB,OAAOD;QACT;QAEA,IAAI,CAAEd,CAAAA,MAAMe,IAAI,KAAK,WAAWf,MAAMe,IAAI,KAAK,QAAO,KAAMpB,kBAAkBK,QAAQ;YACpF,OAAO;mBACFc;mBACAN,aAAa;oBACdC;oBACAC,QAAQV,MAAMU,MAAM;oBACpBC,aAAaT,aAAa;wBAAEF;wBAAOG,QAAQQ;oBAAY;oBACvDC,MAAMd,4BAA4Bc,MAAMZ;gBAC1C;aACD;QACH;QAEA,IAAIA,MAAMe,IAAI,KAAK,UAAU,UAAUf,OAAO;YAC5C,OAAO;mBACFc;mBACAd,MAAMgB,IAAI,CAACH,MAAM,CAClB,CAACI,WAAWC;oBACV,IAAI,YAAYA,KAAK;wBACnB,MAAMC,aAAa,UAAUD,OAAOA,IAAIjB,IAAI;wBAE5C,MAAMmB,UAAUD,aAAa,GAAGP,OAAOA,OAAO,MAAM,KAAKM,IAAIjB,IAAI,EAAE,GAAGW;wBAEtE,OAAO;+BACFK;+BACAT,aAAa;gCACdC;gCACAC,QAAQQ,IAAIR,MAAM;gCAClBC,aAAaQ,aACTjB,aAAa;oCACXF,OAAO;wCACLC,MAAMiB,IAAIjB,IAAI;wCACdM,OAAOW,IAAIX,KAAK,IAAIW,IAAIjB,IAAI;oCAC9B;oCACAE,QAAQQ;gCACV,KACAA;gCACJC,MAAMQ;4BACR;yBACD;oBACH;oBACA,OAAOH;gBACT,GACA,EAAE;aAEL;QACH;QAEA,MAAMI,MAAMvB,4BAA4Bc,MAAMZ;QAE9C,oCAAoC;QACpC,IACES,eAAea,IAAI,CACjB,CAACC,gBAAkBF,QAAQE,iBAAiBF,IAAIG,UAAU,CAAC,GAAGD,cAAc,CAAC,CAAC,IAEhF;YACA,OAAOT;QACT;QAEA,MAAMW,iBAAiB;YACrBC,IAAIL;YACJd,OAAOL,aAAa;gBAAEF;gBAAOG,QAAQQ;YAAY;YACjDgB,OAAON;QACT;QAEA,OAAO;eAAIP;YAAaW;SAAe;IACzC,GACA,EAAE;AAEN,EAAC"}