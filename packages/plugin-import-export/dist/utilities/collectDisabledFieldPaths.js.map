{"version":3,"sources":["../../src/utilities/collectDisabledFieldPaths.ts"],"sourcesContent":["import type { Field } from 'payload'\n\nimport { traverseFields } from 'payload'\nimport { fieldAffectsData } from 'payload/shared'\n\n/**\n * Recursively traverses a Payload field schema to collect all field paths\n * that are explicitly disabled for the import/export plugin via:\n *   field.custom['plugin-import-export'].disabled\n *\n * Handles nested fields including named tabs, groups, arrays, blocks, etc.\n * Tracks each fieldâ€™s path by storing it in `ref.path` and manually propagating\n * it through named tab layers via a temporary `__manualRef` marker.\n *\n * @param fields - The top-level array of Payload field definitions\n * @returns An array of dot-notated field paths that are marked as disabled\n */\nexport const collectDisabledFieldPaths = (fields: Field[]): string[] => {\n  const disabledPaths: string[] = []\n\n  traverseFields({\n    callback: ({ field, next, parentRef, ref }) => {\n      // Handle named tabs\n      if (field.type === 'tabs' && Array.isArray(field.tabs)) {\n        for (const tab of field.tabs) {\n          if ('name' in tab && typeof tab.name === 'string') {\n            // Build the path prefix for this tab\n            const parentPath =\n              parentRef && typeof (parentRef as { path?: unknown }).path === 'string'\n                ? (parentRef as { path: string }).path\n                : ''\n            const tabPath = parentPath ? `${parentPath}.${tab.name}` : tab.name\n\n            // Prepare a ref for this named tab's children to inherit the path\n            const refObj = ref as Record<string, any>\n            const tabRef = refObj[tab.name] ?? {}\n            tabRef.path = tabPath\n            tabRef.__manualRef = true // flag this as a manually constructed parentRef\n            refObj[tab.name] = tabRef\n          }\n        }\n\n        // Skip further processing of the tab container itself\n        return\n      }\n\n      // Skip unnamed fields (e.g. rows/collapsibles)\n      if (!('name' in field) || typeof field.name !== 'string') {\n        return\n      }\n\n      // Determine the path to the current field\n      let parentPath: string | undefined\n\n      if (\n        parentRef &&\n        typeof parentRef === 'object' &&\n        'path' in parentRef &&\n        typeof (parentRef as { path?: unknown }).path === 'string'\n      ) {\n        parentPath = (parentRef as { path: string }).path\n      } else if ((ref as any)?.__manualRef && typeof (ref as any)?.path === 'string') {\n        // Fallback: if current ref is a manual tabRef, use its path\n        parentPath = (ref as any).path\n      }\n\n      const fullPath = parentPath ? `${parentPath}.${field.name}` : field.name\n\n      // Store current path for any nested children to use\n      ;(ref as any).path = fullPath\n\n      // If field is a data-affecting field and disabled via plugin config, collect its path\n      if (fieldAffectsData(field) && field.custom?.['plugin-import-export']?.disabled) {\n        disabledPaths.push(fullPath)\n        return next?.()\n      }\n    },\n    fields,\n  })\n\n  return disabledPaths\n}\n"],"names":["traverseFields","fieldAffectsData","collectDisabledFieldPaths","fields","disabledPaths","callback","field","next","parentRef","ref","type","Array","isArray","tabs","tab","name","parentPath","path","tabPath","refObj","tabRef","__manualRef","fullPath","custom","disabled","push"],"mappings":"AAEA,SAASA,cAAc,QAAQ,UAAS;AACxC,SAASC,gBAAgB,QAAQ,iBAAgB;AAEjD;;;;;;;;;;;CAWC,GACD,OAAO,MAAMC,4BAA4B,CAACC;IACxC,MAAMC,gBAA0B,EAAE;IAElCJ,eAAe;QACbK,UAAU,CAAC,EAAEC,KAAK,EAAEC,IAAI,EAAEC,SAAS,EAAEC,GAAG,EAAE;YACxC,oBAAoB;YACpB,IAAIH,MAAMI,IAAI,KAAK,UAAUC,MAAMC,OAAO,CAACN,MAAMO,IAAI,GAAG;gBACtD,KAAK,MAAMC,OAAOR,MAAMO,IAAI,CAAE;oBAC5B,IAAI,UAAUC,OAAO,OAAOA,IAAIC,IAAI,KAAK,UAAU;wBACjD,qCAAqC;wBACrC,MAAMC,aACJR,aAAa,OAAO,AAACA,UAAiCS,IAAI,KAAK,WAC3D,AAACT,UAA+BS,IAAI,GACpC;wBACN,MAAMC,UAAUF,aAAa,GAAGA,WAAW,CAAC,EAAEF,IAAIC,IAAI,EAAE,GAAGD,IAAIC,IAAI;wBAEnE,kEAAkE;wBAClE,MAAMI,SAASV;wBACf,MAAMW,SAASD,MAAM,CAACL,IAAIC,IAAI,CAAC,IAAI,CAAC;wBACpCK,OAAOH,IAAI,GAAGC;wBACdE,OAAOC,WAAW,GAAG,MAAK,gDAAgD;wBAC1EF,MAAM,CAACL,IAAIC,IAAI,CAAC,GAAGK;oBACrB;gBACF;gBAEA,sDAAsD;gBACtD;YACF;YAEA,+CAA+C;YAC/C,IAAI,CAAE,CAAA,UAAUd,KAAI,KAAM,OAAOA,MAAMS,IAAI,KAAK,UAAU;gBACxD;YACF;YAEA,0CAA0C;YAC1C,IAAIC;YAEJ,IACER,aACA,OAAOA,cAAc,YACrB,UAAUA,aACV,OAAO,AAACA,UAAiCS,IAAI,KAAK,UAClD;gBACAD,aAAa,AAACR,UAA+BS,IAAI;YACnD,OAAO,IAAI,AAACR,KAAaY,eAAe,OAAQZ,KAAaQ,SAAS,UAAU;gBAC9E,4DAA4D;gBAC5DD,aAAa,AAACP,IAAYQ,IAAI;YAChC;YAEA,MAAMK,WAAWN,aAAa,GAAGA,WAAW,CAAC,EAAEV,MAAMS,IAAI,EAAE,GAAGT,MAAMS,IAAI;YAGtEN,IAAYQ,IAAI,GAAGK;YAErB,sFAAsF;YACtF,IAAIrB,iBAAiBK,UAAUA,MAAMiB,MAAM,EAAE,CAAC,uBAAuB,EAAEC,UAAU;gBAC/EpB,cAAcqB,IAAI,CAACH;gBACnB,OAAOf;YACT;QACF;QACAJ;IACF;IAEA,OAAOC;AACT,EAAC"}