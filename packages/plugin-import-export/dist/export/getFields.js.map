{"version":3,"sources":["../../src/export/getFields.ts"],"sourcesContent":["import type { TFunction } from '@payloadcms/translations'\nimport type { Config, Field, SelectField } from 'payload'\n\nimport { getFilename } from '../utilities/getFilename.js'\nimport { validateLimitValue } from '../utilities/validateLimitValue.js'\n\ntype GetFieldsOptions = {\n  /**\n   * Force a specific format, hiding the format dropdown\n   */\n  format?: 'csv' | 'json'\n}\n\nexport const getFields = (config: Config, options?: GetFieldsOptions): Field[] => {\n  const format = options?.format\n  let localeField: SelectField | undefined\n  if (config.localization) {\n    localeField = {\n      name: 'locale',\n      type: 'select',\n      admin: {\n        width: '25%',\n      },\n      defaultValue: 'all',\n      // @ts-expect-error - this is not correctly typed in plugins right now\n      label: ({ t }) => t('plugin-import-export:field-locale-label'),\n      options: [\n        {\n          label: ({ t }) => t('general:allLocales'),\n          value: 'all',\n        },\n        ...config.localization.locales.map((locale) => ({\n          label: typeof locale === 'string' ? locale : locale.label,\n          value: typeof locale === 'string' ? locale : locale.code,\n        })),\n      ],\n    }\n  }\n\n  return [\n    {\n      type: 'collapsible',\n      fields: [\n        {\n          name: 'name',\n          type: 'text',\n          defaultValue: () => getFilename(),\n          // @ts-expect-error - this is not correctly typed in plugins right now\n          label: ({ t }) => t('plugin-import-export:field-name-label'),\n        },\n        {\n          type: 'row',\n          fields: [\n            {\n              name: 'format',\n              type: 'select',\n              admin: {\n                // Hide if a forced format is set via config\n                condition: () => !format,\n                width: '33.3333%',\n              },\n              defaultValue: format ?? 'csv',\n              // @ts-expect-error - this is not correctly typed in plugins right now\n              label: ({ t }) => t('plugin-import-export:field-format-label'),\n              options: [\n                {\n                  label: 'CSV',\n                  value: 'csv',\n                },\n                {\n                  label: 'JSON',\n                  value: 'json',\n                },\n              ],\n              required: true,\n            },\n            {\n              name: 'limit',\n              type: 'number',\n              admin: {\n                placeholder: 'No limit',\n                step: 100,\n                width: '33.3333%',\n              },\n              validate: (value: null | number | undefined, { req }: { req: { t: TFunction } }) => {\n                return validateLimitValue(value, req.t) ?? true\n              },\n              // @ts-expect-error - this is not correctly typed in plugins right now\n              label: ({ t }) => t('plugin-import-export:field-limit-label'),\n            },\n            {\n              name: 'page',\n              type: 'number',\n              admin: {\n                components: {\n                  Field: '@payloadcms/plugin-import-export/rsc#Page',\n                },\n                condition: ({ limit }) => {\n                  // Show the page field only if limit is set\n                  return typeof limit === 'number' && limit !== 0\n                },\n                width: '33.3333%',\n              },\n              defaultValue: 1,\n              // @ts-expect-error - this is not correctly typed in plugins right now\n              label: ({ t }) => t('plugin-import-export:field-page-label'),\n            },\n          ],\n        },\n        {\n          type: 'row',\n          fields: [\n            {\n              name: 'sort',\n              type: 'text',\n              admin: {\n                components: {\n                  Field: '@payloadcms/plugin-import-export/rsc#SortBy',\n                },\n              },\n              // @ts-expect-error - this is not correctly typed in plugins right now\n              label: ({ t }) => t('plugin-import-export:field-sort-label'),\n            },\n            {\n              name: 'sortOrder',\n              type: 'select',\n              admin: {\n                components: {\n                  Field: '@payloadcms/plugin-import-export/rsc#SortOrder',\n                },\n                // Only show when `sort` has a value\n                condition: ({ sort }) => typeof sort === 'string' && sort.trim().length > 0,\n              },\n              // @ts-expect-error - this is not correctly typed in plugins right now\n              label: ({ t }) => t('plugin-import-export:field-sort-order-label'),\n              options: [\n                { label: 'Ascending', value: 'asc' },\n                { label: 'Descending', value: 'desc' },\n              ],\n            },\n            ...(localeField ? [localeField] : []),\n            {\n              name: 'drafts',\n              type: 'select',\n              admin: {\n                condition: (data) => {\n                  const collectionConfig = (config.collections ?? []).find(\n                    (collection) => collection.slug === data.collectionSlug,\n                  )\n                  return Boolean(\n                    typeof collectionConfig?.versions === 'object' &&\n                      collectionConfig?.versions?.drafts,\n                  )\n                },\n                width: '25%',\n              },\n              defaultValue: 'yes',\n              // @ts-expect-error - this is not correctly typed in plugins right now\n              label: ({ t }) => t('plugin-import-export:field-drafts-label'),\n              options: [\n                {\n                  label: ({ t }) => t('general:yes'),\n                  value: 'yes',\n                },\n                {\n                  label: ({ t }) => t('general:no'),\n                  value: 'no',\n                },\n              ],\n            },\n            // {\n            //   name: 'depth',\n            //   type: 'number',\n            //   // @ts-expect-error - this is not correctly typed in plugins right now\n            //   label: ({ t }) => t('plugin-import-export:field-depth-label'),\n            //   admin: {\n            //     width: '33%',\n            //   },\n            //   defaultValue: 1,\n            //   required: true,\n            // },\n          ],\n        },\n        {\n          name: 'selectionToUse',\n          type: 'radio',\n          admin: {\n            components: {\n              Field: '@payloadcms/plugin-import-export/rsc#SelectionToUseField',\n            },\n          },\n          options: [\n            {\n              // @ts-expect-error - this is not correctly typed in plugins right now\n              label: ({ t }) => t('plugin-import-export:selectionToUse-currentSelection'),\n              value: 'currentSelection',\n            },\n            {\n              // @ts-expect-error - this is not correctly typed in plugins right now\n              label: ({ t }) => t('plugin-import-export:selectionToUse-currentFilters'),\n              value: 'currentFilters',\n            },\n            {\n              // @ts-expect-error - this is not correctly typed in plugins right now\n              label: ({ t }) => t('plugin-import-export:selectionToUse-allDocuments'),\n              value: 'all',\n            },\n          ],\n          virtual: true,\n        },\n        {\n          name: 'fields',\n          type: 'text',\n          admin: {\n            components: {\n              Field: '@payloadcms/plugin-import-export/rsc#FieldsToExport',\n            },\n          },\n          hasMany: true,\n          // @ts-expect-error - this is not correctly typed in plugins right now\n          label: ({ t }) => t('plugin-import-export:field-fields-label'),\n        },\n        {\n          name: 'collectionSlug',\n          type: 'text',\n          admin: {\n            components: {\n              Field: '@payloadcms/plugin-import-export/rsc#CollectionField',\n            },\n          },\n          required: true,\n        },\n        {\n          name: 'where',\n          type: 'json',\n          admin: {\n            hidden: true,\n          },\n          defaultValue: {},\n          hooks: {\n            beforeValidate: [\n              ({ value }) => {\n                return value ?? {}\n              },\n            ],\n          },\n        },\n      ],\n      // @ts-expect-error - this is not correctly typed in plugins right now\n      label: ({ t }) => t('plugin-import-export:exportOptions'),\n    },\n    {\n      name: 'preview',\n      type: 'ui',\n      admin: {\n        components: {\n          Field: '@payloadcms/plugin-import-export/rsc#ExportPreview',\n        },\n      },\n    },\n  ]\n}\n"],"names":["getFilename","validateLimitValue","getFields","config","options","format","localeField","localization","name","type","admin","width","defaultValue","label","t","value","locales","map","locale","code","fields","condition","required","placeholder","step","validate","req","components","Field","limit","sort","trim","length","data","collectionConfig","collections","find","collection","slug","collectionSlug","Boolean","versions","drafts","virtual","hasMany","hidden","hooks","beforeValidate"],"mappings":"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"}