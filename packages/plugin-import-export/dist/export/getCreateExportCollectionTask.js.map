{"version":3,"sources":["../../src/export/getCreateExportCollectionTask.ts"],"sourcesContent":["import type { Config, TaskConfig } from 'payload'\n\nimport type { Export } from './createExport.js'\n\nimport { createExport } from './createExport.js'\nimport { getFields } from './getFields.js'\n\n/**\n * Export input type for job queue serialization.\n * When exports are queued as jobs, the user must be serialized as an ID string or number\n * along with the collection name so it can be rehydrated when the job runs.\n */\nexport type ExportJobInput = {\n  user: number | string\n  userCollection: string\n} & Export\n\nexport const getCreateCollectionExportTask = (\n  config: Config,\n): TaskConfig<{\n  input: ExportJobInput\n  output: object\n}> => {\n  const inputSchema = getFields(config).concat(\n    {\n      name: 'userID',\n      type: 'text',\n    },\n    {\n      name: 'userCollection',\n      type: 'text',\n    },\n    {\n      name: 'exportsCollection',\n      type: 'text',\n    },\n  )\n\n  return {\n    slug: 'createCollectionExport',\n    handler: async ({ input, req }) => {\n      if (!input) {\n        req.payload.logger.error('No input provided to createCollectionExport task')\n\n        return { output: {} }\n      }\n\n      await createExport({\n        ...input,\n        req,\n      })\n\n      return {\n        output: {},\n      }\n    },\n    inputSchema,\n  }\n}\n"],"names":["createExport","getFields","getCreateCollectionExportTask","config","inputSchema","concat","name","type","slug","handler","input","req","payload","logger","error","output"],"mappings":"AAIA,SAASA,YAAY,QAAQ,oBAAmB;AAChD,SAASC,SAAS,QAAQ,iBAAgB;AAY1C,OAAO,MAAMC,gCAAgC,CAC3CC;IAKA,MAAMC,cAAcH,UAAUE,QAAQE,MAAM,CAC1C;QACEC,MAAM;QACNC,MAAM;IACR,GACA;QACED,MAAM;QACNC,MAAM;IACR,GACA;QACED,MAAM;QACNC,MAAM;IACR;IAGF,OAAO;QACLC,MAAM;QACNC,SAAS,OAAO,EAAEC,KAAK,EAAEC,GAAG,EAAE;YAC5B,IAAI,CAACD,OAAO;gBACVC,IAAIC,OAAO,CAACC,MAAM,CAACC,KAAK,CAAC;gBAEzB,OAAO;oBAAEC,QAAQ,CAAC;gBAAE;YACtB;YAEA,MAAMf,aAAa;gBACjB,GAAGU,KAAK;gBACRC;YACF;YAEA,OAAO;gBACLI,QAAQ,CAAC;YACX;QACF;QACAX;IACF;AACF,EAAC"}