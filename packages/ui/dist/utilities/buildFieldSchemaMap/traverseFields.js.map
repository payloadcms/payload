{"version":3,"file":"traverseFields.js","names":["MissingEditorProp","fieldAffectsData","getFieldPaths","tabHasName","traverseFields","config","fields","i18n","parentIndexPath","parentSchemaPath","schemaMap","index","field","entries","indexPath","schemaPath","set","type","blockReferences","blocks","map","_block","block","find","b","slug","blockSchemaPath","editor","Error","generateSchemaMap","isNamedTab","tabs","tab"],"sources":["../../../src/utilities/buildFieldSchemaMap/traverseFields.ts"],"sourcesContent":["import type { I18n } from '@payloadcms/translations'\nimport type { Field, FieldSchemaMap, SanitizedConfig, TabAsField } from 'payload'\n\nimport { MissingEditorProp } from 'payload'\nimport { fieldAffectsData, getFieldPaths, tabHasName } from 'payload/shared'\n\ntype Args = {\n  config: SanitizedConfig\n  fields: (Field | TabAsField)[]\n  i18n: I18n<any, any>\n  parentIndexPath: string\n  parentSchemaPath: string\n  schemaMap: FieldSchemaMap\n}\n\nexport const traverseFields = ({\n  config,\n  fields,\n  i18n,\n  parentIndexPath,\n  parentSchemaPath,\n  schemaMap,\n}: Args) => {\n  for (const [index, field] of fields.entries()) {\n    const { indexPath, schemaPath } = getFieldPaths({\n      field,\n      index,\n      parentIndexPath,\n      parentSchemaPath,\n    })\n\n    schemaMap.set(schemaPath, field)\n\n    switch (field.type) {\n      case 'array':\n        traverseFields({\n          config,\n          fields: field.fields,\n          i18n,\n          parentIndexPath: '',\n          parentSchemaPath: schemaPath,\n          schemaMap,\n        })\n\n        break\n\n      case 'blocks':\n        ;(field.blockReferences ?? field.blocks).map((_block) => {\n          // TODO: iterate over blocks mapped to block slug in v4, or pass through payload.blocks\n          const block =\n            typeof _block === 'string' ? config.blocks.find((b) => b.slug === _block) : _block\n\n          const blockSchemaPath = `${schemaPath}.${block.slug}`\n\n          schemaMap.set(blockSchemaPath, block)\n          traverseFields({\n            config,\n            fields: block.fields,\n            i18n,\n            parentIndexPath: '',\n            parentSchemaPath: schemaPath + '.' + block.slug,\n            schemaMap,\n          })\n        })\n\n        break\n\n      case 'collapsible':\n      case 'row':\n        traverseFields({\n          config,\n          fields: field.fields,\n          i18n,\n          parentIndexPath: indexPath,\n          parentSchemaPath: schemaPath,\n          schemaMap,\n        })\n\n        break\n\n      case 'group':\n        if (fieldAffectsData(field)) {\n          traverseFields({\n            config,\n            fields: field.fields,\n            i18n,\n            parentIndexPath: '',\n            parentSchemaPath: schemaPath,\n            schemaMap,\n          })\n        } else {\n          traverseFields({\n            config,\n            fields: field.fields,\n            i18n,\n            parentIndexPath: indexPath,\n            parentSchemaPath: schemaPath,\n            schemaMap,\n          })\n        }\n\n        break\n\n      case 'richText': {\n        if (!field?.editor) {\n          throw new MissingEditorProp(field) // while we allow disabling editor functionality, you should not have any richText fields defined if you do not have an editor\n        }\n\n        if (typeof field.editor === 'function') {\n          throw new Error('Attempted to access unsanitized rich text editor.')\n        }\n\n        if (typeof field.editor.generateSchemaMap === 'function') {\n          field.editor.generateSchemaMap({\n            config,\n            field,\n            i18n,\n            schemaMap,\n            schemaPath,\n          })\n        }\n\n        break\n      }\n\n      case 'tab': {\n        const isNamedTab = tabHasName(field)\n\n        traverseFields({\n          config,\n          fields: field.fields,\n          i18n,\n          parentIndexPath: isNamedTab ? '' : indexPath,\n          parentSchemaPath: schemaPath,\n          schemaMap,\n        })\n\n        break\n      }\n\n      case 'tabs': {\n        traverseFields({\n          config,\n          fields: field.tabs.map((tab) => ({ ...tab, type: 'tab' })),\n          i18n,\n          parentIndexPath: indexPath,\n          parentSchemaPath: schemaPath,\n          schemaMap,\n        })\n\n        break\n      }\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}