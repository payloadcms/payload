{"version":3,"file":"index.js","names":["React","useMemo","BulkUploadProvider","useField","withCondition","useConfig","mergeFieldStyles","UploadInput","baseClass","UploadComponent","props","field","admin","allowCreate","className","description","isSortable","hasMany","label","localized","maxRows","relationTo","relationToFromProps","required","path","pathFromProps","readOnly","validate","config","displayPreview","memoizedValidate","useCallback","value","options","customComponents","AfterInput","BeforeInput","Description","Error","Label","disabled","filterOptions","setValue","showError","potentiallyStalePath","isPolymorphic","Array","isArray","memoizedValue","map","val","styles","_jsx","drawerSlugPrefix","api","routes","onChange","serverURL","style","UploadField"],"sources":["../../../src/fields/Upload/index.tsx"],"sourcesContent":["'use client'\n\nimport type { UploadFieldClientProps, ValueWithRelation } from 'payload'\n\nimport React, { useMemo } from 'react'\n\nimport { BulkUploadProvider } from '../../elements/BulkUpload/index.js'\nimport { useField } from '../../forms/useField/index.js'\nimport { withCondition } from '../../forms/withCondition/index.js'\nimport { useConfig } from '../../providers/Config/index.js'\nimport { mergeFieldStyles } from '../mergeFieldStyles.js'\nimport { UploadInput } from './Input.js'\nimport './index.scss'\n\nexport { UploadInput } from './Input.js'\nexport type { UploadInputProps } from './Input.js'\n\nexport const baseClass = 'upload'\n\nexport function UploadComponent(props: UploadFieldClientProps) {\n  const {\n    field,\n    field: {\n      admin: { allowCreate, className, description, isSortable } = {},\n      hasMany,\n      label,\n      localized,\n      maxRows,\n      relationTo: relationToFromProps,\n      required,\n    },\n    path: pathFromProps,\n    readOnly,\n    validate,\n  } = props\n\n  const { config } = useConfig()\n\n  const displayPreview = field.displayPreview\n\n  const memoizedValidate = React.useCallback(\n    (value, options) => {\n      if (typeof validate === 'function') {\n        return validate(value, { ...options, required })\n      }\n    },\n    [validate, required],\n  )\n\n  const {\n    customComponents: { AfterInput, BeforeInput, Description, Error, Label } = {},\n    disabled,\n    filterOptions,\n    path,\n    setValue,\n    showError,\n    value,\n  } = useField<string | string[]>({\n    potentiallyStalePath: pathFromProps,\n    validate: memoizedValidate,\n  })\n\n  const isPolymorphic = Array.isArray(relationToFromProps)\n\n  const memoizedValue:\n    | (number | string)[]\n    | number\n    | string\n    | ValueWithRelation\n    | ValueWithRelation[] = React.useMemo(() => {\n    if (hasMany === true) {\n      return (\n        Array.isArray(value)\n          ? value.map((val) => {\n              return isPolymorphic\n                ? val\n                : {\n                    relationTo: Array.isArray(relationToFromProps)\n                      ? relationToFromProps[0]\n                      : relationToFromProps,\n                    value: val,\n                  }\n            })\n          : value\n      ) as ValueWithRelation[]\n    } else {\n      // Value comes in as string when not polymorphic and with the object with the right relationTo when it is polymorphic\n      return value\n    }\n  }, [hasMany, value, isPolymorphic, relationToFromProps])\n\n  const styles = useMemo(() => mergeFieldStyles(field), [field])\n\n  return (\n    <BulkUploadProvider drawerSlugPrefix={pathFromProps}>\n      <UploadInput\n        AfterInput={AfterInput}\n        allowCreate={allowCreate !== false}\n        api={config.routes.api}\n        BeforeInput={BeforeInput}\n        className={className}\n        Description={Description}\n        description={description}\n        displayPreview={displayPreview}\n        Error={Error}\n        filterOptions={filterOptions}\n        hasMany={hasMany}\n        isSortable={isSortable}\n        label={label}\n        Label={Label}\n        localized={localized}\n        maxRows={maxRows}\n        onChange={setValue}\n        path={path}\n        readOnly={readOnly || disabled}\n        relationTo={relationToFromProps}\n        required={required}\n        serverURL={config.serverURL}\n        showError={showError}\n        style={styles}\n        value={memoizedValue}\n      />\n    </BulkUploadProvider>\n  )\n}\n\nexport const UploadField = withCondition(UploadComponent)\n"],"mappings":"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","ignoreList":[]}