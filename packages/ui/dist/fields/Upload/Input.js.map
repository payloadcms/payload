{"version":3,"file":"Input.js","names":["useModal","formatAdminURL","qs","React","useCallback","useEffect","useMemo","useBulkUpload","Button","useDocumentDrawer","Dropzone","useListDrawer","RenderCustomComponent","ShimmerEffect","FieldDescription","FieldError","FieldLabel","useAuth","useLocale","useTranslation","normalizeRelationshipValue","fieldBaseClass","UploadComponentHasMany","UploadComponentHasOne","baseClass","UploadInput","props","AfterInput","allowCreate","api","BeforeInput","className","Description","description","displayPreview","Error","filterOptions","filterOptionsFromProps","hasMany","isSortable","Label","label","localized","maxRows","onChange","onChangeFromProps","path","readOnly","relationTo","required","serverURL","showError","style","value","populatedDocs","setPopulatedDocs","useState","activeRelationTo","Array","isArray","openModal","drawerSlug","setCollectionSlug","setInitialFiles","setMaxFiles","setOnSuccess","setSelectableCollections","permissions","code","i18n","t","collectionSlugsWithCreatePermission","filter","relation","collections","create","isPoly","existingIdsByRelation","values","val","push","collection","id","newFilterOptions","relations","forEach","existingIds","not_in","concat","ListDrawer","closeDrawer","closeListDrawer","openDrawer","openListDrawer","collectionSlugs","CreateDocDrawer","closeCreateDocDrawer","openCreateDocDrawer","collectionSlug","loadedValueRef","useRef","canCreate","newValue","populateDocs","items","length","grouped","idValue","fetches","Object","entries","map","ids","query","depth","draft","limit","locale","where","and","in","response","fetch","apiRoute","body","stringify","credentials","headers","language","method","docs","ok","data","json","docsById","reduce","acc","doc","results","Promise","all","lookup","sortedDocs","filename","isPlaceholder","normalizeValue","onUploadSuccess","uploadedForms","newValues","form","normalizedExisting","mergedValue","currentDocs","firstDoc","onLocalFileSelection","fileList","fileListToUse","dataTransfer","DataTransfer","add","files","collectionToUse","onListBulkSelect","selectedDocIDs","isSelected","itemsToLoad","loadedDocs","onDocCreate","onListSelect","selectedDoc","valueToUse","reloadDoc","docID","updatedDocsToPropogate","existingDocIndex","findIndex","hasExisting","updatedDocs","onReorder","newValueToSave","rel","onRemove","loadInitialDocs","v","current","valueChanged","showDropzone","_jsxs","Boolean","join","replace","_jsx","CustomComponent","Fallback","_Fragment","fileDocs","readonly","showCollectionSlug","height","fileDoc","disabled","multipleFiles","buttonStyle","onClick","size","onSave","enableRowSelections","onBulkSelect","onSelect"],"sources":["../../../src/fields/Upload/Input.tsx"],"sourcesContent":["'use client'\n\nimport type {\n  ClientCollectionConfig,\n  FieldLabelClientProps,\n  FilterOptionsResult,\n  JsonObject,\n  StaticDescription,\n  StaticLabel,\n  UploadFieldClient,\n  UploadField as UploadFieldType,\n  ValueWithRelation,\n} from 'payload'\nimport type { MarkOptional } from 'ts-essentials'\n\nimport { useModal } from '@faceless-ui/modal'\nimport { formatAdminURL } from 'payload/shared'\nimport * as qs from 'qs-esm'\nimport React, { useCallback, useEffect, useMemo } from 'react'\n\nimport type { ListDrawerProps } from '../../elements/ListDrawer/types.js'\nimport type { ReloadDoc, ValueAsDataWithRelation } from './types.js'\n\nimport { type BulkUploadContext, useBulkUpload } from '../../elements/BulkUpload/index.js'\nimport { Button } from '../../elements/Button/index.js'\nimport { useDocumentDrawer } from '../../elements/DocumentDrawer/index.js'\nimport { Dropzone } from '../../elements/Dropzone/index.js'\nimport { useListDrawer } from '../../elements/ListDrawer/index.js'\nimport { RenderCustomComponent } from '../../elements/RenderCustomComponent/index.js'\nimport { ShimmerEffect } from '../../elements/ShimmerEffect/index.js'\nimport { FieldDescription } from '../../fields/FieldDescription/index.js'\nimport { FieldError } from '../../fields/FieldError/index.js'\nimport { FieldLabel } from '../../fields/FieldLabel/index.js'\nimport { useAuth } from '../../providers/Auth/index.js'\nimport { useLocale } from '../../providers/Locale/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { normalizeRelationshipValue } from '../../utilities/normalizeRelationshipValue.js'\nimport { fieldBaseClass } from '../shared/index.js'\nimport { UploadComponentHasMany } from './HasMany/index.js'\nimport './index.scss'\nimport { UploadComponentHasOne } from './HasOne/index.js'\n\nexport const baseClass = 'upload'\n\ntype PopulatedDocs = { relationTo: string; value: JsonObject }[]\n\nexport type UploadInputProps = {\n  readonly AfterInput?: React.ReactNode\n  readonly allowCreate?: boolean\n  /**\n   * Controls the visibility of the \"Create new collection\" button\n   */\n  readonly api?: string\n  readonly BeforeInput?: React.ReactNode\n  readonly className?: string\n  readonly collection?: ClientCollectionConfig\n  readonly customUploadActions?: React.ReactNode[]\n  readonly Description?: React.ReactNode\n  readonly description?: StaticDescription\n  readonly displayPreview?: boolean\n  readonly Error?: React.ReactNode\n  readonly filterOptions?: FilterOptionsResult\n  readonly hasMany?: boolean\n  readonly hideRemoveFile?: boolean\n  readonly isSortable?: boolean\n  readonly Label?: React.ReactNode\n  readonly label?: StaticLabel\n  readonly labelProps?: FieldLabelClientProps<MarkOptional<UploadFieldClient, 'type'>>\n  readonly localized?: boolean\n  readonly maxRows?: number\n  readonly onChange?: (e) => void\n  readonly path: string\n  readonly readOnly?: boolean\n  readonly relationTo: UploadFieldType['relationTo']\n  readonly required?: boolean\n  readonly serverURL?: string\n  readonly showError?: boolean\n  readonly style?: React.CSSProperties\n  readonly value?: (number | string)[] | number | string | ValueWithRelation | ValueWithRelation[]\n}\n\nexport function UploadInput(props: UploadInputProps) {\n  const {\n    AfterInput,\n    allowCreate,\n    api,\n    BeforeInput,\n    className,\n    Description,\n    description,\n    displayPreview,\n    Error,\n    filterOptions: filterOptionsFromProps,\n    hasMany,\n    isSortable,\n    Label,\n    label,\n    localized,\n    maxRows,\n    onChange: onChangeFromProps,\n    path,\n    readOnly,\n    relationTo,\n    required,\n    serverURL,\n    showError,\n    style,\n    value,\n  } = props\n\n  const [populatedDocs, setPopulatedDocs] = React.useState<\n    {\n      relationTo: string\n      value: JsonObject\n    }[]\n  >()\n\n  const [activeRelationTo] = React.useState<string>(\n    Array.isArray(relationTo) ? relationTo[0] : relationTo,\n  )\n\n  const { openModal } = useModal()\n  const {\n    drawerSlug,\n    setCollectionSlug,\n    setInitialFiles,\n    setMaxFiles,\n    setOnSuccess,\n    setSelectableCollections,\n  } = useBulkUpload()\n  const { permissions } = useAuth()\n  const { code } = useLocale()\n  const { i18n, t } = useTranslation()\n\n  // This will be used by the bulk upload to allow you to select only collections you have create permissions for\n  const collectionSlugsWithCreatePermission = useMemo(() => {\n    if (Array.isArray(relationTo)) {\n      return relationTo.filter(\n        (relation) => permissions?.collections && permissions.collections?.[relation]?.create,\n      )\n    }\n    return []\n  }, [relationTo, permissions])\n\n  const filterOptions: FilterOptionsResult = useMemo(() => {\n    const isPoly = Array.isArray(relationTo)\n\n    if (!value) {\n      return filterOptionsFromProps\n    }\n\n    // Group existing IDs by relation\n    const existingIdsByRelation: Record<string, (number | string)[]> = {}\n\n    const values = Array.isArray(value) ? value : [value]\n\n    for (const val of values) {\n      if (isPoly && typeof val === 'object' && 'relationTo' in val) {\n        // Poly upload - group by relationTo\n        if (!existingIdsByRelation[val.relationTo]) {\n          existingIdsByRelation[val.relationTo] = []\n        }\n        existingIdsByRelation[val.relationTo].push(val.value)\n      } else if (!isPoly) {\n        // Non-poly upload - all IDs belong to the single collection\n        const collection = relationTo\n        if (!existingIdsByRelation[collection]) {\n          existingIdsByRelation[collection] = []\n        }\n        const id = typeof val === 'object' && 'value' in val ? val.value : val\n        if (typeof id === 'string' || typeof id === 'number') {\n          existingIdsByRelation[collection].push(id)\n        }\n      }\n    }\n\n    // Build filter options for each collection\n    const newFilterOptions = { ...filterOptionsFromProps }\n    const relations = isPoly ? relationTo : [relationTo]\n\n    relations.forEach((relation) => {\n      const existingIds = existingIdsByRelation[relation] || []\n\n      newFilterOptions[relation] = {\n        ...((filterOptionsFromProps?.[relation] as any) || {}),\n        id: {\n          ...((filterOptionsFromProps?.[relation] as any)?.id || {}),\n          not_in: ((filterOptionsFromProps?.[relation] as any)?.id?.not_in || []).concat(\n            existingIds,\n          ),\n        },\n      }\n    })\n\n    return newFilterOptions\n  }, [value, filterOptionsFromProps, relationTo])\n\n  const [ListDrawer, , { closeDrawer: closeListDrawer, openDrawer: openListDrawer }] =\n    useListDrawer({\n      collectionSlugs: typeof relationTo === 'string' ? [relationTo] : relationTo,\n      filterOptions,\n    })\n\n  const [\n    CreateDocDrawer,\n    ,\n    { closeDrawer: closeCreateDocDrawer, openDrawer: openCreateDocDrawer },\n  ] = useDocumentDrawer({\n    collectionSlug: activeRelationTo,\n  })\n\n  /**\n   * Track the last loaded value to prevent unnecessary reloads\n   */\n  const loadedValueRef = React.useRef<\n    (number | string)[] | null | number | string | ValueWithRelation | ValueWithRelation[]\n  >(null)\n\n  const canCreate = useMemo(() => {\n    if (!allowCreate) {\n      return false\n    }\n\n    if (typeof activeRelationTo === 'string') {\n      if (permissions?.collections && permissions.collections?.[activeRelationTo]?.create) {\n        return true\n      }\n    }\n\n    return false\n  }, [activeRelationTo, permissions, allowCreate])\n\n  const onChange = React.useCallback(\n    (newValue) => {\n      if (typeof onChangeFromProps === 'function') {\n        onChangeFromProps(newValue)\n      }\n    },\n    [onChangeFromProps],\n  )\n\n  const populateDocs = React.useCallback(\n    async (items: ValueWithRelation[]): Promise<ValueAsDataWithRelation[]> => {\n      if (!items?.length) {\n        return []\n      }\n\n      // 1. Group IDs by collection\n      const grouped: Record<string, (number | string)[]> = {}\n      items.forEach(({ relationTo, value }) => {\n        if (!grouped[relationTo]) {\n          grouped[relationTo] = []\n        }\n        // Ensure we extract the actual ID value, not an object\n        let idValue: number | string = value\n\n        if (value && typeof value === 'object' && 'value' in (value as any)) {\n          idValue = (value as any).value\n        }\n\n        grouped[relationTo].push(idValue)\n      })\n\n      // 2. Fetch per collection\n      const fetches = Object.entries(grouped).map(async ([collection, ids]) => {\n        const query = {\n          depth: 0,\n          draft: true,\n          limit: ids.length,\n          locale: code,\n          where: {\n            and: [\n              {\n                id: {\n                  in: ids,\n                },\n              },\n            ],\n          },\n        }\n        const response = await fetch(\n          formatAdminURL({\n            apiRoute: api,\n            path: `/${collection}`,\n          }),\n          {\n            body: qs.stringify(query),\n            credentials: 'include',\n            headers: {\n              'Accept-Language': i18n.language,\n              'Content-Type': 'application/x-www-form-urlencoded',\n              'X-Payload-HTTP-Method-Override': 'GET',\n            },\n            method: 'POST',\n          },\n        )\n        let docs: any[] = []\n        if (response.ok) {\n          const data = await response.json()\n          docs = data.docs\n        }\n        // Map docs by ID for fast lookup\n        const docsById = docs.reduce((acc, doc) => {\n          acc[doc.id] = doc\n          return acc\n        }, {})\n        return { collection, docsById }\n      })\n\n      const results = await Promise.all(fetches)\n\n      // 3. Build lookup\n      const lookup: Record<string, Record<string, any>> = {}\n      results.forEach(({ collection, docsById }) => {\n        lookup[collection] = docsById\n      })\n\n      // 4. Reconstruct in input order, add placeholders if missing\n      const sortedDocs = items.map(({ relationTo, value }) => {\n        const doc = lookup[relationTo]?.[value] || {\n          id: value,\n          filename: `${t('general:untitled')} - ID: ${value}`,\n          isPlaceholder: true,\n        }\n        return { relationTo, value: doc }\n      })\n\n      return sortedDocs\n    },\n    [api, code, i18n.language, t],\n  )\n\n  const normalizeValue = useCallback(\n    (value: any): any => normalizeRelationshipValue(value, relationTo),\n    [relationTo],\n  )\n\n  const onUploadSuccess: BulkUploadContext['onSuccess'] = useCallback(\n    (uploadedForms) => {\n      const isPoly = Array.isArray(relationTo)\n\n      if (hasMany) {\n        const newValues = uploadedForms.map((form) =>\n          isPoly ? { relationTo: form.collectionSlug, value: form.doc.id } : form.doc.id,\n        )\n        // Normalize existing values before merging\n        const normalizedExisting = Array.isArray(value) ? value.map(normalizeValue) : []\n        const mergedValue = [...normalizedExisting, ...newValues]\n        onChange(mergedValue)\n        setPopulatedDocs((currentDocs) => [\n          ...(currentDocs || []),\n          ...uploadedForms.map((form) => ({\n            relationTo: form.collectionSlug,\n            value: form.doc,\n          })),\n        ])\n      } else {\n        const firstDoc = uploadedForms[0]\n        const newValue = isPoly\n          ? { relationTo: firstDoc.collectionSlug, value: firstDoc.doc.id }\n          : firstDoc.doc.id\n        onChange(newValue)\n        setPopulatedDocs([\n          {\n            relationTo: firstDoc.collectionSlug,\n            value: firstDoc.doc,\n          },\n        ])\n      }\n    },\n    [value, onChange, hasMany, relationTo, normalizeValue],\n  )\n\n  const onLocalFileSelection = React.useCallback(\n    (fileList?: FileList) => {\n      let fileListToUse = fileList\n      if (!hasMany && fileList && fileList.length > 1) {\n        const dataTransfer = new DataTransfer()\n        dataTransfer.items.add(fileList[0])\n        fileListToUse = dataTransfer.files\n      }\n      if (fileListToUse) {\n        setInitialFiles(fileListToUse)\n      }\n      // Use activeRelationTo for poly uploads, or relationTo as string for single collection\n      const collectionToUse = Array.isArray(relationTo) ? activeRelationTo : relationTo\n\n      setCollectionSlug(collectionToUse)\n      if (Array.isArray(collectionSlugsWithCreatePermission)) {\n        setSelectableCollections(collectionSlugsWithCreatePermission)\n      }\n\n      if (typeof maxRows === 'number') {\n        setMaxFiles(maxRows)\n      }\n\n      openModal(drawerSlug)\n    },\n    [\n      hasMany,\n      relationTo,\n      activeRelationTo,\n      setCollectionSlug,\n      collectionSlugsWithCreatePermission,\n      maxRows,\n      openModal,\n      drawerSlug,\n      setInitialFiles,\n      setSelectableCollections,\n      setMaxFiles,\n    ],\n  )\n\n  // only hasMany can bulk select\n  const onListBulkSelect = React.useCallback<NonNullable<ListDrawerProps['onBulkSelect']>>(\n    async (docs) => {\n      const isPoly = Array.isArray(relationTo)\n      const selectedDocIDs = []\n\n      for (const [id, isSelected] of docs) {\n        if (isSelected) {\n          selectedDocIDs.push(id)\n        }\n      }\n\n      const itemsToLoad = selectedDocIDs.map((id) => ({\n        relationTo: activeRelationTo,\n        value: id,\n      }))\n\n      const loadedDocs = await populateDocs(itemsToLoad)\n      if (loadedDocs) {\n        setPopulatedDocs((currentDocs) => [...(currentDocs || []), ...loadedDocs])\n      }\n\n      const newValues = selectedDocIDs.map((id) =>\n        isPoly ? { relationTo: activeRelationTo, value: id } : id,\n      )\n      // Normalize existing values before merging\n      const normalizedExisting = Array.isArray(value) ? value.map(normalizeValue) : []\n      onChange([...normalizedExisting, ...newValues])\n      closeListDrawer()\n    },\n    [activeRelationTo, closeListDrawer, onChange, populateDocs, value, relationTo, normalizeValue],\n  )\n\n  const onDocCreate = React.useCallback(\n    (data) => {\n      const isPoly = Array.isArray(relationTo)\n      if (data.doc) {\n        setPopulatedDocs((currentDocs) => [\n          ...(currentDocs || []),\n          {\n            relationTo: activeRelationTo,\n            value: data.doc,\n          },\n        ])\n\n        const newValue = isPoly ? { relationTo: activeRelationTo, value: data.doc.id } : data.doc.id\n        onChange(newValue)\n      }\n      closeCreateDocDrawer()\n    },\n    [closeCreateDocDrawer, activeRelationTo, onChange, relationTo],\n  )\n\n  const onListSelect = useCallback<NonNullable<ListDrawerProps['onSelect']>>(\n    async ({ collectionSlug, doc }) => {\n      const isPoly = Array.isArray(relationTo)\n\n      const loadedDocs = await populateDocs([{ relationTo: collectionSlug, value: doc.id }])\n      const selectedDoc = loadedDocs?.[0] || null\n\n      setPopulatedDocs((currentDocs) => {\n        if (selectedDoc) {\n          if (hasMany) {\n            return [...(currentDocs || []), selectedDoc]\n          }\n          return [selectedDoc]\n        }\n        return currentDocs\n      })\n\n      if (hasMany) {\n        const newValue = isPoly ? { relationTo: collectionSlug, value: doc.id } : doc.id\n        // Normalize existing values before merging\n        const normalizedExisting = Array.isArray(value) ? value.map(normalizeValue) : []\n        const valueToUse = [...normalizedExisting, newValue]\n        onChange(valueToUse)\n      } else {\n        const valueToUse = isPoly ? { relationTo: collectionSlug, value: doc.id } : doc.id\n        onChange(valueToUse)\n      }\n      closeListDrawer()\n    },\n    [closeListDrawer, hasMany, populateDocs, onChange, value, relationTo, normalizeValue],\n  )\n\n  const reloadDoc = React.useCallback<ReloadDoc>(\n    async (docID, collectionSlug) => {\n      const docs = await populateDocs([{ relationTo: collectionSlug, value: docID }])\n\n      if (docs[0]) {\n        let updatedDocsToPropogate = []\n        setPopulatedDocs((currentDocs) => {\n          const existingDocIndex = currentDocs?.findIndex((doc) => {\n            const hasExisting = doc.value?.id === docs[0].value.id || doc.value?.isPlaceholder\n            return hasExisting && doc.relationTo === collectionSlug\n          })\n          if (existingDocIndex > -1) {\n            const updatedDocs = [...currentDocs]\n            updatedDocs[existingDocIndex] = docs[0]\n            updatedDocsToPropogate = updatedDocs\n            return updatedDocs\n          }\n          return currentDocs\n        })\n\n        if (updatedDocsToPropogate.length && hasMany) {\n          onChange(updatedDocsToPropogate.map((doc) => doc.value?.id))\n        }\n      }\n    },\n    [populateDocs, onChange, hasMany],\n  )\n\n  // only hasMany can reorder\n  const onReorder = React.useCallback(\n    (newValue) => {\n      const isPoly = Array.isArray(relationTo)\n      const newValueToSave = newValue.map(({ relationTo: rel, value }) =>\n        isPoly ? { relationTo: rel, value: value.id } : value.id,\n      )\n      onChange(newValueToSave)\n      setPopulatedDocs(newValue)\n    },\n    [onChange, relationTo],\n  )\n\n  const onRemove = React.useCallback(\n    (newValue?: PopulatedDocs) => {\n      const isPoly = Array.isArray(relationTo)\n\n      if (!newValue || newValue.length === 0) {\n        onChange(hasMany ? [] : null)\n        setPopulatedDocs(hasMany ? [] : null)\n        return\n      }\n\n      const newValueToSave = newValue.map(({ relationTo: rel, value }) =>\n        isPoly ? { relationTo: rel, value: value.id } : value.id,\n      )\n\n      onChange(hasMany ? newValueToSave : newValueToSave[0])\n      setPopulatedDocs(newValue)\n    },\n    [onChange, hasMany, relationTo],\n  )\n\n  useEffect(() => {\n    async function loadInitialDocs() {\n      if (value) {\n        let itemsToLoad: ValueWithRelation[] = []\n        if (\n          Array.isArray(relationTo) &&\n          ((typeof value === 'object' && 'relationTo' in value) ||\n            (Array.isArray(value) &&\n              value.length > 0 &&\n              typeof value[0] === 'object' &&\n              'relationTo' in value[0]))\n        ) {\n          // For poly uploads, value should already be in the format { relationTo, value }\n          const values = Array.isArray(value) ? value : [value]\n          itemsToLoad = values\n            .filter((v): v is ValueWithRelation => typeof v === 'object' && 'relationTo' in v)\n            .map((v) => {\n              // Ensure the value property is a simple ID, not nested\n              let idValue: any = v.value\n              while (\n                idValue &&\n                typeof idValue === 'object' &&\n                idValue !== null &&\n                'value' in idValue\n              ) {\n                idValue = idValue.value\n              }\n              return {\n                relationTo: v.relationTo,\n                value: idValue as number | string,\n              }\n            })\n        } else {\n          // This check is here to satisfy TypeScript that relationTo is a string\n          if (!Array.isArray(relationTo)) {\n            // For single collection uploads, we need to wrap the IDs\n            const ids = Array.isArray(value) ? value : [value]\n            itemsToLoad = ids.map((id): ValueWithRelation => {\n              // Extract the actual ID, handling nested objects\n              let idValue: any = id\n              while (\n                idValue &&\n                typeof idValue === 'object' &&\n                idValue !== null &&\n                'value' in idValue\n              ) {\n                idValue = idValue.value\n              }\n              return {\n                relationTo,\n                value: idValue as number | string,\n              }\n            })\n          }\n        }\n\n        if (itemsToLoad.length > 0) {\n          const loadedDocs = await populateDocs(itemsToLoad)\n\n          if (loadedDocs) {\n            setPopulatedDocs(loadedDocs)\n            loadedValueRef.current = value\n          }\n        }\n      } else {\n        // Clear populated docs when value is cleared\n        setPopulatedDocs([])\n        loadedValueRef.current = null\n      }\n    }\n\n    // Only load if value has changed from what we last loaded\n    const valueChanged = loadedValueRef.current !== value\n    if (valueChanged) {\n      void loadInitialDocs()\n    }\n  }, [populateDocs, value, relationTo])\n\n  useEffect(() => {\n    setOnSuccess(onUploadSuccess)\n  }, [value, path, onUploadSuccess, setOnSuccess])\n\n  const showDropzone =\n    !value ||\n    (hasMany && Array.isArray(value) && (typeof maxRows !== 'number' || value.length < maxRows)) ||\n    (!hasMany && populatedDocs?.[0] && typeof populatedDocs[0].value === 'undefined')\n\n  return (\n    <div\n      className={[\n        fieldBaseClass,\n        baseClass,\n        className,\n        showError && 'error',\n        readOnly && 'read-only',\n      ]\n        .filter(Boolean)\n        .join(' ')}\n      id={`field-${path?.replace(/\\./g, '__')}`}\n      style={style}\n    >\n      <RenderCustomComponent\n        CustomComponent={Label}\n        Fallback={\n          <FieldLabel label={label} localized={localized} path={path} required={required} />\n        }\n      />\n      <div className={`${baseClass}__wrap`}>\n        <RenderCustomComponent\n          CustomComponent={Error}\n          Fallback={<FieldError path={path} showError={showError} />}\n        />\n      </div>\n      {BeforeInput}\n      <div className={`${baseClass}__dropzoneAndUpload`}>\n        {hasMany && Array.isArray(value) && value.length > 0 ? (\n          <>\n            {populatedDocs && populatedDocs?.length > 0 ? (\n              <UploadComponentHasMany\n                displayPreview={displayPreview}\n                fileDocs={populatedDocs}\n                isSortable={isSortable && !readOnly}\n                onRemove={onRemove}\n                onReorder={onReorder}\n                readonly={readOnly}\n                reloadDoc={reloadDoc}\n                serverURL={serverURL}\n                showCollectionSlug={Array.isArray(relationTo)}\n              />\n            ) : (\n              <div className={`${baseClass}__loadingRows`}>\n                {value.map((id) => (\n                  <ShimmerEffect height=\"40px\" key={typeof id === 'object' ? id.value : id} />\n                ))}\n              </div>\n            )}\n          </>\n        ) : null}\n        {!hasMany && value ? (\n          <>\n            {populatedDocs && populatedDocs?.length > 0 && populatedDocs[0].value ? (\n              <UploadComponentHasOne\n                displayPreview={displayPreview}\n                fileDoc={populatedDocs[0]}\n                onRemove={onRemove}\n                readonly={readOnly}\n                reloadDoc={reloadDoc}\n                serverURL={serverURL}\n                showCollectionSlug={Array.isArray(relationTo)}\n              />\n            ) : populatedDocs && value && !populatedDocs?.[0]?.value ? (\n              <>\n                {t('general:untitled')} - ID: {value}\n              </>\n            ) : (\n              <ShimmerEffect height=\"62px\" />\n            )}\n          </>\n        ) : null}\n        {showDropzone ? (\n          <Dropzone\n            disabled={readOnly || !canCreate}\n            multipleFiles={hasMany}\n            onChange={onLocalFileSelection}\n          >\n            <div className={`${baseClass}__dropzoneContent`}>\n              <div className={`${baseClass}__dropzoneContent__buttons`}>\n                {canCreate && (\n                  <>\n                    <Button\n                      buttonStyle=\"pill\"\n                      className={`${baseClass}__createNewToggler`}\n                      disabled={readOnly || !canCreate}\n                      onClick={() => {\n                        if (!readOnly) {\n                          if (hasMany) {\n                            onLocalFileSelection()\n                          } else {\n                            openCreateDocDrawer()\n                          }\n                        }\n                      }}\n                      size=\"small\"\n                    >\n                      {t('general:createNew')}\n                    </Button>\n                    <span className={`${baseClass}__dropzoneContent__orText`}>\n                      {t('general:or')}\n                    </span>\n                  </>\n                )}\n                <Button\n                  buttonStyle=\"pill\"\n                  className={`${baseClass}__listToggler`}\n                  disabled={readOnly}\n                  onClick={openListDrawer}\n                  size=\"small\"\n                >\n                  {t('fields:chooseFromExisting')}\n                </Button>\n                <CreateDocDrawer onSave={onDocCreate} />\n                <ListDrawer\n                  allowCreate={canCreate}\n                  enableRowSelections={hasMany}\n                  onBulkSelect={onListBulkSelect}\n                  onSelect={onListSelect}\n                />\n              </div>\n\n              {canCreate && !readOnly && (\n                <p className={`${baseClass}__dragAndDropText`}>\n                  {t('general:or')} {t('upload:dragAndDrop')}\n                </p>\n              )}\n            </div>\n          </Dropzone>\n        ) : (\n          <>\n            {!readOnly &&\n            !populatedDocs &&\n            (!value ||\n              typeof maxRows !== 'number' ||\n              (Array.isArray(value) && value.length < maxRows)) ? (\n              <ShimmerEffect height=\"40px\" />\n            ) : null}\n          </>\n        )}\n      </div>\n      {AfterInput}\n      <RenderCustomComponent\n        CustomComponent={Description}\n        Fallback={<FieldDescription description={description} path={path} />}\n      />\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]}