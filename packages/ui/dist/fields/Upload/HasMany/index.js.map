{"version":3,"file":"index.js","names":["c","_c","React","DraggableSortableItem","DraggableSortable","DragHandleIcon","RelationshipContent","UploadCard","baseClass","getBestFitFromSizes","isImage","UploadComponentHasMany","props","$","className","displayPreview","fileDocs","isSortable","onRemove","onReorder","readonly","reloadDoc","serverURL","showCollectionSlug","t0","undefined","t1","moveFromIndex","moveToIndex","updatedArray","item","splice","moveRow","t2","index","updatedArray_0","length","removeItem","t3","filter","Boolean","t4","join","t5","t6","t7","moveFromIndex_0","moveToIndex_0","t8","index_0","relationTo","value","value_0","id","String","src","thumbnailSrc","url","toString","thumbnailURL","mimeType","sizes","width","_jsx","disabled","children","draggableSortableItemProps","ref","setNodeRef","style","transform","transition","zIndex","isDragging","_jsxs","size","attributes","listeners","allowEdit","allowRemove","alt","filename","byteSize","filesize","collectionSlug","updatedAt","withMeta","x","y","height","ids","map","_temp","onDragEnd"],"sources":["../../../../src/fields/Upload/HasMany/index.tsx"],"sourcesContent":["'use client'\nimport type { JsonObject } from 'payload'\n\nimport React from 'react'\n\nimport { DraggableSortableItem } from '../../../elements/DraggableSortable/DraggableSortableItem/index.js'\nimport { DraggableSortable } from '../../../elements/DraggableSortable/index.js'\nimport { DragHandleIcon } from '../../../icons/DragHandle/index.js'\nimport { RelationshipContent } from '../RelationshipContent/index.js'\nimport { UploadCard } from '../UploadCard/index.js'\n\nconst baseClass = 'upload upload--has-many'\n\nimport { getBestFitFromSizes, isImage } from 'payload/shared'\n\nimport './index.scss'\n\nimport type { ReloadDoc } from '../types.js'\n\ntype Props = {\n  readonly className?: string\n  readonly displayPreview?: boolean\n  readonly fileDocs: {\n    relationTo: string\n    value: JsonObject\n  }[]\n  readonly isSortable?: boolean\n  readonly onRemove?: (value) => void\n  readonly onReorder?: (value) => void\n  readonly readonly?: boolean\n  readonly reloadDoc: ReloadDoc\n  readonly serverURL: string\n  readonly showCollectionSlug?: boolean\n}\n\nexport function UploadComponentHasMany(props: Props) {\n  const {\n    className,\n    displayPreview,\n    fileDocs,\n    isSortable,\n    onRemove,\n    onReorder,\n    readonly,\n    reloadDoc,\n    serverURL,\n    showCollectionSlug = false,\n  } = props\n\n  const moveRow = React.useCallback(\n    (moveFromIndex: number, moveToIndex: number) => {\n      if (moveFromIndex === moveToIndex) {\n        return\n      }\n\n      const updatedArray = [...fileDocs]\n      const [item] = updatedArray.splice(moveFromIndex, 1)\n\n      updatedArray.splice(moveToIndex, 0, item)\n\n      onReorder(updatedArray)\n    },\n    [fileDocs, onReorder],\n  )\n\n  const removeItem = React.useCallback(\n    (index: number) => {\n      const updatedArray = [...(fileDocs || [])]\n      updatedArray.splice(index, 1)\n      onRemove(updatedArray.length === 0 ? [] : updatedArray)\n    },\n    [fileDocs, onRemove],\n  )\n\n  return (\n    <div className={[baseClass, className].filter(Boolean).join(' ')}>\n      <DraggableSortable\n        className={`${baseClass}__draggable-rows`}\n        ids={fileDocs?.map(({ value }) => String(value.id))}\n        onDragEnd={({ moveFromIndex, moveToIndex }) => moveRow(moveFromIndex, moveToIndex)}\n      >\n        {fileDocs.map(({ relationTo, value }, index) => {\n          const id = String(value.id)\n          let src: string\n          let thumbnailSrc: string\n\n          if (value.url) {\n            try {\n              src = new URL(value.url, serverURL).toString()\n            } catch {\n              src = `${serverURL}${value.url}`\n            }\n          }\n\n          if (value.thumbnailURL) {\n            try {\n              thumbnailSrc = new URL(value.thumbnailURL, serverURL).toString()\n            } catch {\n              thumbnailSrc = `${serverURL}${value.thumbnailURL}`\n            }\n          }\n\n          if (isImage(value.mimeType)) {\n            thumbnailSrc = getBestFitFromSizes({\n              sizes: value.sizes,\n              thumbnailURL: thumbnailSrc,\n              url: src,\n              width: value.width,\n            })\n          }\n\n          return (\n            <DraggableSortableItem disabled={!isSortable || readonly} id={id} key={id}>\n              {(draggableSortableItemProps) => (\n                <div\n                  className={[\n                    `${baseClass}__dragItem`,\n                    draggableSortableItemProps && isSortable && `${baseClass}--has-drag-handle`,\n                  ]\n                    .filter(Boolean)\n                    .join(' ')}\n                  ref={draggableSortableItemProps.setNodeRef}\n                  style={{\n                    transform: draggableSortableItemProps.transform,\n                    transition: draggableSortableItemProps.transition,\n                    zIndex: draggableSortableItemProps.isDragging ? 1 : undefined,\n                  }}\n                >\n                  <UploadCard size=\"small\">\n                    {draggableSortableItemProps && (\n                      <div\n                        className={`${baseClass}__drag`}\n                        {...draggableSortableItemProps.attributes}\n                        {...draggableSortableItemProps.listeners}\n                      >\n                        <DragHandleIcon />\n                      </div>\n                    )}\n\n                    <RelationshipContent\n                      allowEdit={!readonly}\n                      allowRemove={!readonly}\n                      alt={(value?.alt || value?.filename) as string}\n                      byteSize={value.filesize as number}\n                      collectionSlug={relationTo}\n                      displayPreview={displayPreview}\n                      filename={value.filename as string}\n                      id={id}\n                      mimeType={value?.mimeType as string}\n                      onRemove={() => removeItem(index)}\n                      reloadDoc={reloadDoc}\n                      showCollectionSlug={showCollectionSlug}\n                      src={src}\n                      thumbnailSrc={thumbnailSrc}\n                      updatedAt={value.updatedAt}\n                      withMeta={false}\n                      x={value?.width as number}\n                      y={value?.height as number}\n                    />\n                  </UploadCard>\n                </div>\n              )}\n            </DraggableSortableItem>\n          )\n        })}\n      </DraggableSortable>\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]}