{"version":3,"file":"index.js","names":["useModal","getTranslation","useRouter","useSearchParams","formatAdminURL","mergeListSearchAndWhere","qs","React","toast","CheckboxInput","useAuth","useConfig","useLocale","useRouteCache","SelectAllStatus","useSelection","useTranslation","requests","parseSearchParams","ConfirmationModal","ListSelectionButton","confirmManyRestoreDrawerSlug","baseClass","RestoreMany","props","collection","slug","viewType","permissions","config","collections","routes","serverURL","code","locale","router","clearRouteCache","searchParams","count","getSelectedIds","selectAll","toggleAll","openModal","i18n","t","restoreAsPublished","setRestoreAsPublished","useState","collectionPermissions","hasUpdatePermission","update","None","selectingAll","AllAvailable","selectedIDs","baseWhere","where","finalWhere","and","Array","isArray","deletedAt","exists","handleRestore","collectionConfig","find","c","whereConstraint","id","in","url","apiRoute","api","path","stringify","limit","select","trash","search","addQueryPrefix","body","versions","drafts","_status","restoreManyResponse","patch","JSON","headers","language","plural","singular","labels","json","restoredDocs","docs","length","successLabel","status","success","label","errors","error","message","description","map","e","join","err","replace","page","undefined","s","labelString","_jsxs","Fragment","_jsx","className","onClick","checked","name","onToggle","target","confirmingLabel","heading","modalSlug","onConfirm"],"sources":["../../../src/elements/RestoreMany/index.tsx"],"sourcesContent":["'use client'\nimport type { ClientCollectionConfig, ViewTypes, Where } from 'payload'\n\nimport { useModal } from '@faceless-ui/modal'\nimport { getTranslation } from '@payloadcms/translations'\nimport { useRouter, useSearchParams } from 'next/navigation.js'\nimport { formatAdminURL, mergeListSearchAndWhere } from 'payload/shared'\nimport * as qs from 'qs-esm'\nimport React from 'react'\nimport { toast } from 'sonner'\n\nimport { CheckboxInput } from '../../fields/Checkbox/Input.js'\nimport { useAuth } from '../../providers/Auth/index.js'\nimport { useConfig } from '../../providers/Config/index.js'\nimport { useLocale } from '../../providers/Locale/index.js'\nimport { useRouteCache } from '../../providers/RouteCache/index.js'\nimport { SelectAllStatus, useSelection } from '../../providers/Selection/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { requests } from '../../utilities/api.js'\nimport { parseSearchParams } from '../../utilities/parseSearchParams.js'\nimport { ConfirmationModal } from '../ConfirmationModal/index.js'\nimport { ListSelectionButton } from '../ListSelection/index.js'\nimport './index.scss'\n\nconst confirmManyRestoreDrawerSlug = `confirm-restore-many-docs`\n\nconst baseClass = 'restore-many'\n\nexport type Props = {\n  collection: ClientCollectionConfig\n  viewType?: ViewTypes\n}\n\nexport const RestoreMany: React.FC<Props> = (props) => {\n  const { collection: { slug } = {}, viewType } = props\n\n  const { permissions } = useAuth()\n  const {\n    config: { collections, routes, serverURL },\n  } = useConfig()\n  const { code: locale } = useLocale()\n  const router = useRouter()\n  const { clearRouteCache } = useRouteCache()\n  const searchParams = useSearchParams()\n  const { count, getSelectedIds, selectAll, toggleAll } = useSelection()\n  const { openModal } = useModal()\n\n  const { i18n, t } = useTranslation()\n\n  const [restoreAsPublished, setRestoreAsPublished] = React.useState(false)\n\n  const collectionPermissions = permissions?.collections?.[slug]\n  const hasUpdatePermission = collectionPermissions?.update\n\n  if (selectAll === SelectAllStatus.None || !hasUpdatePermission || viewType !== 'trash') {\n    return null\n  }\n\n  const selectingAll = selectAll === SelectAllStatus.AllAvailable\n  const selectedIDs = !selectingAll ? getSelectedIds() : []\n\n  const baseWhere = parseSearchParams(searchParams)?.where as Where\n\n  const finalWhere = {\n    and: [\n      ...(Array.isArray(baseWhere?.and) ? baseWhere.and : baseWhere ? [baseWhere] : []),\n      { deletedAt: { exists: true } },\n    ],\n  }\n\n  const handleRestore = async () => {\n    const collectionConfig = collections.find((c) => c.slug === slug)\n    if (!collectionConfig) {\n      return\n    }\n\n    let whereConstraint: Where\n\n    if (selectingAll) {\n      whereConstraint = finalWhere\n    } else {\n      whereConstraint = {\n        and: [{ id: { in: selectedIDs } }, { deletedAt: { exists: true } }],\n      }\n    }\n\n    const url = formatAdminURL({\n      apiRoute: routes.api,\n      path: `/${slug}${qs.stringify(\n        {\n          limit: 0,\n          locale,\n          select: {},\n          trash: true, // Ensure trashed docs are returned\n          where: mergeListSearchAndWhere({\n            collectionConfig,\n            search: parseSearchParams(searchParams)?.search as string,\n            where: whereConstraint,\n          }),\n        },\n        { addQueryPrefix: true },\n      )}`,\n    })\n\n    const body: Record<string, unknown> = {\n      deletedAt: null,\n    }\n\n    // Only include _status if drafts are enabled\n    if (collectionConfig?.versions?.drafts) {\n      body._status = restoreAsPublished ? 'published' : 'draft'\n    }\n\n    const restoreManyResponse = await requests.patch(url, {\n      body: JSON.stringify(body),\n      headers: {\n        'Accept-Language': i18n.language,\n        'Content-Type': 'application/json',\n      },\n    })\n\n    try {\n      const { plural, singular } = collectionConfig.labels\n      const json = await restoreManyResponse.json()\n\n      const restoredDocs = json?.docs?.length || 0\n      const successLabel = restoredDocs > 1 ? plural : singular\n\n      if (restoreManyResponse.status < 400 || restoredDocs > 0) {\n        toast.success(\n          t('general:restoredCountSuccessfully', {\n            count: restoredDocs,\n            label: getTranslation(successLabel, i18n),\n          }),\n        )\n      }\n\n      if (json?.errors?.length > 0) {\n        toast.error(json.message, {\n          description: json.errors.map((e) => e.message).join('\\n'),\n        })\n      }\n    } catch (err) {\n      toast.error(t('error:unknown'))\n    }\n\n    toggleAll()\n\n    router.replace(\n      qs.stringify(\n        {\n          ...parseSearchParams(searchParams),\n          page: selectingAll ? '1' : undefined,\n        },\n        { addQueryPrefix: true },\n      ),\n    )\n\n    clearRouteCache()\n  }\n\n  const collectionConfig = collections.find(({ slug: s }) => s === slug)\n\n  const labelString = getTranslation(\n    count === 1 ? collectionConfig.labels.singular : collectionConfig.labels.plural,\n    i18n,\n  )\n\n  return (\n    <React.Fragment>\n      <ListSelectionButton\n        aria-label={t('general:restore')}\n        className=\"restore-documents__toggle\"\n        onClick={() => {\n          openModal(confirmManyRestoreDrawerSlug)\n        }}\n      >\n        {t('general:restore')}\n      </ListSelectionButton>\n      <ConfirmationModal\n        body={\n          <React.Fragment>\n            {t(\n              collectionConfig?.versions?.drafts\n                ? 'general:aboutToRestoreAsDraftCount'\n                : 'general:aboutToRestoreCount',\n              {\n                count,\n                label: labelString,\n              },\n            )}\n            {collectionConfig?.versions?.drafts && (\n              <div className={`${baseClass}__checkbox`}>\n                <CheckboxInput\n                  checked={restoreAsPublished}\n                  id=\"restore-as-published-many\"\n                  label={t('general:restoreAsPublished')}\n                  name=\"restore-as-published-many\"\n                  onToggle={(e) => setRestoreAsPublished(e.target.checked)}\n                />\n              </div>\n            )}\n          </React.Fragment>\n        }\n        className={baseClass}\n        confirmingLabel={t('general:restoring')}\n        heading={t('general:confirmRestoration')}\n        modalSlug={confirmManyRestoreDrawerSlug}\n        onConfirm={handleRestore}\n      />\n    </React.Fragment>\n  )\n}\n"],"mappings":"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","ignoreList":[]}