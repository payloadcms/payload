{"version":3,"file":"index.js","names":["formatAdminURL","qs","React","useCallback","useEffect","useReducer","useState","useDebounce","useEffectEvent","useConfig","useLocale","useTranslation","ReactSelect","optionsReducer","baseClass","maxResultsPerRequest","RelationshipFilter","props","disabled","field","admin","hasMany","relationTo","filterOptions","onChange","value","placeholder","undefined","isSortable","config","routes","api","getEntityConfig","hasMultipleRelations","Array","isArray","options","dispatchOptions","search","setSearch","debouncedSearch","errorLoading","setErrorLoading","hasLoadedFirstOptions","setHasLoadedFirstOptions","i18n","t","locale","relationSlugs","loadedRelationships","useRef","Map","map","relation","hasLoadedAll","nextPage","addOptions","data","collection","collectionSlug","type","loadOptions","abortController","relationSlug","loadedRelationship","current","get","fieldToSearch","useAsTitle","where","and","query","depth","limit","code","page","select","push","like","response","fetch","apiRoute","path","stringify","addQueryPrefix","credentials","headers","language","signal","ok","json","docs","length","set","e","aborted","console","error","handleScrollToBottom","relationshipToLoad","entries","next","AbortController","findOptionsByValue","val","matchedOption","forEach","opt","some","subOpt","find","valueWithRelation","handleInputChange","input","required","addOptionByID","id","relations","abortControllers","controller","abort","_err","matchedOptions","option","i","classes","filter","Boolean","join","valueToRender","_jsx","className","isMulti","selected","onInputChange","onMenuScrollToBottom"],"sources":["../../../../../src/elements/WhereBuilder/Condition/Relationship/index.tsx"],"sourcesContent":["'use client'\nimport type { PaginatedDocs, Where } from 'payload'\n\nimport { formatAdminURL } from 'payload/shared'\nimport * as qs from 'qs-esm'\nimport React, { useCallback, useEffect, useReducer, useState } from 'react'\n\nimport type { Option } from '../../../ReactSelect/types.js'\nimport type { RelationshipFilterProps as Props, ValueWithRelation } from './types.js'\n\nimport { useDebounce } from '../../../../hooks/useDebounce.js'\nimport { useEffectEvent } from '../../../../hooks/useEffectEvent.js'\nimport { useConfig } from '../../../../providers/Config/index.js'\nimport { useLocale } from '../../../../providers/Locale/index.js'\nimport { useTranslation } from '../../../../providers/Translation/index.js'\nimport { ReactSelect } from '../../../ReactSelect/index.js'\nimport './index.scss'\nimport optionsReducer from './optionsReducer.js'\n\nconst baseClass = 'condition-value-relationship'\n\nconst maxResultsPerRequest = 10\n\nexport const RelationshipFilter: React.FC<Props> = (props) => {\n  const {\n    disabled,\n    field: { admin = {}, hasMany, relationTo },\n    filterOptions,\n    onChange,\n    value,\n  } = props\n\n  const placeholder = 'placeholder' in admin ? admin?.placeholder : undefined\n  const isSortable = admin?.isSortable\n\n  const {\n    config: {\n      routes: { api },\n    },\n    getEntityConfig,\n  } = useConfig()\n\n  const hasMultipleRelations = Array.isArray(relationTo)\n  const [options, dispatchOptions] = useReducer(optionsReducer, [])\n  const [search, setSearch] = useState('')\n  const debouncedSearch = useDebounce(search, 300)\n  const [errorLoading, setErrorLoading] = useState('')\n  const [hasLoadedFirstOptions, setHasLoadedFirstOptions] = useState(false)\n  const { i18n, t } = useTranslation()\n  const locale = useLocale()\n\n  const relationSlugs = hasMultipleRelations ? relationTo : [relationTo]\n\n  const loadedRelationships = React.useRef<\n    Map<\n      string,\n      {\n        hasLoadedAll: boolean\n        nextPage: number\n      }\n    >\n  >(\n    new Map(\n      relationSlugs.map((relation) => [\n        relation,\n        {\n          hasLoadedAll: false,\n          nextPage: 1,\n        },\n      ]),\n    ),\n  )\n\n  const addOptions = useCallback(\n    (data, relation) => {\n      const collection = getEntityConfig({ collectionSlug: relation })\n      dispatchOptions({ type: 'ADD', collection, data, hasMultipleRelations, i18n, relation })\n    },\n    [hasMultipleRelations, i18n, getEntityConfig],\n  )\n\n  const loadOptions = useEffectEvent(\n    async ({\n      abortController,\n      relationSlug,\n    }: {\n      abortController: AbortController\n      relationSlug: string\n    }) => {\n      const loadedRelationship = loadedRelationships.current.get(relationSlug)\n\n      if (relationSlug && !loadedRelationship.hasLoadedAll) {\n        const collection = getEntityConfig({\n          collectionSlug: relationSlug,\n        })\n\n        const fieldToSearch = collection?.admin?.useAsTitle || 'id'\n\n        const where: Where = {\n          and: [],\n        }\n\n        const query = {\n          depth: 0,\n          limit: maxResultsPerRequest,\n          locale: locale.code,\n          page: loadedRelationship.nextPage,\n          select: {\n            [fieldToSearch]: true,\n          },\n          where,\n        }\n\n        if (filterOptions && filterOptions?.[relationSlug]) {\n          query.where.and.push(filterOptions[relationSlug])\n        }\n\n        if (debouncedSearch) {\n          query.where.and.push({\n            [fieldToSearch]: {\n              like: debouncedSearch,\n            },\n          })\n        }\n\n        try {\n          const response = await fetch(\n            formatAdminURL({\n              apiRoute: api,\n              path: `/${relationSlug}${qs.stringify(query, { addQueryPrefix: true })}`,\n            }),\n            {\n              credentials: 'include',\n              headers: {\n                'Accept-Language': i18n.language,\n              },\n              signal: abortController.signal,\n            },\n          )\n\n          if (response.ok) {\n            const data: PaginatedDocs = await response.json()\n            if (data.docs.length > 0) {\n              addOptions(data, relationSlug)\n\n              if (data.nextPage) {\n                loadedRelationships.current.set(relationSlug, {\n                  hasLoadedAll: false,\n                  nextPage: data.nextPage,\n                })\n              } else {\n                loadedRelationships.current.set(relationSlug, {\n                  hasLoadedAll: true,\n                  nextPage: null,\n                })\n              }\n            }\n          } else {\n            setErrorLoading(t('error:unspecific'))\n          }\n        } catch (e) {\n          if (!abortController.signal.aborted) {\n            console.error(e) // eslint-disable-line no-console\n          }\n        }\n      }\n\n      setHasLoadedFirstOptions(true)\n    },\n  )\n\n  const handleScrollToBottom = React.useCallback(() => {\n    const relationshipToLoad = loadedRelationships.current.entries().next().value\n\n    if (relationshipToLoad[0] && !relationshipToLoad[1].hasLoadedAll) {\n      const abortController = new AbortController()\n\n      void loadOptions({\n        abortController,\n        relationSlug: relationshipToLoad[0],\n      })\n    }\n  }, [])\n\n  const findOptionsByValue = useCallback((): Option | Option[] => {\n    if (value) {\n      if (hasMany) {\n        if (Array.isArray(value)) {\n          return value.map((val) => {\n            if (hasMultipleRelations) {\n              let matchedOption: Option\n\n              options.forEach((opt) => {\n                if (opt.options) {\n                  opt.options.some((subOpt) => {\n                    if (subOpt?.value == val.value) {\n                      matchedOption = subOpt\n                      return true\n                    }\n\n                    return false\n                  })\n                }\n              })\n\n              return matchedOption\n            }\n\n            return options.find((opt) => opt.value == val)\n          })\n        }\n\n        return undefined\n      }\n\n      if (hasMultipleRelations) {\n        let matchedOption: Option\n\n        const valueWithRelation = value as ValueWithRelation\n\n        options.forEach((opt) => {\n          if (opt?.options) {\n            opt.options.some((subOpt) => {\n              if (subOpt?.value == valueWithRelation.value) {\n                matchedOption = subOpt\n                return true\n              }\n              return false\n            })\n          }\n        })\n\n        return matchedOption\n      }\n\n      return options.find((opt) => opt.value == value)\n    }\n\n    return undefined\n  }, [hasMany, hasMultipleRelations, value, options])\n\n  const handleInputChange = useCallback(\n    (input: string) => {\n      if (input !== search) {\n        dispatchOptions({ type: 'CLEAR', i18n, required: false })\n\n        const relationSlugs = Array.isArray(relationTo) ? relationTo : [relationTo]\n\n        loadedRelationships.current = new Map(\n          relationSlugs.map((relation) => [\n            relation,\n            {\n              hasLoadedAll: false,\n              nextPage: 1,\n            },\n          ]),\n        )\n\n        setSearch(input)\n      }\n    },\n    [i18n, relationTo, search],\n  )\n\n  const addOptionByID = useCallback(\n    async (id, relation) => {\n      if (!errorLoading && id !== 'null' && id && relation) {\n        const response = await fetch(\n          formatAdminURL({ apiRoute: api, path: `/${relation}/${id}?depth=0` }),\n          {\n            credentials: 'include',\n            headers: {\n              'Accept-Language': i18n.language,\n            },\n          },\n        )\n\n        if (response.ok) {\n          const data = await response.json()\n          addOptions({ docs: [data] }, relation)\n        } else {\n          // eslint-disable-next-line no-console\n          console.error(t('error:loadingDocument', { id }))\n        }\n      }\n    },\n    [i18n, addOptions, api, errorLoading, t],\n  )\n\n  /**\n   * When `relationTo` changes externally, reset the options and reload them from scratch\n   * The `loadOptions` dependency is a useEffectEvent which has no dependencies of its own\n   * This means we can safely depend on it without it triggering this effect to run\n   * This is useful because this effect should _only_ run when `relationTo` changes\n   */\n  useEffect(() => {\n    const relations = Array.isArray(relationTo) ? relationTo : [relationTo]\n\n    loadedRelationships.current = new Map(\n      relations.map((relation) => [\n        relation,\n        {\n          hasLoadedAll: false,\n          nextPage: 1,\n        },\n      ]),\n    )\n\n    dispatchOptions({ type: 'CLEAR', i18n, required: false })\n    setHasLoadedFirstOptions(false)\n\n    const abortControllers: AbortController[] = []\n\n    relations.forEach((relation) => {\n      const abortController = new AbortController()\n\n      void loadOptions({\n        abortController,\n        relationSlug: relation,\n      })\n\n      abortControllers.push(abortController)\n    })\n\n    return () => {\n      abortControllers.forEach((controller) => {\n        if (controller.signal) {\n          try {\n            controller.abort()\n          } catch (_err) {\n            // swallow error\n          }\n        }\n      })\n    }\n  }, [i18n, relationTo, debouncedSearch, filterOptions])\n\n  /**\n   * Load any other options that might exist in the value that were not loaded already\n   */\n  useEffect(() => {\n    if (value && hasLoadedFirstOptions) {\n      if (hasMany) {\n        const matchedOptions = findOptionsByValue()\n\n        ;((matchedOptions as Option[]) || []).forEach((option, i) => {\n          if (!option) {\n            if (hasMultipleRelations) {\n              void addOptionByID(value[i].value, value[i].relationTo)\n            } else {\n              void addOptionByID(value[i], relationTo)\n            }\n          }\n        })\n      } else {\n        const matchedOption = findOptionsByValue()\n\n        if (!matchedOption) {\n          if (hasMultipleRelations) {\n            const valueWithRelation = value as ValueWithRelation\n            void addOptionByID(valueWithRelation.value, valueWithRelation.relationTo)\n          } else {\n            void addOptionByID(value, relationTo)\n          }\n        }\n      }\n    }\n  }, [\n    addOptionByID,\n    findOptionsByValue,\n    hasMany,\n    hasMultipleRelations,\n    relationTo,\n    value,\n    hasLoadedFirstOptions,\n  ])\n\n  const classes = ['field-type', baseClass, errorLoading && 'error-loading']\n    .filter(Boolean)\n    .join(' ')\n\n  const valueToRender = (findOptionsByValue() || value) as Option\n\n  return (\n    <div className={classes}>\n      {errorLoading ? (\n        <div className={`${baseClass}__error-loading`}>{errorLoading}</div>\n      ) : (\n        <ReactSelect\n          disabled={disabled}\n          isMulti={hasMany}\n          isSortable={isSortable}\n          onChange={(selected) => {\n            if (!selected) {\n              onChange(null)\n              return\n            }\n\n            if (hasMany && Array.isArray(selected)) {\n              onChange(\n                selected\n                  ? selected.map((option) => {\n                      if (hasMultipleRelations) {\n                        return {\n                          relationTo: option?.relationTo,\n                          value: option?.value,\n                        }\n                      }\n\n                      return option?.value\n                    })\n                  : null,\n              )\n            } else if (hasMultipleRelations && !Array.isArray(selected)) {\n              onChange({\n                relationTo: selected?.relationTo,\n                value: selected?.value,\n              })\n            } else if (!Array.isArray(selected)) {\n              onChange(selected?.value)\n            }\n          }}\n          onInputChange={handleInputChange}\n          onMenuScrollToBottom={handleScrollToBottom}\n          options={options}\n          placeholder={placeholder}\n          value={valueToRender}\n        />\n      )}\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]}