{"version":3,"file":"index.js","names":["useModal","getTranslation","useRouter","formatAdminURL","React","Fragment","useCallback","useState","toast","CheckboxInput","useForm","useConfig","useDocumentTitle","useRouteTransition","useTranslation","requests","ConfirmationModal","PopupList","Translation","baseClass","DeleteDocument","props","id","buttonId","collectionSlug","onDelete","redirectAfterDelete","singularLabel","title","titleFromProps","config","routes","admin","adminRoute","api","getEntityConfig","collectionConfig","setModified","router","i18n","t","startRouteTransition","openModal","modalSlug","deletePermanently","setDeletePermanently","addDefaultError","error","handleDelete","url","apiRoute","path","res","trash","delete","headers","language","patch","body","JSON","stringify","deletedAt","Date","toISOString","json","status","success","label","message","push","errors","forEach","_err","_jsxs","_jsx","Button","onClick","elements","1","children","i18nKey","variables","className","checked","name","onToggle","e","target","confirmingLabel","heading","onConfirm"],"sources":["../../../src/elements/DeleteDocument/index.tsx"],"sourcesContent":["'use client'\nimport type { SanitizedCollectionConfig } from 'payload'\n\nimport { useModal } from '@faceless-ui/modal'\nimport { getTranslation } from '@payloadcms/translations'\nimport { useRouter } from 'next/navigation.js'\nimport { formatAdminURL } from 'payload/shared'\nimport React, { Fragment, useCallback, useState } from 'react'\nimport { toast } from 'sonner'\n\nimport type { DocumentDrawerContextType } from '../DocumentDrawer/Provider.js'\n\nimport { CheckboxInput } from '../../fields/Checkbox/Input.js'\nimport { useForm } from '../../forms/Form/context.js'\nimport { useConfig } from '../../providers/Config/index.js'\nimport { useDocumentTitle } from '../../providers/DocumentTitle/index.js'\nimport { useRouteTransition } from '../../providers/RouteTransition/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { requests } from '../../utilities/api.js'\nimport { ConfirmationModal } from '../ConfirmationModal/index.js'\nimport { PopupList } from '../Popup/index.js'\nimport { Translation } from '../Translation/index.js'\nimport './index.scss'\n\nconst baseClass = 'delete-document'\n\nexport type Props = {\n  readonly buttonId?: string\n  readonly collectionSlug: SanitizedCollectionConfig['slug']\n  readonly id?: string\n  readonly onDelete?: DocumentDrawerContextType['onDelete']\n  readonly redirectAfterDelete?: boolean\n  readonly singularLabel: SanitizedCollectionConfig['labels']['singular']\n  readonly title?: string\n  readonly useAsTitle: SanitizedCollectionConfig['admin']['useAsTitle']\n}\n\nexport const DeleteDocument: React.FC<Props> = (props) => {\n  const {\n    id,\n    buttonId,\n    collectionSlug,\n    onDelete,\n    redirectAfterDelete = true,\n    singularLabel,\n    title: titleFromProps,\n  } = props\n\n  const {\n    config: {\n      routes: { admin: adminRoute, api },\n    },\n    getEntityConfig,\n  } = useConfig()\n\n  const collectionConfig = getEntityConfig({ collectionSlug })\n\n  const { setModified } = useForm()\n  const router = useRouter()\n  const { i18n, t } = useTranslation()\n  const { title } = useDocumentTitle()\n  const { startRouteTransition } = useRouteTransition()\n  const { openModal } = useModal()\n\n  const modalSlug = `delete-${id}`\n\n  const [deletePermanently, setDeletePermanently] = useState(false)\n\n  const addDefaultError = useCallback(() => {\n    toast.error(t('error:deletingTitle', { title }))\n  }, [t, title])\n\n  const handleDelete = useCallback(async () => {\n    setModified(false)\n\n    try {\n      const url = formatAdminURL({\n        apiRoute: api,\n        path: `/${collectionSlug}/${id}`,\n      })\n      const res =\n        deletePermanently || !collectionConfig.trash\n          ? await requests.delete(url, {\n              headers: {\n                'Accept-Language': i18n.language,\n                'Content-Type': 'application/json',\n              },\n            })\n          : await requests.patch(url, {\n              body: JSON.stringify({\n                deletedAt: new Date().toISOString(),\n              }),\n              headers: {\n                'Accept-Language': i18n.language,\n                'Content-Type': 'application/json',\n              },\n            })\n\n      const json = await res.json()\n\n      if (res.status < 400) {\n        toast.success(\n          t(\n            deletePermanently || !collectionConfig.trash\n              ? 'general:titleDeleted'\n              : 'general:titleTrashed',\n            {\n              label: getTranslation(singularLabel, i18n),\n              title,\n            },\n          ) || json.message,\n        )\n\n        if (redirectAfterDelete) {\n          return startRouteTransition(() =>\n            router.push(formatAdminURL({ adminRoute, path: `/collections/${collectionSlug}` })),\n          )\n        }\n\n        if (typeof onDelete === 'function') {\n          await onDelete({ id, collectionConfig })\n        }\n\n        return\n      }\n\n      if (json.errors) {\n        json.errors.forEach((error) => toast.error(error.message))\n      } else {\n        addDefaultError()\n      }\n\n      return\n    } catch (_err) {\n      return addDefaultError()\n    }\n  }, [\n    deletePermanently,\n    setModified,\n\n    api,\n    collectionSlug,\n    id,\n    t,\n    singularLabel,\n    addDefaultError,\n    i18n,\n    title,\n    router,\n    adminRoute,\n    redirectAfterDelete,\n    onDelete,\n    collectionConfig,\n    startRouteTransition,\n  ])\n\n  if (id) {\n    return (\n      <Fragment>\n        <PopupList.Button\n          id={buttonId}\n          onClick={() => {\n            openModal(modalSlug)\n          }}\n        >\n          {t('general:delete')}\n        </PopupList.Button>\n        <ConfirmationModal\n          body={\n            <Fragment>\n              <Translation\n                elements={{\n                  '1': ({ children }) => <strong>{children}</strong>,\n                }}\n                i18nKey={collectionConfig.trash ? 'general:aboutToTrash' : 'general:aboutToDelete'}\n                t={t}\n                variables={{\n                  label: getTranslation(singularLabel, i18n),\n                  title: titleFromProps || title || id,\n                }}\n              />\n              {collectionConfig.trash && (\n                <div className={`${baseClass}__checkbox`}>\n                  <CheckboxInput\n                    checked={deletePermanently}\n                    id=\"delete-forever\"\n                    label={t('general:deletePermanently')}\n                    name=\"delete-forever\"\n                    onToggle={(e) => setDeletePermanently(e.target.checked)}\n                  />\n                </div>\n              )}\n            </Fragment>\n          }\n          className={baseClass}\n          confirmingLabel={t('general:deleting')}\n          heading={t('general:confirmDeletion')}\n          modalSlug={modalSlug}\n          onConfirm={handleDelete}\n        />\n      </Fragment>\n    )\n  }\n\n  return null\n}\n"],"mappings":"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","ignoreList":[]}