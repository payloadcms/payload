{"version":3,"file":"index.js","names":["useModal","usePathname","useRouter","formatAdminURL","qs","React","createContext","use","useCallback","useEffect","useState","toast","stayLoggedInModalSlug","useEffectEvent","useTranslation","requests","useConfig","useRouteTransition","Context","maxTimeoutMs","AuthProvider","children","permissions","initialPermissions","user","initialUser","pathname","router","config","admin","autoLogin","autoRefresh","routes","inactivity","logoutInactivityRoute","userSlug","adminRoute","api","apiRoute","i18n","closeAllModals","openModal","startRouteTransition","setUserInMemory","tokenInMemory","setTokenInMemory","tokenExpirationMs","setTokenExpirationMs","setPermissions","forceLogoutBufferMs","setForceLogoutBufferMs","fetchedUserOnMount","setFetchedUserOnMount","refreshTokenTimeoutRef","useRef","reminderTimeoutRef","forceLogOutTimeoutRef","id","redirectToInactivityRoute","baseAdminRoute","path","replace","window","location","startsWith","encodeURIComponent","revokeTokenAndExpire","undefined","clearTimeout","current","handleReminderTimeout","refreshCookieEvent","setNewUser","userResponse","token","exp","expiresInMs","Math","max","min","Date","now","nextForceLogoutBufferMs","setTimeout","refreshCookie","forceRefresh","request","post","headers","language","status","json","e","error","message","refreshCookieAsync","skipSetUser","logOut","collection","_","refreshPermissions","locale","params","stringify","addQueryPrefix","get","Error","fetchFullUser","credentials","fetchFullUserEvent","fetchUserOnMount","prefillOnly","_jsx","value","setUser","useAuth"],"sources":["../../../src/providers/Auth/index.tsx"],"sourcesContent":["'use client'\nimport type { ClientUser, SanitizedPermissions, TypedUser } from 'payload'\n\nimport { useModal } from '@faceless-ui/modal'\nimport { usePathname, useRouter } from 'next/navigation.js'\nimport { formatAdminURL } from 'payload/shared'\nimport * as qs from 'qs-esm'\nimport React, { createContext, use, useCallback, useEffect, useState } from 'react'\nimport { toast } from 'sonner'\n\nimport { stayLoggedInModalSlug } from '../../elements/StayLoggedIn/index.js'\nimport { useEffectEvent } from '../../hooks/useEffectEvent.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { requests } from '../../utilities/api.js'\nimport { useConfig } from '../Config/index.js'\nimport { useRouteTransition } from '../RouteTransition/index.js'\n\nexport type UserWithToken<T = ClientUser> = {\n  /** seconds until expiration */\n  exp: number\n  token: string\n  user: T\n}\n\nexport type AuthContext<T = ClientUser> = {\n  fetchFullUser: () => Promise<null | TypedUser>\n  logOut: () => Promise<boolean>\n  /**\n   * These are the permissions for the current user from a global scope.\n   *\n   * When checking for permissions on document specific level, use the `useDocumentInfo` hook instead.\n   *\n   * @example\n   *\n   * ```tsx\n   * import { useAuth } from 'payload/ui'\n   *\n   * const MyComponent: React.FC = () => {\n   *   const { permissions } = useAuth()\n   *\n   *   if (permissions?.collections?.myCollection?.create) {\n   *     // user can create documents in 'myCollection'\n   *   }\n   *\n   *   return null\n   * }\n   * ```\n   *\n   * with useDocumentInfo:\n   *\n   * ```tsx\n   * import { useDocumentInfo } from 'payload/ui'\n   *\n   * const MyComponent: React.FC = () => {\n   *  const { docPermissions } = useDocumentInfo()\n   *  if (docPermissions?.create) {\n   *   // user can create this document\n   *  }\n   *  return null\n   * } ```\n   */\n  permissions?: SanitizedPermissions\n  refreshCookie: (forceRefresh?: boolean) => void\n  refreshCookieAsync: () => Promise<ClientUser>\n  refreshPermissions: () => Promise<void>\n  setPermissions: (permissions: SanitizedPermissions) => void\n  setUser: (user: null | UserWithToken<T>) => void\n  strategy?: string\n  token?: string\n  tokenExpirationMs?: number\n  user?: null | T\n}\n\nconst Context = createContext({} as AuthContext)\n\nconst maxTimeoutMs = 2147483647\n\ntype Props = {\n  children: React.ReactNode\n  permissions?: SanitizedPermissions\n  user?: ClientUser | null\n}\n\nexport function AuthProvider({\n  children,\n  permissions: initialPermissions,\n  user: initialUser,\n}: Props) {\n  const pathname = usePathname()\n  const router = useRouter()\n\n  const { config } = useConfig()\n\n  const {\n    admin: {\n      autoLogin,\n      autoRefresh,\n      routes: { inactivity: logoutInactivityRoute },\n      user: userSlug,\n    },\n    routes: { admin: adminRoute, api: apiRoute },\n  } = config\n\n  const { i18n } = useTranslation()\n  const { closeAllModals, openModal } = useModal()\n  const { startRouteTransition } = useRouteTransition()\n\n  const [user, setUserInMemory] = useState<ClientUser | null>(initialUser)\n  const [tokenInMemory, setTokenInMemory] = useState<string>()\n  const [tokenExpirationMs, setTokenExpirationMs] = useState<number>()\n  const [permissions, setPermissions] = useState<SanitizedPermissions>(initialPermissions)\n  const [forceLogoutBufferMs, setForceLogoutBufferMs] = useState<number>(120_000)\n  const [fetchedUserOnMount, setFetchedUserOnMount] = useState(false)\n\n  const refreshTokenTimeoutRef = React.useRef<ReturnType<typeof setTimeout>>(null)\n  const reminderTimeoutRef = React.useRef<ReturnType<typeof setTimeout>>(null)\n  const forceLogOutTimeoutRef = React.useRef<ReturnType<typeof setTimeout>>(null)\n\n  const id = user?.id\n\n  const redirectToInactivityRoute = useCallback(() => {\n    const baseAdminRoute = formatAdminURL({ adminRoute, path: '' })\n    startRouteTransition(() =>\n      router.replace(\n        formatAdminURL({\n          adminRoute,\n          path: `${logoutInactivityRoute}${window.location.pathname.startsWith(baseAdminRoute) ? `?redirect=${encodeURIComponent(window.location.pathname)}` : ''}`,\n        }),\n      ),\n    )\n\n    closeAllModals()\n  }, [router, adminRoute, logoutInactivityRoute, closeAllModals, startRouteTransition])\n\n  const revokeTokenAndExpire = useCallback(() => {\n    setUserInMemory(null)\n    setTokenInMemory(undefined)\n    setTokenExpirationMs(undefined)\n    clearTimeout(refreshTokenTimeoutRef.current)\n  }, [])\n\n  // Handler for reminder timeout - uses useEffectEvent to capture latest autoRefresh value\n  const handleReminderTimeout = useEffectEvent(() => {\n    if (autoRefresh) {\n      refreshCookieEvent()\n    } else {\n      openModal(stayLoggedInModalSlug)\n    }\n  })\n\n  const setNewUser = useCallback(\n    (userResponse: null | UserWithToken) => {\n      clearTimeout(reminderTimeoutRef.current)\n      clearTimeout(forceLogOutTimeoutRef.current)\n\n      if (userResponse?.user) {\n        setUserInMemory(userResponse.user)\n        setTokenInMemory(userResponse.token)\n        setTokenExpirationMs(userResponse.exp * 1000)\n\n        const expiresInMs = Math.max(\n          0,\n          Math.min((userResponse.exp ?? 0) * 1000 - Date.now(), maxTimeoutMs),\n        )\n\n        if (expiresInMs) {\n          const nextForceLogoutBufferMs = Math.min(60_000, expiresInMs / 2)\n          setForceLogoutBufferMs(nextForceLogoutBufferMs)\n\n          reminderTimeoutRef.current = setTimeout(\n            handleReminderTimeout,\n            Math.max(expiresInMs - nextForceLogoutBufferMs, 0),\n          )\n\n          forceLogOutTimeoutRef.current = setTimeout(() => {\n            revokeTokenAndExpire()\n            redirectToInactivityRoute()\n          }, expiresInMs)\n        }\n      } else {\n        revokeTokenAndExpire()\n      }\n    },\n    [redirectToInactivityRoute, revokeTokenAndExpire],\n  )\n\n  const refreshCookie = useCallback(\n    (forceRefresh?: boolean) => {\n      if (!id) {\n        return\n      }\n\n      const expiresInMs = Math.max(0, (tokenExpirationMs ?? 0) - Date.now())\n\n      if (forceRefresh || (tokenExpirationMs && expiresInMs < forceLogoutBufferMs * 2)) {\n        clearTimeout(refreshTokenTimeoutRef.current)\n        refreshTokenTimeoutRef.current = setTimeout(async () => {\n          try {\n            const request = await requests.post(\n              formatAdminURL({\n                apiRoute,\n                path: `/${userSlug}/refresh-token?refresh`,\n              }),\n              {\n                headers: {\n                  'Accept-Language': i18n.language,\n                },\n              },\n            )\n\n            if (request.status === 200) {\n              const json: UserWithToken = await request.json()\n              setNewUser(json)\n            } else {\n              setNewUser(null)\n              redirectToInactivityRoute()\n            }\n          } catch (e) {\n            toast.error(e.message)\n          }\n        }, 1000)\n      }\n    },\n    [\n      apiRoute,\n      i18n.language,\n      redirectToInactivityRoute,\n      setNewUser,\n      tokenExpirationMs,\n      userSlug,\n      forceLogoutBufferMs,\n      id,\n    ],\n  )\n\n  const refreshCookieAsync = useCallback(\n    async (skipSetUser?: boolean): Promise<ClientUser> => {\n      try {\n        const request = await requests.post(\n          formatAdminURL({\n            apiRoute,\n            path: `/${userSlug}/refresh-token`,\n          }),\n          {\n            headers: {\n              'Accept-Language': i18n.language,\n            },\n          },\n        )\n\n        if (request.status === 200) {\n          const json: UserWithToken = await request.json()\n          if (!skipSetUser) {\n            setNewUser(json)\n          }\n          return json.user\n        }\n\n        if (user) {\n          setNewUser(null)\n          redirectToInactivityRoute()\n        }\n      } catch (e) {\n        toast.error(`Refreshing token failed: ${e.message}`)\n      }\n      return null\n    },\n    [apiRoute, i18n.language, redirectToInactivityRoute, setNewUser, userSlug, user],\n  )\n\n  const logOut = useCallback(async () => {\n    try {\n      if (user && user.collection) {\n        setNewUser(null)\n        await requests.post(\n          formatAdminURL({\n            apiRoute,\n            path: `/${user.collection}/logout`,\n          }),\n        )\n      }\n    } catch (_) {\n      // fail silently and log the user out in state\n    }\n\n    return true\n  }, [apiRoute, setNewUser, user])\n\n  const refreshPermissions = useCallback(\n    async ({ locale }: { locale?: string } = {}) => {\n      const params = qs.stringify(\n        {\n          locale,\n        },\n        {\n          addQueryPrefix: true,\n        },\n      )\n\n      try {\n        const request = await requests.get(\n          formatAdminURL({\n            apiRoute,\n            path: `/access${params}`,\n          }),\n          {\n            headers: {\n              'Accept-Language': i18n.language,\n            },\n          },\n        )\n\n        if (request.status === 200) {\n          const json: SanitizedPermissions = await request.json()\n          setPermissions(json)\n        } else {\n          throw new Error(`Fetching permissions failed with status code ${request.status}`)\n        }\n      } catch (e) {\n        toast.error(`Refreshing permissions failed: ${e.message}`)\n      }\n    },\n    [apiRoute, i18n],\n  )\n\n  const fetchFullUser = React.useCallback(async () => {\n    try {\n      const request = await requests.get(\n        formatAdminURL({\n          apiRoute,\n          path: `/${userSlug}/me`,\n        }),\n        {\n          credentials: 'include',\n          headers: {\n            'Accept-Language': i18n.language,\n          },\n        },\n      )\n\n      if (request.status === 200) {\n        const json: UserWithToken = await request.json()\n        setNewUser(json)\n        return json?.user || null\n      }\n    } catch (e) {\n      toast.error(`Fetching user failed: ${e.message}`)\n    }\n\n    return null\n  }, [apiRoute, userSlug, i18n.language, setNewUser])\n\n  const refreshCookieEvent = useEffectEvent(refreshCookie)\n  useEffect(() => {\n    // when location changes, refresh cookie\n    refreshCookieEvent()\n  }, [pathname])\n\n  const fetchFullUserEvent = useEffectEvent(fetchFullUser)\n  useEffect(() => {\n    async function fetchUserOnMount() {\n      await fetchFullUserEvent()\n      setFetchedUserOnMount(true)\n    }\n\n    void fetchUserOnMount()\n  }, [])\n\n  useEffect(() => {\n    if (!user && autoLogin && !autoLogin.prefillOnly) {\n      void fetchFullUserEvent()\n    }\n  }, [user, autoLogin])\n\n  useEffect(\n    () => () => {\n      // remove all timeouts on unmount\n      clearTimeout(refreshTokenTimeoutRef.current)\n      clearTimeout(reminderTimeoutRef.current)\n      clearTimeout(forceLogOutTimeoutRef.current)\n    },\n    [],\n  )\n\n  if (!user && !fetchedUserOnMount) {\n    return null\n  }\n\n  return (\n    <Context\n      value={{\n        fetchFullUser,\n        logOut,\n        permissions,\n        refreshCookie,\n        refreshCookieAsync,\n        refreshPermissions,\n        setPermissions,\n        setUser: setNewUser,\n        token: tokenInMemory,\n        tokenExpirationMs,\n        user,\n      }}\n    >\n      {children}\n    </Context>\n  )\n}\n\nexport const useAuth = <T = ClientUser,>(): AuthContext<T> => use(Context) as AuthContext<T>\n"],"mappings":"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","ignoreList":[]}