{"version":3,"file":"index.js","names":["formatAdminURL","qs","React","createContext","use","useCallback","useEffect","useMemo","useRef","useState","useControllableState","useAuth","requests","formatDocTitle","useConfig","DocumentTitleProvider","useLocale","useLocaleLoading","usePreferences","useTranslation","UploadEditsProvider","useUploadEdits","useGetDocPermissions","Context","useDocumentInfo","DocumentInfo","children","props","id","collectionSlug","currentEditor","currentEditorFromProps","docPermissions","docPermissionsFromProps","globalSlug","hasPublishedDoc","hasPublishedDocFromProps","hasPublishPermission","hasPublishPermissionFromProps","hasSavePermission","hasSavePermissionFromProps","initialData","initialState","isLocked","isLockedFromProps","lastUpdateTime","lastUpdateTimeFromProps","mostRecentVersionIsAutosaved","mostRecentVersionIsAutosavedFromProps","unpublishedVersionCount","unpublishedVersionCountFromProps","versionCount","versionCountFromProps","setDocPermissions","setHasSavePermission","setHasPublishPermission","permissions","config","admin","dateFormat","collections","routes","api","getEntityConfig","collectionConfig","globalConfig","hasLockedDocumentsCollection","some","collection","slug","abortControllerRef","AbortController","docConfig","i18n","uploadEdits","title","setDocumentTitle","data","fallback","toString","setMostRecentVersionIsAutosaved","setVersionCount","setHasPublishedDoc","setUnpublishedVersionCount","documentIsLocked","setDocumentIsLocked","setCurrentEditor","setLastUpdateTime","setData","uploadStatus","setUploadStatus","documentLockState","hasShownLockedModal","user","updateUploadStatus","status","getPreference","setPreference","code","locale","localeIsLoading","isInitializing","undefined","baseAPIPath","apiRoute","path","pluralType","preferencesKey","unlockDocument","docID","isGlobal","request","get","credentials","params","docs","json","length","lockID","delete","headers","error","console","updateDocumentEditor","userData","relationTo","value","patch","body","JSON","stringify","getDocPermissions","getDocPreferences","setDocFieldPreferences","fieldPreferences","allPreferences","fields","e","incrementVersionCount","newCount","versions","maxPerDoc","Math","min","max","re1","current","abort","_err","action","docPath","depth","addQueryPrefix","savedDocumentData","updateSavedDocumentData","_jsx","DocumentInfoProvider"],"sources":["../../../src/providers/DocumentInfo/index.tsx"],"sourcesContent":["'use client'\nimport type { ClientUser, DocumentPreferences } from 'payload'\n\nimport { formatAdminURL } from 'payload/shared'\nimport * as qs from 'qs-esm'\nimport React, { createContext, use, useCallback, useEffect, useMemo, useRef, useState } from 'react'\n\nimport type { DocumentInfoContext, DocumentInfoProps } from './types.js'\n\nimport { useControllableState } from '../../hooks/useControllableState.js'\nimport { useAuth } from '../../providers/Auth/index.js'\nimport { requests } from '../../utilities/api.js'\nimport { formatDocTitle } from '../../utilities/formatDocTitle/index.js'\nimport { useConfig } from '../Config/index.js'\nimport { DocumentTitleProvider } from '../DocumentTitle/index.js'\nimport { useLocale, useLocaleLoading } from '../Locale/index.js'\nimport { usePreferences } from '../Preferences/index.js'\nimport { useTranslation } from '../Translation/index.js'\nimport { UploadEditsProvider, useUploadEdits } from '../UploadEdits/index.js'\nimport { useGetDocPermissions } from './useGetDocPermissions.js'\n\nconst Context = createContext({} as DocumentInfoContext)\n\nexport type * from './types.js'\n\nexport const useDocumentInfo = (): DocumentInfoContext => use(Context)\n\nconst DocumentInfo: React.FC<\n  {\n    readonly children: React.ReactNode\n  } & DocumentInfoProps\n> = ({ children, ...props }) => {\n  const {\n    id,\n    collectionSlug,\n    currentEditor: currentEditorFromProps,\n    docPermissions: docPermissionsFromProps,\n    globalSlug,\n    hasPublishedDoc: hasPublishedDocFromProps,\n    hasPublishPermission: hasPublishPermissionFromProps,\n    hasSavePermission: hasSavePermissionFromProps,\n    initialData,\n    initialState,\n    isLocked: isLockedFromProps,\n    lastUpdateTime: lastUpdateTimeFromProps,\n    mostRecentVersionIsAutosaved: mostRecentVersionIsAutosavedFromProps,\n    unpublishedVersionCount: unpublishedVersionCountFromProps,\n    versionCount: versionCountFromProps,\n  } = props\n\n  const [docPermissions, setDocPermissions] = useControllableState(docPermissionsFromProps)\n\n  const [hasSavePermission, setHasSavePermission] = useControllableState(hasSavePermissionFromProps)\n\n  const [hasPublishPermission, setHasPublishPermission] = useControllableState(\n    hasPublishPermissionFromProps,\n  )\n\n  const { permissions } = useAuth()\n\n  const {\n    config: {\n      admin: { dateFormat },\n      collections,\n      routes: { api },\n    },\n    getEntityConfig,\n  } = useConfig()\n\n  const collectionConfig = getEntityConfig({ collectionSlug })\n  const globalConfig = getEntityConfig({ globalSlug })\n\n  // Check if the locked-documents collection exists in the config\n  const hasLockedDocumentsCollection = collections.some(\n    (collection) => collection.slug === 'payload-locked-documents',\n  )\n\n  const abortControllerRef = useRef(new AbortController())\n  const docConfig = collectionConfig || globalConfig\n\n  const { i18n } = useTranslation()\n\n  const { uploadEdits } = useUploadEdits()\n\n  /**\n   * @deprecated This state will be removed in v4.\n   * This is for performance reasons. Use the `DocumentTitleContext` instead.\n   */\n  const [title, setDocumentTitle] = useState(() =>\n    formatDocTitle({\n      collectionConfig,\n      data: { ...(initialData || {}), id },\n      dateFormat,\n      fallback: id?.toString(),\n      globalConfig,\n      i18n,\n    }),\n  )\n\n  const [mostRecentVersionIsAutosaved, setMostRecentVersionIsAutosaved] = useState(\n    mostRecentVersionIsAutosavedFromProps,\n  )\n\n  const [versionCount, setVersionCount] = useState(versionCountFromProps)\n\n  const [hasPublishedDoc, setHasPublishedDoc] = useState(hasPublishedDocFromProps)\n\n  const [unpublishedVersionCount, setUnpublishedVersionCount] = useState(\n    unpublishedVersionCountFromProps,\n  )\n\n  const [documentIsLocked, setDocumentIsLocked] = useControllableState<boolean | undefined>(\n    isLockedFromProps,\n  )\n\n  const [currentEditor, setCurrentEditor] = useControllableState<ClientUser | null>(\n    currentEditorFromProps,\n  )\n  const [lastUpdateTime, setLastUpdateTime] = useControllableState<number>(lastUpdateTimeFromProps)\n\n  const [data, setData] = useControllableState(initialData)\n\n  const [uploadStatus, setUploadStatus] = useControllableState<'failed' | 'idle' | 'uploading'>(\n    'idle',\n  )\n\n  const documentLockState = useRef<{\n    hasShownLockedModal: boolean\n    isLocked: boolean\n    user: ClientUser | number | string\n  } | null>({\n    hasShownLockedModal: false,\n    isLocked: false,\n    user: null,\n  })\n\n  const updateUploadStatus = useCallback(\n    (status: 'failed' | 'idle' | 'uploading') => {\n      setUploadStatus(status)\n    },\n    [setUploadStatus],\n  )\n\n  const { getPreference, setPreference } = usePreferences()\n  const { code: locale } = useLocale()\n  const { localeIsLoading } = useLocaleLoading()\n\n  const isInitializing = useMemo(\n    () => initialState === undefined || initialData === undefined || localeIsLoading,\n    [initialData, initialState, localeIsLoading],\n  )\n\n  const baseAPIPath = formatAdminURL({\n    apiRoute: api,\n    path: '',\n  })\n\n  let slug: string\n  let pluralType: 'collections' | 'globals'\n  let preferencesKey: string\n\n  if (globalSlug) {\n    slug = globalSlug\n    pluralType = 'globals'\n    preferencesKey = `global-${slug}`\n  }\n\n  if (collectionSlug) {\n    slug = collectionSlug\n    pluralType = 'collections'\n\n    if (id) {\n      preferencesKey = `collection-${slug}-${id}`\n    }\n  }\n\n  const unlockDocument = useCallback(\n    async (docID: number | string, slug: string) => {\n      // Check if the locked-documents collection exists before making API calls\n      if (!hasLockedDocumentsCollection) {\n        return\n      }\n\n      try {\n        const isGlobal = slug === globalSlug\n\n        const request = await requests.get(`${baseAPIPath}/payload-locked-documents`, {\n          credentials: 'include',\n          params: isGlobal\n            ? {\n                'where[globalSlug][equals]': slug,\n              }\n            : {\n                'where[document.relationTo][equals]': slug,\n                'where[document.value][equals]': docID,\n              },\n        })\n\n        const { docs } = await request.json()\n\n        if (docs?.length > 0) {\n          const lockID = docs[0].id\n          await requests.delete(`${baseAPIPath}/payload-locked-documents/${lockID}`, {\n            credentials: 'include',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n          })\n          setDocumentIsLocked(false)\n        }\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error('Failed to unlock the document', error)\n      }\n    },\n    [baseAPIPath, globalSlug, setDocumentIsLocked, hasLockedDocumentsCollection],\n  )\n\n  const updateDocumentEditor = useCallback(\n    async (docID: number | string, slug: string, user: ClientUser | number | string) => {\n      // Check if the locked-documents collection exists before making API calls\n      if (!hasLockedDocumentsCollection) {\n        return\n      }\n\n      try {\n        const isGlobal = slug === globalSlug\n\n        // Check if the document is already locked\n        const request = await requests.get(`${baseAPIPath}/payload-locked-documents`, {\n          credentials: 'include',\n          params: isGlobal\n            ? {\n                'where[globalSlug][equals]': slug,\n              }\n            : {\n                'where[document.relationTo][equals]': slug,\n                'where[document.value][equals]': docID,\n              },\n        })\n\n        const { docs } = await request.json()\n\n        if (docs?.length > 0) {\n          const lockID = docs[0].id\n\n          const userData =\n            typeof user === 'object'\n              ? { relationTo: user.collection, value: user.id }\n              : { relationTo: 'users', value: user }\n\n          // Send a patch request to update the _lastEdited info\n          await requests.patch(`${baseAPIPath}/payload-locked-documents/${lockID}`, {\n            body: JSON.stringify({\n              user: userData,\n            }),\n            credentials: 'include',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n          })\n        }\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error('Failed to update the document editor', error)\n      }\n    },\n    [baseAPIPath, globalSlug, hasLockedDocumentsCollection],\n  )\n\n  const getDocPermissions = useGetDocPermissions({\n    id: id as string,\n    api,\n    collectionSlug,\n    globalSlug,\n    i18n,\n    locale,\n    permissions,\n    setDocPermissions,\n    setHasPublishPermission,\n    setHasSavePermission,\n  })\n\n  const getDocPreferences = useCallback(() => {\n    return getPreference<DocumentPreferences>(preferencesKey)\n  }, [getPreference, preferencesKey])\n\n  const setDocFieldPreferences = useCallback<DocumentInfoContext['setDocFieldPreferences']>(\n    async (path, fieldPreferences) => {\n      const allPreferences = await getDocPreferences()\n\n      if (preferencesKey) {\n        try {\n          await setPreference(preferencesKey, {\n            ...allPreferences,\n            fields: {\n              ...(allPreferences?.fields || {}),\n              [path]: {\n                ...allPreferences?.fields?.[path],\n                ...fieldPreferences,\n              },\n            },\n          })\n        } catch (e) {\n          console.error(e) // eslint-disable-line no-console\n        }\n      }\n    },\n    [setPreference, preferencesKey, getDocPreferences],\n  )\n\n  const incrementVersionCount = useCallback(() => {\n    const newCount = versionCount + 1\n    if (collectionConfig && collectionConfig.versions) {\n      if (collectionConfig.versions.maxPerDoc > 0) {\n        setVersionCount(Math.min(newCount, collectionConfig.versions.maxPerDoc))\n      } else {\n        setVersionCount(newCount)\n      }\n    } else if (globalConfig && globalConfig.versions) {\n      if (globalConfig.versions.max > 0) {\n        setVersionCount(Math.min(newCount, globalConfig.versions.max))\n      } else {\n        setVersionCount(newCount)\n      }\n    }\n  }, [collectionConfig, globalConfig, versionCount])\n\n  /**\n   * @todo: Remove this in v4\n   * Users should use the `DocumentTitleContext` instead.\n   */\n  useEffect(() => {\n    setDocumentTitle(\n      formatDocTitle({\n        collectionConfig,\n        data: { ...data, id },\n        dateFormat,\n        fallback: id?.toString(),\n        globalConfig,\n        i18n,\n      }),\n    )\n  }, [collectionConfig, globalConfig, data, dateFormat, i18n, id])\n\n  // clean on unmount\n  useEffect(() => {\n    const re1 = abortControllerRef.current\n\n    return () => {\n      if (re1) {\n        try {\n          re1.abort()\n        } catch (_err) {\n          // swallow error\n        }\n      }\n    }\n  }, [])\n\n  const action: string = React.useMemo(() => {\n    const docPath = `${pluralType === 'globals' ? `/globals` : ''}/${slug}${id ? `/${id}` : ''}`\n\n    return `${baseAPIPath}${docPath}${qs.stringify(\n      {\n        depth: 0,\n        'fallback-locale': 'null',\n        locale,\n        uploadEdits: uploadEdits || undefined,\n      },\n      {\n        addQueryPrefix: true,\n      },\n    )}`\n  }, [baseAPIPath, locale, pluralType, id, slug, uploadEdits])\n\n  const value: DocumentInfoContext = {\n    ...props,\n    action,\n    currentEditor,\n    data,\n    docConfig,\n    docPermissions,\n    documentIsLocked,\n    documentLockState,\n    getDocPermissions,\n    getDocPreferences,\n    hasPublishedDoc,\n    hasPublishPermission,\n    hasSavePermission,\n    incrementVersionCount,\n    initialData,\n    initialState,\n    isInitializing,\n    lastUpdateTime,\n    mostRecentVersionIsAutosaved,\n    preferencesKey,\n    savedDocumentData: data,\n    setCurrentEditor,\n    setData,\n    setDocFieldPreferences,\n    setDocumentIsLocked,\n    setDocumentTitle,\n    setHasPublishedDoc,\n    setLastUpdateTime,\n    setMostRecentVersionIsAutosaved,\n    setUnpublishedVersionCount,\n    setUploadStatus: updateUploadStatus,\n    title,\n    unlockDocument,\n    unpublishedVersionCount,\n    updateDocumentEditor,\n    updateSavedDocumentData: setData,\n    uploadStatus,\n    versionCount,\n  }\n\n  return (\n    <Context value={value}>\n      <DocumentTitleProvider>{children}</DocumentTitleProvider>\n    </Context>\n  )\n}\n\nexport const DocumentInfoProvider: React.FC<\n  {\n    readonly children: React.ReactNode\n  } & DocumentInfoProps\n> = (props) => {\n  return (\n    <UploadEditsProvider>\n      <DocumentInfo {...props} />\n    </UploadEditsProvider>\n  )\n}\n"],"mappings":"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","ignoreList":[]}