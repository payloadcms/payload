{"version":3,"sources":["../../../src/providers/TenantSelectionProvider/index.tsx"],"sourcesContent":["import type { Payload, TypedUser } from 'payload'\n\nimport { cookies as getCookies } from 'next/headers.js'\n\nimport type { MultiTenantPluginConfig } from '../../types.js'\n\nimport { getTenantOptions } from '../../utilities/getTenantOptions.js'\nimport { TenantSelectionProviderClient } from './index.client.js'\n\ntype Args<ConfigType> = {\n  children: React.ReactNode\n  payload: Payload\n  tenantsArrayFieldName: string\n  tenantsArrayTenantFieldName: string\n  tenantsCollectionSlug: string\n  useAsTitle: string\n  user: TypedUser\n  userHasAccessToAllTenants: Required<\n    MultiTenantPluginConfig<ConfigType>\n  >['userHasAccessToAllTenants']\n}\n\nexport const TenantSelectionProvider = async ({\n  children,\n  payload,\n  tenantsArrayFieldName,\n  tenantsArrayTenantFieldName,\n  tenantsCollectionSlug,\n  useAsTitle,\n  user,\n  userHasAccessToAllTenants,\n}: Args<any>) => {\n  const tenantOptions = await getTenantOptions({\n    payload,\n    tenantsArrayFieldName,\n    tenantsArrayTenantFieldName,\n    tenantsCollectionSlug,\n    useAsTitle,\n    user,\n    userHasAccessToAllTenants,\n  })\n\n  const cookies = await getCookies()\n  const tenantCookie = cookies.get('payload-tenant')?.value\n  let initialValue = undefined\n\n  /**\n   * Ensure the cookie is a valid tenant\n   */\n  if (tenantCookie) {\n    const matchingOption = tenantOptions.find((option) => String(option.value) === tenantCookie)\n    if (matchingOption) {\n      initialValue = matchingOption.value\n    }\n  }\n\n  /**\n   * If the there was no cookie or the cookie was an invalid tenantID set intialValue\n   */\n  if (!initialValue) {\n    initialValue = tenantOptions.length > 1 ? undefined : tenantOptions[0]?.value\n  }\n\n  return (\n    <TenantSelectionProviderClient\n      initialTenantOptions={tenantOptions}\n      initialValue={initialValue}\n      tenantsCollectionSlug={tenantsCollectionSlug}\n    >\n      {children}\n    </TenantSelectionProviderClient>\n  )\n}\n"],"names":["cookies","getCookies","getTenantOptions","TenantSelectionProviderClient","TenantSelectionProvider","children","payload","tenantsArrayFieldName","tenantsArrayTenantFieldName","tenantsCollectionSlug","useAsTitle","user","userHasAccessToAllTenants","tenantOptions","tenantCookie","get","value","initialValue","undefined","matchingOption","find","option","String","length","initialTenantOptions"],"mappings":";AAEA,SAASA,WAAWC,UAAU,QAAQ,kBAAiB;AAIvD,SAASC,gBAAgB,QAAQ,sCAAqC;AACtE,SAASC,6BAA6B,QAAQ,oBAAmB;AAejE,OAAO,MAAMC,0BAA0B,OAAO,EAC5CC,QAAQ,EACRC,OAAO,EACPC,qBAAqB,EACrBC,2BAA2B,EAC3BC,qBAAqB,EACrBC,UAAU,EACVC,IAAI,EACJC,yBAAyB,EACf;IACV,MAAMC,gBAAgB,MAAMX,iBAAiB;QAC3CI;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;IACF;IAEA,MAAMZ,UAAU,MAAMC;IACtB,MAAMa,eAAed,QAAQe,GAAG,CAAC,mBAAmBC;IACpD,IAAIC,eAAeC;IAEnB;;GAEC,GACD,IAAIJ,cAAc;QAChB,MAAMK,iBAAiBN,cAAcO,IAAI,CAAC,CAACC,SAAWC,OAAOD,OAAOL,KAAK,MAAMF;QAC/E,IAAIK,gBAAgB;YAClBF,eAAeE,eAAeH,KAAK;QACrC;IACF;IAEA;;GAEC,GACD,IAAI,CAACC,cAAc;QACjBA,eAAeJ,cAAcU,MAAM,GAAG,IAAIL,YAAYL,aAAa,CAAC,EAAE,EAAEG;IAC1E;IAEA,qBACE,KAACb;QACCqB,sBAAsBX;QACtBI,cAAcA;QACdR,uBAAuBA;kBAEtBJ;;AAGP,EAAC"}