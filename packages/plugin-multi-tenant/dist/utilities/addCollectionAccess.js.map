{"version":3,"sources":["../../src/utilities/addCollectionAccess.ts"],"sourcesContent":["import type { CollectionConfig } from 'payload'\n\nimport type { AllAccessKeys, MultiTenantPluginConfig } from '../types.js'\n\nimport { withTenantAccess } from './withTenantAccess.js'\n\nexport const collectionAccessKeys: AllAccessKeys = [\n  'create',\n  'read',\n  'update',\n  'delete',\n  'readVersions',\n  'unlock',\n] as const\n\ntype Args<ConfigType> = {\n  accessResultCallback?: MultiTenantPluginConfig<ConfigType>['usersAccessResultOverride']\n  adminUsersSlug: string\n  collection: CollectionConfig\n  fieldName: string\n  tenantsArrayFieldName?: string\n  tenantsArrayTenantFieldName?: string\n  userHasAccessToAllTenants: Required<\n    MultiTenantPluginConfig<ConfigType>\n  >['userHasAccessToAllTenants']\n}\n\n/**\n * Adds tenant access constraint to collection\n * - constrains access a users assigned tenants\n */\nexport const addCollectionAccess = <ConfigType>({\n  accessResultCallback,\n  adminUsersSlug,\n  collection,\n  fieldName,\n  tenantsArrayFieldName,\n  tenantsArrayTenantFieldName,\n  userHasAccessToAllTenants,\n}: Args<ConfigType>): void => {\n  collectionAccessKeys.forEach((key) => {\n    if (!collection.access) {\n      collection.access = {}\n    }\n    collection.access[key] = withTenantAccess<ConfigType>({\n      accessFunction: collection.access?.[key],\n      accessKey: key,\n      accessResultCallback,\n      adminUsersSlug,\n      collection,\n      fieldName: key === 'readVersions' ? `version.${fieldName}` : fieldName,\n      tenantsArrayFieldName,\n      tenantsArrayTenantFieldName,\n      userHasAccessToAllTenants,\n    })\n  })\n}\n"],"names":["withTenantAccess","collectionAccessKeys","addCollectionAccess","accessResultCallback","adminUsersSlug","collection","fieldName","tenantsArrayFieldName","tenantsArrayTenantFieldName","userHasAccessToAllTenants","forEach","key","access","accessFunction","accessKey"],"mappings":"AAIA,SAASA,gBAAgB,QAAQ,wBAAuB;AAExD,OAAO,MAAMC,uBAAsC;IACjD;IACA;IACA;IACA;IACA;IACA;CACD,CAAS;AAcV;;;CAGC,GACD,OAAO,MAAMC,sBAAsB,CAAa,EAC9CC,oBAAoB,EACpBC,cAAc,EACdC,UAAU,EACVC,SAAS,EACTC,qBAAqB,EACrBC,2BAA2B,EAC3BC,yBAAyB,EACR;IACjBR,qBAAqBS,OAAO,CAAC,CAACC;QAC5B,IAAI,CAACN,WAAWO,MAAM,EAAE;YACtBP,WAAWO,MAAM,GAAG,CAAC;QACvB;QACAP,WAAWO,MAAM,CAACD,IAAI,GAAGX,iBAA6B;YACpDa,gBAAgBR,WAAWO,MAAM,EAAE,CAACD,IAAI;YACxCG,WAAWH;YACXR;YACAC;YACAC;YACAC,WAAWK,QAAQ,iBAAiB,CAAC,QAAQ,EAAEL,WAAW,GAAGA;YAC7DC;YACAC;YACAC;QACF;IACF;AACF,EAAC"}