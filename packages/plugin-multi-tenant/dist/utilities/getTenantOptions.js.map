{"version":3,"sources":["../../src/utilities/getTenantOptions.ts"],"sourcesContent":["import type { OptionObject, Payload, TypedUser } from 'payload'\n\nimport type { MultiTenantPluginConfig } from '../types.js'\n\nexport const getTenantOptions = async ({\n  payload,\n  tenantsArrayFieldName,\n  tenantsArrayTenantFieldName,\n  tenantsCollectionSlug,\n  useAsTitle,\n  user,\n  userHasAccessToAllTenants,\n}: {\n  payload: Payload\n  tenantsArrayFieldName: string\n  tenantsArrayTenantFieldName: string\n  tenantsCollectionSlug: string\n  useAsTitle: string\n  user: TypedUser\n  userHasAccessToAllTenants: Required<MultiTenantPluginConfig<any>>['userHasAccessToAllTenants']\n}): Promise<OptionObject[]> => {\n  let tenantOptions: OptionObject[] = []\n\n  if (!user) {\n    return tenantOptions\n  }\n\n  const isOrderable = payload.collections[tenantsCollectionSlug]?.config?.orderable || false\n\n  const userTenantIds = !userHasAccessToAllTenants(user)\n    ? ((user[tenantsArrayFieldName] as { [key: string]: unknown }[]) || []).map((tenantRow) => {\n        const tenantField = tenantRow[tenantsArrayTenantFieldName]\n        if (typeof tenantField === 'string' || typeof tenantField === 'number') {\n          return tenantField\n        }\n        if (tenantField && typeof tenantField === 'object' && 'id' in tenantField) {\n          return tenantField.id as number | string\n        }\n      })\n    : undefined\n\n  const tenants = await payload.find({\n    collection: tenantsCollectionSlug,\n    depth: 0,\n    limit: 0,\n    overrideAccess: false,\n    select: {\n      [useAsTitle]: true,\n      ...(isOrderable && { _order: true }),\n    },\n    sort: isOrderable ? '_order' : useAsTitle,\n    user,\n    ...(userTenantIds && {\n      where: {\n        id: {\n          in: userTenantIds,\n        },\n      },\n    }),\n  })\n\n  tenantOptions = tenants.docs.map((doc) => ({\n    label: String(doc[useAsTitle as 'id']),\n    value: doc.id as string,\n  }))\n\n  return tenantOptions\n}\n"],"names":["getTenantOptions","payload","tenantsArrayFieldName","tenantsArrayTenantFieldName","tenantsCollectionSlug","useAsTitle","user","userHasAccessToAllTenants","tenantOptions","isOrderable","collections","config","orderable","userTenantIds","map","tenantRow","tenantField","id","undefined","tenants","find","collection","depth","limit","overrideAccess","select","_order","sort","where","in","docs","doc","label","String","value"],"mappings":"AAIA,OAAO,MAAMA,mBAAmB,OAAO,EACrCC,OAAO,EACPC,qBAAqB,EACrBC,2BAA2B,EAC3BC,qBAAqB,EACrBC,UAAU,EACVC,IAAI,EACJC,yBAAyB,EAS1B;IACC,IAAIC,gBAAgC,EAAE;IAEtC,IAAI,CAACF,MAAM;QACT,OAAOE;IACT;IAEA,MAAMC,cAAcR,QAAQS,WAAW,CAACN,sBAAsB,EAAEO,QAAQC,aAAa;IAErF,MAAMC,gBAAgB,CAACN,0BAA0BD,QAC7C,AAAC,CAAA,AAACA,IAAI,CAACJ,sBAAsB,IAAqC,EAAE,AAAD,EAAGY,GAAG,CAAC,CAACC;QACzE,MAAMC,cAAcD,SAAS,CAACZ,4BAA4B;QAC1D,IAAI,OAAOa,gBAAgB,YAAY,OAAOA,gBAAgB,UAAU;YACtE,OAAOA;QACT;QACA,IAAIA,eAAe,OAAOA,gBAAgB,YAAY,QAAQA,aAAa;YACzE,OAAOA,YAAYC,EAAE;QACvB;IACF,KACAC;IAEJ,MAAMC,UAAU,MAAMlB,QAAQmB,IAAI,CAAC;QACjCC,YAAYjB;QACZkB,OAAO;QACPC,OAAO;QACPC,gBAAgB;QAChBC,QAAQ;YACN,CAACpB,WAAW,EAAE;YACd,GAAII,eAAe;gBAAEiB,QAAQ;YAAK,CAAC;QACrC;QACAC,MAAMlB,cAAc,WAAWJ;QAC/BC;QACA,GAAIO,iBAAiB;YACnBe,OAAO;gBACLX,IAAI;oBACFY,IAAIhB;gBACN;YACF;QACF,CAAC;IACH;IAEAL,gBAAgBW,QAAQW,IAAI,CAAChB,GAAG,CAAC,CAACiB,MAAS,CAAA;YACzCC,OAAOC,OAAOF,GAAG,CAAC1B,WAAmB;YACrC6B,OAAOH,IAAId,EAAE;QACf,CAAA;IAEA,OAAOT;AACT,EAAC"}