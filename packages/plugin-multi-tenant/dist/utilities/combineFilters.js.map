{"version":3,"sources":["../../src/utilities/combineFilters.ts"],"sourcesContent":["import type { BaseFilter, Where } from 'payload'\n\ntype Args = {\n  baseFilter?: BaseFilter\n  customFilter: BaseFilter\n}\n/**\n * Combines a base filter with a tenant list filter\n *\n * Combines where constraints inside of an AND operator\n */\nexport const combineFilters =\n  ({ baseFilter, customFilter }: Args): BaseFilter =>\n  async (args) => {\n    const filterConstraints = []\n\n    if (typeof baseFilter === 'function') {\n      const baseFilterResult = await baseFilter(args)\n\n      if (baseFilterResult) {\n        filterConstraints.push(baseFilterResult)\n      }\n    }\n\n    const customFilterResult = await customFilter(args)\n\n    if (customFilterResult) {\n      filterConstraints.push(customFilterResult)\n    }\n\n    if (filterConstraints.length) {\n      const combinedWhere: Where = { and: [] }\n      filterConstraints.forEach((constraint) => {\n        if (combinedWhere.and && constraint && typeof constraint === 'object') {\n          combinedWhere.and.push(constraint)\n        }\n      })\n      return combinedWhere\n    }\n\n    // Access control will take it from here\n    return null\n  }\n"],"names":["combineFilters","baseFilter","customFilter","args","filterConstraints","baseFilterResult","push","customFilterResult","length","combinedWhere","and","forEach","constraint"],"mappings":"AAMA;;;;CAIC,GACD,OAAO,MAAMA,iBACX,CAAC,EAAEC,UAAU,EAAEC,YAAY,EAAQ,GACnC,OAAOC;QACL,MAAMC,oBAAoB,EAAE;QAE5B,IAAI,OAAOH,eAAe,YAAY;YACpC,MAAMI,mBAAmB,MAAMJ,WAAWE;YAE1C,IAAIE,kBAAkB;gBACpBD,kBAAkBE,IAAI,CAACD;YACzB;QACF;QAEA,MAAME,qBAAqB,MAAML,aAAaC;QAE9C,IAAII,oBAAoB;YACtBH,kBAAkBE,IAAI,CAACC;QACzB;QAEA,IAAIH,kBAAkBI,MAAM,EAAE;YAC5B,MAAMC,gBAAuB;gBAAEC,KAAK,EAAE;YAAC;YACvCN,kBAAkBO,OAAO,CAAC,CAACC;gBACzB,IAAIH,cAAcC,GAAG,IAAIE,cAAc,OAAOA,eAAe,UAAU;oBACrEH,cAAcC,GAAG,CAACJ,IAAI,CAACM;gBACzB;YACF;YACA,OAAOH;QACT;QAEA,wCAAwC;QACxC,OAAO;IACT,EAAC"}