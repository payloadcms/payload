{"version":3,"sources":["../../../src/components/TenantSelector/index.client.tsx"],"sourcesContent":["'use client'\nimport type { ReactSelectOption } from '@payloadcms/ui'\nimport type { ViewTypes } from 'payload'\n\nimport { getTranslation } from '@payloadcms/translations'\nimport { ConfirmationModal, SelectInput, useModal, useTranslation } from '@payloadcms/ui'\nimport React from 'react'\n\nimport type {\n  PluginMultiTenantTranslationKeys,\n  PluginMultiTenantTranslations,\n} from '../../translations/index.js'\nimport type { MultiTenantPluginConfig } from '../../types.js'\n\nimport { useTenantSelection } from '../../providers/TenantSelectionProvider/index.client.js'\nimport './index.scss'\n\nconst confirmLeaveWithoutSavingSlug = 'confirm-leave-without-saving'\n\nexport const TenantSelectorClient = ({\n  disabled: disabledFromProps,\n  label,\n  viewType,\n}: {\n  disabled?: boolean\n  label?: MultiTenantPluginConfig['tenantSelectorLabel']\n  viewType?: ViewTypes\n}) => {\n  const { entityType, modified, options, selectedTenantID, setTenant } = useTenantSelection()\n  const { closeModal, openModal } = useModal()\n  const { i18n, t } = useTranslation<\n    PluginMultiTenantTranslations,\n    PluginMultiTenantTranslationKeys\n  >()\n  const [tenantSelection, setTenantSelection] = React.useState<\n    ReactSelectOption | ReactSelectOption[]\n  >()\n\n  const switchTenant = React.useCallback(\n    (option: ReactSelectOption | ReactSelectOption[] | undefined) => {\n      if (option && 'value' in option) {\n        setTenant({ id: option.value as string, refresh: true })\n      } else {\n        setTenant({ id: undefined, refresh: true })\n      }\n    },\n    [setTenant],\n  )\n\n  const onChange = React.useCallback(\n    (option: ReactSelectOption | ReactSelectOption[]) => {\n      if (option && 'value' in option && option.value === selectedTenantID) {\n        // If the selected option is the same as the current tenant, do nothing\n        return\n      }\n\n      if (entityType === 'global' && modified) {\n        // If the entityType is 'global' and there are unsaved changes, prompt for confirmation\n        setTenantSelection(option)\n        openModal(confirmLeaveWithoutSavingSlug)\n      } else {\n        // If the entityType is not 'document', switch tenant without confirmation\n        switchTenant(option)\n      }\n    },\n    [selectedTenantID, entityType, modified, switchTenant, openModal],\n  )\n\n  if (options.length <= 1) {\n    return null\n  }\n\n  return (\n    <div className=\"tenant-selector\">\n      <SelectInput\n        isClearable={['dashboard', 'list'].includes(viewType ?? '')}\n        label={\n          label ? getTranslation(label, i18n) : t('plugin-multi-tenant:nav-tenantSelector-label')\n        }\n        name=\"setTenant\"\n        onChange={onChange}\n        options={options}\n        path=\"setTenant\"\n        readOnly={\n          disabledFromProps ||\n          (entityType !== 'global' &&\n            viewType &&\n            (['document', 'version'] satisfies ViewTypes[] as ViewTypes[]).includes(viewType))\n        }\n        value={selectedTenantID as string | undefined}\n      />\n\n      <ConfirmationModal\n        body={t('general:changesNotSaved')}\n        cancelLabel={t('general:stayOnThisPage')}\n        confirmLabel={t('general:leaveAnyway')}\n        heading={t('general:leaveWithoutSaving')}\n        modalSlug={confirmLeaveWithoutSavingSlug}\n        onCancel={() => {\n          closeModal(confirmLeaveWithoutSavingSlug)\n        }}\n        onConfirm={() => {\n          switchTenant(tenantSelection)\n        }}\n      />\n    </div>\n  )\n}\n"],"names":["getTranslation","ConfirmationModal","SelectInput","useModal","useTranslation","React","useTenantSelection","confirmLeaveWithoutSavingSlug","TenantSelectorClient","disabled","disabledFromProps","label","viewType","entityType","modified","options","selectedTenantID","setTenant","closeModal","openModal","i18n","t","tenantSelection","setTenantSelection","useState","switchTenant","useCallback","option","id","value","refresh","undefined","onChange","length","div","className","isClearable","includes","name","path","readOnly","body","cancelLabel","confirmLabel","heading","modalSlug","onCancel","onConfirm"],"mappings":"AAAA;;AAIA,SAASA,cAAc,QAAQ,2BAA0B;AACzD,SAASC,iBAAiB,EAAEC,WAAW,EAAEC,QAAQ,EAAEC,cAAc,QAAQ,iBAAgB;AACzF,OAAOC,WAAW,QAAO;AAQzB,SAASC,kBAAkB,QAAQ,0DAAyD;AAC5F,OAAO,eAAc;AAErB,MAAMC,gCAAgC;AAEtC,OAAO,MAAMC,uBAAuB,CAAC,EACnCC,UAAUC,iBAAiB,EAC3BC,KAAK,EACLC,QAAQ,EAKT;IACC,MAAM,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,OAAO,EAAEC,gBAAgB,EAAEC,SAAS,EAAE,GAAGX;IACvE,MAAM,EAAEY,UAAU,EAAEC,SAAS,EAAE,GAAGhB;IAClC,MAAM,EAAEiB,IAAI,EAAEC,CAAC,EAAE,GAAGjB;IAIpB,MAAM,CAACkB,iBAAiBC,mBAAmB,GAAGlB,MAAMmB,QAAQ;IAI5D,MAAMC,eAAepB,MAAMqB,WAAW,CACpC,CAACC;QACC,IAAIA,UAAU,WAAWA,QAAQ;YAC/BV,UAAU;gBAAEW,IAAID,OAAOE,KAAK;gBAAYC,SAAS;YAAK;QACxD,OAAO;YACLb,UAAU;gBAAEW,IAAIG;gBAAWD,SAAS;YAAK;QAC3C;IACF,GACA;QAACb;KAAU;IAGb,MAAMe,WAAW3B,MAAMqB,WAAW,CAChC,CAACC;QACC,IAAIA,UAAU,WAAWA,UAAUA,OAAOE,KAAK,KAAKb,kBAAkB;YACpE,uEAAuE;YACvE;QACF;QAEA,IAAIH,eAAe,YAAYC,UAAU;YACvC,uFAAuF;YACvFS,mBAAmBI;YACnBR,UAAUZ;QACZ,OAAO;YACL,0EAA0E;YAC1EkB,aAAaE;QACf;IACF,GACA;QAACX;QAAkBH;QAAYC;QAAUW;QAAcN;KAAU;IAGnE,IAAIJ,QAAQkB,MAAM,IAAI,GAAG;QACvB,OAAO;IACT;IAEA,qBACE,MAACC;QAAIC,WAAU;;0BACb,KAACjC;gBACCkC,aAAa;oBAAC;oBAAa;iBAAO,CAACC,QAAQ,CAACzB,YAAY;gBACxDD,OACEA,QAAQX,eAAeW,OAAOS,QAAQC,EAAE;gBAE1CiB,MAAK;gBACLN,UAAUA;gBACVjB,SAASA;gBACTwB,MAAK;gBACLC,UACE9B,qBACCG,eAAe,YACdD,YACA,AAAC;oBAAC;oBAAY;iBAAU,CAAuCyB,QAAQ,CAACzB;gBAE5EiB,OAAOb;;0BAGT,KAACf;gBACCwC,MAAMpB,EAAE;gBACRqB,aAAarB,EAAE;gBACfsB,cAActB,EAAE;gBAChBuB,SAASvB,EAAE;gBACXwB,WAAWtC;gBACXuC,UAAU;oBACR5B,WAAWX;gBACb;gBACAwC,WAAW;oBACTtB,aAAaH;gBACf;;;;AAIR,EAAC"}