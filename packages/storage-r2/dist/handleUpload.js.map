{"version":3,"sources":["../src/handleUpload.ts"],"sourcesContent":["import type { HandleUpload } from '@payloadcms/plugin-cloud-storage/types'\nimport type { CollectionConfig } from 'payload'\n\nimport path from 'path'\n\nimport type { R2Bucket } from './types.js'\n\ninterface Args {\n  bucket: R2Bucket\n  collection: CollectionConfig\n  prefix?: string\n}\n\nexport const getHandleUpload = ({ bucket, prefix = '' }: Args): HandleUpload => {\n  return async ({ data, file }) => {\n    // Read more: https://github.com/cloudflare/workers-sdk/issues/6047#issuecomment-2691217843\n    const buffer = process.env.NODE_ENV === 'development' ? new Blob([file.buffer]) : file.buffer\n    await bucket.put(path.posix.join(data.prefix || prefix, file.filename), buffer, {\n      httpMetadata: { contentType: file.mimeType },\n    })\n\n    return data\n  }\n}\n"],"names":["path","getHandleUpload","bucket","prefix","data","file","buffer","process","env","NODE_ENV","Blob","put","posix","join","filename","httpMetadata","contentType","mimeType"],"mappings":"AAGA,OAAOA,UAAU,OAAM;AAUvB,OAAO,MAAMC,kBAAkB,CAAC,EAAEC,MAAM,EAAEC,SAAS,EAAE,EAAQ;IAC3D,OAAO,OAAO,EAAEC,IAAI,EAAEC,IAAI,EAAE;QAC1B,2FAA2F;QAC3F,MAAMC,SAASC,QAAQC,GAAG,CAACC,QAAQ,KAAK,gBAAgB,IAAIC,KAAK;YAACL,KAAKC,MAAM;SAAC,IAAID,KAAKC,MAAM;QAC7F,MAAMJ,OAAOS,GAAG,CAACX,KAAKY,KAAK,CAACC,IAAI,CAACT,KAAKD,MAAM,IAAIA,QAAQE,KAAKS,QAAQ,GAAGR,QAAQ;YAC9ES,cAAc;gBAAEC,aAAaX,KAAKY,QAAQ;YAAC;QAC7C;QAEA,OAAOb;IACT;AACF,EAAC"}