{"version":3,"sources":["../src/mergeData.ts"],"sourcesContent":["import type { CollectionPopulationRequestHandler } from './types.js'\n\nconst defaultRequestHandler: CollectionPopulationRequestHandler = ({\n  apiPath,\n  data,\n  endpoint,\n  serverURL,\n}) => {\n  const url = `${serverURL}${apiPath}/${endpoint}`\n\n  return fetch(url, {\n    body: JSON.stringify(data),\n    credentials: 'include',\n    headers: {\n      'Content-Type': 'application/json',\n      'X-Payload-HTTP-Method-Override': 'GET',\n    },\n    method: 'POST',\n  })\n}\n\nexport const mergeData = async <T extends Record<string, any>>(args: {\n  apiRoute?: string\n  collectionSlug?: string\n  depth?: number\n  globalSlug?: string\n  incomingData: Partial<T>\n  initialData: T\n  locale?: string\n  requestHandler?: CollectionPopulationRequestHandler\n  serverURL: string\n}): Promise<T> => {\n  const {\n    apiRoute,\n    collectionSlug,\n    depth,\n    globalSlug,\n    incomingData,\n    initialData,\n    locale,\n    serverURL,\n  } = args\n\n  const requestHandler = args.requestHandler || defaultRequestHandler\n\n  const result = await requestHandler({\n    apiPath: apiRoute || '/api',\n    data: {\n      data: incomingData,\n      depth,\n      // The incoming data already has had its locales flattened\n      flattenLocales: false,\n      locale,\n    },\n    endpoint: encodeURI(\n      `${globalSlug ? 'globals/' : ''}${collectionSlug ?? globalSlug}${collectionSlug ? `/${initialData.id}` : ''}`,\n    ),\n    serverURL,\n  }).then((res) => res.json())\n\n  return result\n}\n"],"names":["defaultRequestHandler","apiPath","data","endpoint","serverURL","url","fetch","body","JSON","stringify","credentials","headers","method","mergeData","args","apiRoute","collectionSlug","depth","globalSlug","incomingData","initialData","locale","requestHandler","result","flattenLocales","encodeURI","id","then","res","json"],"mappings":"AAEA,MAAMA,wBAA4D,CAAC,EACjEC,OAAO,EACPC,IAAI,EACJC,QAAQ,EACRC,SAAS,EACV;IACC,MAAMC,MAAM,GAAGD,YAAYH,QAAQ,CAAC,EAAEE,UAAU;IAEhD,OAAOG,MAAMD,KAAK;QAChBE,MAAMC,KAAKC,SAAS,CAACP;QACrBQ,aAAa;QACbC,SAAS;YACP,gBAAgB;YAChB,kCAAkC;QACpC;QACAC,QAAQ;IACV;AACF;AAEA,OAAO,MAAMC,YAAY,OAAsCC;IAW7D,MAAM,EACJC,QAAQ,EACRC,cAAc,EACdC,KAAK,EACLC,UAAU,EACVC,YAAY,EACZC,WAAW,EACXC,MAAM,EACNjB,SAAS,EACV,GAAGU;IAEJ,MAAMQ,iBAAiBR,KAAKQ,cAAc,IAAItB;IAE9C,MAAMuB,SAAS,MAAMD,eAAe;QAClCrB,SAASc,YAAY;QACrBb,MAAM;YACJA,MAAMiB;YACNF;YACA,0DAA0D;YAC1DO,gBAAgB;YAChBH;QACF;QACAlB,UAAUsB,UACR,GAAGP,aAAa,aAAa,KAAKF,kBAAkBE,aAAaF,iBAAiB,CAAC,CAAC,EAAEI,YAAYM,EAAE,EAAE,GAAG,IAAI;QAE/GtB;IACF,GAAGuB,IAAI,CAAC,CAACC,MAAQA,IAAIC,IAAI;IAEzB,OAAON;AACT,EAAC"}