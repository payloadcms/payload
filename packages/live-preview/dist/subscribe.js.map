{"version":3,"sources":["../src/subscribe.ts"],"sourcesContent":["import type { CollectionPopulationRequestHandler } from './types.js'\n\nimport { handleMessage, resetCache } from './handleMessage.js'\n\nexport const subscribe = <T extends Record<string, any>>(args: {\n  apiRoute?: string\n  callback: (data: T) => void\n  depth?: number\n  initialData: T\n  requestHandler?: CollectionPopulationRequestHandler\n  serverURL: string\n}): ((event: MessageEvent) => Promise<void> | void) => {\n  const { apiRoute, callback, depth, initialData, requestHandler, serverURL } = args\n\n  // Ensure previous subscription state does not leak across navigations\n  // by clearing the internal cached data before subscribing.\n  resetCache()\n\n  const onMessage = async (event: MessageEvent) => {\n    const mergedData = await handleMessage<T>({\n      apiRoute,\n      depth,\n      event,\n      initialData,\n      requestHandler,\n      serverURL,\n    })\n\n    callback(mergedData)\n  }\n\n  if (typeof window !== 'undefined') {\n    window.addEventListener('message', onMessage)\n  }\n\n  return onMessage\n}\n"],"names":["handleMessage","resetCache","subscribe","args","apiRoute","callback","depth","initialData","requestHandler","serverURL","onMessage","event","mergedData","window","addEventListener"],"mappings":"AAEA,SAASA,aAAa,EAAEC,UAAU,QAAQ,qBAAoB;AAE9D,OAAO,MAAMC,YAAY,CAAgCC;IAQvD,MAAM,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,KAAK,EAAEC,WAAW,EAAEC,cAAc,EAAEC,SAAS,EAAE,GAAGN;IAE9E,sEAAsE;IACtE,2DAA2D;IAC3DF;IAEA,MAAMS,YAAY,OAAOC;QACvB,MAAMC,aAAa,MAAMZ,cAAiB;YACxCI;YACAE;YACAK;YACAJ;YACAC;YACAC;QACF;QAEAJ,SAASO;IACX;IAEA,IAAI,OAAOC,WAAW,aAAa;QACjCA,OAAOC,gBAAgB,CAAC,WAAWJ;IACrC;IAEA,OAAOA;AACT,EAAC"}