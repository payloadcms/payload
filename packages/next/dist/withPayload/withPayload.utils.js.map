{"version":3,"file":"withPayload.utils.js","names":["readFileSync","fileURLToPath","_parseInt","input","parseInt","SEMVER_REGEXP","parseSemver","match","major","minor","patch","prerelease","canaryVersion","startsWith","split","undefined","buildmetadata","isNaN","getNextjsVersion","pkgPath","import","meta","resolve","pkgUrl","require","pkgJson","JSON","parse","version","e","console","error","supportsTurbopackExternalizeTransitiveDependencies"],"sources":["../../src/withPayload/withPayload.utils.js"],"sourcesContent":[" \n/**\n * This was taken and modified from https://github.com/getsentry/sentry-javascript/blob/15256034ee8150a5b7dcb97d23eca1a5486f0cae/packages/nextjs/src/config/util.ts\n *\n * MIT License\n *\n * Copyright (c) 2012 Functional Software, Inc. dba Sentry\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { readFileSync } from 'fs'\nimport { fileURLToPath } from 'url'\n\n/**\n * @param {string | undefined} input\n * @returns {number}\n */\nfunction _parseInt(input) {\n  return parseInt(input || '', 10)\n}\n\n/**\n * Represents Semantic Versioning object\n * @typedef {Object} SemVer\n * @property {string} [buildmetadata]\n * @property {number} [canaryVersion] - undefined if not a canary version\n * @property {number} [major]\n * @property {number} [minor]\n * @property {number} [patch]\n * @property {string} [prerelease]\n */\n\n// https://semver.org/#is-there-a-suggested-regular-expression-regex-to-check-a-semver-string\nconst SEMVER_REGEXP =\n  /^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-z-][0-9a-z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-z-][0-9a-z-]*))*))?(?:\\+([0-9a-z-]+(?:\\.[0-9a-z-]+)*))?$/i\n\n/**\n * Parses input into a SemVer interface\n * @param {string} input - string representation of a semver version\n * @returns {SemVer}\n */\nexport function parseSemver(input) {\n  const match = input.match(SEMVER_REGEXP) || []\n  const major = _parseInt(match[1])\n  const minor = _parseInt(match[2])\n  const patch = _parseInt(match[3])\n\n  const prerelease = match[4]\n  const canaryVersion = prerelease?.startsWith('canary.')\n    ? parseInt(prerelease.split('.')[1] || '0', 10)\n    : undefined\n\n  return {\n    buildmetadata: match[5],\n    canaryVersion,\n    major: isNaN(major) ? undefined : major,\n    minor: isNaN(minor) ? undefined : minor,\n    patch: isNaN(patch) ? undefined : patch,\n    prerelease: match[4],\n  }\n}\n\n/**\n * Returns the version of Next.js installed in the project, or undefined if it cannot be determined.\n * @returns {SemVer | undefined}\n */\nexport function getNextjsVersion() {\n  try {\n    /** @type {string} */\n    let pkgPath\n\n    // Check if we're in ESM or CJS environment\n    if (typeof import.meta?.resolve === 'function') {\n      // ESM environment - use import.meta.resolve\n      const pkgUrl = import.meta.resolve('next/package.json')\n      // Use fileURLToPath for proper cross-platform path handling (Windows, macOS, Linux)\n      // new URL().pathname returns '/C:/path' on Windows which causes path resolution issues\n      pkgPath = fileURLToPath(pkgUrl)\n    } else {\n      // CJS environment - use require.resolve\n      pkgPath = require.resolve('next/package.json')\n    }\n\n    const pkgJson = JSON.parse(readFileSync(pkgPath, 'utf8'))\n    return parseSemver(pkgJson.version)\n  } catch (e) {\n    console.error('Payload: Error getting Next.js version', e)\n    return undefined\n  }\n}\n\n/**\n * Checks if the current Next.js version supports Turbopack externalize transitive dependencies.\n * This was introduced in Next.js v16.1.0-canary.3\n * @param {SemVer | undefined} version\n * @returns {boolean}\n */\nexport function supportsTurbopackExternalizeTransitiveDependencies(version) {\n  if (!version) {\n    return false\n  }\n\n  const { canaryVersion, major, minor, patch } = version\n\n  if (major === undefined || minor === undefined) {\n    return false\n  }\n\n  if (major > 16) {\n    return true\n  }\n\n  if (major === 16) {\n    if (minor > 1) {\n      return true\n    }\n    if (minor === 1) {\n      // 16.1.1+ and canaries support this feature\n      if (patch > 0) {\n        return true\n      }\n      if (canaryVersion !== undefined) {\n        // 16.1.0-canary.3+\n        return canaryVersion >= 3\n      } else {\n        // Next.js 16.1.0\n        return true\n      }\n    }\n  }\n\n  return false\n}\n"],"mappings":"AACA;;;;;;;;;;;;;;;;;;;;;;;;GA0BA,SAASA,YAAY,QAAQ;AAC7B,SAASC,aAAa,QAAQ;AAE9B;;;;AAIA,SAASC,UAAUC,KAAK;EACtB,OAAOC,QAAA,CAASD,KAAA,IAAS,IAAI;AAC/B;AAEA;;;;;;;;;GAAA,CAWA;AACA,MAAME,aAAA,GACJ;AAEF;;;;;AAKA,OAAO,SAASC,YAAYH,KAAK;EAC/B,MAAMI,KAAA,GAAQJ,KAAA,CAAMI,KAAK,CAACF,aAAA,KAAkB,EAAE;EAC9C,MAAMG,KAAA,GAAQN,SAAA,CAAUK,KAAK,CAAC,EAAE;EAChC,MAAME,KAAA,GAAQP,SAAA,CAAUK,KAAK,CAAC,EAAE;EAChC,MAAMG,KAAA,GAAQR,SAAA,CAAUK,KAAK,CAAC,EAAE;EAEhC,MAAMI,UAAA,GAAaJ,KAAK,CAAC,EAAE;EAC3B,MAAMK,aAAA,GAAgBD,UAAA,EAAYE,UAAA,CAAW,aACzCT,QAAA,CAASO,UAAA,CAAWG,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,KAAK,MAC1CC,SAAA;EAEJ,OAAO;IACLC,aAAA,EAAeT,KAAK,CAAC,EAAE;IACvBK,aAAA;IACAJ,KAAA,EAAOS,KAAA,CAAMT,KAAA,IAASO,SAAA,GAAYP,KAAA;IAClCC,KAAA,EAAOQ,KAAA,CAAMR,KAAA,IAASM,SAAA,GAAYN,KAAA;IAClCC,KAAA,EAAOO,KAAA,CAAMP,KAAA,IAASK,SAAA,GAAYL,KAAA;IAClCC,UAAA,EAAYJ,KAAK,CAAC;EACpB;AACF;AAEA;;;;AAIA,OAAO,SAASW,iBAAA;EACd,IAAI;IACF,qBACA,IAAIC,OAAA;IAEJ;IACA,IAAI,OAAOC,MAAA,CAAAC,IAAA,EAAaC,OAAA,KAAY,YAAY;MAC9C;MACA,MAAMC,MAAA,GAASH,MAAA,CAAAC,IAAA,CAAYC,OAAO,CAAC;MACnC;MACA;MACAH,OAAA,GAAUlB,aAAA,CAAcsB,MAAA;IAC1B,OAAO;MACL;MACAJ,OAAA,GAAUK,OAAA,CAAQF,OAAO,CAAC;IAC5B;IAEA,MAAMG,OAAA,GAAUC,IAAA,CAAKC,KAAK,CAAC3B,YAAA,CAAamB,OAAA,EAAS;IACjD,OAAOb,WAAA,CAAYmB,OAAA,CAAQG,OAAO;EACpC,EAAE,OAAOC,CAAA,EAAG;IACVC,OAAA,CAAQC,KAAK,CAAC,0CAA0CF,CAAA;IACxD,OAAOd,SAAA;EACT;AACF;AAEA;;;;;;AAMA,OAAO,SAASiB,mDAAmDJ,OAAO;EACxE,IAAI,CAACA,OAAA,EAAS;IACZ,OAAO;EACT;EAEA,MAAM;IAAEhB,aAAa;IAAEJ,KAAK;IAAEC,KAAK;IAAEC;EAAK,CAAE,GAAGkB,OAAA;EAE/C,IAAIpB,KAAA,KAAUO,SAAA,IAAaN,KAAA,KAAUM,SAAA,EAAW;IAC9C,OAAO;EACT;EAEA,IAAIP,KAAA,GAAQ,IAAI;IACd,OAAO;EACT;EAEA,IAAIA,KAAA,KAAU,IAAI;IAChB,IAAIC,KAAA,GAAQ,GAAG;MACb,OAAO;IACT;IACA,IAAIA,KAAA,KAAU,GAAG;MACf;MACA,IAAIC,KAAA,GAAQ,GAAG;QACb,OAAO;MACT;MACA,IAAIE,aAAA,KAAkBG,SAAA,EAAW;QAC/B;QACA,OAAOH,aAAA,IAAiB;MAC1B,OAAO;QACL;QACA,OAAO;MACT;IACF;EACF;EAEA,OAAO;AACT","ignoreList":[]}