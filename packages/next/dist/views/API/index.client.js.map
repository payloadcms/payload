{"version":3,"file":"index.client.js","names":["CheckboxField","CopyToClipboard","Form","Gutter","MinimizeMaximizeIcon","NumberField","SetDocumentStepNav","toast","useConfig","useDocumentInfo","useLocale","useTranslation","useSearchParams","formatAdminURL","hasDraftsEnabled","React","LocaleSelector","RenderJSON","baseClass","APIViewClient","id","collectionSlug","globalSlug","initialData","isTrashed","searchParams","i18n","t","code","config","defaultDepth","localization","routes","api","apiRoute","serverURL","getEntityConfig","collectionConfig","globalConfig","localeOptions","locales","map","locale","label","value","draftsEnabled","docEndpoint","undefined","data","setData","useState","draft","setDraft","get","setLocale","depth","setDepth","toString","authenticated","setAuthenticated","fullscreen","setFullscreen","trashParam","deletedAt","params","URLSearchParams","String","trash","fetchURL","path","window","location","origin","useEffect","fetchData","res","fetch","credentials","headers","language","method","json","error","console","_jsxs","className","filter","Boolean","join","right","_jsx","globalLabel","pluralLabel","labels","plural","useAsTitle","admin","view","href","rel","target","initialState","initialValue","valid","Number","field","name","onChange","step","max","min","onClick","type","isMinimized","object"],"sources":["../../../src/views/API/index.client.tsx"],"sourcesContent":["'use client'\n\nimport {\n  CheckboxField,\n  CopyToClipboard,\n  Form,\n  Gutter,\n  MinimizeMaximizeIcon,\n  NumberField,\n  SetDocumentStepNav,\n  toast,\n  useConfig,\n  useDocumentInfo,\n  useLocale,\n  useTranslation,\n} from '@payloadcms/ui'\nimport { useSearchParams } from 'next/navigation.js'\n\nimport './index.scss'\n\nimport { formatAdminURL, hasDraftsEnabled } from 'payload/shared'\nimport * as React from 'react'\n\nimport { LocaleSelector } from './LocaleSelector/index.js'\nimport { RenderJSON } from './RenderJSON/index.js'\n\nconst baseClass = 'query-inspector'\n\nexport const APIViewClient: React.FC = () => {\n  const { id, collectionSlug, globalSlug, initialData, isTrashed } = useDocumentInfo()\n\n  const searchParams = useSearchParams()\n  const { i18n, t } = useTranslation()\n  const { code } = useLocale()\n\n  const {\n    config: {\n      defaultDepth,\n      localization,\n      routes: { api: apiRoute },\n      serverURL,\n    },\n    getEntityConfig,\n  } = useConfig()\n\n  const collectionConfig = getEntityConfig({ collectionSlug })\n  const globalConfig = getEntityConfig({ globalSlug })\n\n  const localeOptions =\n    localization &&\n    localization.locales.map((locale) => ({ label: locale.label, value: locale.code }))\n\n  let draftsEnabled: boolean = false\n  let docEndpoint: `/${string}` = undefined\n\n  if (collectionConfig) {\n    draftsEnabled = hasDraftsEnabled(collectionConfig)\n    docEndpoint = `/${collectionSlug}/${id}`\n  }\n\n  if (globalConfig) {\n    draftsEnabled = hasDraftsEnabled(globalConfig)\n    docEndpoint = `/globals/${globalSlug}`\n  }\n\n  const [data, setData] = React.useState<any>(initialData)\n  const [draft, setDraft] = React.useState<boolean>(searchParams.get('draft') === 'true')\n  const [locale, setLocale] = React.useState<string>(searchParams?.get('locale') || code)\n  const [depth, setDepth] = React.useState<string>(\n    searchParams.get('depth') || defaultDepth.toString(),\n  )\n  const [authenticated, setAuthenticated] = React.useState<boolean>(true)\n  const [fullscreen, setFullscreen] = React.useState<boolean>(false)\n\n  const trashParam = typeof initialData?.deletedAt === 'string'\n\n  const params = new URLSearchParams({\n    depth,\n    draft: String(draft),\n    locale,\n    trash: trashParam ? 'true' : 'false',\n  }).toString()\n\n  const fetchURL = formatAdminURL({\n    apiRoute,\n    path: `${docEndpoint}?${params}`,\n    serverURL: serverURL || window.location.origin,\n  })\n\n  React.useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const res = await fetch(fetchURL, {\n          credentials: authenticated ? 'include' : 'omit',\n          headers: {\n            'Accept-Language': i18n.language,\n          },\n          method: 'GET',\n        })\n\n        try {\n          const json = await res.json()\n          setData(json)\n        } catch (error) {\n          toast.error('Error parsing response')\n          console.error(error) // eslint-disable-line no-console\n        }\n      } catch (error) {\n        toast.error('Error making request')\n        console.error(error) // eslint-disable-line no-console\n      }\n    }\n\n    void fetchData()\n  }, [i18n.language, fetchURL, authenticated])\n\n  return (\n    <Gutter\n      className={[baseClass, fullscreen && `${baseClass}--fullscreen`].filter(Boolean).join(' ')}\n      right={false}\n    >\n      <SetDocumentStepNav\n        collectionSlug={collectionSlug}\n        globalLabel={globalConfig?.label}\n        globalSlug={globalSlug}\n        id={id}\n        isTrashed={isTrashed}\n        pluralLabel={collectionConfig ? collectionConfig?.labels?.plural : undefined}\n        useAsTitle={collectionConfig ? collectionConfig?.admin?.useAsTitle : undefined}\n        view=\"API\"\n      />\n      <div className={`${baseClass}__configuration`}>\n        <div className={`${baseClass}__api-url`}>\n          <span className={`${baseClass}__label`}>\n            API URL <CopyToClipboard value={fetchURL} />\n          </span>\n          <a href={fetchURL} rel=\"noopener noreferrer\" target=\"_blank\">\n            {fetchURL}\n          </a>\n        </div>\n        <Form\n          initialState={{\n            authenticated: {\n              initialValue: authenticated || false,\n              valid: true,\n              value: authenticated || false,\n            },\n            depth: {\n              initialValue: Number(depth || 0),\n              valid: true,\n              value: Number(depth || 0),\n            },\n            draft: {\n              initialValue: draft || false,\n              valid: true,\n              value: draft || false,\n            },\n            locale: {\n              initialValue: locale,\n              valid: true,\n              value: locale,\n            },\n          }}\n        >\n          <div className={`${baseClass}__form-fields`}>\n            <div className={`${baseClass}__filter-query-checkboxes`}>\n              {draftsEnabled && (\n                <CheckboxField\n                  field={{\n                    name: 'draft',\n                    label: t('version:draft'),\n                  }}\n                  onChange={() => setDraft(!draft)}\n                  path=\"draft\"\n                />\n              )}\n              <CheckboxField\n                field={{\n                  name: 'authenticated',\n                  label: t('authentication:authenticated'),\n                }}\n                onChange={() => setAuthenticated(!authenticated)}\n                path=\"authenticated\"\n              />\n            </div>\n            {localeOptions && <LocaleSelector localeOptions={localeOptions} onChange={setLocale} />}\n            <NumberField\n              field={{\n                name: 'depth',\n                admin: {\n                  step: 1,\n                },\n                label: t('general:depth'),\n                max: 10,\n                min: 0,\n              }}\n              onChange={(value) => setDepth(value?.toString())}\n              path=\"depth\"\n            />\n          </div>\n        </Form>\n      </div>\n      <div className={`${baseClass}__results-wrapper`}>\n        <div className={`${baseClass}__toggle-fullscreen-button-container`}>\n          <button\n            aria-label=\"toggle fullscreen\"\n            className={`${baseClass}__toggle-fullscreen-button`}\n            onClick={() => setFullscreen(!fullscreen)}\n            type=\"button\"\n          >\n            <MinimizeMaximizeIcon isMinimized={!fullscreen} />\n          </button>\n        </div>\n        <div className={`${baseClass}__results`}>\n          <RenderJSON object={data} />\n        </div>\n      </div>\n    </Gutter>\n  )\n}\n"],"mappings":"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","ignoreList":[]}