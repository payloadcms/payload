{"version":3,"file":"renderDocumentSlots.js","names":["ViewDescription","RenderServerComponent","hasDraftsEnabled","getDocumentPermissions","renderDocumentSlots","args","id","collectionConfig","globalConfig","hasSavePermission","req","components","unsavedDraftWithValidations","undefined","isPreviewEnabled","admin","preview","serverProps","i18n","payload","user","BeforeDocumentControls","edit","beforeDocumentControls","elements","Component","importMap","EditMenuItems","editMenuItems","CustomPreviewButton","PreviewButton","LivePreview","views","livePreview","descriptionFromConfig","description","staticDescription","t","CustomDescription","Description","hasDescription","clientProps","collectionSlug","slug","Fallback","versions","drafts","CustomStatus","Status","CustomPublishButton","PublishButton","CustomSaveDraftButton","SaveDraftButton","draftsEnabled","CustomSaveButton","SaveButton","upload","Upload","controls","UploadControls","renderDocumentSlotsHandler","collections","config","Error","docPermissions","data","permissions"],"sources":["../../../src/views/Document/renderDocumentSlots.tsx"],"sourcesContent":["import type {\n  BeforeDocumentControlsServerPropsOnly,\n  DocumentSlots,\n  EditMenuItemsServerPropsOnly,\n  PayloadRequest,\n  PreviewButtonServerPropsOnly,\n  PublishButtonServerPropsOnly,\n  SanitizedCollectionConfig,\n  SanitizedDocumentPermissions,\n  SanitizedGlobalConfig,\n  SaveButtonServerPropsOnly,\n  SaveDraftButtonServerPropsOnly,\n  ServerFunction,\n  ServerProps,\n  StaticDescription,\n  ViewDescriptionClientProps,\n  ViewDescriptionServerPropsOnly,\n} from 'payload'\n\nimport { ViewDescription } from '@payloadcms/ui'\nimport { RenderServerComponent } from '@payloadcms/ui/elements/RenderServerComponent'\nimport { hasDraftsEnabled } from 'payload/shared'\n\nimport { getDocumentPermissions } from './getDocumentPermissions.js'\n\nexport const renderDocumentSlots: (args: {\n  collectionConfig?: SanitizedCollectionConfig\n  globalConfig?: SanitizedGlobalConfig\n  hasSavePermission: boolean\n  id?: number | string\n  permissions: SanitizedDocumentPermissions\n  req: PayloadRequest\n}) => DocumentSlots = (args) => {\n  const { id, collectionConfig, globalConfig, hasSavePermission, req } = args\n\n  const components: DocumentSlots = {} as DocumentSlots\n\n  const unsavedDraftWithValidations = undefined\n\n  const isPreviewEnabled = collectionConfig?.admin?.preview || globalConfig?.admin?.preview\n\n  const serverProps: ServerProps = {\n    id,\n    i18n: req.i18n,\n    payload: req.payload,\n    user: req.user,\n    // TODO: Add remaining serverProps\n  }\n\n  const BeforeDocumentControls =\n    collectionConfig?.admin?.components?.edit?.beforeDocumentControls ||\n    globalConfig?.admin?.components?.elements?.beforeDocumentControls\n\n  if (BeforeDocumentControls) {\n    components.BeforeDocumentControls = RenderServerComponent({\n      Component: BeforeDocumentControls,\n      importMap: req.payload.importMap,\n      serverProps: serverProps satisfies BeforeDocumentControlsServerPropsOnly,\n    })\n  }\n\n  const EditMenuItems = collectionConfig?.admin?.components?.edit?.editMenuItems\n\n  if (EditMenuItems) {\n    components.EditMenuItems = RenderServerComponent({\n      Component: EditMenuItems,\n      importMap: req.payload.importMap,\n      serverProps: serverProps satisfies EditMenuItemsServerPropsOnly,\n    })\n  }\n\n  const CustomPreviewButton =\n    collectionConfig?.admin?.components?.edit?.PreviewButton ||\n    globalConfig?.admin?.components?.elements?.PreviewButton\n\n  if (isPreviewEnabled && CustomPreviewButton) {\n    components.PreviewButton = RenderServerComponent({\n      Component: CustomPreviewButton,\n      importMap: req.payload.importMap,\n      serverProps: serverProps satisfies PreviewButtonServerPropsOnly,\n    })\n  }\n\n  const LivePreview =\n    collectionConfig?.admin?.components?.views?.edit?.livePreview ||\n    globalConfig?.admin?.components?.views?.edit?.livePreview\n\n  if (LivePreview?.Component) {\n    components.LivePreview = RenderServerComponent({\n      Component: LivePreview.Component,\n      importMap: req.payload.importMap,\n      serverProps,\n    })\n  }\n\n  const descriptionFromConfig =\n    collectionConfig?.admin?.description || globalConfig?.admin?.description\n\n  const staticDescription: StaticDescription =\n    typeof descriptionFromConfig === 'function'\n      ? descriptionFromConfig({ t: req.i18n.t })\n      : descriptionFromConfig\n\n  const CustomDescription =\n    collectionConfig?.admin?.components?.Description ||\n    globalConfig?.admin?.components?.elements?.Description\n\n  const hasDescription = CustomDescription || staticDescription\n\n  if (hasDescription) {\n    components.Description = RenderServerComponent({\n      clientProps: {\n        collectionSlug: collectionConfig?.slug,\n        description: staticDescription,\n      } satisfies ViewDescriptionClientProps,\n      Component: CustomDescription,\n      Fallback: ViewDescription,\n      importMap: req.payload.importMap,\n      serverProps: serverProps satisfies ViewDescriptionServerPropsOnly,\n    })\n  }\n\n  if (collectionConfig?.versions?.drafts || globalConfig?.versions?.drafts) {\n    const CustomStatus =\n      collectionConfig?.admin?.components?.edit?.Status ||\n      globalConfig?.admin?.components?.elements?.Status\n\n    if (CustomStatus) {\n      components.Status = RenderServerComponent({\n        Component: CustomStatus,\n        importMap: req.payload.importMap,\n        serverProps,\n      })\n    }\n  }\n\n  if (hasSavePermission) {\n    if (hasDraftsEnabled(collectionConfig || globalConfig)) {\n      const CustomPublishButton =\n        collectionConfig?.admin?.components?.edit?.PublishButton ||\n        globalConfig?.admin?.components?.elements?.PublishButton\n\n      if (CustomPublishButton) {\n        components.PublishButton = RenderServerComponent({\n          Component: CustomPublishButton,\n          importMap: req.payload.importMap,\n          serverProps: serverProps satisfies PublishButtonServerPropsOnly,\n        })\n      }\n\n      const CustomSaveDraftButton =\n        collectionConfig?.admin?.components?.edit?.SaveDraftButton ||\n        globalConfig?.admin?.components?.elements?.SaveDraftButton\n\n      const draftsEnabled = hasDraftsEnabled(collectionConfig || globalConfig)\n\n      if ((draftsEnabled || unsavedDraftWithValidations) && CustomSaveDraftButton) {\n        components.SaveDraftButton = RenderServerComponent({\n          Component: CustomSaveDraftButton,\n          importMap: req.payload.importMap,\n          serverProps: serverProps satisfies SaveDraftButtonServerPropsOnly,\n        })\n      }\n    } else {\n      const CustomSaveButton =\n        collectionConfig?.admin?.components?.edit?.SaveButton ||\n        globalConfig?.admin?.components?.elements?.SaveButton\n\n      if (CustomSaveButton) {\n        components.SaveButton = RenderServerComponent({\n          Component: CustomSaveButton,\n          importMap: req.payload.importMap,\n          serverProps: serverProps satisfies SaveButtonServerPropsOnly,\n        })\n      }\n    }\n  }\n\n  if (collectionConfig?.upload && collectionConfig?.admin?.components?.edit?.Upload) {\n    components.Upload = RenderServerComponent({\n      Component: collectionConfig.admin.components.edit.Upload,\n      importMap: req.payload.importMap,\n      serverProps,\n    })\n  }\n\n  if (collectionConfig?.upload && collectionConfig.upload.admin?.components?.controls) {\n    components.UploadControls = RenderServerComponent({\n      Component: collectionConfig.upload.admin.components.controls,\n      importMap: req.payload.importMap,\n      serverProps,\n    })\n  }\n\n  return components\n}\n\nexport const renderDocumentSlotsHandler: ServerFunction<{\n  collectionSlug: string\n  id?: number | string\n}> = async (args) => {\n  const { id, collectionSlug, req } = args\n\n  const collectionConfig = req.payload.collections[collectionSlug]?.config\n\n  if (!collectionConfig) {\n    throw new Error(req.t('error:incorrectCollection'))\n  }\n\n  const { docPermissions, hasSavePermission } = await getDocumentPermissions({\n    collectionConfig,\n    data: {},\n    req,\n  })\n\n  return renderDocumentSlots({\n    id,\n    collectionConfig,\n    hasSavePermission,\n    permissions: docPermissions,\n    req,\n  })\n}\n"],"mappings":"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","ignoreList":[]}