{"version":3,"file":"getDocumentPermissions.js","names":["hasSavePermission","getHasSavePermission","isEditing","getIsEditing","docAccessOperation","docAccessOperationGlobal","logError","hasDraftsEnabled","getDocumentPermissions","args","id","collectionConfig","data","globalConfig","req","docPermissions","hasPublishPermission","collection","config","_status","update","err","payload","collectionSlug","slug","globalSlug"],"sources":["../../../src/views/Document/getDocumentPermissions.tsx"],"sourcesContent":["import type {\n  Data,\n  PayloadRequest,\n  SanitizedCollectionConfig,\n  SanitizedDocumentPermissions,\n  SanitizedGlobalConfig,\n} from 'payload'\n\nimport {\n  hasSavePermission as getHasSavePermission,\n  isEditing as getIsEditing,\n} from '@payloadcms/ui/shared'\nimport { docAccessOperation, docAccessOperationGlobal, logError } from 'payload'\nimport { hasDraftsEnabled } from 'payload/shared'\n\nexport const getDocumentPermissions = async (args: {\n  collectionConfig?: SanitizedCollectionConfig\n  data: Data\n  globalConfig?: SanitizedGlobalConfig\n  /**\n   * When called for creating a new document, id is not provided.\n   */\n  id?: number | string\n  req: PayloadRequest\n}): Promise<{\n  docPermissions: SanitizedDocumentPermissions\n  hasPublishPermission: boolean\n  hasSavePermission: boolean\n}> => {\n  const { id, collectionConfig, data = {}, globalConfig, req } = args\n\n  let docPermissions: SanitizedDocumentPermissions\n  let hasPublishPermission = false\n\n  if (collectionConfig) {\n    try {\n      docPermissions = await docAccessOperation({\n        id,\n        collection: {\n          config: collectionConfig,\n        },\n        data: {\n          ...data,\n          _status: 'draft',\n        },\n        req,\n      })\n\n      if (hasDraftsEnabled(collectionConfig)) {\n        hasPublishPermission = (\n          await docAccessOperation({\n            id,\n            collection: {\n              config: collectionConfig,\n            },\n            data: {\n              ...data,\n              _status: 'published',\n            },\n            req,\n          })\n        ).update\n      }\n    } catch (err) {\n      logError({ err, payload: req.payload })\n    }\n  }\n\n  if (globalConfig) {\n    try {\n      docPermissions = await docAccessOperationGlobal({\n        data,\n        globalConfig,\n        req,\n      })\n\n      if (hasDraftsEnabled(globalConfig)) {\n        hasPublishPermission = (\n          await docAccessOperationGlobal({\n            data: {\n              ...data,\n              _status: 'published',\n            },\n            globalConfig,\n            req,\n          })\n        ).update\n      }\n    } catch (err) {\n      logError({ err, payload: req.payload })\n    }\n  }\n\n  const hasSavePermission = getHasSavePermission({\n    collectionSlug: collectionConfig?.slug,\n    docPermissions,\n    globalSlug: globalConfig?.slug,\n    isEditing: getIsEditing({\n      id,\n      collectionSlug: collectionConfig?.slug,\n      globalSlug: globalConfig?.slug,\n    }),\n  })\n\n  return {\n    docPermissions,\n    hasPublishPermission,\n    hasSavePermission,\n  }\n}\n"],"mappings":"AAQA,SACEA,iBAAA,IAAqBC,oBAAoB,EACzCC,SAAA,IAAaC,YAAY,QACpB;AACP,SAASC,kBAAkB,EAAEC,wBAAwB,EAAEC,QAAQ,QAAQ;AACvE,SAASC,gBAAgB,QAAQ;AAEjC,OAAO,MAAMC,sBAAA,GAAyB,MAAOC,IAAA;EAc3C,MAAM;IAAEC,EAAE;IAAEC,gBAAgB;IAAEC,IAAA,GAAO,CAAC,CAAC;IAAEC,YAAY;IAAEC;EAAG,CAAE,GAAGL,IAAA;EAE/D,IAAIM,cAAA;EACJ,IAAIC,oBAAA,GAAuB;EAE3B,IAAIL,gBAAA,EAAkB;IACpB,IAAI;MACFI,cAAA,GAAiB,MAAMX,kBAAA,CAAmB;QACxCM,EAAA;QACAO,UAAA,EAAY;UACVC,MAAA,EAAQP;QACV;QACAC,IAAA,EAAM;UACJ,GAAGA,IAAI;UACPO,OAAA,EAAS;QACX;QACAL;MACF;MAEA,IAAIP,gBAAA,CAAiBI,gBAAA,GAAmB;QACtCK,oBAAA,GAAuB,CACrB,MAAMZ,kBAAA,CAAmB;UACvBM,EAAA;UACAO,UAAA,EAAY;YACVC,MAAA,EAAQP;UACV;UACAC,IAAA,EAAM;YACJ,GAAGA,IAAI;YACPO,OAAA,EAAS;UACX;UACAL;QACF,EAAC,EACDM,MAAM;MACV;IACF,EAAE,OAAOC,GAAA,EAAK;MACZf,QAAA,CAAS;QAAEe,GAAA;QAAKC,OAAA,EAASR,GAAA,CAAIQ;MAAQ;IACvC;EACF;EAEA,IAAIT,YAAA,EAAc;IAChB,IAAI;MACFE,cAAA,GAAiB,MAAMV,wBAAA,CAAyB;QAC9CO,IAAA;QACAC,YAAA;QACAC;MACF;MAEA,IAAIP,gBAAA,CAAiBM,YAAA,GAAe;QAClCG,oBAAA,GAAuB,CACrB,MAAMX,wBAAA,CAAyB;UAC7BO,IAAA,EAAM;YACJ,GAAGA,IAAI;YACPO,OAAA,EAAS;UACX;UACAN,YAAA;UACAC;QACF,EAAC,EACDM,MAAM;MACV;IACF,EAAE,OAAOC,GAAA,EAAK;MACZf,QAAA,CAAS;QAAEe,GAAA;QAAKC,OAAA,EAASR,GAAA,CAAIQ;MAAQ;IACvC;EACF;EAEA,MAAMtB,iBAAA,GAAoBC,oBAAA,CAAqB;IAC7CsB,cAAA,EAAgBZ,gBAAA,EAAkBa,IAAA;IAClCT,cAAA;IACAU,UAAA,EAAYZ,YAAA,EAAcW,IAAA;IAC1BtB,SAAA,EAAWC,YAAA,CAAa;MACtBO,EAAA;MACAa,cAAA,EAAgBZ,gBAAA,EAAkBa,IAAA;MAClCC,UAAA,EAAYZ,YAAA,EAAcW;IAC5B;EACF;EAEA,OAAO;IACLT,cAAA;IACAC,oBAAA;IACAhB;EACF;AACF","ignoreList":[]}