{"version":3,"file":"index.js","names":["DocumentInfoProvider","EditDepthProvider","HydrateAuthProvider","LivePreviewProvider","RenderServerComponent","handleLivePreview","handlePreview","isEditing","getIsEditing","buildFormState","notFound","redirect","isolateObjectProperty","logError","formatAdminURL","hasAutosaveEnabled","hasDraftsEnabled","React","DocumentHeader","getPreferences","NotFoundView","getDocPreferences","getDocumentData","getDocumentPermissions","getDocumentView","getIsLocked","getMetaBySegment","getVersions","renderDocumentSlots","generateMetadata","args","renderDocument","disableActions","documentSubViewType","drawerSlug","importMap","initialData","initPageResult","overrideEntityVisibility","params","redirectAfterCreate","redirectAfterDelete","redirectAfterDuplicate","redirectAfterRestore","searchParams","versions","viewType","collectionConfig","docID","idFromArgs","globalConfig","locale","permissions","req","i18n","payload","config","routes","admin","adminRoute","api","apiRoute","serverURL","user","visibleEntities","segments","Array","isArray","collectionSlug","slug","undefined","globalSlug","id","doc","redirectURL","path","encodeURIComponent","Error","isTrashedDoc","Boolean","deletedAt","reqForPermissions","transactionID","reqForLockCheck","docPreferences","docPermissions","hasPublishPermission","hasSavePermission","currentEditor","isLocked","lastUpdateTime","entityPreferences","Promise","all","data","collection","operation","hasPublishedDoc","mostRecentVersionIsAutosaved","unpublishedVersionCount","versionCount","state","formState","code","fallbackLocale","readOnly","renderAllFields","schemaPath","skipValidation","documentViewServerProps","routeSegments","collections","find","visibleSlug","globals","formattedParams","URLSearchParams","append","apiQueryParams","toString","apiURL","View","showHeader","RootViewOverride","components","views","edit","root","Component","shouldAutosave","validateDraftData","drafts","validate","create","depth","draft","documentSlots","Description","clientProps","isLivePreviewEnabled","livePreviewConfig","livePreviewURL","isPreviewEnabled","previewURL","Document","_jsx","initialState","isTrashed","_jsxs","breakpoints","isLivePreviewing","value","editViewType","typeofLivePreviewURL","url","AfterHeader","serverProps","DocumentView","props","RenderedDocument","error","message","err"],"sources":["../../../src/views/Document/index.tsx"],"sourcesContent":["import type {\n  AdminViewServerProps,\n  CollectionPreferences,\n  Data,\n  DocumentViewClientProps,\n  DocumentViewServerProps,\n  DocumentViewServerPropsOnly,\n  EditViewComponent,\n  PayloadComponent,\n  RenderDocumentVersionsProperties,\n} from 'payload'\n\nimport {\n  DocumentInfoProvider,\n  EditDepthProvider,\n  HydrateAuthProvider,\n  LivePreviewProvider,\n} from '@payloadcms/ui'\nimport { RenderServerComponent } from '@payloadcms/ui/elements/RenderServerComponent'\nimport { handleLivePreview, handlePreview } from '@payloadcms/ui/rsc'\nimport { isEditing as getIsEditing } from '@payloadcms/ui/shared'\nimport { buildFormState } from '@payloadcms/ui/utilities/buildFormState'\nimport { notFound, redirect } from 'next/navigation.js'\nimport { isolateObjectProperty, logError } from 'payload'\nimport { formatAdminURL, hasAutosaveEnabled, hasDraftsEnabled } from 'payload/shared'\nimport React from 'react'\n\nimport type { GenerateEditViewMetadata } from './getMetaBySegment.js'\n\nimport { DocumentHeader } from '../../elements/DocumentHeader/index.js'\nimport { getPreferences } from '../../utilities/getPreferences.js'\nimport { NotFoundView } from '../NotFound/index.js'\nimport { getDocPreferences } from './getDocPreferences.js'\nimport { getDocumentData } from './getDocumentData.js'\nimport { getDocumentPermissions } from './getDocumentPermissions.js'\nimport { getDocumentView } from './getDocumentView.js'\nimport { getIsLocked } from './getIsLocked.js'\nimport { getMetaBySegment } from './getMetaBySegment.js'\nimport { getVersions } from './getVersions.js'\nimport { renderDocumentSlots } from './renderDocumentSlots.js'\n\nexport const generateMetadata: GenerateEditViewMetadata = async (args) => getMetaBySegment(args)\n\nexport type ViewToRender =\n  | EditViewComponent\n  | PayloadComponent<DocumentViewServerProps>\n  | React.FC\n  | React.FC<DocumentViewClientProps>\n\n/**\n * This function is responsible for rendering\n * an Edit Document view on the server for both:\n *  - default document edit views\n *  - on-demand edit views within drawers\n */\nexport const renderDocument = async ({\n  disableActions,\n  documentSubViewType,\n  drawerSlug,\n  importMap,\n  initialData,\n  initPageResult,\n  overrideEntityVisibility,\n  params,\n  redirectAfterCreate,\n  redirectAfterDelete,\n  redirectAfterDuplicate,\n  redirectAfterRestore,\n  searchParams,\n  versions,\n  viewType,\n}: {\n  drawerSlug?: string\n  overrideEntityVisibility?: boolean\n  readonly redirectAfterCreate?: boolean\n  readonly redirectAfterDelete?: boolean\n  readonly redirectAfterDuplicate?: boolean\n  readonly redirectAfterRestore?: boolean\n  versions?: RenderDocumentVersionsProperties\n} & AdminViewServerProps): Promise<{\n  data: Data\n  Document: React.ReactNode\n}> => {\n  const {\n    collectionConfig,\n    docID: idFromArgs,\n    globalConfig,\n    locale,\n    permissions,\n    req,\n    req: {\n      i18n,\n      payload,\n      payload: {\n        config,\n        config: {\n          routes: { admin: adminRoute, api: apiRoute },\n          serverURL,\n        },\n      },\n      user,\n    },\n    visibleEntities,\n  } = initPageResult\n\n  const segments = Array.isArray(params?.segments) ? params.segments : []\n  const collectionSlug = collectionConfig?.slug || undefined\n  const globalSlug = globalConfig?.slug || undefined\n  let isEditing = getIsEditing({ id: idFromArgs, collectionSlug, globalSlug })\n\n  // Fetch the doc required for the view\n  let doc =\n    !idFromArgs && !globalSlug\n      ? initialData || null\n      : await getDocumentData({\n          id: idFromArgs,\n          collectionSlug,\n          globalSlug,\n          locale,\n          payload,\n          req,\n          segments,\n          user,\n        })\n\n  if (isEditing && !doc) {\n    // If it's a collection document that doesn't exist, redirect to collection list\n    if (collectionSlug) {\n      const redirectURL = formatAdminURL({\n        adminRoute,\n        path: `/collections/${collectionSlug}?notFound=${encodeURIComponent(idFromArgs)}`,\n      })\n      redirect(redirectURL)\n    } else {\n      // For globals or other cases, keep the 404 behavior\n      throw new Error('not-found')\n    }\n  }\n\n  const isTrashedDoc = Boolean(doc && 'deletedAt' in doc && typeof doc?.deletedAt === 'string')\n\n  // CRITICAL FIX FOR TRANSACTION RACE CONDITION:\n  // When running parallel operations with Promise.all, if they share the same req object\n  // and one operation calls initTransaction() which MUTATES req.transactionID, that mutation\n  // is visible to all parallel operations. This causes:\n  // 1. Operation A (e.g., getDocumentPermissions → docAccessOperation) calls initTransaction()\n  //    which sets req.transactionID = Promise, then resolves it to a UUID\n  // 2. Operation B (e.g., getIsLocked) running in parallel receives the SAME req with the mutated transactionID\n  // 3. Operation A (does not even know that Operation B even exists and is stil using the transactionID) commits/ends its transaction\n  // 4. Operation B tries to use the now-expired session → MongoExpiredSessionError!\n  //\n  // Solution: Use isolateObjectProperty to create a Proxy that isolates the 'transactionID' property.\n  // This allows each operation to have its own transactionID without affecting the parent req.\n  // If parent req already has a transaction, preserve it (don't isolate), since this\n  // issue only arises when one of the operations calls initTransaction() themselves -\n  // because then, that operation will also try to commit/end the transaction itself.\n\n  // If the transactionID is already set, the parallel operations will not try to\n  // commit/end the transaction themselves, so we don't need to isolate the\n  // transactionID property.\n  const reqForPermissions = req.transactionID ? req : isolateObjectProperty(req, 'transactionID')\n  const reqForLockCheck = req.transactionID ? req : isolateObjectProperty(req, 'transactionID')\n\n  const [\n    docPreferences,\n    { docPermissions, hasPublishPermission, hasSavePermission },\n    { currentEditor, isLocked, lastUpdateTime },\n    entityPreferences,\n  ] = await Promise.all([\n    // Get document preferences\n    getDocPreferences({\n      id: idFromArgs,\n      collectionSlug,\n      globalSlug,\n      payload,\n      user,\n    }),\n\n    // Get permissions - isolated transactionID prevents cross-contamination\n    getDocumentPermissions({\n      id: idFromArgs,\n      collectionConfig,\n      data: doc,\n      globalConfig,\n      req: reqForPermissions,\n    }),\n\n    // Fetch document lock state - isolated transactionID prevents cross-contamination\n    getIsLocked({\n      id: idFromArgs,\n      collectionConfig,\n      globalConfig,\n      isEditing,\n      req: reqForLockCheck,\n    }),\n\n    // get entity preferences\n    getPreferences<CollectionPreferences>(\n      collectionSlug ? `collection-${collectionSlug}` : `global-${globalSlug}`,\n      payload,\n      req.user.id,\n      req.user.collection,\n    ),\n  ])\n\n  const operation = (collectionSlug && idFromArgs) || globalSlug ? 'update' : 'create'\n\n  const [\n    { hasPublishedDoc, mostRecentVersionIsAutosaved, unpublishedVersionCount, versionCount },\n    { state: formState },\n  ] = await Promise.all([\n    getVersions({\n      id: idFromArgs,\n      collectionConfig,\n      doc,\n      docPermissions,\n      globalConfig,\n      locale: locale?.code,\n      payload,\n      user,\n    }),\n    buildFormState({\n      id: idFromArgs,\n      collectionSlug,\n      data: doc,\n      docPermissions,\n      docPreferences,\n      fallbackLocale: false,\n      globalSlug,\n      locale: locale?.code,\n      operation,\n      readOnly: isTrashedDoc || isLocked,\n      renderAllFields: true,\n      req,\n      schemaPath: collectionSlug || globalSlug,\n      skipValidation: true,\n    }),\n  ])\n\n  const documentViewServerProps: DocumentViewServerPropsOnly = {\n    doc,\n    hasPublishedDoc,\n    i18n,\n    initPageResult,\n    locale,\n    params,\n    payload,\n    permissions,\n    routeSegments: segments,\n    searchParams,\n    user,\n    versions,\n  }\n\n  if (\n    !overrideEntityVisibility &&\n    ((collectionSlug &&\n      !visibleEntities?.collections?.find((visibleSlug) => visibleSlug === collectionSlug)) ||\n      (globalSlug && !visibleEntities?.globals?.find((visibleSlug) => visibleSlug === globalSlug)))\n  ) {\n    throw new Error('not-found')\n  }\n\n  const formattedParams = new URLSearchParams()\n\n  if (hasDraftsEnabled(collectionConfig || globalConfig)) {\n    formattedParams.append('draft', 'true')\n  }\n\n  if (locale?.code) {\n    formattedParams.append('locale', locale.code)\n  }\n\n  const apiQueryParams = `?${formattedParams.toString()}`\n\n  const apiURL = formatAdminURL({\n    apiRoute,\n    path: collectionSlug\n      ? `/${collectionSlug}/${idFromArgs}${apiQueryParams}`\n      : globalSlug\n        ? `/${globalSlug}${apiQueryParams}`\n        : '',\n  })\n\n  let View: ViewToRender = null\n\n  let showHeader = true\n\n  const RootViewOverride =\n    collectionConfig?.admin?.components?.views?.edit?.root &&\n    'Component' in collectionConfig.admin.components.views.edit.root\n      ? collectionConfig?.admin?.components?.views?.edit?.root?.Component\n      : globalConfig?.admin?.components?.views?.edit?.root &&\n          'Component' in globalConfig.admin.components.views.edit.root\n        ? globalConfig?.admin?.components?.views?.edit?.root?.Component\n        : null\n\n  if (RootViewOverride) {\n    View = RootViewOverride\n    showHeader = false\n  } else {\n    ;({ View } = getDocumentView({\n      collectionConfig,\n      config,\n      docPermissions,\n      globalConfig,\n      routeSegments: segments,\n    }))\n  }\n\n  if (!View) {\n    View = NotFoundView\n  }\n\n  /**\n   * Handle case where autoSave is enabled and the document is being created\n   * => create document and redirect\n   */\n  const shouldAutosave = hasSavePermission && hasAutosaveEnabled(collectionConfig || globalConfig)\n\n  const validateDraftData =\n    collectionConfig?.versions?.drafts && collectionConfig?.versions?.drafts?.validate\n\n  let id = idFromArgs\n\n  if (shouldAutosave && !validateDraftData && !idFromArgs && collectionSlug) {\n    doc = await payload.create({\n      collection: collectionSlug,\n      data: initialData || {},\n      depth: 0,\n      draft: true,\n      fallbackLocale: false,\n      locale: locale?.code,\n      req,\n      user,\n    })\n\n    if (doc?.id) {\n      id = doc.id\n      isEditing = getIsEditing({ id: doc.id, collectionSlug, globalSlug })\n\n      if (!drawerSlug && redirectAfterCreate !== false) {\n        const redirectURL = formatAdminURL({\n          adminRoute,\n          path: `/collections/${collectionSlug}/${doc.id}`,\n        })\n\n        redirect(redirectURL)\n      }\n    } else {\n      throw new Error('not-found')\n    }\n  }\n\n  const documentSlots = renderDocumentSlots({\n    id,\n    collectionConfig,\n    globalConfig,\n    hasSavePermission,\n    permissions: docPermissions,\n    req,\n  })\n\n  // Extract Description from documentSlots to pass to DocumentHeader\n  const { Description } = documentSlots\n\n  const clientProps: DocumentViewClientProps = {\n    formState,\n    ...documentSlots,\n    documentSubViewType,\n    viewType,\n  }\n\n  const { isLivePreviewEnabled, livePreviewConfig, livePreviewURL } = await handleLivePreview({\n    collectionSlug,\n    config,\n    data: doc,\n    globalSlug,\n    operation,\n    req,\n  })\n\n  const { isPreviewEnabled, previewURL } = await handlePreview({\n    collectionSlug,\n    config,\n    data: doc,\n    globalSlug,\n    operation,\n    req,\n  })\n\n  return {\n    data: doc,\n    Document: (\n      <DocumentInfoProvider\n        apiURL={apiURL}\n        collectionSlug={collectionConfig?.slug}\n        currentEditor={currentEditor}\n        disableActions={disableActions ?? false}\n        docPermissions={docPermissions}\n        globalSlug={globalConfig?.slug}\n        hasPublishedDoc={hasPublishedDoc}\n        hasPublishPermission={hasPublishPermission}\n        hasSavePermission={hasSavePermission}\n        id={id}\n        initialData={doc}\n        initialState={formState}\n        isEditing={isEditing}\n        isLocked={isLocked}\n        isTrashed={isTrashedDoc}\n        key={locale?.code}\n        lastUpdateTime={lastUpdateTime}\n        mostRecentVersionIsAutosaved={mostRecentVersionIsAutosaved}\n        redirectAfterCreate={redirectAfterCreate}\n        redirectAfterDelete={redirectAfterDelete}\n        redirectAfterDuplicate={redirectAfterDuplicate}\n        redirectAfterRestore={redirectAfterRestore}\n        unpublishedVersionCount={unpublishedVersionCount}\n        versionCount={versionCount}\n      >\n        <LivePreviewProvider\n          breakpoints={livePreviewConfig?.breakpoints}\n          isLivePreviewEnabled={isLivePreviewEnabled && operation !== 'create'}\n          isLivePreviewing={Boolean(\n            entityPreferences?.value?.editViewType === 'live-preview' && livePreviewURL,\n          )}\n          isPreviewEnabled={Boolean(isPreviewEnabled)}\n          previewURL={previewURL}\n          typeofLivePreviewURL={typeof livePreviewConfig?.url as 'function' | 'string' | undefined}\n          url={livePreviewURL}\n        >\n          {showHeader && !drawerSlug && (\n            <DocumentHeader\n              AfterHeader={Description}\n              collectionConfig={collectionConfig}\n              globalConfig={globalConfig}\n              permissions={permissions}\n              req={req}\n            />\n          )}\n          <HydrateAuthProvider permissions={permissions} />\n          <EditDepthProvider>\n            {RenderServerComponent({\n              clientProps,\n              Component: View,\n              importMap,\n              serverProps: documentViewServerProps,\n            })}\n          </EditDepthProvider>\n        </LivePreviewProvider>\n      </DocumentInfoProvider>\n    ),\n  }\n}\n\nexport async function DocumentView(props: AdminViewServerProps) {\n  try {\n    const { Document: RenderedDocument } = await renderDocument(props)\n    return RenderedDocument\n  } catch (error) {\n    if (error?.message === 'NEXT_REDIRECT') {\n      throw error\n    }\n\n    logError({ err: error, payload: props.initPageResult.req.payload })\n\n    if (error.message === 'not-found') {\n      notFound()\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}