---
title: Atomic Operations
label: Atomic Operations
order: 80
keywords: database, atomic, $inc, $push
desc: Perform atomic operations on documents.
---

Atomic operations let you update fields on a document without overwriting the whole record. This is useful when multiple processes might update the same document at the same time, such as with job queues or counters.

Currently, Payload supports the following atomic operators:

- **`$push`** â€” append one or more items to an array field
- **`$inc`** â€” increment or decrement a number field

These are only supported when using direct db calls (`payload.db.*`).

## `$push`

Use `$push` to append new items to an array. This works with both localized and unlocalized arrays. You can push a single item or an array of items in one call.

### Example: Push a single item

```ts
import mongoose from 'mongoose'

await payload.db.updateOne({
  collection: 'posts',
  id: post.id,
  data: {
    tags: {
      $push: {
        id: new mongoose.Types.ObjectId().toHexString(),
        text: 'new tag',
      },
    },
    // Performance optimization: skip setting updatedAt => results in 1 instead of 2 db roundtrips on postgres
    // updatedAt: null,
  },
})
```

### Example: Push multiple items

```ts
await payload.db.updateOne({
  collection: 'posts',
  id: post.id,
  data: {
    tags: {
      $push: [
        { id: new mongoose.Types.ObjectId().toHexString(), text: 'tag 1' },
        { id: new mongoose.Types.ObjectId().toHexString(), text: 'tag 2' },
      ],
    },
  },
})
```

### Example: Push to a localized array

```ts
await payload.db.updateOne({
  collection: 'posts',
  id: post.id,
  data: {
    tagsLocalized: {
      $push: {
        en: { id: new mongoose.Types.ObjectId().toHexString(), text: 'tag en' },
        es: [
          {
            text: 'tag es 1',
            id: new mongoose.Types.ObjectId().toHexString(),
          },
          {
            text: 'tag es 2',
            id: new mongoose.Types.ObjectId().toHexString(),
          },
        ],
      },
    },
  },
})
```

<Banner type="info">

**Performance tip:**
When pushing an item to an array in Postgres, the default behavior triggers **two database calls**:

1. Update the `updatedAt` column on the parent row.
2. Insert the new array element into the related table.

You can avoid the extra update by explicitly setting `updatedAt` to `null`. This skips the timestamp update and reduces the operation to a **single roundtrip**:

```ts
await payload.db.updateOne({
  collection: 'posts',
  id: post.id,
  data: {
    tags: {
      $push: {
        id: new mongoose.Types.ObjectId().toHexString(),
        text: 'new tag',
      },
    },
    updatedAt: null, // prevents automatic timestamp update
  },
})
```

</Banner>

## `$inc`

Use `$inc` to adjust a number field by a given amount. Positive values increment, negative values decrement.

This only works if the update data is "simple", meaning no:

- Arrays / Blocks
- Localized Fields
- `hasMany: true`` text / select / number / relationship fields
- relationship fields with relationTo as an array

## Example: Increment a counter

```ts
await payload.db.updateOne({
  collection: 'posts',
  id: post.id,
  data: {
    numberField: { $inc: 2 },
  },
})
```
